This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
Mare/
  1Mesa de trabajo 25.jpg
  Menu Bebidas.jpg
  Menu Comidas.jpg
  Menu Promociones.jpg
  Mesa de trabajo 13.jpg
  Mesa de trabajo 15.png
  Mesa de trabajo 16.png
  Mesa de trabajo 2 (1).png
  Mesa de trabajo 2 (2).png
  Mesa de trabajo 2.png
  Mesa de trabajo 4.png
  Mesa de trabajo 5.png
  Mesa de trabajo 9.png
public/
  assets/
    mare/
      marketing/
        mesa-15.png
        mesa-2-1.png
        mesa-25.jpg
        mesa-5.png
        mesa-9.png
      menu/
        bebidas.jpg
        comidas.jpg
        promociones.jpg
    perezoso/
      image-1.png
      image-2.png
      image-3.png
      image-4.png
      image-5.png
      image-6.png
      image-7.png
      image-8.png
      LogoPerezoso.png
  clients/
    mare_cafe/
      flyer_template_1_1769954037447.png
      flyer_template_2_1769954052827.png
      flyer_template_3_1769954068639.png
      logo.png
  file.svg
  globe.svg
  logo-mare.png
  next.svg
  perezoso-menu.html
  vercel.svg
  window.svg
Remodelacion MARE/
  mare-design-system.jsx
  mare-design-system.md
scripts/
  debug_keys.js
  fix_admin_role.js
  fix_admin_self.js
src/
  app/
    actions/
      marketing.ts
    admin/
      error.tsx
      page.tsx
    auth/
      login/
        page.tsx
    client/
      menu/
        page.tsx
      page.tsx
    promo/
      [id]/
        page.tsx
    staff/
      page.tsx
    test-qr/
      page.tsx
    unauthorized/
      page.tsx
    error.tsx
    favicon.ico
    globals.css
    layout.tsx
    manifest.ts
    page.tsx
  components/
    admin/
      dashboards/
        MareDashboard.tsx
        PerezosoDashboard.tsx
        StandardDashboard.tsx
      ClientsTab.tsx
      EmailEditor.tsx
    client/
      layouts/
        MareClient.tsx
        PerezosoClient.tsx
        StandardClient.tsx
      marketing/
        MarketingNotification.tsx
      menu/
        CategoryTabs.tsx
        MenuGalleryModal.tsx
        MenuHeader.tsx
        ProductDetailModal.tsx
        ProductGrid.tsx
      AboutUs.tsx
      BottomNav.tsx
      ClientHeader.tsx
      NewsFeed.tsx
      PromoBanner.tsx
      QRSheet.tsx
      StampProgress.tsx
    IOSInstallPrompt.tsx
    PoweredBy.tsx
    Scanner.tsx
  config/
    clients/
      mare_cafe.ts
      perezoso_cafe.ts
    types.ts
  context/
    ClientConfigContext.tsx
  data/
    menu-data.ts
  lib/
    shop-service.ts
    supabase-admin.ts
    supabase.ts
  types/
    menu.ts
supabase/
  migrations/
    02_phase2_schema.sql
    03_fix_function.sql
    04_rename_role.sql
    05_security_rules.sql
    06_redeem_logic.sql
    07_gamification.sql
    20240201173000_create_campaigns.sql
    20240204_client_features.sql
    20260208_add_client_code_to_stamps.sql
    20260208_add_missing_profile_cols.sql
    20260208_create_shops_table.sql
    20260208_fix_redeem_logic_dynamic.sql
    20260208_fix_schema_all.sql
    20260208_secure_pins.sql
    example_update_perezoso.sql
  schema.sql
.gitignore
Auditoria_v2_Mejoras_y_Rediseno.md
check_user_role.js
coffeinopia-redesign-preview.jsx
eslint.config.mjs
fix_admin_role.sql
formatodetrabajo.html
next.config.ts
package.json
postcss.config.mjs
README.md
tsconfig.json
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="public/file.svg">
<svg fill="none" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg"><path d="M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z" clip-rule="evenodd" fill="#666" fill-rule="evenodd"/></svg>
</file>

<file path="public/globe.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g clip-path="url(#a)"><path fill-rule="evenodd" clip-rule="evenodd" d="M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1" fill="#666"/></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h16v16H0z"/></clipPath></defs></svg>
</file>

<file path="public/next.svg">
<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 394 80"><path fill="#000" d="M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z"/><path fill="#000" d="M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z"/></svg>
</file>

<file path="public/perezoso-menu.html">
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perezoso Cafe - Pide y RelÃ¡jate</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'perezoso': {
                            'dark': '#2E2333',
                            'darker': '#1F181F',
                            'brown': '#3D2914',
                            'orange': '#F5A623',
                            'gold': '#FFAE00',
                            'cream': '#FFF5E1',
                            'cream-dark': '#E8D5B7',
                        }
                    },
                    fontFamily: {
                        'fredoka': ['Fredoka', 'sans-serif'],
                    },
                    borderRadius: {
                        '4xl': '2rem',
                        '5xl': '2.5rem',
                    }
                }
            }
        }
    </script>
    <style>
        * {
            font-family: 'Fredoka', sans-serif;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #2E2333;
        }
        ::-webkit-scrollbar-thumb {
            background: #F5A623;
            border-radius: 10px;
        }
        
        /* Smooth animations */
        .cart-bounce {
            animation: bounce 0.5s ease;
        }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .slide-up {
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from { transform: translateY(100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="bg-perezoso-dark min-h-screen" x-data="cafeApp()">

    <!-- Header Sticky -->
    <header class="sticky top-0 z-40 bg-perezoso-darker/95 backdrop-blur-md border-b border-perezoso-brown/30 shadow-lg">
        <div class="max-w-lg mx-auto px-4 py-3 flex items-center justify-between">
            <!-- Logo -->
            <div class="flex items-center gap-2">
                <img src="assets/perezoso/LogoPerezoso.png" alt="Perezoso Cafe" class="h-14 w-auto">
            </div>
            
            <!-- Cart Button -->
            <button 
                @click="cartOpen = true" 
                class="relative bg-perezoso-orange hover:bg-perezoso-gold text-perezoso-brown p-3 rounded-2xl transition-all duration-300 shadow-lg hover:shadow-perezoso-orange/30 hover:scale-105"
                :class="{ 'cart-bounce': cartAnimation }"
            >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                </svg>
                <!-- Cart Counter -->
                <span 
                    x-show="cartCount > 0" 
                    x-text="cartCount"
                    class="absolute -top-2 -right-2 bg-perezoso-cream text-perezoso-brown text-xs font-bold w-6 h-6 rounded-full flex items-center justify-center shadow-md"
                    x-transition
                ></span>
            </button>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="bg-gradient-to-b from-perezoso-darker to-perezoso-dark px-4 py-8 text-center">
        <h1 class="text-3xl font-bold text-perezoso-cream mb-2">Bienvenido, amigo ðŸ¦¥</h1>
        <p class="text-perezoso-cream-dark text-lg">Pide y relÃ¡jate... sin prisas</p>
    </section>

    <!-- Category Tabs -->
    <nav class="sticky top-[76px] z-30 bg-perezoso-dark border-b border-perezoso-brown/20 shadow-md">
        <div class="max-w-lg mx-auto px-4 py-3 flex gap-2 overflow-x-auto scrollbar-hide">
            <template x-for="category in categories" :key="category.id">
                <button 
                    @click="activeCategory = category.id"
                    :class="activeCategory === category.id 
                        ? 'bg-perezoso-orange text-perezoso-brown shadow-lg shadow-perezoso-orange/20' 
                        : 'bg-perezoso-brown/40 text-perezoso-cream hover:bg-perezoso-brown/60'"
                    class="px-5 py-2.5 rounded-3xl font-semibold whitespace-nowrap transition-all duration-300 text-sm"
                    x-text="category.name"
                ></button>
            </template>
        </div>
    </nav>

    <!-- Products Grid -->
    <main class="max-w-lg mx-auto px-4 py-6 pb-24">
        <div class="grid grid-cols-2 gap-4">
            <template x-for="product in filteredProducts" :key="product.id">
                <div 
                    @click="openProductModal(product)"
                    class="bg-perezoso-darker rounded-4xl overflow-hidden shadow-xl border border-perezoso-brown/20 hover:border-perezoso-orange/50 transition-all duration-300 hover:scale-[1.02] cursor-pointer group"
                >
                    <!-- Product Image -->
                    <div class="aspect-square bg-perezoso-brown/30 relative overflow-hidden">
                        <img 
                            :src="product.image" 
                            :alt="product.name"
                            class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"
                            onerror="this.src='https://placehold.co/300x300/3D2914/FFF5E1?text=ðŸ¦¥+Foto'"
                        >
                        <!-- Quick Add Button -->
                        <button 
                            @click.stop="addToCart(product)"
                            class="absolute bottom-3 right-3 bg-perezoso-orange hover:bg-perezoso-gold text-perezoso-brown w-10 h-10 rounded-2xl flex items-center justify-center shadow-lg transition-all duration-300 hover:scale-110"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                            </svg>
                        </button>
                    </div>
                    
                    <!-- Product Info -->
                    <div class="p-4">
                        <h3 class="text-perezoso-cream font-semibold text-sm mb-1 line-clamp-2" x-text="product.name"></h3>
                        <p class="text-perezoso-cream-dark text-xs mb-2 line-clamp-1" x-text="product.description"></p>
                        <p class="text-perezoso-orange font-bold text-lg">$<span x-text="product.price.toLocaleString()"></span></p>
                    </div>
                </div>
            </template>
        </div>
        
        <!-- Empty State -->
        <div x-show="filteredProducts.length === 0" class="text-center py-16">
            <span class="text-6xl mb-4 block">ðŸ¦¥</span>
            <p class="text-perezoso-cream-dark text-lg">AÃºn no hay productos aquÃ­...</p>
            <p class="text-perezoso-cream-dark/60 text-sm">Pero pronto llegarÃ¡n, sin prisa</p>
        </div>
    </main>

    <!-- Product Modal -->
    <div 
        x-show="productModalOpen" 
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 z-50 flex items-end justify-center bg-black/60 backdrop-blur-sm"
        @click.self="productModalOpen = false"
    >
        <div 
            x-show="productModalOpen"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="translate-y-full"
            x-transition:enter-end="translate-y-0"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="translate-y-0"
            x-transition:leave-end="translate-y-full"
            class="bg-perezoso-darker w-full max-w-lg rounded-t-5xl shadow-2xl max-h-[85vh] overflow-hidden"
        >
            <!-- Modal Header Image -->
            <div class="relative aspect-video bg-perezoso-brown/30">
                <img 
                    :src="selectedProduct?.image" 
                    :alt="selectedProduct?.name"
                    class="w-full h-full object-cover"
                    onerror="this.src='https://placehold.co/600x400/3D2914/FFF5E1?text=ðŸ¦¥+Foto'"
                >
                <button 
                    @click="productModalOpen = false"
                    class="absolute top-4 right-4 bg-perezoso-dark/80 text-perezoso-cream w-10 h-10 rounded-full flex items-center justify-center backdrop-blur-sm hover:bg-perezoso-orange hover:text-perezoso-brown transition-colors"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Modal Content -->
            <div class="p-6">
                <h2 class="text-2xl font-bold text-perezoso-cream mb-2" x-text="selectedProduct?.name"></h2>
                <p class="text-perezoso-cream-dark mb-4" x-text="selectedProduct?.description"></p>
                
                <!-- Quantity Selector -->
                <div class="flex items-center justify-between bg-perezoso-dark rounded-3xl p-4 mb-6">
                    <span class="text-perezoso-cream font-medium">Cantidad</span>
                    <div class="flex items-center gap-4">
                        <button 
                            @click="modalQuantity = Math.max(1, modalQuantity - 1)"
                            class="bg-perezoso-brown/50 text-perezoso-cream w-10 h-10 rounded-xl flex items-center justify-center hover:bg-perezoso-brown transition-colors"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M20 12H4" />
                            </svg>
                        </button>
                        <span class="text-perezoso-cream font-bold text-xl w-8 text-center" x-text="modalQuantity"></span>
                        <button 
                            @click="modalQuantity++"
                            class="bg-perezoso-orange text-perezoso-brown w-10 h-10 rounded-xl flex items-center justify-center hover:bg-perezoso-gold transition-colors"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" />
                            </svg>
                        </button>
                    </div>
                </div>
                
                <!-- Add to Cart Button -->
                <button 
                    @click="addToCartFromModal()"
                    class="w-full bg-perezoso-orange hover:bg-perezoso-gold text-perezoso-brown font-bold py-4 rounded-3xl transition-all duration-300 shadow-lg hover:shadow-perezoso-orange/30 flex items-center justify-center gap-3 text-lg"
                >
                    <span>Agregar al pedido</span>
                    <span class="bg-perezoso-brown/20 px-3 py-1 rounded-xl">$<span x-text="((selectedProduct?.price || 0) * modalQuantity).toLocaleString()"></span></span>
                </button>
            </div>
        </div>
    </div>

    <!-- Cart Slide-over -->
    <div 
        x-show="cartOpen" 
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="opacity-0"
        x-transition:enter-end="opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="opacity-100"
        x-transition:leave-end="opacity-0"
        class="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm"
        @click.self="cartOpen = false"
    >
        <div 
            x-show="cartOpen"
            x-transition:enter="transition ease-out duration-300"
            x-transition:enter-start="translate-x-full"
            x-transition:enter-end="translate-x-0"
            x-transition:leave="transition ease-in duration-200"
            x-transition:leave-start="translate-x-0"
            x-transition:leave-end="translate-x-full"
            class="absolute right-0 top-0 h-full w-full max-w-md bg-perezoso-darker shadow-2xl flex flex-col"
        >
            <!-- Cart Header -->
            <div class="flex items-center justify-between p-6 border-b border-perezoso-brown/30">
                <h2 class="text-2xl font-bold text-perezoso-cream flex items-center gap-2">
                    ðŸ¦¥ Tu Pedido
                </h2>
                <button 
                    @click="cartOpen = false"
                    class="text-perezoso-cream-dark hover:text-perezoso-cream p-2 rounded-xl hover:bg-perezoso-brown/30 transition-colors"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Cart Items -->
            <div class="flex-1 overflow-y-auto p-6">
                <!-- Empty Cart -->
                <div x-show="cart.length === 0" class="text-center py-16">
                    <span class="text-6xl mb-4 block">ðŸ˜´</span>
                    <p class="text-perezoso-cream-dark text-lg mb-2">Tu carrito estÃ¡ descansando...</p>
                    <p class="text-perezoso-cream-dark/60 text-sm">Agrega algo rico para comenzar</p>
                </div>
                
                <!-- Cart Items List -->
                <div x-show="cart.length > 0" class="space-y-4">
                    <template x-for="(item, index) in cart" :key="item.id + '-' + index">
                        <div class="bg-perezoso-dark rounded-3xl p-4 flex gap-4 items-center">
                            <img 
                                :src="item.image" 
                                :alt="item.name"
                                class="w-20 h-20 rounded-2xl object-cover"
                                onerror="this.src='https://placehold.co/100x100/3D2914/FFF5E1?text=ðŸ¦¥'"
                            >
                            <div class="flex-1 min-w-0">
                                <h3 class="text-perezoso-cream font-semibold text-sm truncate" x-text="item.name"></h3>
                                <p class="text-perezoso-orange font-bold">$<span x-text="item.price.toLocaleString()"></span></p>
                                
                                <!-- Quantity Controls -->
                                <div class="flex items-center gap-2 mt-2">
                                    <button 
                                        @click="decreaseQuantity(index)"
                                        class="bg-perezoso-brown/50 text-perezoso-cream w-7 h-7 rounded-lg flex items-center justify-center hover:bg-perezoso-brown transition-colors text-sm"
                                    >âˆ’</button>
                                    <span class="text-perezoso-cream font-medium w-6 text-center" x-text="item.quantity"></span>
                                    <button 
                                        @click="increaseQuantity(index)"
                                        class="bg-perezoso-orange text-perezoso-brown w-7 h-7 rounded-lg flex items-center justify-center hover:bg-perezoso-gold transition-colors text-sm"
                                    >+</button>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-perezoso-cream font-bold">$<span x-text="(item.price * item.quantity).toLocaleString()"></span></p>
                                <button 
                                    @click="removeFromCart(index)"
                                    class="text-red-400 hover:text-red-300 text-xs mt-1 hover:underline"
                                >Quitar</button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
            
            <!-- Cart Footer -->
            <div x-show="cart.length > 0" class="border-t border-perezoso-brown/30 p-6 bg-perezoso-darker">
                <div class="flex justify-between items-center mb-4">
                    <span class="text-perezoso-cream-dark text-lg">Total</span>
                    <span class="text-perezoso-cream text-2xl font-bold">$<span x-text="cartTotal.toLocaleString()"></span></span>
                </div>
                <button 
                    @click="checkout()"
                    class="w-full bg-perezoso-orange hover:bg-perezoso-gold text-perezoso-brown font-bold py-4 rounded-3xl transition-all duration-300 shadow-lg hover:shadow-perezoso-orange/30 text-lg"
                >
                    Pedir con calma ðŸ¦¥
                </button>
                <button 
                    @click="clearCart()"
                    class="w-full mt-3 text-perezoso-cream-dark hover:text-red-400 py-2 text-sm transition-colors"
                >
                    Vaciar carrito
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div 
        x-show="toastVisible"
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="translate-y-full opacity-0"
        x-transition:enter-end="translate-y-0 opacity-100"
        x-transition:leave="transition ease-in duration-200"
        x-transition:leave-start="translate-y-0 opacity-100"
        x-transition:leave-end="translate-y-full opacity-0"
        class="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-perezoso-orange text-perezoso-brown px-6 py-3 rounded-2xl shadow-lg font-medium flex items-center gap-2"
    >
        <span>âœ“</span>
        <span x-text="toastMessage"></span>
    </div>

    <script>
        function cafeApp() {
            return {
                activeCategory: 'cafes',
                cartOpen: false,
                productModalOpen: false,
                selectedProduct: null,
                modalQuantity: 1,
                cart: [],
                cartAnimation: false,
                toastVisible: false,
                toastMessage: '',
                
                categories: [
                    { id: 'cafes', name: 'â˜• CafÃ©s' },
                    { id: 'postres', name: 'ðŸ° Postres' },
                    { id: 'especiales', name: 'âœ¨ Especiales' },
                    { id: 'frios', name: 'ðŸ§Š FrÃ­os' },
                ],
                
                products: [
                    // CafÃ©s
                    { id: 1, category: 'cafes', name: 'Latte Perezoso', description: 'Espresso suave con leche cremosa', price: 4500, image: 'assets/perezoso/latte.jpg' },
                    { id: 2, category: 'cafes', name: 'Cappuccino Tranquilo', description: 'Espresso, leche espumada y canela', price: 4800, image: 'assets/perezoso/cappuccino.jpg' },
                    { id: 3, category: 'cafes', name: 'Americano Relajado', description: 'Espresso doble con agua caliente', price: 3500, image: 'assets/perezoso/americano.jpg' },
                    { id: 4, category: 'cafes', name: 'Mocha DormilÃ³n', description: 'Espresso, chocolate y crema', price: 5200, image: 'assets/perezoso/mocha.jpg' },
                    
                    // Postres
                    { id: 5, category: 'postres', name: 'Torta de Zanahoria', description: 'Con frosting de queso crema', price: 4200, image: 'assets/perezoso/carrot_cake.jpg' },
                    { id: 6, category: 'postres', name: 'Brownie Lento', description: 'Chocolate intenso con nueces', price: 3800, image: 'assets/perezoso/brownie.jpg' },
                    { id: 7, category: 'postres', name: 'Cheesecake Suave', description: 'Con coulis de frutos rojos', price: 4500, image: 'assets/perezoso/cheesecake.jpg' },
                    { id: 8, category: 'postres', name: 'Cinnamon Roll', description: 'ReciÃ©n horneado con glaseado', price: 3500, image: 'assets/perezoso/cinnamon.jpg' },
                    
                    // Especiales
                    { id: 9, category: 'especiales', name: 'Golden Sloth Latte', description: 'CÃºrcuma, jengibre y leche de avena', price: 5500, image: 'assets/perezoso/golden_latte.jpg' },
                    { id: 10, category: 'especiales', name: 'Matcha Slow', description: 'Matcha ceremonial con leche', price: 5800, image: 'assets/perezoso/matcha.jpg' },
                    { id: 11, category: 'especiales', name: 'Chai Perezoso', description: 'TÃ© chai especiado con espuma', price: 4800, image: 'assets/perezoso/chai.jpg' },
                    { id: 12, category: 'especiales', name: 'Affogato Feliz', description: 'Helado de vainilla con espresso', price: 5000, image: 'assets/perezoso/affogato.jpg' },
                    
                    // FrÃ­os
                    { id: 13, category: 'frios', name: 'Cold Brew Suave', description: 'CafÃ© frÃ­o de 12 horas', price: 4800, image: 'assets/perezoso/cold_brew.jpg' },
                    { id: 14, category: 'frios', name: 'FrappÃ© Chocolate', description: 'Helado y cremoso', price: 5500, image: 'assets/perezoso/frappe.jpg' },
                    { id: 15, category: 'frios', name: 'Limonada de Coco', description: 'Refrescante y tropical', price: 4000, image: 'assets/perezoso/limonada.jpg' },
                    { id: 16, category: 'frios', name: 'Iced Latte', description: 'Latte frÃ­o con hielo', price: 4500, image: 'assets/perezoso/iced_latte.jpg' },
                ],
                
                get filteredProducts() {
                    return this.products.filter(p => p.category === this.activeCategory);
                },
                
                get cartCount() {
                    return this.cart.reduce((sum, item) => sum + item.quantity, 0);
                },
                
                get cartTotal() {
                    return this.cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
                },
                
                openProductModal(product) {
                    this.selectedProduct = product;
                    this.modalQuantity = 1;
                    this.productModalOpen = true;
                },
                
                addToCart(product, quantity = 1) {
                    const existingIndex = this.cart.findIndex(item => item.id === product.id);
                    
                    if (existingIndex >= 0) {
                        this.cart[existingIndex].quantity += quantity;
                    } else {
                        this.cart.push({ ...product, quantity });
                    }
                    
                    this.triggerCartAnimation();
                    this.showToast('Agregado al pedido ðŸ¦¥');
                },
                
                addToCartFromModal() {
                    if (this.selectedProduct) {
                        this.addToCart(this.selectedProduct, this.modalQuantity);
                        this.productModalOpen = false;
                    }
                },
                
                increaseQuantity(index) {
                    this.cart[index].quantity++;
                },
                
                decreaseQuantity(index) {
                    if (this.cart[index].quantity > 1) {
                        this.cart[index].quantity--;
                    } else {
                        this.removeFromCart(index);
                    }
                },
                
                removeFromCart(index) {
                    this.cart.splice(index, 1);
                },
                
                clearCart() {
                    if (confirm('Â¿Vaciar el carrito?')) {
                        this.cart = [];
                        this.showToast('Carrito vaciado');
                    }
                },
                
                checkout() {
                    alert(`Â¡Pedido enviado! ðŸ¦¥\n\nTotal: $${this.cartTotal.toLocaleString()}\n\nGracias por tu paciencia, tu pedido llegarÃ¡... con calma.`);
                    this.cart = [];
                    this.cartOpen = false;
                },
                
                triggerCartAnimation() {
                    this.cartAnimation = true;
                    setTimeout(() => this.cartAnimation = false, 500);
                },
                
                showToast(message) {
                    this.toastMessage = message;
                    this.toastVisible = true;
                    setTimeout(() => this.toastVisible = false, 2000);
                }
            }
        }
    </script>
</body>
</html>
</file>

<file path="public/vercel.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1155 1000"><path d="m577.3 0 577.4 1000H0z" fill="#fff"/></svg>
</file>

<file path="public/window.svg">
<svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5" fill="#666"/></svg>
</file>

<file path="Remodelacion MARE/mare-design-system.jsx">
import { useState } from "react";

const COLORS = {
  primary: "#1A3278",
  primaryHover: "#243D8A",
  blueSoft: "#4A6BB5",
  surface: "#F2EDE3",
  canvas: "#FAF8F4",
  gold: "#C8A96E",
  goldLight: "#E8D5A0",
  ink: "#2A2A2E",
  stone: "#8C8B88",
  mist: "#E5E1D9",
  sage: "#5B8C6A",
  terracotta: "#C0574A",
};

const fonts = {
  serif: "'DM Serif Display', 'Playfair Display', Georgia, serif",
  sans: "'Plus Jakarta Sans', 'Outfit', system-ui, sans-serif",
  mono: "'JetBrains Mono', 'SF Mono', monospace",
};

const products = [
  { name: "Cappuccino", desc: "Espresso doble, leche texturizada", price: 2800, tag: null },
  { name: "Caramel Macchiato", desc: "Vainilla, espresso, caramelo", price: 3200, tag: "Popular" },
  { name: "Croissant Manteca", desc: "Masa hojaldrada, fermentaciÃ³n lenta", price: 2200, tag: "Nuevo" },
  { name: "Tarta de Frutos Rojos", desc: "Masa sablÃ©e, crema diplomÃ¡tica", price: 3500, tag: null },
];

const stamps = [true, true, true, false, false, false, false];

function CoffeeIcon({ filled = false, size = 24 }) {
  return (
    <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={filled ? COLORS.canvas : COLORS.gold} strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
      {filled && <circle cx="12" cy="12" r="11" fill={COLORS.primary} stroke="none" />}
      <path d={filled ? "M8 15c0 1.1.9 2 2 2h4a2 2 0 002-2v-4H8v4z" : "M6 17c0 1.1.9 2 2 2h8a2 2 0 002-2V9H6v8z"} stroke={filled ? COLORS.canvas : COLORS.gold} />
      <path d={filled ? "M16 11h1a2 2 0 010 4h-1" : "M18 9h1.5a2.5 2.5 0 010 5H18"} stroke={filled ? COLORS.canvas : COLORS.gold} />
      {!filled && <>
        <path d="M10 5c0-1 .5-2 1.5-2S13 4 13 5" stroke={COLORS.gold} opacity="0.5" />
        <path d="M7.5 5.5C7.5 4.5 8 3.5 9 3.5" stroke={COLORS.gold} opacity="0.3" />
      </>}
    </svg>
  );
}

function StarIcon({ size = 24 }) {
  return (
    <svg width={size} height={size} viewBox="0 0 24 24" fill="none">
      <defs>
        <linearGradient id="goldGrad" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stopColor={COLORS.gold} />
          <stop offset="50%" stopColor={COLORS.goldLight} />
          <stop offset="100%" stopColor={COLORS.gold} />
        </linearGradient>
      </defs>
      <path d="M12 2l2.4 7.4H22l-6.2 4.5 2.4 7.4L12 16.8l-6.2 4.5 2.4-7.4L2 9.4h7.6L12 2z" fill="url(#goldGrad)" stroke={COLORS.gold} strokeWidth="1" />
    </svg>
  );
}

function WaveLoader() {
  return (
    <svg width="48" height="20" viewBox="0 0 48 20">
      <style>{`
        @keyframes wave1 { 0%,100%{d:path('M0 12 Q6 6 12 12 Q18 18 24 12 Q30 6 36 12 Q42 18 48 12')} 50%{d:path('M0 12 Q6 18 12 12 Q18 6 24 12 Q30 18 36 12 Q42 6 48 12')} }
        @keyframes wave2 { 0%,100%{d:path('M0 14 Q6 8 12 14 Q18 20 24 14 Q30 8 36 14 Q42 20 48 14')} 50%{d:path('M0 14 Q6 20 12 14 Q18 8 24 14 Q30 20 36 14 Q42 8 48 14')} }
      `}</style>
      <path d="M0 12 Q6 6 12 12 Q18 18 24 12 Q30 6 36 12 Q42 18 48 12" fill="none" stroke={COLORS.primary} strokeWidth="1.5" strokeLinecap="round" opacity="0.7" style={{ animation: "wave1 2s ease-in-out infinite" }} />
      <path d="M0 14 Q6 8 12 14 Q18 20 24 14 Q30 8 36 14 Q42 20 48 14" fill="none" stroke={COLORS.blueSoft} strokeWidth="1.2" strokeLinecap="round" opacity="0.4" style={{ animation: "wave2 2s ease-in-out infinite 0.3s" }} />
    </svg>
  );
}

export default function MareDesignSystem() {
  const [activeTab, setActiveTab] = useState("palette");
  const [activeSize, setActiveSize] = useState("M");
  const [stampState, setStampState] = useState(stamps);
  const [hoverCard, setHoverCard] = useState(null);
  const [btnPressed, setBtnPressed] = useState(false);

  const tabs = [
    { id: "palette", label: "Paleta" },
    { id: "typography", label: "TipografÃ­a" },
    { id: "components", label: "Componentes" },
    { id: "screens", label: "Pantallas" },
  ];

  return (
    <div style={{ minHeight: "100vh", background: COLORS.canvas, fontFamily: fonts.sans, color: COLORS.ink }}>
      <style>{`
        @import url('https://fonts.googleapis.com/css2?family=DM+Serif+Display:ital@0;1&family=Plus+Jakarta+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');
        * { box-sizing: border-box; margin: 0; padding: 0; }
        @keyframes fadeUp { from { opacity:0; transform:translateY(8px) } to { opacity:1; transform:translateY(0) } }
        @keyframes stampBounce { 0%{transform:scale(0)} 60%{transform:scale(1.15)} 100%{transform:scale(1)} }
        @keyframes shimmer { 0%{background-position:-200% 0} 100%{background-position:200% 0} }
        @keyframes dotSlide { from{transform:translateX(var(--dot-from))} to{transform:translateX(0)} }
        .fade-up { animation: fadeUp 0.3s ease-out both; }
        .stamp-bounce { animation: stampBounce 0.5s cubic-bezier(0.34,1.56,0.64,1) both; }
      `}</style>

      {/* Header */}
      <div style={{
        position: "sticky", top: 0, zIndex: 50,
        background: "rgba(250,248,244,0.85)", backdropFilter: "blur(20px) saturate(1.4)",
        borderBottom: `0.5px solid ${COLORS.mist}`,
        padding: "16px 20px", display: "flex", alignItems: "center", justifyContent: "space-between"
      }}>
        <div>
          <h1 style={{ fontFamily: fonts.serif, fontSize: "22px", color: COLORS.primary, lineHeight: 1.1, letterSpacing: "-0.02em" }}>Mare</h1>
          <span style={{ fontSize: "11px", color: COLORS.stone, letterSpacing: "0.05em", textTransform: "uppercase" }}>Sistema de DiseÃ±o</span>
        </div>
        <WaveLoader />
      </div>

      {/* Tab Navigation */}
      <div style={{
        display: "flex", gap: "4px", padding: "12px 16px",
        borderBottom: `0.5px solid ${COLORS.mist}`, overflowX: "auto"
      }}>
        {tabs.map(t => (
          <button key={t.id} onClick={() => setActiveTab(t.id)} style={{
            padding: "8px 16px", borderRadius: "20px", border: "none", cursor: "pointer",
            fontFamily: fonts.sans, fontSize: "13px", fontWeight: 600, letterSpacing: "0.02em",
            background: activeTab === t.id ? COLORS.primary : "transparent",
            color: activeTab === t.id ? COLORS.surface : COLORS.stone,
            transition: "all 200ms ease"
          }}>
            {t.label}
          </button>
        ))}
      </div>

      {/* Content */}
      <div style={{ padding: "24px 20px 100px", maxWidth: 480, margin: "0 auto" }}>
        
        {activeTab === "palette" && (
          <div className="fade-up" style={{ display: "flex", flexDirection: "column", gap: 32 }}>
            <section>
              <h2 style={{ fontFamily: fonts.serif, fontSize: "24px", color: COLORS.primary, marginBottom: 16, letterSpacing: "-0.02em" }}>Colores Primarios</h2>
              <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr 1fr", gap: 12 }}>
                {[
                  { name: "Royal Blue", hex: COLORS.primary, text: "#fff" },
                  { name: "Parchment", hex: COLORS.surface, text: COLORS.ink },
                  { name: "Warm White", hex: COLORS.canvas, text: COLORS.ink },
                ].map(c => (
                  <div key={c.name} style={{
                    background: c.hex, color: c.text, padding: 16, borderRadius: 16,
                    border: `1px solid ${COLORS.mist}`, minHeight: 100,
                    display: "flex", flexDirection: "column", justifyContent: "flex-end"
                  }}>
                    <div style={{ fontSize: 12, fontWeight: 600, marginBottom: 2 }}>{c.name}</div>
                    <div style={{ fontSize: 11, fontFamily: fonts.mono, opacity: 0.7 }}>{c.hex}</div>
                  </div>
                ))}
              </div>
            </section>

            <section>
              <h2 style={{ fontFamily: fonts.serif, fontSize: "24px", color: COLORS.primary, marginBottom: 16, letterSpacing: "-0.02em" }}>Acentos & Neutrales</h2>
              <div style={{ display: "grid", gridTemplateColumns: "repeat(4, 1fr)", gap: 8 }}>
                {[
                  { name: "Espresso Gold", hex: COLORS.gold },
                  { name: "Mare Blue", hex: COLORS.blueSoft },
                  { name: "Sage", hex: COLORS.sage },
                  { name: "Terracotta", hex: COLORS.terracotta },
                  { name: "Ink", hex: COLORS.ink },
                  { name: "Stone", hex: COLORS.stone },
                  { name: "Mist", hex: COLORS.mist },
                  { name: "Canvas", hex: COLORS.canvas },
                ].map(c => (
                  <div key={c.name} style={{ textAlign: "center" }}>
                    <div style={{
                      width: "100%", aspectRatio: "1", borderRadius: 12, background: c.hex,
                      border: `1px solid ${COLORS.mist}`, marginBottom: 6
                    }} />
                    <div style={{ fontSize: 10, fontWeight: 500, color: COLORS.stone }}>{c.name}</div>
                    <div style={{ fontSize: 9, fontFamily: fonts.mono, color: COLORS.stone }}>{c.hex}</div>
                  </div>
                ))}
              </div>
            </section>

            <section>
              <h2 style={{ fontFamily: fonts.serif, fontSize: "24px", color: COLORS.primary, marginBottom: 16, letterSpacing: "-0.02em" }}>Gradientes</h2>
              <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
                <div style={{
                  background: `linear-gradient(175deg, #1A3278, #243D8A 45%, #2E4F9E)`,
                  padding: 24, borderRadius: 16, color: COLORS.surface
                }}>
                  <div style={{ fontSize: 13, fontWeight: 600 }}>Ocean Gradient</div>
                  <div style={{ fontSize: 11, opacity: 0.7, fontFamily: fonts.mono }}>Headers & Hero sections</div>
                </div>
                <div style={{
                  background: `linear-gradient(135deg, ${COLORS.gold}, ${COLORS.goldLight} 50%, ${COLORS.gold})`,
                  backgroundSize: "200% 100%", animation: "shimmer 3s linear infinite",
                  padding: 24, borderRadius: 16, color: COLORS.ink
                }}>
                  <div style={{ fontSize: 13, fontWeight: 600 }}>Gold Reward Shimmer</div>
                  <div style={{ fontSize: 11, opacity: 0.7, fontFamily: fonts.mono }}>Momentos de recompensa</div>
                </div>
                <div style={{
                  background: `rgba(242,237,227,0.72)`, backdropFilter: "blur(24px) saturate(1.4)",
                  padding: 24, borderRadius: 16, border: `1px solid ${COLORS.mist}`
                }}>
                  <div style={{ fontSize: 13, fontWeight: 600 }}>Glass Cream</div>
                  <div style={{ fontSize: 11, color: COLORS.stone, fontFamily: fonts.mono }}>Modales & overlays</div>
                </div>
              </div>
            </section>
          </div>
        )}

        {activeTab === "typography" && (
          <div className="fade-up" style={{ display: "flex", flexDirection: "column", gap: 40 }}>
            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 8 }}>Display â€” DM Serif Display</div>
              <div style={{ fontFamily: fonts.serif, fontSize: "clamp(2rem,5vw,3.5rem)", color: COLORS.primary, lineHeight: 1.05, letterSpacing: "-0.02em" }}>
                Mare CafÃ©
              </div>
            </section>

            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 8 }}>H1 â€” DM Serif Display</div>
              <div style={{ fontFamily: fonts.serif, fontSize: "clamp(1.5rem,3.5vw,2rem)", color: COLORS.ink, lineHeight: 1.15, letterSpacing: "-0.02em" }}>
                PastelerÃ­a artesanal y cafÃ© de especialidad
              </div>
            </section>

            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 8 }}>H2 â€” Plus Jakarta Sans 600</div>
              <div style={{ fontFamily: fonts.sans, fontSize: "1.25rem", fontWeight: 600, color: COLORS.ink, lineHeight: 1.3 }}>
                Nuestro menÃº del dÃ­a
              </div>
            </section>

            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 8 }}>Body â€” Plus Jakarta Sans 400</div>
              <div style={{ fontFamily: fonts.sans, fontSize: "15px", color: COLORS.ink, lineHeight: 1.6 }}>
                Cada maÃ±ana horneamos con masa madre, manteca francesa y harinas orgÃ¡nicas. Nuestro cafÃ© de especialidad viene de microlotes seleccionados de Huila, Colombia y Sidama, EtiopÃ­a.
              </div>
            </section>

            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 8 }}>Caption â€” Plus Jakarta Sans 500</div>
              <div style={{ fontFamily: fonts.sans, fontSize: "13px", fontWeight: 500, color: COLORS.stone, lineHeight: 1.5 }}>
                Belgrano 2268 Â· Mar del Plata Â· Lun a SÃ¡b 8:00â€“20:00
              </div>
            </section>

            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 8 }}>Mono â€” JetBrains Mono (precios)</div>
              <div style={{ fontFamily: fonts.mono, fontSize: "18px", fontWeight: 500, color: COLORS.primary }}>
                $3.200 <span style={{ fontSize: 13, color: COLORS.stone }}>ARS</span>
              </div>
            </section>

            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 8 }}>Nav Label</div>
              <div style={{ fontFamily: fonts.sans, fontSize: "11px", fontWeight: 600, letterSpacing: "0.08em", textTransform: "uppercase", color: COLORS.primary }}>
                INICIO &nbsp;&nbsp; MENÃš &nbsp;&nbsp; LEALTAD &nbsp;&nbsp; PERFIL
              </div>
            </section>
          </div>
        )}

        {activeTab === "components" && (
          <div className="fade-up" style={{ display: "flex", flexDirection: "column", gap: 32 }}>
            
            {/* Buttons */}
            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 16 }}>Botones</div>
              <div style={{ display: "flex", flexDirection: "column", gap: 12 }}>
                <button
                  onMouseDown={() => setBtnPressed(true)}
                  onMouseUp={() => setBtnPressed(false)}
                  onMouseLeave={() => setBtnPressed(false)}
                  style={{
                    background: COLORS.primary, color: COLORS.surface, border: "none",
                    padding: "14px 28px", borderRadius: 12, fontFamily: fonts.sans,
                    fontSize: 14, fontWeight: 600, cursor: "pointer", width: "100%",
                    transform: btnPressed ? "scale(0.97)" : "scale(1)",
                    transition: "all 200ms ease"
                  }}
                >
                  Agregar al carrito â€” $3.200
                </button>
                <button style={{
                  background: "transparent", color: COLORS.primary,
                  border: `1.5px solid ${COLORS.primary}`,
                  padding: "14px 28px", borderRadius: 12, fontFamily: fonts.sans,
                  fontSize: 14, fontWeight: 600, cursor: "pointer", width: "100%",
                  transition: "all 200ms ease"
                }}>
                  Ver detalles
                </button>
                <button style={{
                  background: "transparent", color: COLORS.blueSoft, border: "none",
                  padding: "8px 0", fontFamily: fonts.sans, fontSize: 14, fontWeight: 500,
                  cursor: "pointer", textDecoration: "underline", textUnderlineOffset: "3px",
                  textAlign: "left"
                }}>
                  Ver todos los productos â†’
                </button>
              </div>
            </section>

            {/* Size Selector */}
            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 16 }}>Selector de TamaÃ±o</div>
              <div style={{ display: "flex", gap: 8, background: COLORS.surface, padding: 4, borderRadius: 12, border: `1px solid ${COLORS.mist}` }}>
                {["S", "M", "L"].map(size => (
                  <button key={size} onClick={() => setActiveSize(size)} style={{
                    flex: 1, padding: "10px 0", borderRadius: 10, border: "none",
                    fontFamily: fonts.sans, fontSize: 14, fontWeight: 600, cursor: "pointer",
                    background: activeSize === size ? COLORS.primary : "transparent",
                    color: activeSize === size ? COLORS.surface : COLORS.stone,
                    transition: "all 200ms ease"
                  }}>
                    {size === "S" ? "Chico" : size === "M" ? "Mediano" : "Grande"}
                  </button>
                ))}
              </div>
            </section>

            {/* Input */}
            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 16 }}>Input Field</div>
              <div>
                <label style={{ display: "block", fontSize: 12, fontWeight: 500, marginBottom: 6, color: COLORS.ink }}>CÃ³digo promocional</label>
                <input
                  type="text"
                  placeholder="Ingresa tu cÃ³digo"
                  style={{
                    width: "100%", padding: "14px 16px", borderRadius: 12,
                    border: `1.5px solid ${COLORS.mist}`, fontFamily: fonts.sans, fontSize: 15,
                    outline: "none", background: COLORS.canvas, color: COLORS.ink,
                    transition: "border-color 200ms ease, box-shadow 200ms ease"
                  }}
                  onFocus={e => { e.target.style.borderColor = COLORS.primary; e.target.style.boxShadow = `0 0 0 3px rgba(26,50,120,0.1)` }}
                  onBlur={e => { e.target.style.borderColor = COLORS.mist; e.target.style.boxShadow = "none" }}
                />
              </div>
            </section>

            {/* Loyalty Card */}
            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 16 }}>Tarjeta de Fidelidad</div>
              <div style={{
                border: `1.5px solid ${COLORS.primary}`, borderRadius: 20, padding: 24,
                background: `linear-gradient(135deg, ${COLORS.surface}, ${COLORS.canvas})`,
              }}>
                <div style={{ fontFamily: fonts.serif, fontSize: 18, color: COLORS.primary, marginBottom: 4, letterSpacing: "-0.02em" }}>Tu Tarjeta Mare</div>
                <div style={{ fontSize: 13, color: COLORS.stone, marginBottom: 20 }}>3 de 7 para tu cafÃ© gratis</div>
                <div style={{ display: "flex", gap: 8, justifyContent: "center", marginBottom: 20 }}>
                  {stampState.map((filled, i) => (
                    <div key={i} onClick={() => {
                      if (!filled) {
                        const next = [...stampState];
                        next[i] = true;
                        setStampState(next);
                      }
                    }} style={{ cursor: filled ? "default" : "pointer" }}>
                      {i === 6 ? (
                        <div style={{
                          width: 36, height: 36, borderRadius: "50%",
                          display: "flex", alignItems: "center", justifyContent: "center",
                          background: stampState.every(Boolean)
                            ? `linear-gradient(135deg, ${COLORS.gold}, ${COLORS.goldLight}, ${COLORS.gold})`
                            : "transparent",
                          border: stampState.every(Boolean) ? "none" : `1.5px dashed ${COLORS.gold}`,
                        }}>
                          <StarIcon size={20} />
                        </div>
                      ) : (
                        <div className={filled ? "stamp-bounce" : ""} style={{
                          width: 36, height: 36, borderRadius: "50%",
                          display: "flex", alignItems: "center", justifyContent: "center",
                          border: filled ? "none" : `1.5px dashed ${COLORS.gold}`,
                          background: filled ? COLORS.primary : "transparent",
                          transition: "all 300ms ease"
                        }}>
                          {filled ? <CoffeeIcon filled size={20} /> : <CoffeeIcon size={18} />}
                        </div>
                      )}
                    </div>
                  ))}
                </div>
                <div style={{ height: 3, borderRadius: 2, background: COLORS.mist, overflow: "hidden" }}>
                  <div style={{
                    height: "100%", borderRadius: 2, background: COLORS.primary,
                    width: `${(stampState.filter(Boolean).length / 7) * 100}%`,
                    transition: "width 500ms ease"
                  }} />
                </div>
                <div style={{ fontSize: 11, color: COLORS.stone, marginTop: 6, textAlign: "right", fontFamily: fonts.mono }}>
                  {Math.round((stampState.filter(Boolean).length / 7) * 100)}%
                </div>
              </div>
              <div style={{ fontSize: 11, color: COLORS.stone, marginTop: 8, textAlign: "center" }}>
                Toca los cÃ­rculos vacÃ­os para simular un stamp â˜
              </div>
            </section>

            {/* Product Card */}
            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 16 }}>Product Card</div>
              <div style={{
                borderRadius: 16, border: `1px solid ${COLORS.mist}`, overflow: "hidden",
                background: COLORS.canvas, transition: "all 200ms ease",
                transform: hoverCard === "demo" ? "translateY(-2px)" : "none",
              }}
                onMouseEnter={() => setHoverCard("demo")}
                onMouseLeave={() => setHoverCard(null)}
              >
                <div style={{
                  aspectRatio: "4/3", background: `linear-gradient(135deg, ${COLORS.primary}, ${COLORS.blueSoft})`,
                  display: "flex", alignItems: "center", justifyContent: "center"
                }}>
                  <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                    <circle cx="32" cy="32" r="24" stroke={COLORS.surface} strokeWidth="1.5" opacity="0.3" />
                    <path d="M22 40c0 2.2 1.8 4 4 4h12a4 4 0 004-4V28H22v12z" stroke={COLORS.surface} strokeWidth="1.5" />
                    <path d="M42 28h3a5 5 0 010 10h-3" stroke={COLORS.surface} strokeWidth="1.5" />
                    <path d="M28 20c0-2 1-4 3-4s3 2 3 4" stroke={COLORS.surface} strokeWidth="1.5" opacity="0.5" />
                    <path d="M33 18c0-2 1-4 3-4" stroke={COLORS.surface} strokeWidth="1.5" opacity="0.3" />
                  </svg>
                </div>
                <div style={{ padding: "16px" }}>
                  <div style={{ fontFamily: fonts.serif, fontSize: 16, color: COLORS.ink, marginBottom: 2, letterSpacing: "-0.01em" }}>Cappuccino</div>
                  <div style={{ fontSize: 13, color: COLORS.stone, marginBottom: 12 }}>Leche texturizada, espresso doble</div>
                  <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center" }}>
                    <span style={{ fontFamily: fonts.mono, fontSize: 15, fontWeight: 500, color: COLORS.primary }}>$2.800</span>
                    <div style={{
                      width: 36, height: 36, borderRadius: "50%", background: COLORS.primary,
                      display: "flex", alignItems: "center", justifyContent: "center", cursor: "pointer"
                    }}>
                      <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                        <path d="M8 3v10M3 8h10" stroke={COLORS.surface} strokeWidth="2" strokeLinecap="round" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            </section>
          </div>
        )}

        {activeTab === "screens" && (
          <div className="fade-up" style={{ display: "flex", flexDirection: "column", gap: 32 }}>
            
            {/* Screen: Home */}
            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 16 }}>Pantalla â€” Home</div>
              <div style={{
                borderRadius: 24, overflow: "hidden", border: `1px solid ${COLORS.mist}`,
                background: COLORS.canvas, boxShadow: "0 4px 24px rgba(0,0,0,0.06)"
              }}>
                {/* Status bar mock */}
                <div style={{ background: COLORS.canvas, padding: "8px 20px", display: "flex", justifyContent: "space-between", fontSize: 12, fontWeight: 600, color: COLORS.ink }}>
                  <span>9:41</span>
                  <div style={{ display: "flex", gap: 4 }}>
                    <span>â—â—â—â—</span>
                    <span>WiFi</span>
                    <span>ðŸ”‹</span>
                  </div>
                </div>

                {/* Header */}
                <div style={{
                  background: `linear-gradient(175deg, #1A3278, #243D8A 45%, #2E4F9E)`,
                  padding: "24px 20px 32px", color: COLORS.surface
                }}>
                  <div style={{ display: "flex", justifyContent: "space-between", alignItems: "flex-start", marginBottom: 20 }}>
                    <div>
                      <div style={{ fontFamily: fonts.serif, fontSize: 28, letterSpacing: "-0.02em" }}>Mare</div>
                      <div style={{ fontSize: 11, opacity: 0.7, letterSpacing: "0.04em" }}>PastelerÃ­a y CafÃ©</div>
                    </div>
                    <div style={{
                      width: 40, height: 40, borderRadius: "50%", background: "rgba(255,255,255,0.12)",
                      display: "flex", alignItems: "center", justifyContent: "center"
                    }}>
                      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke={COLORS.surface} strokeWidth="1.5">
                        <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0" />
                      </svg>
                    </div>
                  </div>
                  <div style={{ fontSize: 18, fontWeight: 500, marginBottom: 4 }}>Hola, Valentina ðŸ‘‹</div>
                  <div style={{ fontSize: 13, opacity: 0.7 }}>Te faltan 4 cafÃ©s para tu recompensa</div>
                </div>

                {/* Loyalty Card Mini */}
                <div style={{ padding: "0 16px", marginTop: -16 }}>
                  <div style={{
                    background: COLORS.canvas, borderRadius: 16, padding: "16px 20px",
                    border: `1px solid ${COLORS.mist}`,
                    boxShadow: "0 2px 12px rgba(0,0,0,0.04)"
                  }}>
                    <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 12 }}>
                      <span style={{ fontFamily: fonts.serif, fontSize: 14, color: COLORS.primary }}>Tu Tarjeta</span>
                      <span style={{ fontSize: 11, fontFamily: fonts.mono, color: COLORS.stone }}>3/7</span>
                    </div>
                    <div style={{ display: "flex", gap: 6, justifyContent: "center" }}>
                      {stamps.map((f, i) => (
                        <div key={i} style={{
                          width: 28, height: 28, borderRadius: "50%",
                          background: f ? COLORS.primary : "transparent",
                          border: f ? "none" : `1px dashed ${COLORS.gold}`,
                          display: "flex", alignItems: "center", justifyContent: "center"
                        }}>
                          {f && <CoffeeIcon filled size={16} />}
                        </div>
                      ))}
                    </div>
                  </div>
                </div>

                {/* Quick Actions */}
                <div style={{ padding: "20px 16px 8px" }}>
                  <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.06em", textTransform: "uppercase", marginBottom: 12 }}>Acceso rÃ¡pido</div>
                  <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 10 }}>
                    {[
                      { icon: "ðŸ“–", label: "Ver MenÃº" },
                      { icon: "ðŸ“", label: "CÃ³mo llegar" },
                    ].map(a => (
                      <div key={a.label} style={{
                        padding: "14px 16px", borderRadius: 12, border: `1px solid ${COLORS.mist}`,
                        display: "flex", alignItems: "center", gap: 10, background: COLORS.canvas
                      }}>
                        <span style={{ fontSize: 18 }}>{a.icon}</span>
                        <span style={{ fontSize: 13, fontWeight: 500 }}>{a.label}</span>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Destacados */}
                <div style={{ padding: "16px 16px 24px" }}>
                  <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: 12 }}>
                    <span style={{ fontFamily: fonts.serif, fontSize: 18, color: COLORS.primary, letterSpacing: "-0.01em" }}>Destacados</span>
                    <span style={{ fontSize: 12, color: COLORS.blueSoft, fontWeight: 500, cursor: "pointer" }}>Ver todos â†’</span>
                  </div>
                  <div style={{ display: "flex", gap: 12, overflowX: "auto", paddingBottom: 4 }}>
                    {products.slice(0, 3).map((p, i) => (
                      <div key={i} style={{
                        minWidth: 140, borderRadius: 14, border: `1px solid ${COLORS.mist}`,
                        overflow: "hidden", background: COLORS.canvas, flexShrink: 0
                      }}>
                        <div style={{
                          height: 90, background: `linear-gradient(${135 + i * 30}deg, ${COLORS.primary}, ${COLORS.blueSoft})`,
                          display: "flex", alignItems: "center", justifyContent: "center", position: "relative"
                        }}>
                          <svg width="32" height="32" viewBox="0 0 64 64" fill="none">
                            <path d="M22 40c0 2.2 1.8 4 4 4h12a4 4 0 004-4V28H22v12z" stroke={COLORS.surface} strokeWidth="1.5" />
                            <path d="M42 28h3a5 5 0 010 10h-3" stroke={COLORS.surface} strokeWidth="1.5" />
                          </svg>
                          {p.tag && (
                            <span style={{
                              position: "absolute", top: 6, right: 6, fontSize: 9, fontWeight: 600,
                              background: p.tag === "Nuevo" ? COLORS.sage : COLORS.gold,
                              color: "#fff", padding: "2px 8px", borderRadius: 6, letterSpacing: "0.04em"
                            }}>{p.tag}</span>
                          )}
                        </div>
                        <div style={{ padding: "10px 12px" }}>
                          <div style={{ fontFamily: fonts.serif, fontSize: 13, marginBottom: 2 }}>{p.name}</div>
                          <div style={{ fontFamily: fonts.mono, fontSize: 12, color: COLORS.primary, fontWeight: 500 }}>${p.price.toLocaleString()}</div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                {/* Bottom Nav */}
                <div style={{
                  display: "flex", justifyContent: "space-around", padding: "12px 0 20px",
                  background: "rgba(250,248,244,0.9)", backdropFilter: "blur(20px)",
                  borderTop: `0.5px solid ${COLORS.mist}`
                }}>
                  {[
                    { icon: "âŒ‚", label: "INICIO", active: true },
                    { icon: "â˜•", label: "MENÃš", active: false },
                    { icon: "â™¥", label: "LEALTAD", active: false },
                    { icon: "â—¯", label: "PERFIL", active: false },
                  ].map(t => (
                    <div key={t.label} style={{ textAlign: "center", display: "flex", flexDirection: "column", alignItems: "center", gap: 4 }}>
                      <span style={{ fontSize: 18, opacity: t.active ? 1 : 0.4, color: COLORS.primary }}>{t.icon}</span>
                      <span style={{
                        fontSize: 9, fontWeight: 600, letterSpacing: "0.08em",
                        color: t.active ? COLORS.primary : COLORS.stone
                      }}>{t.label}</span>
                      {t.active && <div style={{ width: 4, height: 4, borderRadius: "50%", background: COLORS.primary }} />}
                    </div>
                  ))}
                </div>
              </div>
            </section>

            {/* Screen: Menu */}
            <section>
              <div style={{ fontSize: 11, color: COLORS.stone, letterSpacing: "0.08em", textTransform: "uppercase", marginBottom: 16 }}>Pantalla â€” MenÃº</div>
              <div style={{
                borderRadius: 24, overflow: "hidden", border: `1px solid ${COLORS.mist}`,
                background: COLORS.canvas, boxShadow: "0 4px 24px rgba(0,0,0,0.06)"
              }}>
                {/* Menu Header */}
                <div style={{ padding: "16px 20px", borderBottom: `0.5px solid ${COLORS.mist}` }}>
                  <div style={{ fontFamily: fonts.serif, fontSize: 24, color: COLORS.primary, letterSpacing: "-0.02em" }}>MenÃº</div>
                </div>

                {/* Categories */}
                <div style={{ display: "flex", gap: 6, padding: "12px 16px", overflowX: "auto" }}>
                  {["Todos", "CafÃ©", "PastelerÃ­a", "Brunch"].map((c, i) => (
                    <span key={c} style={{
                      padding: "6px 14px", borderRadius: 20, fontSize: 12, fontWeight: 600, whiteSpace: "nowrap",
                      background: i === 0 ? COLORS.primary : "transparent",
                      color: i === 0 ? COLORS.surface : COLORS.stone,
                      border: i === 0 ? "none" : `1px solid ${COLORS.mist}`
                    }}>{c}</span>
                  ))}
                </div>

                {/* Product List */}
                <div style={{ padding: "8px 16px 24px", display: "flex", flexDirection: "column", gap: 12 }}>
                  {products.map((p, i) => (
                    <div key={i} style={{
                      display: "flex", gap: 14, padding: 12, borderRadius: 14,
                      border: `1px solid ${COLORS.mist}`, background: COLORS.canvas, alignItems: "center"
                    }}>
                      <div style={{
                        width: 60, height: 60, borderRadius: 12, flexShrink: 0,
                        background: `linear-gradient(${135 + i * 25}deg, ${COLORS.primary}, ${COLORS.blueSoft})`,
                        display: "flex", alignItems: "center", justifyContent: "center"
                      }}>
                        <svg width="24" height="24" viewBox="0 0 64 64" fill="none">
                          <path d="M22 40c0 2.2 1.8 4 4 4h12a4 4 0 004-4V28H22v12z" stroke={COLORS.surface} strokeWidth="1.5" />
                        </svg>
                      </div>
                      <div style={{ flex: 1, minWidth: 0 }}>
                        <div style={{ fontFamily: fonts.serif, fontSize: 14, marginBottom: 2 }}>{p.name}</div>
                        <div style={{ fontSize: 11, color: COLORS.stone, whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis" }}>{p.desc}</div>
                      </div>
                      <div style={{ textAlign: "right", flexShrink: 0 }}>
                        <div style={{ fontFamily: fonts.mono, fontSize: 13, fontWeight: 500, color: COLORS.primary }}>${p.price.toLocaleString()}</div>
                        {p.tag && <span style={{ fontSize: 9, color: COLORS.gold, fontWeight: 600 }}>{p.tag}</span>}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            </section>

          </div>
        )}
      </div>
    </div>
  );
}
</file>

<file path="Remodelacion MARE/mare-design-system.md">
# Mare CafÃ© â€” Sistema de DiseÃ±o Premium

## Propuesta de DirecciÃ³n de Arte & Interfaz Digital

---

## 1. Concepto Visual

### Moodboard Descriptivo

La identidad de **Mare CafÃ©** vive en la intersecciÃ³n entre la **pastelerÃ­a artesanal europea** y la **costa atlÃ¡ntica argentina**. El flyer revela un universo visual claro: ilustraciÃ³n editorial a una sola tinta, tipografÃ­a bold con personalidad manual, y una paleta binaria azul profundo/crema que evoca cerÃ¡mica portuguesa, manteles de lino y la bruma marina de Mar del Plata.

### Palabras Clave de Estilo

| Eje | Descriptor |
|---|---|
| AtmÃ³sfera | Calma costera, maÃ±ana de domingo, brisa salada |
| EstÃ©tica | Neo-editorial, post-minimal, artesanal-digital |
| Materialidad | CerÃ¡mica esmaltada, lino crudo, papel verjurado |
| TecnologÃ­a | Invisible â€” la sofisticaciÃ³n estÃ¡ en lo que *no* se ve |
| Referentes | Kinfolk Magazine, Cereal Magazine, Aesop Stores, Blue Bottle Coffee App |

### Principio Rector

> *"El lujo silencioso aplicado al cafÃ©: nada sobra, nada falta."*

La app debe sentirse como hojear una revista de gastronomÃ­a independiente, no como usar un delivery genÃ©rico. Cada pantalla es una composiciÃ³n editorial donde el contenido respira.

---

## 2. Paleta de Colores

### Colores Primarios (Derivados del Flyer)

| Rol | Nombre | Hex | Uso |
|---|---|---|---|
| **Primary** | Royal Deep Blue | `#1A3278` | Encabezados, navegaciÃ³n activa, CTA primario, iconografÃ­a |
| **Surface** | Parchment Cream | `#F2EDE3` | Fondo principal, Ã¡reas de contenido, cards |
| **Canvas** | Warm White | `#FAF8F4` | Fondo base de la app, Ã¡reas de respiraciÃ³n |

### Colores Secundarios & Acentos

| Rol | Nombre | Hex | Uso |
|---|---|---|---|
| **Accent Warm** | Espresso Gold | `#C8A96E` | Badges premium, recompensas, estados "gold" |
| **Accent Soft** | Mare Blue Light | `#4A6BB5` | Estados hover, links, elementos interactivos secundarios |
| **Neutral Dark** | Ink | `#2A2A2E` | Texto body principal |
| **Neutral Mid** | Stone | `#8C8B88` | Texto secundario, placeholders, metadata |
| **Neutral Light** | Mist | `#E5E1D9` | Bordes sutiles, separadores, lÃ­neas de card |
| **Semantic Success** | Sage | `#5B8C6A` | Confirmaciones, estados completados |
| **Semantic Error** | Terracotta | `#C0574A` | Errores, alertas (nunca rojo puro) |

### Gradientes

```css
/* Hero / Header gradient â€” simula la profundidad del mar */
--gradient-ocean: linear-gradient(175deg, #1A3278 0%, #243D8A 45%, #2E4F9E 100%);

/* Glassmorphism surface â€” para modales y overlays */
--glass-cream: rgba(242, 237, 227, 0.72);
--glass-blur: blur(24px) saturate(1.4);

/* Gold reward shimmer â€” para momentos "wow" */
--gradient-gold: linear-gradient(135deg, #C8A96E 0%, #E8D5A0 50%, #C8A96E 100%);
```

### PsicologÃ­a del Color

El azul royal (`#1A3278`) no es un azul corporativo frÃ­o â€” es un **azul mediterrÃ¡neo profundo** que transmite confianza, tradiciÃ³n y serenidad. Combinado con el crema (`#F2EDE3`), genera un contraste de alto impacto sin agresividad, similar a la cerÃ¡mica Delft o los azulejos de las cafeterÃ­as clÃ¡sicas portuarias. El dorado (`#C8A96E`) aparece solo en momentos de *recompensa*, creando un sistema de refuerzo positivo visual.

---

## 3. TipografÃ­a

### Pares TipogrÃ¡ficos

#### Display & Headlines: **DM Serif Display**
- *Por quÃ©:* Serif editorial con curvas generosas que evocan la calidez de la pastelerÃ­a artesanal. Compatible con la tipografÃ­a condensada bold del flyer pero mÃ¡s refinada para pantalla.
- Alternativa: **Playfair Display** (ya configurado en el codebase como `--font-playfair`) o **Lora**.
- Uso: TÃ­tulos principales, nombre del cafÃ©, encabezados de secciÃ³n.
- Weight: `400` (regular) y `700` (bold).

#### Body & UI: **Plus Jakarta Sans**
- *Por quÃ©:* GeomÃ©trica humanista con terminaciones suaves. Altamente legible en tamaÃ±os pequeÃ±os, moderna sin ser frÃ­a. Evita la genericidad de Inter/Roboto.
- Alternativa: **Outfit** o **General Sans**.
- Uso: Texto body, labels, botones, navegaciÃ³n, metadata.
- Weights: `400`, `500`, `600`, `700`.

#### Monospace (precios/datos): **JetBrains Mono**
- Uso exclusivo: Precios, cÃ³digos de pedido, nÃºmeros de mesa.
- Weight: `500`.

### Escala TipogrÃ¡fica

```
--text-display:    clamp(2rem, 5vw, 3.5rem)   / 1.05  â†’ TÃ­tulos hero
--text-h1:         clamp(1.5rem, 3.5vw, 2rem)  / 1.15  â†’ Secciones principales
--text-h2:         1.25rem                       / 1.3   â†’ SubtÃ­tulos
--text-body:       0.9375rem (15px)              / 1.6   â†’ Contenido general
--text-caption:    0.8125rem (13px)              / 1.5   â†’ Labels, metadata
--text-micro:      0.6875rem (11px)              / 1.4   â†’ Badges, timestamps
```

### Tracking & Estilo

- Los headlines en serif usan `letter-spacing: -0.02em` (tracking tight para elegancia editorial).
- Los labels de navegaciÃ³n en mayÃºsculas usan `letter-spacing: 0.08em` (tracking abierto para legibilidad).
- Nunca usar ALL CAPS en mÃ¡s de 2 palabras consecutivas excepto en navegaciÃ³n.

---

## 4. Componentes UI

### 4.1 NavegaciÃ³n Inferior (Tab Bar)

**Estilo:** Barra minimalista con fondo `glass-cream` (backdrop-blur), sin bordes superiores. Los Ã­conos son line-art personalizados (estilo ilustraciÃ³n del flyer â€” trazo 1.5px). El Ã­tem activo se indica con el Ã­cono en `fill` azul + un punto (`â€¢`) debajo, sin backgrounds ruidosos.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   â˜• Inicio    ðŸ“– MenÃº    â™¥ Lealtad    ðŸ‘¤ Mi  â”‚
â”‚                  â€¢                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- 4 tabs mÃ¡ximo para mantener claridad.
- TransiciÃ³n de Ã­cono: `outline â†’ filled` con ease de 200ms.
- Label: Plus Jakarta Sans 11px, `letter-spacing: 0.06em`, uppercase.

### 4.2 Tarjetas de Producto (Product Cards)

**Estilo:** Esquinas redondeadas suaves (`border-radius: 16px`), sin sombra visible â€” en su lugar, un borde `1px solid #E5E1D9` que se intensifica al `:hover` â†’ `1px solid #1A3278`. La imagen del producto ocupa el 60% superior de la card con `object-fit: cover` y esquinas top redondeadas.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     â”‚
â”‚    [Imagen cafÃ©]    â”‚   â† aspect-ratio: 4/3
â”‚                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Cappuccino         â”‚   â† DM Serif Display, 16px
â”‚  Leche texturizada  â”‚   â† Plus Jakarta, 13px, color: Stone
â”‚                     â”‚
â”‚  $2.800        [+]  â”‚   â† JetBrains Mono + Ã­cono CTA
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Fondo: `#FAF8F4` (Warm White).
- Hover: elevaciÃ³n sutil con `transform: translateY(-2px)` + border color transition.
- El botÃ³n `[+]` es un cÃ­rculo de 36px, fondo `#1A3278`, Ã­cono `+` en crema.

### 4.3 Botones

#### Primario
- Fondo: `#1A3278` â†’ hover: `#243D8A`
- Texto: `#F2EDE3`, Plus Jakarta Sans 14px `font-weight: 600`
- Border-radius: `12px`
- Padding: `14px 28px`
- TransiciÃ³n: `background-color 200ms ease, transform 100ms ease`
- Active state: `transform: scale(0.97)`
- Sin sombras â€” el contraste cromÃ¡tico es suficiente.

#### Secundario / Ghost
- Fondo: `transparent`
- Borde: `1.5px solid #1A3278`
- Texto: `#1A3278`
- Hover: fondo `rgba(26, 50, 120, 0.06)`

#### Terciario / Text Button
- Sin fondo ni borde.
- Texto: `#4A6BB5` con `text-decoration: underline` offset `3px`.
- Hover: color â†’ `#1A3278`

### 4.4 Modal de Detalle de Producto

**Estilo:** Bottom sheet que sube desde abajo con `spring animation` (leve rebote). Fondo del overlay: `rgba(26, 50, 120, 0.4)` con backdrop-blur de 8px. La sheet tiene esquinas top de `24px`, fondo `#FAF8F4`.

Estructura interna:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           â”€â”€â”€ (drag handle)          â”‚
â”‚                                      â”‚
â”‚  [      Imagen grande 16:9      ]    â”‚
â”‚                                      â”‚
â”‚  Caramel Macchiato              â™¥    â”‚  â† DM Serif, 22px
â”‚  Espresso, leche y caramelo          â”‚  â† Plus Jakarta, 14px, Stone
â”‚                                      â”‚
â”‚  â”€â”€ TamaÃ±o â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  [ S ]  [ M â—]  [ L ]               â”‚  â† Pill selector
â”‚                                      â”‚
â”‚  â”€â”€ PersonalizaciÃ³n â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  Tipo de leche        Entera  â–¾      â”‚  â† Dropdown sutil
â”‚  Crema batida         â—‹ SÃ­  â— No    â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚     Agregar Â· $3.200         â”‚    â”‚  â† CTA Primario full-width
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- El pill selector de tamaÃ±o usa: fondo `transparent` por defecto, seleccionado â†’ fondo `#1A3278` con texto crema. TransiciÃ³n: 200ms ease.
- Separadores de secciÃ³n: lÃ­nea `0.5px` en `#E5E1D9` con label en `text-micro`, uppercase, tracking abierto.

### 4.5 Tarjeta de Fidelidad (Stamps)

**Estilo:** Card destacada con borde `1.5px solid #1A3278` y fondo con gradiente sutil:
`linear-gradient(135deg, #F2EDE3 0%, #FAF8F4 100%)`.

Los stamps vacÃ­os son cÃ­rculos con borde `dashed 1.5px #C8A96E`. Los stamps activos tienen fondo `#1A3278` con un Ã­cono de taza en lÃ­nea blanca (estilo ilustraciÃ³n del flyer). El stamp final (recompensa) brilla con `gradient-gold` y una micro-animaciÃ³n de pulso sutil.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Tu Tarjeta Mare                     â”‚  â† DM Serif, 18px
â”‚  3 de 7 para tu cafÃ© gratis          â”‚  â† Plus Jakarta, 13px
â”‚                                      â”‚
â”‚   â˜•  â˜•  â˜•  â—‹  â—‹  â—‹  [â˜…]           â”‚
â”‚                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ progreso â”€â”€â”€â”€â”€â”€    â”‚
â”‚  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  43%        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Progress bar: height `3px`, border-radius `2px`, color de fill `#1A3278`, track `#E5E1D9`.
- AnimaciÃ³n de nuevo stamp: el cÃ­rculo hace `scale(0 â†’ 1.15 â†’ 1)` con un leve `bounce`.

### 4.6 Header de Pantalla

Minimalista. Sin gradientes ni sombras agresivas.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â†    Mare                     ðŸ””    â”‚
â”‚        PastelerÃ­a y CafÃ©             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- Logo text "Mare" en DM Serif Display, 22px, color `#1A3278`.
- SubtÃ­tulo en Plus Jakarta 11px, `letter-spacing: 0.05em`, color `Stone`.
- Fondo: `#FAF8F4` con border-bottom `0.5px solid #E5E1D9`.
- Sticky con backdrop-blur para transparencia al scrollear.

### 4.7 Input Fields

- Border: `1.5px solid #E5E1D9` â†’ focus: `1.5px solid #1A3278`
- Border-radius: `12px`
- Padding: `14px 16px`
- Label: Plus Jakarta 12px, `font-weight: 500`, color `#2A2A2E`, posicionada arriba del input.
- Placeholder: color `#8C8B88`
- Focus ring: `box-shadow: 0 0 0 3px rgba(26, 50, 120, 0.1)`
- TransiciÃ³n: `border-color 200ms ease, box-shadow 200ms ease`

---

## 5. Principios de InteracciÃ³n & Micro-animaciones

### FilosofÃ­a

Las animaciones en Mare son **funcionales y discretas**. Nunca decorativas por sÃ­ mismas. Siguen la cadencia natural de una conversaciÃ³n tranquila en un cafÃ©.

| InteracciÃ³n | AnimaciÃ³n | DuraciÃ³n | Easing |
|---|---|---|---|
| Page transition | Fade-in + translateY(8px â†’ 0) | 300ms | `ease-out` |
| Card appear | Stagger fade-in (50ms delay entre cards) | 250ms | `ease-out` |
| Button press | `scale(0.97)` | 100ms | `ease-in-out` |
| Modal open | Slide-up + spring overshoot | 400ms | `cubic-bezier(0.34, 1.56, 0.64, 1)` |
| Stamp earned | Scale bounce + ripple dorado | 500ms | `spring` |
| Tab switch | Crossfade content + dot slide | 200ms | `ease-in-out` |
| Pull to refresh | Custom wave animation (olas del mar) | Loop | `linear` |

### Detalle Especial: Pull-to-Refresh

En lugar del spinner genÃ©rico, se muestra una pequeÃ±a animaciÃ³n de olas estilizadas (3 lÃ­neas curvas azules que oscilan), alineada con el concepto "Mare" (mar). Es un detalle de marca que eleva la experiencia.

---

## 6. IconografÃ­a

Estilo: **Line icons personalizados** inspirados en la ilustraciÃ³n del flyer (trazo uniforme de 1.5px, terminaciones redondeadas). Evitar sets genÃ©ricos como Feather/Lucide sin customizaciÃ³n.

Set mÃ­nimo necesario:
- Inicio (casita estilizada tipo storefont del flyer)
- MenÃº (taza de cafÃ© con vapor)
- Lealtad (estrella o sello circular)
- Perfil (silueta minimalista)
- Carrito (bolsa de papel)
- CorazÃ³n (favoritos)
- Campana (notificaciones)
- Flecha atrÃ¡s
- Plus / Minus (para cantidades)
- Checkmark
- UbicaciÃ³n (pin)
- Reloj (horarios)

---

## 7. Espaciado & Layout Grid

```
--space-xs:    4px
--space-sm:    8px
--space-md:    16px
--space-lg:    24px
--space-xl:    32px
--space-2xl:   48px
--space-3xl:   64px

Grid: 4-column en mobile, 20px gutters, 16px margins laterales.
Max-width contenido: 420px (centrado en tablets/desktop).
```

### Safe Areas

La app respeta `env(safe-area-inset-*)` para dispositivos con notch. La barra de navegaciÃ³n inferior tiene un padding-bottom adicional de `env(safe-area-inset-bottom)`.

---

## 8. ActualizaciÃ³n Sugerida al Config del Codebase

```typescript
// src/config/clients/mare_cafe.ts â€” Propuesta actualizada
export const mareCafeConfig: ClientConfig = {
    code: 'mare_cafe',
    name: 'Mare Cafe',
    theme: {
        primaryColor: '#1A3278',      // Royal Deep Blue (ajustado)
        secondaryColor: '#F2EDE3',    // Parchment Cream
        accentColor: '#C8A96E',       // Espresso Gold
        fontFamily: 'var(--font-dm-serif)',
    },
    texts: {
        welcomeTitle: 'Mare',
        welcomeSubtitle: 'PastelerÃ­a y CafÃ© de Especialidad',
        stampCardTitle: 'Tu Tarjeta Mare',
        rewardsTitle: 'Tus Recompensas',
    },
    rules: {
        stampsPerReward: 7,
    },
    assets: {
        logo: '/logo-mare.png',
    },
    features: {
        showBuyButton: true,
        externalMenuUrl: undefined,     // Ahora con menÃº nativo
        showNewsFeed: true,
        menuEnabled: true,              // â† Habilitar menÃº in-app
        showAboutUs: true,
    },
};
```

---

## 9. Prompt para GeneraciÃ³n de Imagen (Midjourney / DALL-E)

```
A premium mobile app UI mockup for "Mare Cafe", an artisan pastry and specialty
coffee shop. The design features a sophisticated two-tone palette: deep royal blue
(#1A3278) and warm parchment cream (#F2EDE3) with subtle gold accents. The layout
shows a coffee ordering screen with editorial serif typography for headings (similar
to DM Serif Display), clean sans-serif for body text, rounded cards with thin
borders (no shadows), minimalist line-art icons with 1.5px stroke. The aesthetic is
inspired by Kinfolk magazine, Aesop packaging, and Portuguese ceramic tiles.
Bottom navigation with 4 tabs: Home, Menu, Loyalty, Profile. A stamp loyalty card
is visible with custom illustrated coffee cup stamps in a single-color blue line
art style. The overall feel is calm, coastal, luxurious yet approachable. Shot on
a marble surface with soft directional light. UI/UX design, Figma style mockup,
4K, ultra-detailed --ar 9:16 --style raw --v 6.1
```

---

## 10. Resumen Ejecutivo de Diferenciadores

| Lo que evitamos | Lo que hacemos |
|---|---|
| Gradientes saturados, neon | Paleta binaria azul/crema con acentos dorados quirÃºrgicos |
| Sombras `box-shadow` pesadas | Bordes finos `1px` con transiciones de color |
| TipografÃ­a genÃ©rica (Inter, Roboto) | Par editorial: DM Serif Display + Plus Jakarta Sans |
| Iconos Lucide/Feather sin personalizar | Line-art custom inspirada en la ilustraciÃ³n del flyer |
| NavegaciÃ³n recargada (5+ tabs) | 4 tabs, glass background, dot indicator |
| Bottom sheets aburridos | Spring animations con overshoot natural |
| Pull-to-refresh spinner genÃ©rico | Olas animadas del mar (identidad de marca) |
| Cards con sombras difusas | Cards con borde `Mist` que transiciona a `Royal Blue` en hover |

---

*Documento preparado para Mare CafÃ© â€” Belgrano 2268, Mar del Plata.*
*VersiÃ³n 1.0 â€” Febrero 2026*
</file>

<file path="scripts/debug_keys.js">
const { createClient } = require('@supabase/supabase-js');
const dotenv = require('dotenv');
const path = require('path');

dotenv.config({ path: path.resolve(__dirname, '../.env.local') });

const url = process.env.NEXT_PUBLIC_SUPABASE_URL;
const anonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;

console.log('URL:', url);
console.log('Anon Key:', anonKey);
console.log('Service Key:', serviceKey ? serviceKey.substring(0, 20) + '...' : 'undefined');

// Decode JWT
function decodeJwt(token) {
    if (!token) return null;
    const parts = token.split('.');
    if (parts.length !== 3) return 'Not a JWT';
    try {
        const payload = Buffer.from(parts[1], 'base64').toString('utf-8');
        return JSON.parse(payload);
    } catch (e) {
        return 'Invalid JWT';
    }
}

console.log('--- Service Key Payload ---');
console.log(decodeJwt(serviceKey));

async function testConnection() {
    console.log('\n--- Testing Anon Key ---');
    const anonClient = createClient(url, anonKey);
    const { data: anonData, error: anonError } = await anonClient.from('profiles').select('count').limit(1);
    console.log('Anon Query Result:', anonError ? anonError.message : 'Success');

    console.log('\n--- Testing Service Key ---');
    const serviceClient = createClient(url, serviceKey);
    const { data: serviceData, error: serviceError } = await serviceClient.from('profiles').select('count', { count: 'exact', head: true });
    // Using head: true to just check access
    console.log('Service Query Result:', serviceError ? serviceError.message : 'Success');

    const { data: users, error: userError } = await serviceClient.auth.admin.listUsers({ page: 1, perPage: 1 });
    console.log('Admin ListUsers Result:', userError ? userError.message : 'Success');
}

testConnection();
</file>

<file path="scripts/fix_admin_role.js">
const { createClient } = require('@supabase/supabase-js');
const dotenv = require('dotenv');
const path = require('path');

// Load environment variables from .env.local
dotenv.config({ path: path.resolve(__dirname, '../.env.local') });

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;

console.log('NEXT_PUBLIC_SUPABASE_URL:', supabaseUrl);
console.log('SUPABASE_SERVICE_ROLE_KEY length:', supabaseServiceKey ? supabaseServiceKey.length : 'undefined');
console.log('Key start:', supabaseServiceKey ? supabaseServiceKey.substring(0, 10) : 'undefined');
// console.log('Key end:', supabaseServiceKey ? supabaseServiceKey.substring(supabaseServiceKey.length - 10) : 'undefined');

if (!supabaseUrl || !supabaseServiceKey) {
    console.error('Error: Missing environment variables.');
    process.exit(1);
}

const supabase = createClient(supabaseUrl, supabaseServiceKey, {
    auth: {
        autoRefreshToken: false,
        persistSession: false
    }
});

async function fixAdminRole() {
    const email = 'admin@test.com';
    console.log(`Fixing role for user: ${email}...`);

    // 1. Get User ID
    const { data: { users }, error: userError } = await supabase.auth.admin.listUsers();

    if (userError) {
        console.error('Error fetching users:', userError);
        // return; 
        // CONTINUE EVEN IF ERROR to try direct profile update?
        // No, if listUsers fails, direct profile update via service role MIGHT work if profiles is not protected by auth.admin?
        // But usually RLS for profiles might allow service role.
    }

    let userId = null;
    if (users) {
        const user = users.find(u => u.email === email);
        if (user) userId = user.id;
    }

    if (!userId) {
        console.log("Could not find user via auth.admin.listUsers(). Trying to find via profiles lookup (if possible)...");
        const { data: profile } = await supabase.from('profiles').select('id').eq('email', email).single();
        if (profile) userId = profile.id;
    }

    if (!userId) {
        console.error(`User ${email} not found.`);
        return;
    }

    console.log(`Found User ID: ${userId}`);

    // 2. Update Profile
    const { data, error } = await supabase
        .from('profiles')
        .update({
            role: 'admin',
            client_code: 'perezoso_cafe'
        })
        .eq('id', userId)
        .select();

    if (error) {
        console.error('Error updating profile:', error);
    } else {
        console.log('Success! Profile updated:', data);
    }

    // 3. Verify Auth Metadata
    const { data: authUpdate, error: authError } = await supabase.auth.admin.updateUserById(
        userId,
        { user_metadata: { role: 'admin', client_code: 'perezoso_cafe' } }
    );

    if (authError) {
        console.error('Error updating auth metadata:', authError);
    } else {
        console.log('Auth metadata updated.');
    }
}

fixAdminRole();
</file>

<file path="scripts/fix_admin_self.js">
const { createClient } = require('@supabase/supabase-js');
const dotenv = require('dotenv');
const path = require('path');

dotenv.config({ path: path.resolve(__dirname, '../.env.local') });

const url = process.env.NEXT_PUBLIC_SUPABASE_URL;
const anonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;

if (!url || !anonKey) {
    console.error('Missing URL or Anon Key');
    process.exit(1);
}

const supabase = createClient(url, anonKey);

async function attemptSelfElevation() {
    const email = 'admin@test.com';
    const password = '123456';

    console.log(`Logging in as ${email}...`);
    const { data: { session }, error: loginError } = await supabase.auth.signInWithPassword({
        email,
        password
    });

    if (loginError) {
        console.error('Login failed:', loginError.message);
        return;
    }

    console.log('Login successful. Attempting to update profile...');
    console.log('User ID:', session.user.id);

    // Update Profile
    const { data, error } = await supabase
        .from('profiles')
        .update({
            role: 'admin',
            client_code: 'perezoso_cafe'
        })
        .eq('id', session.user.id)
        .select();

    if (error) {
        console.error('Update failed (likely RLS):', error.message);
        console.log('Hint: The "role" column is usually protected. You need the Service Role Key to bypass this.');
    } else {
        console.log('Success! Profile updated:', data);
    }
}

attemptSelfElevation();
</file>

<file path="src/app/actions/marketing.ts">
'use server';


import { Resend } from 'resend';
import { supabaseAdmin } from '@/lib/supabase-admin';

// Initialize Supabase Client (Service Role needed for mass emailing to avoid RLS issues)
const supabase = supabaseAdmin;

const resend = new Resend(process.env.RESEND_API_KEY || 're_123456789'); // Placeholder if missing

export async function sendCampaign(formData: FormData) {
    const title = formData.get('title') as string;
    const content = formData.get('content') as string;
    const audience = formData.get('audience') as string;
    const testEmail = formData.get('testEmail') as string | null;
    const html = formData.get('html') as string | null;
    const campaignId = formData.get('campaignId') as string | null;

    console.log(`ðŸš€ Starting Campaign: ${title} (ID: ${campaignId || 'None'})`);

    try {
        let targets: string[] = [];

        // 1. Determine Targets
        if (testEmail) {
            console.log(`ðŸ§ª Test Mode: Sending only to ${testEmail}`);
            targets = [testEmail];
        } else {
            console.log(`ðŸ‘¥ Database Mode: Fetching users for audience: ${audience}`);

            let query = supabase.from('profiles').select('email');

            // Apply Filters
            if (audience === 'Nivel 2+ (Frecuentes)') {
                query = query.gte('level', 2);
            } else if (audience === 'Nivel 3+ (VIP)') {
                query = query.gte('level', 3);
            }
            // 'Todos' gets everyone

            const { data, error } = await query;

            if (error) throw new Error(`DB Error: ${error.message}`);

            targets = data.map(p => p.email).filter(e => e && e.includes('@')); // Simple validation
            console.log(`âœ… Found ${targets.length} valid targets in Database.`);
        }

        if (targets.length === 0) {
            return { success: false, message: 'No se encontraron destinatarios vÃ¡lidos.' };
        }

        // 2. Send Emails (Batching or Loop)
        // For MVP, we loop. Resend has batch API too.

        // CHECK IF RESEND KEY IS REAL
        const hasKey = process.env.RESEND_API_KEY && !process.env.RESEND_API_KEY.startsWith('re_123');
        const baseUrl = process.env.NEXT_PUBLIC_BASE_URL || 'http://localhost:3000'; // Define this in env vars

        if (!hasKey) {
            // SIMULATION MODE
            console.log('âš ï¸ No RESEND_API_KEY found. Simulating delivery.');
            await new Promise(r => setTimeout(r, 1500)); // Fake delay
            return {
                success: true,
                message: `[MODO SIMULACIÃ“N] CampaÃ±a procesada exitosamente para ${targets.length} usuarios. (Configura RESEND_API_KEY para envÃ­os reales).`
            };
        }

        // REAL SEND MODE
        const results = [];
        for (const email of targets) {
            // Generate Personalized Content
            let personalizedHtml = html || `
                <div style="font-family: sans-serif; color: #333;">
                    <h1 style="color: #1E3A8A;">Mare Cafe</h1>
                    <h2>${title}</h2>
                    <p>${content}</p>
                    <br/>
                    <div style="padding: 20px; background-color: #f3f4f6; border-radius: 10px;">
                        <p style="font-size: 12px; color: #888;">Este es un mensaje automÃ¡tico de tu tarjeta de fidelidad.</p>
                    </div>
                </div>
            `;

            if (campaignId) {
                const promoUrl = `${baseUrl}/promo/${campaignId}?user=${encodeURIComponent(email)}`;
                personalizedHtml = personalizedHtml.replace(/{{PROMO_LINK}}/g, promoUrl);
            }

            const result = await resend.emails.send({
                from: 'Mare Cafe <onboarding@resend.dev>', // Default Resend Testing Domain
                to: email,
                subject: title,
                html: personalizedHtml
            });
            results.push(result);

            // Rate Limit Delay (500ms)
            await new Promise(resolve => setTimeout(resolve, 500));
        }

        const errors = results.filter(r => r.error);
        if (errors.length > 0) {
            console.error('Some emails failed:', errors);
            return { success: true, message: `Enviado a ${targets.length - errors.length} usuarios. (${errors.length} fallidos)` };
        }

        return { success: true, message: `Â¡Ã‰xito! Enviado a ${targets.length} usuarios.` };

    } catch (error: any) {
        console.error('Campaign Error:', error);
        return { success: false, message: error.message };
    }
}
</file>

<file path="src/app/admin/error.tsx">
'use client';

import { useEffect } from 'react';
import { ShieldAlert, RefreshCcw } from 'lucide-react';
import PoweredBy from '@/components/PoweredBy';

export default function AdminError({
    error,
    reset,
}: {
    error: Error & { digest?: string };
    reset: () => void;
}) {
    useEffect(() => {
        console.error(error);
    }, [error]);

    return (
        <div className="bg-slate-50 flex items-center justify-center min-h-[calc(100vh-80px)] md:min-h-screen p-6 font-sans">
            <div className="bg-white rounded-3xl shadow-xl p-8 max-w-md w-full text-center border border-red-100">
                <div className="bg-red-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6">
                    <ShieldAlert size={32} className="text-red-500" />
                </div>

                <h2 className="text-xl font-bold text-slate-800 mb-2">Error en el Panel de AdministraciÃ³n</h2>
                <p className="text-slate-500 text-sm mb-6">
                    No se pudo cargar el mÃ³dulo solicitado. Esto puede deberse a un problema de conexiÃ³n o permisos.
                </p>

                <div className="bg-slate-50 p-3 rounded-lg text-left mb-6 border border-slate-100 overflow-hidden">
                    <p className="text-[10px] font-mono text-slate-400 uppercase tracking-wider mb-1">Detalles TÃ©cnicos</p>
                    <p className="text-xs font-mono text-slate-600 truncate">{error.message}</p>
                </div>

                <div className="flex flex-col gap-3">
                    <button
                        onClick={() => reset()}
                        className="w-full bg-blue-900 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 hover:bg-blue-800 transition shadow-lg shadow-blue-900/10"
                    >
                        <RefreshCcw size={18} /> Recargar Panel
                    </button>
                    <button
                        onClick={() => window.location.reload()}
                        className="w-full bg-white text-slate-600 font-semibold py-3 rounded-xl border border-slate-200 hover:bg-slate-50 transition"
                    >
                        Forzar Recarga Completa
                    </button>
                </div>

                <div className="mt-8 opacity-70">
                    <PoweredBy />
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/app/promo/[id]/page.tsx">
'use client';

import { Suspense, useEffect, useState } from 'react';
import { notFound, useSearchParams } from 'next/navigation';
import { QRCodeSVG } from 'qrcode.react';
import { supabase } from '@/lib/supabase';
import { useClientConfig } from '@/context/ClientConfigContext';
import { Loader2, AlertCircle, CheckCircle2 } from 'lucide-react';

function PromoContent({ params }: { params: { id: string } }) {
    const [status, setStatus] = useState<'loading' | 'active' | 'inactive' | 'error'>('loading');
    const [campaign, setCampaign] = useState<any>(null);
    const searchParams = useSearchParams();
    const userEmail = searchParams.get('user');
    const config = useClientConfig();

    useEffect(() => {
        const checkCampaign = async () => {
            if (!params.id || !userEmail) {
                setStatus('error');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('campaigns')
                    .select('*')
                    .eq('id', params.id)
                    .single();

                if (error || !data) {
                    setStatus('error');
                    return;
                }

                setCampaign(data);
                setStatus(data.status === 'active' ? 'active' : 'inactive');
            } catch (err) {
                setStatus('error');
            }
        };

        checkCampaign();
    }, [params.id, userEmail]);

    if (status === 'loading') {
        return <div className="min-h-screen flex items-center justify-center bg-gray-50"><Loader2 className="animate-spin text-blue-600" size={32} /></div>;
    }

    if (status === 'error') {
        return (
            <div className="min-h-screen flex items-center justify-center bg-gray-50 p-6">
                <div className="text-center space-y-4 max-w-md">
                    <div className="bg-red-100 p-4 rounded-full w-16 h-16 flex items-center justify-center mx-auto text-red-600">
                        <AlertCircle size={32} />
                    </div>
                    <h1 className="text-xl font-bold text-gray-800">Enlace no vÃ¡lido</h1>
                    <p className="text-gray-500">No pudimos encontrar la promociÃ³n solicitada.</p>
                </div>
            </div>
        );
    }

    if (status === 'inactive') {
        return (
            <div className="min-h-screen flex items-center justify-center bg-gray-50 p-6">
                <div className="text-center space-y-4 max-w-md">
                    <div className="bg-gray-200 p-4 rounded-full w-16 h-16 flex items-center justify-center mx-auto text-gray-500">
                        <AlertCircle size={32} />
                    </div>
                    <h1 className="text-xl font-bold text-gray-800">PromociÃ³n Finalizada</h1>
                    <p className="text-gray-500">Lo sentimos, esta campaÃ±a {campaign?.title} ya no estÃ¡ disponible.</p>
                </div>
            </div>
        );
    }

    // QR Data Payload
    const qrPayload = JSON.stringify({
        type: 'promo',
        campaignId: campaign.id,
        user: userEmail,
        timestamp: Date.now() // Prevent replay attacks if we check this in scanner
    });

    return (
        <div className="min-h-screen bg-gray-50 flex flex-col items-center justify-center p-6 relative overflow-hidden">
            <div className="absolute top-0 w-full h-64 bg-blue-900 rounded-b-[40px] z-0" style={{ backgroundColor: config.theme.primaryColor }}></div>

            <div className="bg-white rounded-3xl shadow-xl p-8 w-full max-w-sm z-10 text-center space-y-6 animate-in slide-in-from-bottom-4 duration-500">
                <div className="space-y-4 flex flex-col items-center">
                    {config.assets?.logo ? (
                        <div className="w-48 h-48 mb-4 relative">
                            <img
                                src={config.assets.logo}
                                alt={config.name}
                                className="w-full h-full object-contain"
                            />
                        </div>
                    ) : (
                        <h2 className="text-xs font-bold text-blue-600 uppercase tracking-widest">{config.name}</h2>
                    )}
                    <h1 className="text-2xl font-black text-gray-800 leading-tight">{campaign.title}</h1>
                </div>

                <div className="bg-white p-4 rounded-2xl border-2 border-dashed border-gray-200 inline-block relative group">
                    <QRCodeSVG value={qrPayload} size={200} level="H" className="mx-auto" />
                    <div className="absolute -bottom-3 left-1/2 -translate-x-1/2 bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold shadow-sm whitespace-nowrap flex items-center gap-1">
                        <CheckCircle2 size={12} /> Listo para Canjear
                    </div>
                </div>

                <p className="text-sm text-gray-500">
                    Muestra este cÃ³digo QR al staff para validar tu beneficio.
                </p>
            </div>

            <p className="mt-8 text-xs text-center text-gray-400 z-10">
                Usuario: {userEmail}
            </p>
        </div>
    );
}

export default function PromoPage({ params }: { params: { id: string } }) {
    return (
        <Suspense fallback={<div className="min-h-screen flex items-center justify-center bg-gray-50">Cargando...</div>}>
            <PromoContent params={params} />
        </Suspense>
    );
}
</file>

<file path="src/app/test-qr/page.tsx">
'use client';

import { QRCodeSVG } from 'qrcode.react';
import Image from 'next/image';

export default function PerezosoQRPreview() {
    // URL de registro para clientes
    // Usamos window.location.origin para que funcione en local y prod, 
    // pero como es preview hardcodeamos un ejemplo o usamos un hook si fuera componente real.
    // Para este archivo de prueba, usaremos una URL base genÃ©rica o la IP local si la conocemos.
    const registerUrl = "http://192.168.1.78:3001/auth/login?role=customer";

    return (
        <div className="min-h-screen bg-[#2E2333] flex items-center justify-center p-4 font-sans">
            <div className="bg-white rounded-[40px] p-8 md:p-12 max-w-sm w-full shadow-2xl text-center relative overflow-hidden border-8 border-[#F5A623]">
                
                {/* Decorative Elements */}
                <div className="absolute top-0 left-0 w-full h-4 bg-[#F5A623]"></div>
                <div className="absolute bottom-0 left-0 w-full h-4 bg-[#F5A623]"></div>

                {/* Header */}
                <div className="mb-8 relative">
                    <div className="w-24 h-24 mx-auto bg-[#2E2333] rounded-full flex items-center justify-center mb-4 shadow-lg border-4 border-[#FFF5E1]">
                        <span className="text-4xl">ðŸ¦¥</span>
                    </div>
                    <h2 className="text-3xl font-black text-[#2E2333] mb-2" style={{ fontFamily: 'var(--font-fredoka)' }}>
                        Â¡Ãšnete al Club!
                    </h2>
                    <p className="text-gray-500 font-medium text-sm leading-relaxed">
                        Escanea para registrarte y empezar a sumar puntos en <span className="text-[#F5A623] font-bold">Perezoso Cafe</span>
                    </p>
                </div>

                {/* QR Container */}
                <div className="relative mx-auto w-64 h-64 bg-[#FFF5E1] p-4 rounded-3xl border-4 border-dashed border-[#2E2333]/20 flex items-center justify-center mb-8">
                    <QRCodeSVG
                        value={registerUrl}
                        size={200}
                        bgColor="transparent"
                        fgColor="#2E2333"
                        level="H"
                        includeMargin={false}
                    />
                    
                    {/* Center Logo Overlay */}
                    <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                        <div className="bg-white p-1.5 rounded-full shadow-md">
                            <div className="w-10 h-10 relative bg-[#F5A623] rounded-full flex items-center justify-center">
                                <span className="text-xl">â˜•</span>
                            </div>
                        </div>
                    </div>
                </div>

                {/* Footer */}
                <div className="space-y-3">
                    <div className="inline-block bg-[#F5A623]/10 text-[#F5A623] px-4 py-1.5 rounded-full text-xs font-bold uppercase tracking-wider">
                        10 Sellos = 1 CafÃ© Gratis
                    </div>
                    <p className="text-[10px] text-gray-400 font-medium mt-4">
                        Desarrollado por Brandia
                    </p>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/app/unauthorized/page.tsx">
'use client';

import Link from 'next/link';
import { ShieldAlert } from 'lucide-react';

export default function UnauthorizedPage() {
    return (
        <div className="min-h-screen flex flex-col items-center justify-center p-4 bg-gray-50 text-center">
            <div className="w-20 h-20 bg-red-100 rounded-full flex items-center justify-center mb-6">
                <ShieldAlert size={40} className="text-red-600" />
            </div>
            <h1 className="text-3xl font-bold text-gray-900 mb-2">Acceso Denegado</h1>
            <p className="text-gray-600 mb-8 max-w-md">
                No tienes permisos para ver esta pÃ¡gina o tu cuenta no pertenece a este comercio.
            </p>
            <div className="flex gap-4">
                <Link
                    href="/"
                    className="px-6 py-3 bg-gray-900 text-white rounded-xl font-bold hover:scale-105 transition-transform"
                >
                    Volver al Inicio
                </Link>
                <Link
                    href="/auth/login?role=customer"
                    className="px-6 py-3 bg-white text-gray-900 border border-gray-200 rounded-xl font-bold hover:bg-gray-50 transition-colors"
                >
                    Iniciar SesiÃ³n
                </Link>
            </div>
        </div>
    );
}
</file>

<file path="src/app/error.tsx">
'use client';

import { useEffect } from 'react';
import { RefreshCcw, AlertTriangle } from 'lucide-react';
import PoweredBy from '@/components/PoweredBy';

export default function GlobalError({
    error,
    reset,
}: {
    error: Error & { digest?: string };
    reset: () => void;
}) {
    useEffect(() => {
        console.error(error);
    }, [error]);

    return (
        <div className="bg-gray-50 flex items-center justify-center min-h-screen p-6 font-sans">
            <div className="bg-white rounded-3xl shadow-xl p-8 max-w-md w-full text-center border border-red-100">
                <div className="bg-red-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-6">
                    <AlertTriangle size={32} className="text-red-500" />
                </div>

                <h2 className="text-2xl font-bold text-gray-800 mb-2">Â¡Ups! Algo saliÃ³ mal.</h2>
                <p className="text-gray-500 text-sm mb-8">
                    Ha ocurrido un error inesperado en la aplicaciÃ³n. Nuestro equipo ha sido notificado.
                </p>

                <div className="bg-gray-50 p-4 rounded-xl text-left mb-8 border border-gray-100 overflow-hidden">
                    <p className="text-xs font-mono text-gray-400">Error Digest: {error.digest}</p>
                    <p className="text-xs font-mono text-gray-600 mt-1 truncate">{error.message}</p>
                </div>

                <div className="flex gap-4">
                    <button
                        onClick={() => window.location.href = '/'}
                        className="flex-1 bg-white border border-slate-200 text-slate-600 font-bold py-3 rounded-xl hover:bg-slate-50 transition"
                    >
                        Ir al Inicio
                    </button>
                    <button
                        onClick={() => reset()}
                        className="flex-1 bg-slate-900 text-white font-bold py-3 rounded-xl flex items-center justify-center gap-2 hover:bg-slate-800 transition shadow-lg shadow-blue-900/10"
                    >
                        <RefreshCcw size={18} /> Reintentar
                    </button>
                </div>

                <div className="mt-8">
                    <PoweredBy />
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/app/manifest.ts">
import { MetadataRoute } from 'next';
import { getShopConfig } from '@/lib/shop-service';

export default async function manifest(): Promise<MetadataRoute.Manifest> {
    const config = await getShopConfig(process.env.NEXT_PUBLIC_CLIENT_CODE || 'mare_cafe');

    if (!config) {
        return {
            name: 'Loyalty App',
            short_name: 'Loyalty',
            start_url: '/',
            display: 'standalone',
            icons: []
        }
    }

    const iconPath = config.assets.favicon || config.assets.logo;

    return {
        name: config.name,
        short_name: config.name,
        description: config.texts.welcomeSubtitle,
        start_url: '/',
        display: 'standalone',
        background_color: config.theme.secondaryColor, // Improved contrast usually
        theme_color: config.theme.primaryColor,
        icons: [
            {
                src: iconPath,
                sizes: '192x192',
                type: 'image/png',
            },
            {
                src: iconPath,
                sizes: '512x512',
                type: 'image/png',
            },
        ],
    };
}
</file>

<file path="src/app/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import Link from 'next/link';
import Image from 'next/image';
import { useClientConfig } from '@/context/ClientConfigContext';
import { User, Store, Loader2 } from 'lucide-react';
import { supabase } from '@/lib/supabase';

export default function LandingPage() {
  const router = useRouter();
  const config = useClientConfig();
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const checkSession = async () => {
      const { data: { session } } = await supabase.auth.getSession();
      if (session) {
        // Fetch profile to know role
        const { data: profile } = await supabase
          .from('profiles')
          .select('role')
          .eq('id', session.user.id)
          .single();

        if (profile) {
          if (profile.role === 'customer') router.push('/client');
          else if (profile.role === 'admin') router.push('/admin');
          else router.push('/staff');
          return;
        }
      }
      setLoading(false);
    };
    checkSession();
  }, [router]);

  if (loading) {
    return (
      <div className="min-h-screen flex flex-col items-center justify-center space-y-4" style={{ backgroundColor: config.theme.primaryColor }}>
        {/* INCREASED LOADING SIZE: w-44 h-44 */}
        <div className="w-44 h-44 bg-white/5 rounded-full flex items-center justify-center backdrop-blur-sm animate-pulse">
          {config.assets?.logo && (
            <Image src={config.assets.logo} alt="Loading" width={120} height={120} className="object-contain opacity-80" />
          )}
        </div>
      </div>
    );
  }

  return (
    <main className="fixed inset-0 flex flex-col items-center justify-between p-6 text-center"
      style={{ backgroundColor: config.theme.primaryColor, color: 'white' }}>

      {/* Main Content Centered */}
      <div className="flex-1 flex flex-col items-center justify-center w-full max-w-md space-y-10">

        <div className="space-y-6 animate-in fade-in zoom-in duration-700 mt-12">
          {/* REDUCED SIZE: w-72 h-72 (10% smaller than w-80) */}
          <div className="w-72 h-72 flex items-center justify-center mx-auto relative">
            <div className="relative w-full h-full">
              {config.assets?.logo && (
                <Image
                  src={config.assets.logo}
                  alt={config.name}
                  fill
                  className="object-contain scale-150"
                  priority
                />
              )}
            </div>
          </div>

          <div className="space-y-2">
            <h1 className="text-4xl font-bold tracking-tight">{config.name}</h1>
            <p className="text-lg text-white/70 max-w-xs mx-auto leading-relaxed font-light">
              {config.texts.welcomeSubtitle}
            </p>
          </div>
        </div>

        {/* Actions - Modernized & Cleaner */}
        <div className="w-full space-y-4 animate-in slide-in-from-bottom-4 duration-1000 delay-300">
          <Link
            href="/auth/login?role=customer"
            className="group relative w-full flex items-center justify-center gap-3 p-5 bg-white text-black rounded-full shadow-xl hover:shadow-2xl hover:scale-[1.02] active:scale-95 transition-all font-bold text-xl overflow-hidden"
          >
            <User className="w-6 h-6 text-gray-900" />
            <span>Soy Cliente</span>
          </Link>

          <Link
            href="/auth/login?role=staff"
            className="w-full flex items-center justify-center gap-3 p-4 text-white/60 hover:text-white hover:bg-white/10 rounded-full transition-all font-medium text-sm backdrop-blur-md"
          >
            <Store className="w-4 h-4" />
            <span>Acceso Staff</span>
          </Link>
        </div>
      </div>

      {/* Footer - Pinned Bottom */}
      <footer className="w-full pt-6 pb-2 text-[10px] text-white/30 font-medium tracking-[0.2em] uppercase">
        Desarrollado por <span className="font-bold text-white/50">BRANDIA</span>
      </footer>
    </main>
  );
}
</file>

<file path="src/components/admin/dashboards/MareDashboard.tsx">
'use client';

/**
 * MareDashboard.tsx â€” Panel de AdministraciÃ³n Premium para Mare CafÃ©
 * 
 * DiseÃ±o editorial: Royal Deep Blue + Parchment Cream + tipografÃ­a serif/sans pairing.
 * Sidebar con gradiente ocean, cards con bordes sutiles, charts con paleta Mare.
 * 
 * AISLAMIENTO: Componente 100% independiente. No modifica Perezoso ni StandardDashboard.
 */

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import { useClientConfig } from '@/context/ClientConfigContext';
import { ClientConfig } from '@/config/types';
import PoweredBy from '@/components/PoweredBy';
import {
    Users, Scan, Gift, TrendingUp, LogOut, Mail, Settings, Bell,
    Send, Clock, LayoutDashboard, Menu as MenuIcon, Plus, ChevronRight
} from 'lucide-react';
import { supabase } from '@/lib/supabase';
import { AreaChart, Area, XAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';
import EmailEditor from '@/components/admin/EmailEditor';
import ClientsTab from '@/components/admin/ClientsTab';

/* â”€â”€â”€ Mare Design Tokens â”€â”€â”€ */
const MARE = {
    primary: '#1A3278',
    primaryHover: '#243D8A',
    blueSoft: '#4A6BB5',
    surface: '#F2EDE3',
    canvas: '#FAF8F4',
    gold: '#C8A96E',
    goldLight: '#E8D5A0',
    ink: '#2A2A2E',
    stone: '#8C8B88',
    mist: '#E5E1D9',
    sage: '#5B8C6A',
    terracotta: '#C0574A',
} as const;

const FONTS = {
    serif: 'var(--font-dm-serif), Georgia, serif',
    sans: 'var(--font-jakarta), system-ui, sans-serif',
    mono: 'var(--font-jetbrains), monospace',
} as const;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMPONENTE PRINCIPAL â€” MareDashboard
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

export default function MareDashboard() {
    const router = useRouter();
    const config = useClientConfig();
    const [loading, setLoading] = useState(true);
    const [activeTab, setActiveTab] = useState<'overview' | 'clients' | 'marketing' | 'settings' | 'activity'>('overview');
    const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

    /* â”€â”€â”€ Metrics State â”€â”€â”€ */
    const [metrics, setMetrics] = useState({ totalClients: 0, scansToday: 0, redemptionsTotal: 0 });
    const [chartData, setChartData] = useState<any[]>([]);
    const [activeChart, setActiveChart] = useState<'scans' | 'clients' | 'redemptions'>('scans');

    /* â”€â”€â”€ Marketing State â”€â”€â”€ */
    const [isSending, setIsSending] = useState(false);
    const [activeAudience, setActiveAudience] = useState('Todos');
    const [showEditor, setShowEditor] = useState(false);
    const [editorInitialData, setEditorInitialData] = useState<any>({});
    const [campaigns, setCampaigns] = useState<any[]>([]);
    const [templates, setTemplates] = useState<string[]>([
        '/assets/mare/marketing/mesa-2-1.png',
        '/assets/mare/marketing/mesa-25.jpg',
        '/assets/mare/marketing/mesa-9.png',
        '/assets/mare/marketing/mesa-5.png',
        '/assets/mare/marketing/mesa-15.png',
    ]);

    /* â”€â”€â”€ Init & Auth â”€â”€â”€ */
    useEffect(() => {
        const init = async () => {
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) { router.push('/auth/login?role=staff'); return; }

            const { data: profile } = await supabase.from('profiles').select('role, client_code').eq('id', user.id).single();
            if (!profile || profile.role !== 'admin') { router.push('/staff'); return; }

            // Client Isolation
            let isValidUser = true;
            if (config.code === 'mare_cafe') {
                if (profile.client_code && profile.client_code !== 'mare_cafe') isValidUser = false;
            } else {
                if (profile.client_code && profile.client_code !== config.code) isValidUser = false;
            }
            if (!isValidUser) {
                alert(`Esta cuenta de administrador no pertenece a ${config.name}.`);
                await supabase.auth.signOut();
                router.push('/');
                return;
            }

            await fetchMetrics(config);
            await fetchCampaigns();
            await fetchChartData(config);
            setLoading(false);

            // Realtime
            const changes = supabase
                .channel('mare-admin-rt')
                .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'transaction_logs' }, () => {
                    fetchMetrics(config); fetchChartData(config);
                })
                .on('postgres_changes', { event: 'INSERT', schema: 'public', table: 'profiles' }, () => {
                    fetchMetrics(config);
                })
                .subscribe();

            return () => { supabase.removeChannel(changes); };
        };
        init();
    }, [router, config]);

    /* â”€â”€â”€ Data Fetchers â”€â”€â”€ */
    const fetchMetrics = async (cfg: ClientConfig) => {
        let clientQuery = supabase.from('profiles').select('*', { count: 'exact', head: true }).eq('role', 'customer');
        if (cfg.code === 'mare_cafe') {
            clientQuery = clientQuery.or('client_code.eq.mare_cafe,client_code.is.null');
        } else {
            clientQuery = clientQuery.eq('client_code', cfg.code);
        }
        const { count: clientCount } = await clientQuery;

        const today = new Date().toISOString().split('T')[0];
        let scansQuery = supabase.from('transaction_logs')
            .select('id, profiles!transaction_logs_user_id_fkey!inner(client_code)', { count: 'exact', head: true })
            .eq('type', 'add_stamp').gte('created_at', today);
        if (cfg.code === 'mare_cafe') {
            scansQuery = scansQuery.or('client_code.eq.mare_cafe,client_code.is.null', { foreignTable: 'profiles' });
        } else {
            scansQuery = scansQuery.eq('profiles.client_code', cfg.code);
        }
        const { count: dailyScans } = await scansQuery;

        let redeemsQuery = supabase.from('transaction_logs')
            .select('id, profiles!transaction_logs_user_id_fkey!inner(client_code)', { count: 'exact', head: true })
            .eq('type', 'redeem_reward');
        if (cfg.code === 'mare_cafe') {
            redeemsQuery = redeemsQuery.or('client_code.eq.mare_cafe,client_code.is.null', { foreignTable: 'profiles' });
        } else {
            redeemsQuery = redeemsQuery.eq('profiles.client_code', cfg.code);
        }
        const { count: redemptions } = await redeemsQuery;

        setMetrics({ totalClients: clientCount || 0, scansToday: dailyScans || 0, redemptionsTotal: redemptions || 0 });
    };

    const fetchChartData = async (cfg: ClientConfig) => {
        const today = new Date();
        const last7Days = Array.from({ length: 7 }, (_, i) => {
            const d = new Date(); d.setDate(today.getDate() - (6 - i));
            return d.toISOString().split('T')[0];
        });

        let logsQuery = supabase.from('transaction_logs')
            .select('created_at, type, metadata, profiles!transaction_logs_user_id_fkey!inner(client_code)')
            .gte('created_at', last7Days[0]);
        if (cfg.code === 'mare_cafe') {
            logsQuery = logsQuery.or('client_code.eq.mare_cafe,client_code.is.null', { foreignTable: 'profiles' });
        } else {
            logsQuery = logsQuery.eq('profiles.client_code', cfg.code);
        }
        const { data: logs } = await logsQuery;

        let clientsQuery = supabase.from('profiles').select('created_at').eq('role', 'customer').gte('created_at', last7Days[0]);
        if (cfg.code === 'mare_cafe') {
            clientsQuery = clientsQuery.or('client_code.eq.mare_cafe,client_code.is.null');
        } else {
            clientsQuery = clientsQuery.eq('client_code', cfg.code);
        }
        const { data: newClients } = await clientsQuery;

        const chartMap = last7Days.reduce((acc: any, date) => {
            const dayName = new Date(date).toLocaleDateString('es-ES', { weekday: 'short' });
            acc[date] = { name: dayName.charAt(0).toUpperCase() + dayName.slice(1), scans: 0, redeems: 0, newClients: 0 };
            return acc;
        }, {});

        logs?.forEach(log => {
            const d = log.created_at.split('T')[0];
            if (chartMap[d]) {
                if (log.type === 'add_stamp') chartMap[d].scans += 1;
                if (log.type === 'redeem_reward') chartMap[d].redeems += 1;
            }
        });
        newClients?.forEach(c => {
            const d = c.created_at.split('T')[0];
            if (chartMap[d]) chartMap[d].newClients += 1;
        });

        setChartData(Object.values(chartMap));
    };

    const fetchCampaigns = async () => {
        const { data } = await supabase.from('campaigns').select('*').order('created_at', { ascending: false });
        if (data) setCampaigns(data);
    };

    /* â”€â”€â”€ Marketing Handlers â”€â”€â”€ */
    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
        const file = e.target.files?.[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (ev) => { setTemplates(prev => [...prev, ev.target?.result as string]); };
            reader.readAsDataURL(file);
        }
    };

    const openEditor = (templateUrl: string) => {
        setEditorInitialData({ imageUrl: templateUrl, title: 'Â¡Novedades en Mare Cafe! â˜•ï¸', content: 'Tenemos nuevas promociones esperÃ¡ndote.' });
        setShowEditor(true);
    };

    const handleSendFromEditor = async (data: { title: string; content: string; html: string; audience: string; imageUrl?: string }) => {
        if (!confirm('Â¿EstÃ¡s seguro de enviar esta campaÃ±a a ' + data.audience + '?')) return;
        setIsSending(true);
        try {
            const { data: campaign, error } = await supabase.from('campaigns').insert({
                title: data.title, content: data.content, audience: data.audience, status: 'active',
                metadata: { imageUrl: data.imageUrl || '', client_code: 'mare_cafe' }
            }).select().single();
            if (error) throw error;

            const formData = new FormData();
            formData.append('title', data.title); formData.append('content', data.content);
            formData.append('html', data.html); formData.append('audience', data.audience);
            formData.append('campaignId', campaign.id);

            const { sendCampaign } = await import('@/app/actions/marketing');
            const result = await sendCampaign(formData);
            if (result.success) { alert('âœ… ' + result.message); setShowEditor(false); fetchCampaigns(); }
            else alert('âŒ Error: ' + result.message);
        } catch (e: any) { alert('Error: ' + e.message); }
        finally { setIsSending(false); }
    };

    const toggleCampaignStatus = async (id: string, currentStatus: string) => {
        const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
        const { error } = await supabase.from('campaigns').update({ status: newStatus }).eq('id', id);
        if (!error) setCampaigns(prev => prev.map(c => c.id === id ? { ...c, status: newStatus } : c));
    };

    const handleTestEmail = async () => {
        const email = prompt('Ingresa tu email para la prueba:', 'tu@email.com');
        if (!email) return;
        setIsSending(true);
        const formData = new FormData();
        formData.append('title', '[TEST] Mare Cafe Preview');
        formData.append('content', 'Prueba de visualizaciÃ³n.');
        formData.append('audience', 'Test'); formData.append('testEmail', email);
        try {
            const { sendCampaign } = await import('@/app/actions/marketing');
            const result = await sendCampaign(formData);
            alert(result.success ? 'âœ… ' + result.message : 'âŒ ' + result.message);
        } catch (e: any) { alert('Error: ' + e.message); }
        finally { setIsSending(false); }
    };

    const handleLogout = async () => { await supabase.auth.signOut(); router.push('/'); };

    /* â”€â”€â”€ Loading â”€â”€â”€ */
    if (loading) {
        return (
            <div className="mare-theme" style={{
                minHeight: '100vh', background: MARE.canvas, display: 'flex', alignItems: 'center',
                justifyContent: 'center', fontFamily: FONTS.sans, color: MARE.primary, fontWeight: 500,
            }}>
                Cargando Panel Mare...
            </div>
        );
    }

    /* â”€â”€â”€ Tab Config (filtered by feature flags) â”€â”€â”€ */
    const tabs = [
        { id: 'overview', label: 'Resumen', icon: <LayoutDashboard size={20} />, enabled: true },
        { id: 'clients', label: 'Clientes', icon: <Users size={20} />, enabled: true },
        { id: 'marketing', label: 'Marketing', icon: <Mail size={20} />, enabled: config.features.marketingEnabled },
        { id: 'activity', label: 'Actividad', icon: <Clock size={20} />, enabled: true },
        { id: 'settings', label: 'Ajustes', icon: <Settings size={20} />, enabled: config.features.adminSettingsEnabled },
    ].filter(t => t.enabled);

    return (
        <main className="mare-theme" style={{ minHeight: '100vh', fontFamily: FONTS.sans, display: 'flex', flexDirection: 'row' as const, color: MARE.ink }}>

            {/* â•â•â• MOBILE HEADER â•â•â• */}
            <header className="md:hidden" style={{
                position: 'fixed', top: 0, left: 0, right: 0, height: 64, zIndex: 30,
                background: 'rgba(250,248,244,0.92)', backdropFilter: 'blur(20px) saturate(1.4)',
                borderBottom: `0.5px solid ${MARE.mist}`,
                display: 'flex', alignItems: 'center', justifyContent: 'space-between', padding: '0 16px',
            }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>
                    <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} style={{ padding: 8, background: 'none', border: 'none', cursor: 'pointer', color: MARE.ink }}>
                        <MenuIcon size={24} />
                    </button>
                    <span style={{ fontFamily: FONTS.serif, fontSize: 20, color: MARE.primary, letterSpacing: '-0.02em' }}>Mare</span>
                </div>
                <button
                    onClick={() => router.push('/staff')}
                    style={{
                        padding: 8, borderRadius: 10, background: MARE.primary, color: MARE.surface,
                        border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center',
                    }}
                >
                    <Scan size={20} />
                </button>
            </header>

            {/* â•â•â• MOBILE MENU OVERLAY â•â•â• */}
            {mobileMenuOpen && (
                <div className="md:hidden" onClick={() => setMobileMenuOpen(false)} style={{
                    position: 'fixed', inset: 0, zIndex: 40, background: 'rgba(26,50,120,0.3)', backdropFilter: 'blur(4px)',
                }}>
                    <div onClick={e => e.stopPropagation()} style={{
                        background: MARE.canvas, width: 264, height: '100%', padding: 20,
                        display: 'flex', flexDirection: 'column',
                        boxShadow: '4px 0 24px rgba(0,0,0,0.08)',
                    }}>
                        <h2 style={{ fontFamily: FONTS.serif, fontSize: 22, color: MARE.primary, marginBottom: 24, letterSpacing: '-0.02em' }}>
                            Mare CafÃ©
                        </h2>
                        <nav style={{ flex: 1, display: 'flex', flexDirection: 'column', gap: 4 }}>
                            {tabs.map(tab => (
                                <button key={tab.id}
                                    onClick={() => { setActiveTab(tab.id as any); setMobileMenuOpen(false); }}
                                    style={{
                                        display: 'flex', alignItems: 'center', gap: 12, width: '100%',
                                        padding: '12px 14px', borderRadius: 12, border: 'none', cursor: 'pointer',
                                        fontFamily: FONTS.sans, fontSize: 14, fontWeight: activeTab === tab.id ? 700 : 500,
                                        background: activeTab === tab.id ? `${MARE.primary}10` : 'transparent',
                                        color: activeTab === tab.id ? MARE.primary : MARE.stone,
                                        transition: 'all 200ms ease',
                                    }}
                                >
                                    {tab.icon} {tab.label}
                                </button>
                            ))}
                        </nav>
                        <button onClick={handleLogout} style={{
                            display: 'flex', alignItems: 'center', gap: 12, padding: '12px 14px',
                            background: 'none', border: 'none', cursor: 'pointer', color: MARE.stone, fontFamily: FONTS.sans, fontSize: 14,
                        }}>
                            <LogOut size={20} /> Cerrar SesiÃ³n
                        </button>
                    </div>
                </div>
            )}

            {/* â•â•â• DESKTOP SIDEBAR â€” Ocean Gradient â•â•â• */}
            <aside className="hidden md:flex" style={{
                width: 260, background: 'linear-gradient(175deg, #1A3278 0%, #243D8A 60%, #2E4F9E 100%)',
                color: MARE.surface, flexDirection: 'column', height: '100vh', position: 'sticky', top: 0, zIndex: 40,
            }}>
                {/* Brand */}
                <div style={{ height: 72, display: 'flex', alignItems: 'center', padding: '0 24px', borderBottom: '1px solid rgba(255,255,255,0.1)' }}>
                    <div>
                        <h1 style={{ fontFamily: FONTS.serif, fontSize: 22, letterSpacing: '-0.02em', lineHeight: 1.1 }}>Mare</h1>
                        <span style={{ fontSize: 10, opacity: 0.6, letterSpacing: '0.05em', textTransform: 'uppercase' as const }}>AdministraciÃ³n</span>
                    </div>
                </div>

                {/* Nav */}
                <nav style={{ flex: 1, padding: 16, display: 'flex', flexDirection: 'column', gap: 4, overflowY: 'auto' }}>
                    {tabs.map(tab => {
                        const isActive = activeTab === tab.id;
                        return (
                            <button key={tab.id}
                                onClick={() => setActiveTab(tab.id as any)}
                                style={{
                                    display: 'flex', alignItems: 'center', gap: 12, width: '100%',
                                    padding: '12px 14px', borderRadius: 12, border: 'none', cursor: 'pointer',
                                    fontFamily: FONTS.sans, fontSize: 14, fontWeight: isActive ? 700 : 500,
                                    background: isActive ? 'rgba(255,255,255,0.15)' : 'transparent',
                                    color: isActive ? '#fff' : 'rgba(255,255,255,0.6)',
                                    transition: 'all 200ms ease',
                                }}
                            >
                                {tab.icon} {tab.label}
                            </button>
                        );
                    })}
                </nav>

                {/* Footer */}
                <div style={{ padding: 16, borderTop: '1px solid rgba(255,255,255,0.1)', display: 'flex', flexDirection: 'column', gap: 4 }}>
                    <button onClick={() => router.push('/staff')} style={{
                        display: 'flex', alignItems: 'center', gap: 12, width: '100%', padding: '10px 14px',
                        borderRadius: 12, background: 'none', border: 'none', cursor: 'pointer',
                        color: 'rgba(255,255,255,0.6)', fontFamily: FONTS.sans, fontSize: 13,
                    }}>
                        <Scan size={18} /> EscÃ¡ner Staff
                    </button>
                    <button onClick={handleLogout} style={{
                        display: 'flex', alignItems: 'center', gap: 12, width: '100%', padding: '10px 14px',
                        borderRadius: 12, background: 'none', border: 'none', cursor: 'pointer',
                        color: 'rgba(255,255,255,0.6)', fontFamily: FONTS.sans, fontSize: 13,
                    }}>
                        <LogOut size={18} /> Cerrar SesiÃ³n
                    </button>
                </div>
            </aside>

            {/* â•â•â• MAIN CONTENT AREA â•â•â• */}
            <div style={{ flex: 1, minHeight: '100vh', background: MARE.canvas, overflowY: 'auto' }}>

                {/* Desktop Header */}
                <header className="hidden md:flex" style={{
                    padding: '24px 32px', borderBottom: `0.5px solid ${MARE.mist}`,
                    justifyContent: 'space-between', alignItems: 'flex-end',
                    background: 'rgba(250,248,244,0.8)', backdropFilter: 'blur(12px)',
                    position: 'sticky', top: 0, zIndex: 20,
                }}>
                    <div>
                        <h2 style={{ fontFamily: FONTS.serif, fontSize: 28, color: MARE.primary, letterSpacing: '-0.02em' }}>
                            {tabs.find(t => t.id === activeTab)?.label}
                        </h2>
                        <p style={{ fontSize: 13, color: MARE.stone, marginTop: 4 }}>
                            {new Date().toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                        </p>
                    </div>
                    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>
                        <div style={{ textAlign: 'right' }}>
                            <p style={{ fontSize: 13, fontWeight: 600, color: MARE.ink }}>{config.name}</p>
                            <p style={{ fontSize: 11, color: MARE.stone }}>AdministraciÃ³n</p>
                        </div>
                    </div>
                </header>

                {/* Content */}
                <div style={{ padding: '24px 16px 40px', maxWidth: 1080, margin: '0 auto' }} className="md:px-8 md:pt-8">

                    {/* OVERVIEW */}
                    {activeTab === 'overview' && (
                        <div className="mare-fade-up" style={{ display: 'flex', flexDirection: 'column', gap: 24 }}>
                            {/* Metric Cards */}
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(220px, 1fr))', gap: 16 }}>
                                <MareMetricCard label="Clientes Totales" value={metrics.totalClients} icon={<Users size={22} />} color={MARE.blueSoft} />
                                <MareMetricCard label="Visitas Hoy" value={metrics.scansToday} icon={<Scan size={22} />} color={MARE.sage} />
                                <MareMetricCard label="Premios Canjeados" value={metrics.redemptionsTotal} icon={<Gift size={22} />} color={MARE.gold} />
                            </div>

                            {/* Chart */}
                            <div style={{
                                background: '#fff', borderRadius: 20, padding: 24,
                                border: `1px solid ${MARE.mist}`,
                            }}>
                                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-end', marginBottom: 24 }}>
                                    <div>
                                        <h3 style={{ fontFamily: FONTS.serif, fontSize: 20, color: MARE.primary, letterSpacing: '-0.02em' }}>
                                            MÃ©tricas de Rendimiento
                                        </h3>
                                        <p style={{ fontSize: 12, color: MARE.stone, marginTop: 4 }}>Ãšltimos 7 dÃ­as</p>
                                    </div>
                                    <div style={{ display: 'flex', gap: 4 }}>
                                        {[
                                            { id: 'scans', label: 'Visitas' },
                                            { id: 'clients', label: 'Clientes' },
                                            { id: 'redemptions', label: 'Canjes' },
                                        ].map(opt => (
                                            <button key={opt.id}
                                                onClick={() => setActiveChart(opt.id as any)}
                                                style={{
                                                    padding: '6px 14px', borderRadius: 20, border: 'none', cursor: 'pointer',
                                                    fontSize: 12, fontWeight: 600, fontFamily: FONTS.sans,
                                                    background: activeChart === opt.id ? MARE.primary : 'transparent',
                                                    color: activeChart === opt.id ? MARE.surface : MARE.stone,
                                                    transition: 'all 200ms ease',
                                                }}
                                            >{opt.label}</button>
                                        ))}
                                    </div>
                                </div>
                                <div style={{ height: 280, width: '100%' }}>
                                    <ResponsiveContainer width="100%" height="100%">
                                        <AreaChart data={chartData}>
                                            <defs>
                                                <linearGradient id="mare-chart-fill" x1="0" y1="0" x2="0" y2="1">
                                                    <stop offset="5%" stopColor={MARE.primary} stopOpacity={0.2} />
                                                    <stop offset="95%" stopColor={MARE.primary} stopOpacity={0} />
                                                </linearGradient>
                                            </defs>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke={MARE.mist} />
                                            <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{ fill: MARE.stone, fontSize: 12 }} dy={10} />
                                            <Tooltip
                                                contentStyle={{ borderRadius: 12, border: `1px solid ${MARE.mist}`, boxShadow: '0 4px 16px rgba(0,0,0,0.06)', fontFamily: FONTS.sans }}
                                                formatter={(value: any, name?: string) => {
                                                    const labels: Record<string, string> = { scans: 'Escaneos', redeems: 'Canjes', newClients: 'Nuevos' };
                                                    return [value, name ? (labels[name] || name) : ''];
                                                }}
                                            />
                                            {activeChart === 'scans' && <Area type="monotone" dataKey="scans" stroke={MARE.primary} strokeWidth={2.5} fill="url(#mare-chart-fill)" />}
                                            {activeChart === 'redemptions' && <Area type="monotone" dataKey="redeems" stroke={MARE.gold} strokeWidth={2.5} fill="url(#mare-chart-fill)" />}
                                            {activeChart === 'clients' && <Area type="monotone" dataKey="newClients" stroke={MARE.blueSoft} strokeWidth={2.5} fill="url(#mare-chart-fill)" />}
                                        </AreaChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* CLIENTS */}
                    {activeTab === 'clients' && (
                        <div className="mare-fade-up" style={{
                            background: '#fff', borderRadius: 20, border: `1px solid ${MARE.mist}`, padding: 4,
                        }}>
                            <ClientsTab />
                        </div>
                    )}

                    {/* MARKETING */}
                    {activeTab === 'marketing' && (
                        <div className="mare-fade-up" style={{ display: 'flex', flexDirection: 'column', gap: 24 }}>
                            <div style={{ background: '#fff', borderRadius: 20, padding: 24, border: `1px solid ${MARE.mist}` }}>
                                <h3 style={{ fontFamily: FONTS.serif, fontSize: 20, color: MARE.primary, marginBottom: 20, letterSpacing: '-0.02em' }}>
                                    Nueva CampaÃ±a
                                </h3>

                                {/* Audience */}
                                <div style={{ marginBottom: 24 }}>
                                    <label style={{ display: 'block', fontSize: 11, fontWeight: 600, color: MARE.stone, letterSpacing: '0.08em', textTransform: 'uppercase' as const, marginBottom: 10 }}>
                                        Audiencia
                                    </label>
                                    <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>
                                        {['Todos', 'Nivel 2+ (Frecuentes)', 'Nivel 3+ (VIP)'].map(label => (
                                            <button key={label} onClick={() => setActiveAudience(label)} style={{
                                                padding: '10px 18px', borderRadius: 12,
                                                fontSize: 13, fontWeight: 600, fontFamily: FONTS.sans, cursor: 'pointer',
                                                background: activeAudience === label ? MARE.primary : 'transparent',
                                                color: activeAudience === label ? MARE.surface : MARE.stone,
                                                border: activeAudience === label ? 'none' : `1.5px solid ${MARE.mist}`,
                                                transition: 'all 200ms ease',
                                            }}>{label}</button>
                                        ))}
                                    </div>
                                </div>

                                {/* Templates */}
                                <div style={{ marginBottom: 24 }}>
                                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 10 }}>
                                        <label style={{ fontSize: 11, fontWeight: 600, color: MARE.stone, letterSpacing: '0.08em', textTransform: 'uppercase' as const }}>
                                            Selecciona DiseÃ±o
                                        </label>
                                        <label style={{
                                            display: 'flex', alignItems: 'center', gap: 4, cursor: 'pointer',
                                            fontSize: 12, fontWeight: 600, color: MARE.primary,
                                            padding: '6px 12px', borderRadius: 8, border: `1px solid ${MARE.mist}`,
                                        }}>
                                            <Plus size={14} /> Subir
                                            <input type="file" className="hidden" style={{ display: 'none' }} accept="image/*" onChange={handleFileUpload} />
                                        </label>
                                    </div>
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(140px, 1fr))', gap: 12 }}>
                                        {templates.map((src, idx) => (
                                            <div key={idx} onClick={() => openEditor(src)} style={{
                                                aspectRatio: '3/4', borderRadius: 16, overflow: 'hidden', cursor: 'pointer',
                                                border: `1px solid ${MARE.mist}`, transition: 'all 200ms ease', position: 'relative',
                                            }}>
                                                <img src={src} alt={`Template ${idx}`} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
                                                <div style={{
                                                    position: 'absolute', inset: 0, background: 'rgba(26,50,120,0.5)',
                                                    opacity: 0, transition: 'opacity 200ms', display: 'flex', alignItems: 'center', justifyContent: 'center',
                                                }}
                                                    onMouseEnter={e => (e.currentTarget.style.opacity = '1')}
                                                    onMouseLeave={e => (e.currentTarget.style.opacity = '0')}
                                                >
                                                    <span style={{
                                                        background: '#fff', color: MARE.primary, padding: '8px 16px', borderRadius: 10,
                                                        fontSize: 12, fontWeight: 600, fontFamily: FONTS.sans,
                                                    }}>
                                                        Usar DiseÃ±o
                                                    </span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>

                                <button onClick={handleTestEmail} style={{
                                    width: '100%', padding: '14px 0', borderRadius: 12,
                                    background: MARE.surface, color: MARE.primary, border: `1px solid ${MARE.mist}`,
                                    fontFamily: FONTS.sans, fontSize: 13, fontWeight: 600, cursor: 'pointer',
                                }}>
                                    ðŸ§ª Enviar Prueba RÃ¡pida
                                </button>
                            </div>

                            {/* Campaign History */}
                            <div style={{ background: '#fff', borderRadius: 20, padding: 24, border: `1px solid ${MARE.mist}` }}>
                                <h3 style={{ fontFamily: FONTS.serif, fontSize: 18, color: MARE.primary, marginBottom: 16, letterSpacing: '-0.02em' }}>
                                    Historial de EnvÃ­os
                                </h3>
                                {campaigns.length === 0 ? (
                                    <div style={{ textAlign: 'center', padding: '32px 0', color: MARE.stone, fontSize: 13, border: `2px dashed ${MARE.mist}`, borderRadius: 16 }}>
                                        No hay campaÃ±as enviadas aÃºn.
                                    </div>
                                ) : (
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>
                                        {campaigns.map(camp => (
                                            <div key={camp.id} style={{
                                                display: 'flex', gap: 12, padding: 12, borderRadius: 14,
                                                border: `1px solid ${MARE.mist}`, alignItems: 'center', transition: 'all 200ms ease',
                                            }}>
                                                <div style={{
                                                    width: 48, height: 48, borderRadius: 10, overflow: 'hidden', flexShrink: 0,
                                                    background: MARE.surface, display: 'flex', alignItems: 'center', justifyContent: 'center',
                                                }}>
                                                    {camp.metadata?.imageUrl
                                                        ? <img src={camp.metadata.imageUrl} style={{ width: '100%', height: '100%', objectFit: 'cover' }} />
                                                        : <Mail size={18} color={MARE.stone} />}
                                                </div>
                                                <div style={{ flex: 1, minWidth: 0 }}>
                                                    <h4 style={{ fontSize: 13, fontWeight: 600, color: MARE.ink, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{camp.title}</h4>
                                                    <p style={{ fontSize: 11, color: MARE.stone, marginTop: 2 }}>{new Date(camp.created_at).toLocaleDateString()}</p>
                                                </div>
                                                <span style={{
                                                    fontSize: 10, fontWeight: 600, padding: '4px 10px', borderRadius: 8,
                                                    background: camp.status === 'active' ? `${MARE.sage}20` : `${MARE.mist}`,
                                                    color: camp.status === 'active' ? MARE.sage : MARE.stone,
                                                    textTransform: 'uppercase' as const, letterSpacing: '0.04em',
                                                }}>
                                                    {camp.status === 'active' ? 'Activa' : 'Inactiva'}
                                                </span>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                        </div>
                    )}

                    {/* ACTIVITY */}
                    {activeTab === 'activity' && (
                        <div className="mare-fade-up" style={{
                            background: '#fff', borderRadius: 20, padding: 24, border: `1px solid ${MARE.mist}`,
                            textAlign: 'center', color: MARE.stone,
                        }}>
                            <Clock size={32} style={{ margin: '0 auto 12px', opacity: 0.4 }} />
                            <p style={{ fontSize: 14 }}>Registro de actividad prÃ³ximamente</p>
                        </div>
                    )}

                    {/* SETTINGS */}
                    {activeTab === 'settings' && (
                        <div className="mare-fade-up" style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>
                            <div style={{ background: '#fff', borderRadius: 20, padding: 24, border: `1px solid ${MARE.mist}` }}>
                                <h3 style={{ fontFamily: FONTS.serif, fontSize: 18, color: MARE.primary, marginBottom: 16, letterSpacing: '-0.02em' }}>
                                    Reglas de Negocio
                                </h3>
                                <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>
                                    <MareSettingRow label="Happy Hour (Puntos Dobles)" desc="Los clientes suman x2 sellos al escanear." />
                                    <MareSettingRow label="Solicitar PIN en Canjes" desc="Mayor seguridad al entregar premios." defaultOn />
                                </div>
                            </div>
                            <div style={{ background: '#fff', borderRadius: 20, padding: 24, border: `1px solid ${MARE.mist}` }}>
                                <h3 style={{ fontFamily: FONTS.serif, fontSize: 18, color: MARE.primary, marginBottom: 16, letterSpacing: '-0.02em' }}>
                                    ConfiguraciÃ³n General
                                </h3>
                                <p style={{ fontSize: 13, color: MARE.stone, marginBottom: 16 }}>ConfiguraciÃ³n para {config.name}</p>
                                <button style={{
                                    width: '100%', padding: '14px 0', borderRadius: 12,
                                    background: MARE.primary, color: MARE.surface, border: 'none',
                                    fontFamily: FONTS.sans, fontSize: 14, fontWeight: 600, cursor: 'pointer',
                                }}>
                                    Actualizar Credenciales
                                </button>
                            </div>
                        </div>
                    )}
                </div>
            </div>

            {/* â•â•â• Email Editor Modal â•â•â• */}
            {showEditor && (
                <EmailEditor
                    initialData={editorInitialData}
                    onClose={() => setShowEditor(false)}
                    onSend={handleSendFromEditor}
                    audience={activeAudience}
                    isSending={isSending}
                />
            )}
        </main>
    );
}

/* â”€â”€â”€ Sub-Components (Mare-scoped) â”€â”€â”€ */

/** Tarjeta de mÃ©trica con estilo editorial Mare */
function MareMetricCard({ label, value, icon, color }: { label: string; value: number; icon: React.ReactNode; color: string }) {
    return (
        <div style={{
            background: '#fff', borderRadius: 16, padding: '20px 24px',
            border: `1px solid ${MARE.mist}`, display: 'flex', alignItems: 'center', gap: 16,
            transition: 'all 200ms ease',
        }}>
            <div style={{
                width: 48, height: 48, borderRadius: 14, display: 'flex', alignItems: 'center', justifyContent: 'center',
                background: `${color}15`, color: color,
            }}>
                {icon}
            </div>
            <div>
                <p style={{ fontSize: 11, fontWeight: 600, color: MARE.stone, letterSpacing: '0.04em', textTransform: 'uppercase' as const }}>{label}</p>
                <h3 style={{ fontFamily: FONTS.mono, fontSize: 28, fontWeight: 700, color: MARE.ink, lineHeight: 1.1, marginTop: 2 }}>{value}</h3>
            </div>
        </div>
    );
}

/** Fila de ajuste toggle con estilo Mare */
function MareSettingRow({ label, desc, defaultOn = false }: { label: string; desc: string; defaultOn?: boolean }) {
    const [on, setOn] = useState(defaultOn);
    return (
        <div style={{
            display: 'flex', justifyContent: 'space-between', alignItems: 'center',
            padding: '8px 0', borderBottom: `0.5px solid ${MARE.mist}`,
        }}>
            <div>
                <h4 style={{ fontSize: 14, fontWeight: 600, color: MARE.ink }}>{label}</h4>
                <p style={{ fontSize: 12, color: MARE.stone, marginTop: 2 }}>{desc}</p>
            </div>
            <button
                onClick={() => setOn(!on)}
                style={{
                    width: 44, height: 24, borderRadius: 12, border: 'none', cursor: 'pointer',
                    background: on ? MARE.primary : MARE.mist, position: 'relative', transition: 'background 200ms ease',
                    flexShrink: 0,
                }}
            >
                <div style={{
                    width: 20, height: 20, borderRadius: '50%', background: '#fff',
                    position: 'absolute', top: 2,
                    left: on ? 22 : 2, transition: 'left 200ms ease',
                    boxShadow: '0 1px 3px rgba(0,0,0,0.1)',
                }} />
            </button>
        </div>
    );
}
</file>

<file path="src/components/admin/dashboards/PerezosoDashboard.tsx">
'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import { useClientConfig } from '@/context/ClientConfigContext';
import { ClientConfig } from '@/config/types';
import PoweredBy from '@/components/PoweredBy';
import { Users, Scan, Gift, TrendingUp, LogOut, Mail, Settings, Bell, ChevronRight, Send, Save, CreditCard, Clock } from 'lucide-react';
import { supabase } from '@/lib/supabase';
import {
    AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar
} from 'recharts';
import EmailEditor from '@/components/admin/EmailEditor';
import { Plus } from 'lucide-react';
import ClientsTab from '@/components/admin/ClientsTab';

export default function PerezosoDashboard() {
    const router = useRouter();
    const config = useClientConfig();
    const [loading, setLoading] = useState(true);
    const [activeTab, setActiveTab] = useState<'overview' | 'clients' | 'marketing' | 'settings' | 'activity'>('overview');

    // Metrics State
    const [metrics, setMetrics] = useState({
        totalClients: 0,
        scansToday: 0,
        redemptionsTotal: 0
    });

    const [chartData, setChartData] = useState<any[]>([]);
    const [activeChart, setActiveChart] = useState<'scans' | 'clients' | 'redemptions'>('scans');

    useEffect(() => {
        const init = async () => {
            // Config is already active via Context

            const { data: { user } } = await supabase.auth.getUser();
            if (!user) { router.push('/auth/login?role=staff'); return; }

            const { data: profile } = await supabase.from('profiles').select('role, client_code').eq('id', user.id).single();
            if (!profile || profile.role !== 'admin') {
                router.push('/staff');
                return;
            }

            // Client Isolation Check
            let isValidUser = true;
            if (config.code === 'perezoso_cafe') {
                if (profile.client_code !== 'perezoso_cafe') isValidUser = false;
            } else if (config.code === 'mare_cafe') {
                if (profile.client_code && profile.client_code !== 'mare_cafe') isValidUser = false;
            } else {
                if (profile.client_code && profile.client_code !== config.code) isValidUser = false;
            }

            if (!isValidUser) {
                alert(`Esta cuenta de administrador no pertenece a ${config.name}.`);
                await supabase.auth.signOut();
                router.push('/');
                return;
            }

            const fetchMetrics = async (cfg: ClientConfig) => {
                // 1. Clients
                let clientQuery = supabase.from('profiles').select('*', { count: 'exact', head: true }).eq('role', 'customer');
                if (cfg.code === 'mare_cafe') {
                    clientQuery = clientQuery.or('client_code.eq.mare_cafe,client_code.is.null');
                } else {
                    clientQuery = clientQuery.eq('client_code', cfg.code);
                }
                const { count: clientCount } = await clientQuery;

                // 2. Scans (Joined with Profiles)
                const today = new Date().toISOString().split('T')[0];
                let scansQuery = supabase.from('transaction_logs')
                    .select('id, profiles!transaction_logs_user_id_fkey!inner(client_code)', { count: 'exact', head: true })
                    .eq('type', 'add_stamp')
                    .gte('created_at', today);

                if (cfg.code === 'mare_cafe') {
                    scansQuery = scansQuery.or('client_code.eq.mare_cafe,client_code.is.null', { foreignTable: 'profiles' });
                } else {
                    scansQuery = scansQuery.eq('profiles.client_code', cfg.code);
                }
                const { count: dailyScans } = await scansQuery;

                // 3. Redemptions
                let redeemsQuery = supabase.from('transaction_logs')
                    .select('id, profiles!transaction_logs_user_id_fkey!inner(client_code)', { count: 'exact', head: true })
                    .eq('type', 'redeem_reward');

                if (cfg.code === 'mare_cafe') {
                    redeemsQuery = redeemsQuery.or('client_code.eq.mare_cafe,client_code.is.null', { foreignTable: 'profiles' });
                } else {
                    redeemsQuery = redeemsQuery.eq('profiles.client_code', cfg.code);
                }
                const { count: redemptions } = await redeemsQuery;

                setMetrics({
                    totalClients: clientCount || 0,
                    scansToday: dailyScans || 0,
                    redemptionsTotal: redemptions || 0
                });
            };

            const fetchChartData = async (cfg: ClientConfig) => {
                const today = new Date();
                const last7Days = Array.from({ length: 7 }, (_, i) => {
                    const d = new Date();
                    d.setDate(today.getDate() - (6 - i));
                    return d.toISOString().split('T')[0];
                });

                // Fetch logs for the last 7 days
                let logsQuery = supabase
                    .from('transaction_logs')
                    .select('created_at, type, metadata, profiles!transaction_logs_user_id_fkey!inner(client_code)')
                    .gte('created_at', last7Days[0]);

                if (cfg.code === 'mare_cafe') {
                    logsQuery = logsQuery.or('client_code.eq.mare_cafe,client_code.is.null', { foreignTable: 'profiles' });
                } else {
                    logsQuery = logsQuery.eq('profiles.client_code', cfg.code);
                }
                const { data: logs } = await logsQuery;

                let clientsQuery = supabase
                    .from('profiles')
                    .select('created_at')
                    .eq('role', 'customer')
                    .gte('created_at', last7Days[0]);

                if (cfg.code === 'mare_cafe') {
                    clientsQuery = clientsQuery.or('client_code.eq.mare_cafe,client_code.is.null');
                } else {
                    clientsQuery = clientsQuery.eq('client_code', cfg.code);
                }

                const { data: newClients } = await clientsQuery;

                const chartDataMap = last7Days.reduce((acc: any, date) => {
                    const dayName = new Date(date).toLocaleDateString('es-ES', { weekday: 'short' });
                    acc[date] = {
                        name: dayName.charAt(0).toUpperCase() + dayName.slice(1),
                        scans: 0,
                        redeems: 0,
                        newClients: 0
                    };
                    return acc;
                }, {});

                logs?.forEach(log => {
                    const date = log.created_at.split('T')[0];
                    if (chartDataMap[date]) {
                        if (log.type === 'add_stamp') chartDataMap[date].scans += 1;
                        if (log.type === 'redeem_reward') chartDataMap[date].redeems += 1;
                    }
                });

                newClients?.forEach(client => {
                    const date = client.created_at.split('T')[0];
                    if (chartDataMap[date]) {
                        chartDataMap[date].newClients += 1;
                    }
                });

                setChartData(Object.values(chartDataMap));
            };

            await fetchMetrics(config);
            await fetchCampaigns();
            await fetchChartData(config);
            setLoading(false);

            // Realtime Subscriptions
            const changes = supabase
                .channel('admin-dashboard-realtime')
                .on(
                    'postgres_changes',
                    { event: 'INSERT', schema: 'public', table: 'transaction_logs' },
                    (payload) => {
                        console.log('New transaction:', payload);
                        fetchMetrics(config);
                        fetchChartData(config);
                    }
                )
                .on(
                    'postgres_changes',
                    { event: 'INSERT', schema: 'public', table: 'profiles' },
                    (payload) => {
                        console.log('New profile:', payload);
                        fetchMetrics(config);
                    }
                )
                .subscribe();

            return () => {
                supabase.removeChannel(changes);
            };
        };
        init();
    }, [router, config]);

    const [isSending, setIsSending] = useState(false);
    const [activeAudience, setActiveAudience] = useState('Todos');
    const [showEditor, setShowEditor] = useState(false);
    const [editorInitialData, setEditorInitialData] = useState<any>({});

    // Templates State
    const [templates, setTemplates] = useState<string[]>([
        '/clients/mare_cafe/flyer_template_1_1769954037447.png',
        '/clients/mare_cafe/flyer_template_2_1769954052827.png',
        '/clients/mare_cafe/flyer_template_3_1769954068639.png'
    ]);

    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
        const file = e.target.files?.[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const result = e.target?.result as string;
                setTemplates(prev => [...prev, result]);
            };
            reader.readAsDataURL(file);
        }
    };

    const openEditor = (templateUrl: string) => {
        setEditorInitialData({
            imageUrl: templateUrl,
            title: 'Â¡Novedades en Mare Cafe! â˜•ï¸',
            content: 'Tenemos nuevas promociones esperÃ¡ndote. Ven y disfruta de un momento especial.'
        });
        setShowEditor(true);
    };

    // Campaigns State
    const [campaigns, setCampaigns] = useState<any[]>([]);

    const fetchCampaigns = async () => {
        const { data } = await supabase.from('campaigns').select('*').order('created_at', { ascending: false });
        if (data) setCampaigns(data);
    };

    const handleSendFromEditor = async (data: { title: string; content: string; html: string; audience: string; imageUrl?: string }) => {
        if (!confirm('Â¿EstÃ¡s seguro de enviar esta campaÃ±a a ' + data.audience + '?')) return;

        setIsSending(true);

        try {
            // 1. Create Campaign in DB
            const { data: campaign, error } = await supabase.from('campaigns').insert({
                title: data.title,
                content: data.content,
                audience: data.audience,
                status: 'active',
                metadata: { imageUrl: data.imageUrl || '' } // Store image URL reference
            }).select().single();

            if (error) throw error;

            // 2. Send via Resend (Server Action)
            // Note: We might want to pass campaignId to the action to generate the dynamic QR link
            // For now, let's append campaignId to FormData so the action can incorporate it
            const formData = new FormData();
            formData.append('title', data.title);
            formData.append('content', data.content);
            formData.append('html', data.html);
            formData.append('audience', data.audience);
            formData.append('campaignId', campaign.id); // Valid UUID

            const { sendCampaign } = await import('@/app/actions/marketing');
            const result = await sendCampaign(formData);

            if (result.success) {
                alert('âœ… ' + result.message);
                setShowEditor(false); // Close editor on success
                fetchCampaigns(); // Refresh list
            } else {
                alert('âŒ Error: ' + result.message);
                // Optional: rollback DB creation if email fails? Or just leave it as draft?
            }
        } catch (e: any) {
            alert('Error inesperado: ' + e.message);
            console.error(e);
        } finally {
            setIsSending(false);
        }
    };

    const toggleCampaignStatus = async (id: string, currentStatus: string) => {
        const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
        const { error } = await supabase.from('campaigns').update({ status: newStatus }).eq('id', id);

        if (error) {
            alert('Error cambiando estado');
        } else {
            // Optimistic update
            setCampaigns(prev => prev.map(c => c.id === id ? { ...c, status: newStatus } : c));
        }
    };

    // Keep legacy handle for the direct "Enviar CampaÃ±a" button if needed, 
    // or we can remove the old UI section. For now, let's keep the tool but disable the old button to force using the editor?
    // Actually the user wanted "que cuando se apreta 'usar' salga un editor".

    const handleSendCampaign = async () => {
        // This was the old direct send. Let's redirect to editor or keep as "Quick Send"
        // For now, let's just leave it but maybe we don't need it if we have the editor.
        // User said: "me gustaria que las 3 portadas... se puedan editar... o sale un editor"
        // So the main flow should be via templates.
        alert("Por favor selecciona un diseÃ±o para editar y enviar.");
    };

    const handleTestEmail = async () => {
        const email = prompt('Ingresa tu email para la prueba:', 'tu@email.com');
        if (!email) return;

        setIsSending(true);
        const formData = new FormData();
        formData.append('title', '[TEST] Vista Previa Mare Cafe');
        formData.append('content', 'Esta es una PRUEBA de visualizaciÃ³n del flyer.');
        formData.append('audience', 'Test');
        formData.append('testEmail', email);

        try {
            const { sendCampaign } = await import('@/app/actions/marketing');
            const result = await sendCampaign(formData);
            alert(result.success ? 'âœ… ' + result.message : 'âŒ ' + result.message);
        } catch (e: any) {
            alert('Error: ' + e.message);
        } finally {
            setIsSending(false);
        }
    };

    const handleLogout = async () => {
        await supabase.auth.signOut();
        router.push('/');
    };

    if (loading) return <div className="flex h-screen items-center justify-center bg-gray-50 text-blue-900 font-bold animate-pulse">Cargando Panel...</div>;

    return (
        <main className="min-h-screen bg-gray-50 font-sans flex flex-col md:flex-row pb-20 md:pb-0">


            {/* --- MOBILE HEADER (Dynamic Theming of Glassmorphism and Colors) --- */}
            <header className="md:hidden fixed top-0 left-0 right-0 h-20 bg-white/80 backdrop-blur-md z-30 flex items-center justify-between px-6 rounded-b-3xl shadow-sm border-b border-white/20">
                <div className="flex items-center gap-3">
                    {config.assets?.logo ? (
                        <img src={config.assets.logo} alt="Logo" className="h-12 w-auto object-contain drop-shadow-sm" />
                    ) : (
                        <div className="w-10 h-10 rounded-full bg-brand-primary flex items-center justify-center text-white font-brand font-bold text-xl shadow-md">
                            {config.name.charAt(0)}
                        </div>
                    )}
                    <div className="flex flex-col">
                        <h1 className="font-brand font-bold text-brand-primary text-xl tracking-tight leading-none">
                            {activeTab === 'overview' && 'Hola, Admin! ðŸ‘‹'}
                            {activeTab === 'clients' && 'Tus Clientes ðŸ‘¥'}
                            {activeTab === 'marketing' && 'Novedades âœ¨'}
                            {activeTab === 'settings' && 'Ajustes âš™ï¸'}
                            {activeTab === 'activity' && 'Actividad ðŸ•’'}
                        </h1>
                        <p className="text-brand-secondary text-opacity-80 text-xs font-medium">{config.name}</p>
                    </div>
                </div>
                <button
                    onClick={() => router.push('/staff')}
                    className="relative p-2 rounded-2xl bg-orange-50 hover:bg-orange-100 transition shadow-sm border border-orange-200"
                >
                    <Scan size={20} className="text-brand-primary" />
                </button>
            </header>


            {/* --- SIDEBAR (Desktop Only - Dynamic) --- */}
            <aside
                className="hidden md:flex w-72 text-white flex-col h-screen sticky top-0 shadow-xl z-40 transition-all duration-300 bg-brand-primary"
            >
                <div className="h-24 flex items-center justify-center px-6 border-b border-white/10">
                    {config.assets?.logo ? (
                        <img
                            src={config.assets.logo}
                            alt="Logo"
                            className="h-16 w-auto object-contain transition-transform hover:scale-105 duration-500"
                        />
                    ) : (
                        <h1 className="font-brand font-bold text-2xl tracking-wide">{config.name}</h1>
                    )}
                </div>

                <nav className="flex-1 p-4 space-y-2 overflow-y-auto">
                    <NavButton
                        active={activeTab === 'overview'}
                        onClick={() => setActiveTab('overview')}
                        icon={<TrendingUp size={20} />}
                        label="Resumen de Negocio"
                        themeColor="var(--brand-primary)"
                    />
                    <NavButton
                        active={activeTab === 'clients'}
                        onClick={() => setActiveTab('clients')}
                        icon={<Users size={20} />}
                        label="Base de Clientes"
                        themeColor="var(--brand-primary)"
                    />
                    {config.features.marketingEnabled && (
                        <NavButton
                            active={activeTab === 'marketing'}
                            onClick={() => setActiveTab('marketing')}
                            icon={<Mail size={20} />}
                            label="CampaÃ±as & Novedades"
                            themeColor="var(--brand-primary)"
                        />
                    )}
                    <NavButton
                        active={activeTab === 'activity'}
                        onClick={() => setActiveTab('activity')}
                        icon={<Clock size={20} />}
                        label="Actividad Reciente"
                        themeColor="var(--brand-primary)"
                    />
                    {config.features.adminSettingsEnabled && (
                        <NavButton
                            active={activeTab === 'settings'}
                            onClick={() => setActiveTab('settings')}
                            icon={<Settings size={20} />}
                            label="ConfiguraciÃ³n"
                            themeColor="var(--brand-primary)"
                        />
                    )}
                </nav>

                <div className="p-4 border-t border-white/10 space-y-2">
                    <button
                        onClick={() => router.push('/staff')}
                        className="flex items-center gap-3 w-full p-3 rounded-xl text-white/70 hover:bg-white/10 hover:text-white transition-all group"
                    >
                        <Scan size={20} className="group-hover:scale-110 transition-transform" />
                        <span className="font-medium text-sm">Ir al EscÃ¡ner</span>
                    </button>
                    <button
                        onClick={handleLogout}
                        className="flex items-center gap-3 w-full p-3 rounded-xl text-white/70 hover:bg-white/10 hover:text-white transition-all group"
                    >
                        <LogOut size={20} className="group-hover:scale-110 transition-transform" />
                        <span className="font-medium text-sm">Cerrar SesiÃ³n</span>
                    </button>
                </div>
            </aside>

            {/* --- MAIN CONTENT --- */}
            <div className="flex-1 min-h-screen bg-[#F8FAFC] pt-16 md:pt-0 overflow-y-auto w-full">

                {/* Desktop Header */}
                <header className="hidden md:flex bg-white/80 backdrop-blur-md sticky top-0 z-20 px-8 py-5 border-b border-slate-100 justify-between items-center">
                    <div>
                        <h2 className="text-2xl font-bold text-slate-800 tracking-tight">
                            {activeTab === 'overview' && 'Hola, Admin ðŸ‘‹'}
                            {activeTab === 'clients' && 'GestiÃ³n de Clientes'}
                            {activeTab === 'marketing' && 'Marketing & Novedades'}
                            {activeTab === 'settings' && 'Ajustes de Tienda'}
                            {activeTab === 'activity' && 'Historial de Actividad'}
                        </h2>
                        <p className="text-slate-400 text-sm mt-1">
                            {new Date().toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' })}
                        </p>
                    </div>
                    <div className="flex items-center gap-4">
                        <div className="text-right hidden lg:block">
                            <p className="text-sm font-bold text-slate-700">Cuenta Administrativa</p>
                            <p className="text-xs text-slate-400">{config.name}</p>
                        </div>
                        <div className="w-10 h-10 rounded-full bg-slate-100 border border-slate-200 overflow-hidden shadow-sm">
                            <img src={`https://ui-avatars.com/api/?name=Admin&background=random`} alt="Admin" className="w-full h-full object-cover" />
                        </div>
                    </div>
                </header>

                <div className="p-4 md:p-8 space-y-6 md:space-y-8 max-w-7xl mx-auto pb-28 md:pb-8 pt-24 md:pt-0"> {/* Added pt-24 for fixed header */}

                    {/* OVERVIEW TAB */}
                    {activeTab === 'overview' && (
                        <div className="space-y-6 md:space-y-8 animate-in fade-in duration-500 slide-in-from-bottom-2">
                            {/* Key Metrics (Super Lindo Style) */}
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
                                <MetricCard
                                    title="Clientes Totales"
                                    value={metrics.totalClients}
                                    icon={<Users size={24} />}
                                    color="bg-[#81D4FA] text-[#01579B]" // Pastel Blue
                                    bgStyle="bg-[#E1F5FE]"
                                    trend="+12% este mes"
                                    trendColor="text-[#0277BD] bg-[#B3E5FC]"
                                    isActive={activeChart === 'clients'}
                                    onClick={() => setActiveChart('clients')}
                                />
                                <MetricCard
                                    title="Visitas Hoy"
                                    value={metrics.scansToday}
                                    icon={<Scan size={24} />}
                                    color="bg-[#A5D6A7] text-[#1B5E20]" // Pastel Green
                                    bgStyle="bg-[#E8F5E9]"
                                    trend="En vivo"
                                    trendColor="text-[#2E7D32] bg-[#C8E6C9]"
                                    isActive={activeChart === 'scans'}
                                    onClick={() => setActiveChart('scans')}
                                />
                                <MetricCard
                                    title="Premios Dados"
                                    value={metrics.redemptionsTotal}
                                    icon={<Gift size={24} />}
                                    color="bg-[#CE93D8] text-[#4A148C]" // Pastel Purple
                                    bgStyle="bg-[#F3E5F5]"
                                    trend="Fidelidad alta"
                                    trendColor="text-[#7B1FA2] bg-[#E1BEE7]"
                                    isActive={activeChart === 'redemptions'}
                                    onClick={() => setActiveChart('redemptions')}
                                />
                            </div>

                            {/* Chart Section (Rounded & Soft) */}
                            <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 transition-all hover:shadow-lg hover:-translate-y-1">
                                <div className="flex flex-col sm:flex-row justify-between items-start sm:items-end mb-6 gap-4">
                                    <div>
                                        <h3 className="text-xl font-fredoka font-bold text-[#5D4037]">
                                            {activeChart === 'scans' && 'Tendencia de Escaneos'}
                                            {activeChart === 'clients' && 'Crecimiento de Clientes'}
                                            {activeChart === 'redemptions' && 'Historial de Canjes'}
                                        </h3>
                                        <p className="text-[#A1887F] text-sm mt-1">
                                            {activeChart === 'scans' && 'Actividad de visitas diarias.'}
                                            {activeChart === 'clients' && 'Nuevos registros en la plataforma.'}
                                            {activeChart === 'redemptions' && 'Premios entregados por el staff.'}
                                        </p>
                                    </div>
                                    <div className="flex gap-2 text-xs font-bold text-[#8D6E63] bg-[#EFEBE9] px-4 py-2 rounded-full border border-[#D7CCC8]">
                                        Ãšltimos 7 dÃ­as
                                    </div>
                                </div>
                                <div className="h-[250px] md:h-[350px] w-full">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <AreaChart data={chartData}>
                                            <defs>
                                                <linearGradient id="colorMain" x1="0" y1="0" x2="0" y2="1">
                                                    <stop offset="5%" stopColor={activeChart === 'scans' ? '#A5D6A7' : activeChart === 'redemptions' ? '#CE93D8' : '#81D4FA'} stopOpacity={0.4} />
                                                    <stop offset="95%" stopColor={activeChart === 'scans' ? '#A5D6A7' : activeChart === 'redemptions' ? '#CE93D8' : '#81D4FA'} stopOpacity={0} />
                                                </linearGradient>
                                            </defs>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#F1F5F9" />
                                            <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{ fill: '#A1887F', fontSize: 12, fontFamily: 'Fredoka' }} dy={10} />
                                            <Tooltip
                                                contentStyle={{ borderRadius: '16px', border: 'none', boxShadow: '0 10px 25px -5px rgba(0, 0, 0, 0.1)', padding: '16px', fontFamily: 'Fredoka' }}
                                                itemStyle={{ fontSize: '14px', fontWeight: 600, color: '#5D4037' }}
                                                labelStyle={{ color: '#A1887F', marginBottom: '8px', fontSize: '12px' }}
                                                formatter={(value, name) => {
                                                    if (name === 'scans') return [value, 'Escaneos'];
                                                    if (name === 'redeems') return [value, 'Canjes'];
                                                    if (name === 'newClients') return [value, 'Nuevos Clientes'];
                                                    return [value, name];
                                                }}
                                                labelFormatter={(label) => `ðŸ“… ${label}`}
                                            />
                                            {activeChart === 'scans' && (
                                                <Area type="monotone" dataKey="scans" stroke="#4CAF50" strokeWidth={4} fillOpacity={1} fill="url(#colorMain)" animationDuration={1000} />
                                            )}
                                            {activeChart === 'redemptions' && (
                                                <Area type="monotone" dataKey="redeems" stroke="#9C27B0" strokeWidth={4} fillOpacity={1} fill="url(#colorMain)" animationDuration={1000} />
                                            )}
                                            {activeChart === 'clients' && (
                                                <Area type="monotone" dataKey="newClients" stroke="#2196F3" strokeWidth={4} fillOpacity={1} fill="url(#colorMain)" animationDuration={1000} />
                                            )}
                                        </AreaChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* CLIENTS TAB (NEW) */}
                    {activeTab === 'clients' && (
                        <div className="animate-in fade-in slide-in-from-bottom-4 duration-500">
                            <ClientsTab />
                        </div>
                    )}

                    {/* MARKETING TAB */}
                    {activeTab === 'marketing' && (
                        <div className="space-y-8 animate-in slide-in-from-right-4 duration-500">

                            {/* Campaign Creator */}
                            <div className="grid grid-cols-1 xl:grid-cols-3 gap-6 md:gap-8">

                                <div className="xl:col-span-2 space-y-6">
                                    <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 hover:shadow-lg transition-all">
                                        <h3 className="text-xl font-fredoka font-bold text-[#5D4037] mb-6 flex items-center gap-2">
                                            <div className="p-2 bg-[#E1F5FE] rounded-xl text-[#0288D1]"><Send size={20} /></div> Nueva CampaÃ±a
                                        </h3>

                                        <div className="space-y-8">
                                            {/* Audience */}
                                            <div>
                                                <label className="text-xs font-bold text-[#A1887F] uppercase tracking-wider mb-3 block">1. Audiencia Objetivo</label>
                                                <div className="grid grid-cols-1 sm:grid-cols-3 gap-3">
                                                    {['Todos', 'Nivel 2+ (Frecuentes)', 'Nivel 3+ (VIP)'].map((label) => (
                                                        <button
                                                            key={label}
                                                            onClick={() => setActiveAudience(label)}
                                                            className={`py-3 px-4 rounded-xl border text-sm font-bold font-fredoka transition-all ${activeAudience === label ? 'bg-[#5D4037] border-[#5D4037] text-white shadow-lg shadow-orange-100' : 'border-slate-200 text-slate-600 hover:bg-slate-50'}`}
                                                        >
                                                            {label}
                                                        </button>
                                                    ))}
                                                </div>
                                            </div>

                                            {/* Template Selection */}
                                            <div>
                                                <div className="flex justify-between items-center mb-3">
                                                    <label className="text-xs font-bold text-[#A1887F] uppercase tracking-wider block">2. Selecciona DiseÃ±o</label>
                                                    <label className="cursor-pointer text-xs font-bold text-[#5D4037] hover:bg-orange-50 px-3 py-1.5 rounded-full border border-orange-100 flex items-center gap-1 transition">
                                                        <Plus size={14} /> Subir Imagen
                                                        <input type="file" className="hidden" accept="image/*" onChange={handleFileUpload} />
                                                    </label>
                                                </div>
                                                <div className="grid grid-cols-2 lg:grid-cols-3 gap-4">
                                                    {templates.map((src, idx) => (
                                                        <div key={idx} className="relative aspect-[3/4] rounded-2xl overflow-hidden cursor-pointer group shadow-sm hover:shadow-xl transition-all border border-slate-100">
                                                            <img src={src} alt={`Template ${idx}`} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" />
                                                            <div className="absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center backdrop-blur-sm">
                                                                <button
                                                                    onClick={() => openEditor(src)}
                                                                    className="bg-white text-slate-900 text-sm font-bold px-5 py-2 rounded-full hover:scale-105 transition shadow-lg font-fredoka"
                                                                >
                                                                    Usar DiseÃ±o
                                                                </button>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            <button
                                                onClick={handleTestEmail}
                                                className="w-full bg-[#EFEBE9] text-[#5D4037] py-3 rounded-xl font-fredoka font-bold text-sm hover:bg-[#D7CCC8] transition border border-[#D7CCC8]"
                                            >
                                                ðŸ§ª Enviar Prueba RÃ¡pida
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                {/* History & Metrics */}
                                <div className="space-y-6">
                                    <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100 h-full overflow-y-auto max-h-[800px]">
                                        <h3 className="font-bold text-[#5D4037] mb-6 flex items-center gap-2 font-fredoka">
                                            <Mail size={20} className="text-[#A1887F]" /> Historial de EnvÃ­os
                                        </h3>
                                        <div className="space-y-4">
                                            {campaigns.length === 0 && (
                                                <div className="text-center text-[#A1887F] text-sm py-10 border-2 border-dashed border-[#D7CCC8] rounded-2xl">
                                                    No hay campaÃ±as enviadas aÃºn.
                                                </div>
                                            )}
                                            {campaigns.map((camp) => (
                                                <div key={camp.id} className="group p-3 rounded-2xl border border-slate-100 hover:border-orange-200 hover:bg-orange-50/30 transition-all cursor-pointer">
                                                    <div className="flex gap-4">
                                                        <div className="w-16 h-16 rounded-xl overflow-hidden flex-shrink-0 bg-slate-100">
                                                            {camp.metadata?.imageUrl ? (
                                                                <img src={camp.metadata.imageUrl} className="w-full h-full object-cover" />
                                                            ) : (
                                                                <div className="w-full h-full flex items-center justify-center text-slate-300"><Mail size={20} /></div>
                                                            )}
                                                        </div>
                                                        <div className="flex-1 min-w-0">
                                                            <div className="flex justify-between items-start">
                                                                <h4 className="font-bold text-[#5D4037] text-sm truncate pr-2 font-fredoka">{camp.title}</h4>
                                                                <label className="relative inline-flex items-center cursor-pointer flex-shrink-0 scale-75 origin-right">
                                                                    <input
                                                                        type="checkbox"
                                                                        checked={camp.status === 'active'}
                                                                        onChange={() => toggleCampaignStatus(camp.id, camp.status)}
                                                                        className="sr-only peer"
                                                                    />
                                                                    <div className="w-9 h-5 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-[#8D6E63]"></div>
                                                                </label>
                                                            </div>
                                                            <p className="text-xs text-[#A1887F] mt-1 line-clamp-1">{camp.content}</p>
                                                            <div className="flex justify-between items-center mt-2">
                                                                <span className="text-[10px] text-[#D7CCC8] font-medium">{new Date(camp.created_at).toLocaleDateString()}</span>
                                                                <span className={`px-2 py-0.5 rounded-md text-[10px] font-bold uppercase tracking-wider ${camp.status === 'active' ? 'bg-[#E8F5E9] text-[#2E7D32]' : 'bg-slate-100 text-slate-500'}`}>
                                                                    {camp.status === 'active' ? 'Activa' : 'Inactiva'}
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    )}

                    {/* STAFF ACTIVITY TAB */}
                    {activeTab === 'activity' && (
                        <div className="space-y-6 animate-in slide-in-from-bottom-4 duration-500">
                            <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                                <h3 className="text-xl font-bold text-[#5D4037] mb-6 flex items-center gap-2 font-fredoka">
                                    <div className="p-2 bg-[#E8F5E9] rounded-lg text-[#2E7D32]"><Scan size={20} /></div> Registro de Actividad
                                </h3>

                                <div className="overflow-x-auto">
                                    <table className="w-full text-left border-collapse">
                                        <thead>
                                            <tr className="border-b border-slate-100 text-[#A1887F] text-xs font-bold uppercase tracking-wider">
                                                <th className="p-4">Fecha y Hora</th>
                                                <th className="p-4">Staff</th>
                                                <th className="p-4">AcciÃ³n</th>
                                                <th className="p-4">Cliente</th>
                                            </tr>
                                        </thead>
                                        <tbody className="text-slate-600 text-sm">
                                            {/* In a real app, map through 'logs' state */}
                                            <tr className="border-b border-slate-50 hover:bg-slate-50 transition font-medium">
                                                <td className="p-4 whitespace-nowrap text-[#5D4037]">Hoy, 10:42 AM</td>
                                                <td className="p-4 text-[#5D4037]">Camarero 1</td>
                                                <td className="p-4"><span className="bg-[#E8F5E9] text-[#2E7D32] px-3 py-1 rounded-full text-xs font-bold font-fredoka">Escaneo âœ¨</span></td>
                                                <td className="p-4 text-[#8D6E63]">juan.perez@gmail.com</td>
                                            </tr>
                                            <tr className="border-b border-slate-50 hover:bg-slate-50 transition font-medium">
                                                <td className="p-4 whitespace-nowrap text-[#5D4037]">Hoy, 09:15 AM</td>
                                                <td className="p-4 text-[#5D4037]">Admin (TÃº)</td>
                                                <td className="p-4"><span className="bg-[#F3E5F5] text-[#7B1FA2] px-3 py-1 rounded-full text-xs font-bold font-fredoka">Canje Premio ðŸŽ</span></td>
                                                <td className="p-4 text-[#8D6E63]">maria.gomez@hotmail.com</td>
                                            </tr>
                                            <tr className="border-b border-slate-50 hover:bg-slate-50 transition font-medium">
                                                <td className="p-4 whitespace-nowrap text-[#5D4037]">Ayer, 18:30 PM</td>
                                                <td className="p-4 text-[#5D4037]">Camarero 2</td>
                                                <td className="p-4"><span className="bg-[#E8F5E9] text-[#2E7D32] px-3 py-1 rounded-full text-xs font-bold font-fredoka">Escaneo âœ¨</span></td>
                                                <td className="p-4 text-[#8D6E63]">carlos.lopez@yahoo.com</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div className="mt-4 text-center">
                                    <button className="text-xs font-bold text-[#A1887F] hover:text-[#5D4037] transition font-fredoka">MOSTRAR MÃS</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* SETTINGS TAB */}
                    {activeTab === 'settings' && (
                        <div className="space-y-6 animate-in slide-in-from-bottom-4 duration-500">
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                                    <h3 className="text-lg font-bold text-[#5D4037] mb-6 border-b border-slate-50 pb-4 flex items-center gap-2 font-fredoka">
                                        <Settings size={20} className="text-[#A1887F]" /> Reglas de Negocio
                                    </h3>
                                    <div className="space-y-6">
                                        <div className="flex items-center justify-between p-2 hover:bg-slate-50 rounded-xl transition">
                                            <div>
                                                <h4 className="font-bold text-[#5D4037] text-sm font-fredoka">Happy Hour (Puntos Dobles)</h4>
                                                <p className="text-xs text-[#A1887F] mt-1">Los clientes suman x2 sellos al escanear.</p>
                                            </div>
                                            <label className="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" value="" className="sr-only peer" />
                                                <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#8D6E63]"></div>
                                            </label>
                                        </div>
                                        <div className="flex items-center justify-between p-2 hover:bg-slate-50 rounded-xl transition">
                                            <div>
                                                <h4 className="font-bold text-[#5D4037] text-sm font-fredoka">Solicitar PIN en Canjes</h4>
                                                <p className="text-xs text-[#A1887F] mt-1">Mayor seguridad al entregar premios.</p>
                                            </div>
                                            <label className="relative inline-flex items-center cursor-pointer">
                                                <input type="checkbox" value="" className="sr-only peer" defaultChecked />
                                                <div className="w-11 h-6 bg-gray-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-[#8D6E63]"></div>
                                            </label>
                                        </div>
                                    </div>
                                </div>


                                <div className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                                    <h3 className="text-lg font-bold text-[#5D4037] mb-6 border-b border-slate-50 pb-4 flex items-center gap-2 font-fredoka">
                                        <Users size={20} className="text-[#A1887F]" /> Credenciales Staff
                                    </h3>
                                    <div className="space-y-4">
                                        <p className="text-sm text-[#A1887F]">
                                            Desde aquÃ­ puedes regenerar los PINs de acceso para los camareros.
                                        </p>
                                        <button className="w-full py-4 rounded-xl bg-[#5D4037] text-white font-bold text-sm hover:bg-[#4E342E] transition shadow-lg shadow-orange-100 font-fredoka">
                                            Actualizar Credenciales Tienda
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}


                </div>
            </div>

            {/* --- MOBILE BOTTOM NAVIGATION (Super Lindo / Floating Dock) --- */}
            <nav className="md:hidden fixed bottom-6 left-4 right-4 h-[72px] bg-white/90 backdrop-blur-xl border border-white/50 rounded-[2rem] shadow-[0_8px_30px_rgb(0,0,0,0.06)] flex justify-between items-center px-2 z-40">
                <MobileNavItem
                    active={activeTab === 'overview'}
                    onClick={() => setActiveTab('overview')}
                    icon={<TrendingUp size={24} />}
                    label="Inicio"
                    color="#5D4037"
                />
                <MobileNavItem
                    active={activeTab === 'clients'}
                    onClick={() => setActiveTab('clients')}
                    icon={<Users size={24} />}
                    label="Clientes"
                    color="#5D4037"
                />

                {/* Spacer for FAB */}
                <div className="w-12"></div>

                {/* FAB is now positioned absolutely relative to the viewport or nav, but here we can stick it in the middle visually */}
                <button
                    onClick={() => router.push('/staff')}
                    className="absolute left-1/2 -translate-x-1/2 -top-6 w-16 h-16 bg-brand-primary rounded-full shadow-[0_8px_20px_rgba(93,64,55,0.4)] flex items-center justify-center text-white border-4 border-[#F5F5F5] transition-transform active:scale-95"
                >
                    <Scan size={28} />
                </button>

                {config.features.marketingEnabled && (
                    <MobileNavItem
                        active={activeTab === 'marketing'}
                        onClick={() => setActiveTab('marketing')}
                        icon={<Mail size={24} />}
                        label="Promo"
                        color="var(--brand-primary)"
                    />
                )}
                {config.features.adminSettingsEnabled && (
                    <MobileNavItem
                        active={activeTab === 'settings'}
                        onClick={() => setActiveTab('settings')}
                        icon={<Settings size={24} />}
                        label="Ajustes"
                        color="var(--brand-primary)"
                    />
                )}
            </nav>


            {
                showEditor && (
                    <EmailEditor
                        initialData={editorInitialData}
                        onClose={() => setShowEditor(false)}
                        onSend={handleSendFromEditor}
                        audience={activeAudience}
                        isSending={isSending}
                    />
                )
            }
        </main >
    );
}

// --- Helper Components ---

function NavButton({ active, onClick, icon, label, themeColor }: any) {
    return (
        <button
            onClick={onClick}
            className={`flex items-center gap-4 w-full p-3.5 rounded-xl transition-all duration-200 group ${active ? 'bg-white font-bold shadow-lg transform scale-105' : 'text-white/70 hover:bg-white/10 hover:text-white'
                }`}
            style={{ color: active ? themeColor : undefined }}
        >
            <div className={`${active ? '' : 'opacity-70 group-hover:opacity-100'}`}>{icon}</div>
            <span className="text-sm">{label}</span>
        </button>
    );
}


function MobileNavItem({ active, onClick, icon, label, color }: any) {
    return (
        <button
            onClick={onClick}
            className={`flex-1 flex flex-col items-center justify-center gap-1 transition-all duration-300 h-full rounded-2xl ${active ? 'bg-orange-50 -translate-y-2 pb-2' : 'hover:bg-slate-50'}`}
        >
            <div className={`p-1.5 rounded-full transition-colors ${active ? 'bg-brand-primary text-white shadow-md' : 'text-brand-secondary text-opacity-60'}`}>
                {icon}
            </div>
            {active && <span className="text-[10px] font-bold text-brand-primary font-brand animate-in fade-in zoom-in duration-300">{label}</span>}
        </button>
    );
}

function MetricCard({ title, value, icon, color, bgStyle, trend, trendColor, isActive, onClick }: any) {
    return (
        <div
            onClick={onClick}
            className={`bg-white p-5 rounded-[2rem] shadow-sm border transition-all cursor-pointer flex items-center gap-4 hover:shadow-lg hover:-translate-y-1 hover:scale-[1.02] ${isActive ? 'border-brand-primary ring-4 ring-orange-100' : 'border-slate-50'}`}
        >
            <div className={`p-4 rounded-2xl shadow-inner ${color} ${bgStyle}`}>
                {icon}
            </div>
            <div>
                <p className="text-brand-secondary text-opacity-60 text-[10px] font-bold uppercase tracking-wider font-brand">{title}</p>
                <h3 className="text-3xl font-black text-brand-primary leading-tight font-brand">{value}</h3>
                <p className={`text-[10px] font-bold mt-1 px-2 py-0.5 rounded-full inline-block ${trendColor ? trendColor : (trend.includes('+') ? 'bg-emerald-50 text-emerald-600' : 'bg-slate-50 text-slate-500')}`}>
                    {trend}
                </p>
            </div>
        </div>
    );
}
</file>

<file path="src/components/admin/dashboards/StandardDashboard.tsx">
'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import { useClientConfig } from '@/context/ClientConfigContext';
import { ClientConfig } from '@/config/types';
import PoweredBy from '@/components/PoweredBy';
import { Users, Scan, Gift, TrendingUp, LogOut, Mail, Settings, Bell, ChevronRight, Send, Save, CreditCard, Clock, LayoutDashboard, Menu as MenuIcon } from 'lucide-react';
import { supabase } from '@/lib/supabase';
import {
    AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar
} from 'recharts';
import EmailEditor from '@/components/admin/EmailEditor';
import { Plus } from 'lucide-react';
import ClientsTab from '@/components/admin/ClientsTab';

export default function StandardDashboard() {
    const router = useRouter();
    const config = useClientConfig();
    const [loading, setLoading] = useState(true);
    const [activeTab, setActiveTab] = useState<'overview' | 'clients' | 'marketing' | 'settings' | 'activity'>('overview');
    const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

    // Metrics State
    const [metrics, setMetrics] = useState({
        totalClients: 0,
        scansToday: 0,
        redemptionsTotal: 0
    });

    const [chartData, setChartData] = useState<any[]>([]);
    const [activeChart, setActiveChart] = useState<'scans' | 'clients' | 'redemptions'>('scans');

    useEffect(() => {
        const init = async () => {
            // Config is already active via Context

            const { data: { user } } = await supabase.auth.getUser();
            if (!user) { router.push('/auth/login?role=staff'); return; }

            const { data: profile } = await supabase.from('profiles').select('role, client_code').eq('id', user.id).single();
            if (!profile || profile.role !== 'admin') {
                router.push('/staff');
                return;
            }

            // Client Isolation Check
            let isValidUser = true;
            if (config.code === 'perezoso_cafe') {
                if (profile.client_code !== 'perezoso_cafe') isValidUser = false;
            } else if (config.code === 'mare_cafe') {
                if (profile.client_code && profile.client_code !== 'mare_cafe') isValidUser = false;
            } else {
                if (profile.client_code && profile.client_code !== config.code) isValidUser = false;
            }

            if (!isValidUser) {
                alert(`Esta cuenta de administrador no pertenece a ${config.name}.`);
                await supabase.auth.signOut();
                router.push('/');
                return;
            }

            const fetchMetrics = async (cfg: ClientConfig) => {
                // 1. Clients
                let clientQuery = supabase.from('profiles').select('*', { count: 'exact', head: true }).eq('role', 'customer');
                if (cfg.code === 'mare_cafe') {
                    clientQuery = clientQuery.or('client_code.eq.mare_cafe,client_code.is.null');
                } else {
                    clientQuery = clientQuery.eq('client_code', cfg.code);
                }
                const { count: clientCount } = await clientQuery;

                // 2. Scans (Joined with Profiles)
                const today = new Date().toISOString().split('T')[0];
                let scansQuery = supabase.from('transaction_logs')
                    .select('id, profiles!transaction_logs_user_id_fkey!inner(client_code)', { count: 'exact', head: true })
                    .eq('type', 'add_stamp')
                    .gte('created_at', today);

                if (cfg.code === 'mare_cafe') {
                    scansQuery = scansQuery.or('client_code.eq.mare_cafe,client_code.is.null', { foreignTable: 'profiles' });
                } else {
                    scansQuery = scansQuery.eq('profiles.client_code', cfg.code);
                }
                const { count: dailyScans } = await scansQuery;

                // 3. Redemptions
                let redeemsQuery = supabase.from('transaction_logs')
                    .select('id, profiles!transaction_logs_user_id_fkey!inner(client_code)', { count: 'exact', head: true })
                    .eq('type', 'redeem_reward');

                if (cfg.code === 'mare_cafe') {
                    redeemsQuery = redeemsQuery.or('client_code.eq.mare_cafe,client_code.is.null', { foreignTable: 'profiles' });
                } else {
                    redeemsQuery = redeemsQuery.eq('profiles.client_code', cfg.code);
                }
                const { count: redemptions } = await redeemsQuery;

                setMetrics({
                    totalClients: clientCount || 0,
                    scansToday: dailyScans || 0,
                    redemptionsTotal: redemptions || 0
                });
            };

            const fetchChartData = async (cfg: ClientConfig) => {
                const today = new Date();
                const last7Days = Array.from({ length: 7 }, (_, i) => {
                    const d = new Date();
                    d.setDate(today.getDate() - (6 - i));
                    return d.toISOString().split('T')[0];
                });

                // Fetch logs for the last 7 days
                let logsQuery = supabase
                    .from('transaction_logs')
                    .select('created_at, type, metadata, profiles!transaction_logs_user_id_fkey!inner(client_code)')
                    .gte('created_at', last7Days[0]);

                if (cfg.code === 'mare_cafe') {
                    logsQuery = logsQuery.or('client_code.eq.mare_cafe,client_code.is.null', { foreignTable: 'profiles' });
                } else {
                    logsQuery = logsQuery.eq('profiles.client_code', cfg.code);
                }
                const { data: logs } = await logsQuery;

                let clientsQuery = supabase
                    .from('profiles')
                    .select('created_at')
                    .eq('role', 'customer')
                    .gte('created_at', last7Days[0]);

                if (cfg.code === 'mare_cafe') {
                    clientsQuery = clientsQuery.or('client_code.eq.mare_cafe,client_code.is.null');
                } else {
                    clientsQuery = clientsQuery.eq('client_code', cfg.code);
                }

                const { data: newClients } = await clientsQuery;

                const chartDataMap = last7Days.reduce((acc: any, date) => {
                    const dayName = new Date(date).toLocaleDateString('es-ES', { weekday: 'short' });
                    acc[date] = {
                        name: dayName.charAt(0).toUpperCase() + dayName.slice(1),
                        scans: 0,
                        redeems: 0,
                        newClients: 0
                    };
                    return acc;
                }, {});

                logs?.forEach(log => {
                    const date = log.created_at.split('T')[0];
                    if (chartDataMap[date]) {
                        if (log.type === 'add_stamp') chartDataMap[date].scans += 1;
                        if (log.type === 'redeem_reward') chartDataMap[date].redeems += 1;
                    }
                });

                newClients?.forEach(client => {
                    const date = client.created_at.split('T')[0];
                    if (chartDataMap[date]) {
                        chartDataMap[date].newClients += 1;
                    }
                });

                setChartData(Object.values(chartDataMap));
            };

            await fetchMetrics(config);
            await fetchCampaigns();
            await fetchChartData(config);
            setLoading(false);

            // Realtime Subscriptions
            const changes = supabase
                .channel('admin-dashboard-realtime')
                .on(
                    'postgres_changes',
                    { event: 'INSERT', schema: 'public', table: 'transaction_logs' },
                    (payload) => {
                        console.log('New transaction:', payload);
                        fetchMetrics(config);
                        fetchChartData(config);
                    }
                )
                .on(
                    'postgres_changes',
                    { event: 'INSERT', schema: 'public', table: 'profiles' },
                    (payload) => {
                        console.log('New profile:', payload);
                        fetchMetrics(config);
                    }
                )
                .subscribe();

            return () => {
                supabase.removeChannel(changes);
            };
        };
        init();
    }, [router, config]);

    const [isSending, setIsSending] = useState(false);
    const [activeAudience, setActiveAudience] = useState('Todos');
    const [showEditor, setShowEditor] = useState(false);
    const [editorInitialData, setEditorInitialData] = useState<any>({});

    // Templates State
    const [templates, setTemplates] = useState<string[]>([
        '/clients/mare_cafe/flyer_template_1_1769954037447.png',
        '/clients/mare_cafe/flyer_template_2_1769954052827.png',
        '/clients/mare_cafe/flyer_template_3_1769954068639.png'
    ]);

    const handleFileUpload = (e: React.ChangeEvent<HTMLInputElement>) => {
        const file = e.target.files?.[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const result = e.target?.result as string;
                setTemplates(prev => [...prev, result]);
            };
            reader.readAsDataURL(file);
        }
    };

    const openEditor = (templateUrl: string) => {
        setEditorInitialData({
            imageUrl: templateUrl,
            title: 'Â¡Novedades en Mare Cafe! â˜•ï¸',
            content: 'Tenemos nuevas promociones esperÃ¡ndote. Ven y disfruta de un momento especial.'
        });
        setShowEditor(true);
    };

    // Campaigns State
    const [campaigns, setCampaigns] = useState<any[]>([]);

    const fetchCampaigns = async () => {
        const { data } = await supabase.from('campaigns').select('*').order('created_at', { ascending: false });
        if (data) setCampaigns(data);
    };

    const handleSendFromEditor = async (data: { title: string; content: string; html: string; audience: string; imageUrl?: string }) => {
        if (!confirm('Â¿EstÃ¡s seguro de enviar esta campaÃ±a a ' + data.audience + '?')) return;

        setIsSending(true);

        try {
            // 1. Create Campaign in DB
            const { data: campaign, error } = await supabase.from('campaigns').insert({
                title: data.title,
                content: data.content,
                audience: data.audience,
                status: 'active',
                metadata: { imageUrl: data.imageUrl || '' } // Store image URL reference
            }).select().single();

            if (error) throw error;

            // 2. Send via Resend (Server Action)
            const formData = new FormData();
            formData.append('title', data.title);
            formData.append('content', data.content);
            formData.append('html', data.html);
            formData.append('audience', data.audience);
            formData.append('campaignId', campaign.id);

            const { sendCampaign } = await import('@/app/actions/marketing');
            const result = await sendCampaign(formData);

            if (result.success) {
                alert('âœ… ' + result.message);
                setShowEditor(false); // Close editor on success
                fetchCampaigns(); // Refresh list
            } else {
                alert('âŒ Error: ' + result.message);
            }
        } catch (e: any) {
            alert('Error inesperado: ' + e.message);
            console.error(e);
        } finally {
            setIsSending(false);
        }
    };

    const toggleCampaignStatus = async (id: string, currentStatus: string) => {
        const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
        const { error } = await supabase.from('campaigns').update({ status: newStatus }).eq('id', id);

        if (error) {
            alert('Error cambiando estado');
        } else {
            // Optimistic update
            setCampaigns(prev => prev.map(c => c.id === id ? { ...c, status: newStatus } : c));
        }
    };

    const handleTestEmail = async () => {
        const email = prompt('Ingresa tu email para la prueba:', 'tu@email.com');
        if (!email) return;

        setIsSending(true);
        const formData = new FormData();
        formData.append('title', '[TEST] Vista Previa Mare Cafe');
        formData.append('content', 'Esta es una PRUEBA de visualizaciÃ³n del flyer.');
        formData.append('audience', 'Test');
        formData.append('testEmail', email);

        try {
            const { sendCampaign } = await import('@/app/actions/marketing');
            const result = await sendCampaign(formData);
            alert(result.success ? 'âœ… ' + result.message : 'âŒ ' + result.message);
        } catch (e: any) {
            alert('Error: ' + e.message);
        } finally {
            setIsSending(false);
        }
    };

    const handleLogout = async () => {
        await supabase.auth.signOut();
        router.push('/');
    };

    if (loading) return <div className="flex h-screen items-center justify-center bg-gray-50 text-slate-900 font-medium">Cargando...</div>;

    const tabs = [
        { id: 'overview', label: 'Resumen', icon: <LayoutDashboard size={20} />, enabled: true },
        { id: 'clients', label: 'Clientes', icon: <Users size={20} />, enabled: true },
        { id: 'marketing', label: 'Marketing', icon: <Mail size={20} />, enabled: config.features.marketingEnabled },
        { id: 'activity', label: 'Actividad', icon: <Clock size={20} />, enabled: true },
        { id: 'settings', label: 'Ajustes', icon: <Settings size={20} />, enabled: config.features.adminSettingsEnabled },
    ].filter(tab => tab.enabled);

    // Filter tabs based on Feature Flags? (Can be added later or now)
    // For now we assume standard has them all.

    return (
        <main className="min-h-screen bg-slate-50 font-sans flex flex-col md:flex-row text-slate-900">

            {/* --- MOBILE HEADER (Standard) --- */}
            <header className="md:hidden bg-white border-b border-slate-200 sticky top-0 z-30 flex items-center justify-between px-4 h-16">
                <div className="flex items-center gap-3">
                    <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className="p-2 -ml-2 text-slate-600">
                        <MenuIcon size={24} />
                    </button>
                    <span className="font-bold text-lg">{config.name}</span>
                </div>
                <button
                    onClick={() => router.push('/staff')}
                    className="p-2 bg-brand-primary text-white rounded-lg shadow-sm"
                >
                    <Scan size={20} />
                </button>
            </header>

            {/* --- MOBILE MENU OVERLAY --- */}
            {mobileMenuOpen && (
                <div className="md:hidden fixed inset-0 z-40 bg-black/50" onClick={() => setMobileMenuOpen(false)}>
                    <div className="bg-white w-64 h-full p-4 shadow-xl flex flex-col" onClick={(e) => e.stopPropagation()}>
                        <h2 className="text-xl font-bold mb-6 px-2">{config.name}</h2>
                        <nav className="flex-1 space-y-1">
                            {tabs.map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => { setActiveTab(tab.id as any); setMobileMenuOpen(false); }}
                                    className={`flex items-center gap-3 w-full p-3 rounded-lg text-left ${activeTab === tab.id ? 'bg-slate-100 font-bold text-brand-primary' : 'text-slate-600 hover:bg-slate-50'}`}
                                >
                                    {tab.icon}
                                    {tab.label}
                                </button>
                            ))}
                        </nav>
                        <button onClick={handleLogout} className="flex items-center gap-3 w-full p-3 text-slate-500 hover:text-red-600">
                            <LogOut size={20} /> Logout
                        </button>
                    </div>
                </div>
            )}


            {/* --- SIDEBAR (Desktop - Corporate Standard) --- */}
            <aside className="hidden md:flex w-64 bg-white border-r border-slate-200 flex-col h-screen sticky top-0 z-40">
                <div className="h-16 flex items-center px-6 border-b border-slate-100">
                    <h1 className="font-bold text-lg truncate text-brand-primary">{config.name}</h1>
                </div>

                <nav className="flex-1 p-4 space-y-1 overflow-y-auto">
                    {tabs.map(tab => (
                        <button
                            key={tab.id}
                            onClick={() => setActiveTab(tab.id as any)}
                            className={`flex items-center gap-3 w-full p-3 rounded-lg text-sm font-medium transition-colors ${activeTab === tab.id
                                ? 'bg-brand-primary text-white shadow-sm'
                                : 'text-slate-600 hover:bg-slate-50 hover:text-slate-900'
                                }`}
                        >
                            {tab.icon}
                            {tab.label}
                        </button>
                    ))}
                </nav>

                <div className="p-4 border-t border-slate-100 space-y-2">
                    <button
                        onClick={() => router.push('/staff')}
                        className="flex items-center gap-3 w-full p-3 rounded-lg text-slate-600 hover:bg-slate-50 text-sm font-medium"
                    >
                        <Scan size={18} />
                        EscÃ¡ner Staff
                    </button>
                    <button
                        onClick={handleLogout}
                        className="flex items-center gap-3 w-full p-3 rounded-lg text-slate-600 hover:bg-red-50 hover:text-red-700 text-sm font-medium"
                    >
                        <LogOut size={18} />
                        Cerrar SesiÃ³n
                    </button>
                </div>
            </aside>

            {/* --- MAIN CONTENT --- */}
            <div className="flex-1 min-h-screen pt-4 md:pt-0 overflow-y-auto w-full px-4 md:px-8 bg-slate-50">

                <header className="hidden md:flex py-8 justify-between items-end border-b border-slate-200 mb-8">
                    <div>
                        <h2 className="text-3xl font-bold text-slate-900">
                            {tabs.find(t => t.id === activeTab)?.label}
                        </h2>
                        <p className="text-slate-500 mt-1">GestiÃ³n administrativa</p>
                    </div>
                    <div className="flex items-center gap-2">
                        <div className="text-right">
                            <p className="text-sm font-medium">{config.name}</p>
                            <p className="text-xs text-slate-400">Admin</p>
                        </div>
                    </div>
                </header>

                <div className="pb-10 md:pb-8 max-w-6xl mx-auto space-y-8">

                    {/* OVERVIEW TAB */}
                    {activeTab === 'overview' && (
                        <div className="space-y-6">
                            {/* Standard Cards */}
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <p className="text-sm font-medium text-slate-500">Clientes Totales</p>
                                            <h3 className="text-3xl font-bold text-slate-900 mt-2">{metrics.totalClients}</h3>
                                        </div>
                                        <div className="p-2 bg-blue-50 text-blue-600 rounded-lg"><Users size={24} /></div>
                                    </div>
                                    <div className="mt-4 flex items-center text-sm">
                                        <span className="text-green-600 font-medium">Activo</span>
                                    </div>
                                </div>
                                <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <p className="text-sm font-medium text-slate-500">Visitas Hoy</p>
                                            <h3 className="text-3xl font-bold text-slate-900 mt-2">{metrics.scansToday}</h3>
                                        </div>
                                        <div className="p-2 bg-green-50 text-green-600 rounded-lg"><Scan size={24} /></div>
                                    </div>
                                    <div className="mt-4 flex items-center text-sm">
                                        <span className="text-slate-500">Registradas en tiempo real</span>
                                    </div>
                                </div>
                                <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                    <div className="flex justify-between items-start">
                                        <div>
                                            <p className="text-sm font-medium text-slate-500">Premios Canjeados</p>
                                            <h3 className="text-3xl font-bold text-slate-900 mt-2">{metrics.redemptionsTotal}</h3>
                                        </div>
                                        <div className="p-2 bg-purple-50 text-purple-600 rounded-lg"><Gift size={24} /></div>
                                    </div>
                                    <div className="mt-4 flex items-center text-sm">
                                        <span className="text-slate-500">Total acumulado</span>
                                    </div>
                                </div>
                            </div>

                            {/* Standard Charts */}
                            <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                <h3 className="font-bold text-lg text-slate-900 mb-6">MÃ©tricas de Rendimiento</h3>
                                <div className="h-[300px] w-full">
                                    <ResponsiveContainer width="100%" height="100%">
                                        <AreaChart data={chartData}>
                                            <CartesianGrid strokeDasharray="3 3" vertical={false} />
                                            <XAxis dataKey="name" axisLine={false} tickLine={false} tick={{ fontSize: 12, fill: '#64748b' }} dy={10} />
                                            <Tooltip />
                                            <Area type="monotone" dataKey="scans" stroke="#0ea5e9" fill="#e0f2fe" strokeWidth={2} name="Escaneos" />
                                            <Area type="monotone" dataKey="redeems" stroke="#8b5cf6" fill="#ede9fe" strokeWidth={2} name="Canjes" />
                                        </AreaChart>
                                    </ResponsiveContainer>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* CLIENTS TAB */}
                    {activeTab === 'clients' && (
                        <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-1">
                            <ClientsTab />
                        </div>
                    )}

                    {/* MARKETING TAB */}
                    {activeTab === 'marketing' && (
                        <div className="space-y-6">
                            <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                <h3 className="font-bold text-lg mb-4">Nueva CampaÃ±a</h3>
                                <div className="space-y-4">
                                    <div className="flex items-center gap-4">
                                        <div className="flex-1">
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Audiencia</label>
                                            <select
                                                className="w-full border border-slate-300 rounded-lg p-2.5"
                                                value={activeAudience}
                                                onChange={(e) => setActiveAudience(e.target.value)}
                                            >
                                                <option>Todos</option>
                                                <option>Nivel 2+ (Frecuentes)</option>
                                                <option>Nivel 3+ (VIP)</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div className="grid grid-cols-2 lg:grid-cols-4 gap-4">
                                        {templates.map((src, idx) => (
                                            <div key={idx} onClick={() => openEditor(src)} className="cursor-pointer border border-slate-200 rounded-lg overflow-hidden hover:border-brand-primary transition">
                                                <img src={src} className="w-full aspect-[3/4] object-cover" />
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* OTHER TABS same as above but simpler container */}
                    {activeTab === 'activity' && (
                        <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-6 text-center text-slate-500">
                            Activity Log Placeholder (Standard)
                        </div>
                    )}
                    {activeTab === 'settings' && (
                        <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-6 space-y-4">
                            <h3 className="font-bold">Ajustes Generales</h3>
                            <p className="text-sm text-slate-500">ConfiguraciÃ³n estÃ¡ndar para {config.name}</p>
                        </div>
                    )}

                </div>
            </div>


            {
                showEditor && (
                    <EmailEditor
                        initialData={editorInitialData}
                        onClose={() => setShowEditor(false)}
                        onSend={handleSendFromEditor}
                        audience={activeAudience}
                        isSending={isSending}
                    />
                )
            }
        </main >
    );
}
</file>

<file path="src/components/admin/ClientsTab.tsx">
'use client';

import { useState, useEffect } from 'react';
import { supabase } from '@/lib/supabase';
import { useClientConfig } from '@/context/ClientConfigContext';
import { Search, QrCode, Smartphone, Mail, Calendar, User, Download } from 'lucide-react';
import QRCode from 'react-qr-code';

interface ClientProfile {
    id: string;
    email: string;
    full_name?: string;
    phone?: string;
    level?: number;
    created_at: string;
    stamps?: number;
}

export default function ClientsTab() {
    const config = useClientConfig();
    const [clients, setClients] = useState<ClientProfile[]>([]);
    const [loading, setLoading] = useState(true);
    const [searchTerm, setSearchTerm] = useState('');
    const [showQR, setShowQR] = useState(false);

    useEffect(() => {
        const fetchClients = async () => {

            let query = supabase
                .from('profiles')
                .select('*, stamps(count)') // select stamps too
                .eq('role', 'customer');

            if (config.code === 'mare_cafe') {
                query = query.or('client_code.eq.mare_cafe,client_code.is.null');
            } else {
                query = query.eq('client_code', config.code);
            }

            const { data } = await query
                .order('created_at', { ascending: false });

            if (data) {
                // Map stamps count cleanly
                const formatted = data.map(c => ({
                    ...c,
                    stamps: c.stamps?.[0]?.count || 0 // Assuming one-to-one or taking first
                }));
                setClients(formatted);
            }
            setLoading(false);
        };
        fetchClients();
    }, [config]);

    const filteredClients = clients.filter(c =>
    (c.email?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        c.full_name?.toLowerCase().includes(searchTerm.toLowerCase()) ||
        c.phone?.includes(searchTerm))
    );

    const downloadQR = () => {
        const svg = document.getElementById("registration-qr");
        if (svg) {
            const svgData = new XMLSerializer().serializeToString(svg);
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            const img = new Image();
            img.onload = () => {
                canvas.width = img.width;
                canvas.height = img.height;
                ctx?.drawImage(img, 0, 0);
                const pngFile = canvas.toDataURL("image/png");
                const downloadLink = document.createElement("a");
                downloadLink.download = "mare-registro-qr.png";
                downloadLink.href = pngFile;
                downloadLink.click();
            };
            img.src = "data:image/svg+xml;base64," + btoa(svgData);
        }
    };

    const registroUrl = typeof window !== 'undefined' ? `${window.location.origin}/auth/login?role=customer` : '';

    return (
        <div className="space-y-6 animate-in slide-in-from-bottom-4 duration-500">

            {/* Header & QR Action */}
            <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div className="bg-white p-6 rounded-3xl shadow-md border border-slate-100 flex-1 w-full">
                    <div className="flex justify-between items-center">
                        <div>
                            <h3 className="text-xl font-bold text-slate-800 flex items-center gap-2">
                                <User size={24} className="text-blue-600" /> Base de Datos de Clientes
                            </h3>
                            <p className="text-slate-400 text-sm mt-1">
                                {clients.length} clientes registrados en total.
                            </p>
                        </div>
                        <button
                            onClick={() => setShowQR(!showQR)}
                            className="flex items-center gap-2 bg-slate-900 text-white px-4 py-2 rounded-xl font-bold hover:bg-slate-700 transition"
                        >
                            <QrCode size={18} /> {showQR ? 'Ocultar QR' : 'Ver QR de Registro'}
                        </button>
                    </div>

                    {showQR && (
                        <div className="mt-6 p-6 bg-slate-50 rounded-2xl border-2 border-dashed border-slate-300 flex flex-col items-center text-center animate-in fade-in">
                            <h4 className="font-bold text-slate-800 mb-2">QR para Nuevos Clientes</h4>
                            <p className="text-sm text-slate-500 mb-4 max-w-sm">
                                Muestra este cÃ³digo a los clientes para que se registren rÃ¡pidamente en la app desde sus celulares.
                            </p>
                            <div className="p-4 bg-white rounded-xl shadow-sm mb-4">
                                <QRCode
                                    id="registration-qr"
                                    value={registroUrl}
                                    size={200}
                                    fgColor="#1E3A8A"
                                />
                            </div>
                            {/* <button onClick={downloadQR} className="text-blue-600 text-sm font-bold flex items-center gap-1 hover:underline">
                        <Download size={14} /> Descargar PNG
                    </button> */}
                            <p className="text-xs text-slate-400 mt-2">{registroUrl}</p>
                        </div>
                    )}
                </div>
            </div>

            {/* Search & List */}
            <div className="bg-white p-6 rounded-3xl shadow-md border border-slate-100">
                <div className="relative mb-6">
                    <Search className="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400" size={20} />
                    <input
                        type="text"
                        placeholder="Buscar por nombre, email o telÃ©fono..."
                        value={searchTerm}
                        onChange={(e) => setSearchTerm(e.target.value)}
                        className="w-full pl-12 pr-4 py-3 bg-slate-50 border-slate-200 rounded-xl focus:ring-2 focus:ring-blue-500 outline-none transition"
                    />
                </div>

                <div className="overflow-x-auto">
                    <table className="w-full text-left border-collapse">
                        <thead>
                            <tr className="border-b border-slate-100 text-slate-400 text-xs uppercase tracking-wider">
                                <th className="p-4 font-semibold">Cliente</th>
                                <th className="p-4 font-semibold">Contacto</th>
                                <th className="p-4 font-semibold text-center">Nivel</th>
                                <th className="p-4 font-semibold text-center">Registrado</th>
                            </tr>
                        </thead>
                        <tbody className="text-slate-600 text-sm">
                            {loading ? (
                                <tr><td colSpan={4} className="p-8 text-center">Cargando datos...</td></tr>
                            ) : (
                                filteredClients.map((client) => (
                                    <tr key={client.id} className="border-b border-slate-50 hover:bg-slate-50 transition">
                                        <td className="p-4">
                                            <div className="font-bold text-slate-800">{client.full_name || 'Sin Nombre'}</div>
                                            <div className="text-xs text-slate-400">ID: {client.id.slice(0, 8)}...</div>
                                        </td>
                                        <td className="p-4 space-y-1">
                                            <div className="flex items-center gap-2 text-xs">
                                                <Mail size={14} className="text-blue-400" /> {client.email}
                                            </div>
                                            {client.phone && (
                                                <div className="flex items-center gap-2 text-xs text-slate-500">
                                                    <Smartphone size={14} className="text-green-500" /> {client.phone}
                                                </div>
                                            )}
                                        </td>
                                        <td className="p-4 text-center">
                                            <span className="bg-amber-100 text-amber-700 px-3 py-1 rounded-full text-xs font-bold">
                                                Lvl {client.level || 1}
                                            </span>
                                        </td>
                                        <td className="p-4 text-center text-xs text-slate-400">
                                            {new Date(client.created_at).toLocaleDateString()}
                                        </td>
                                    </tr>
                                ))
                            )}
                            {!loading && filteredClients.length === 0 && (
                                <tr><td colSpan={4} className="p-8 text-center text-slate-400">No se encontraron clientes.</td></tr>
                            )}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/components/admin/EmailEditor.tsx">
'use client';

import { useState, useEffect } from 'react';
import { X, Layout, Type, Image as ImageIcon, Send, Smartphone, Monitor, Palette } from 'lucide-react';

interface EmailEditorProps {
    initialData: {
        title: string;
        content: string;
        imageUrl?: string;
        offer?: string;
    };
    onClose: () => void;
    onSend: (data: { title: string; content: string; html: string; audience: string }) => Promise<void>;
    audience: string;
    isSending: boolean;
}

export default function EmailEditor({ initialData, onClose, onSend, audience, isSending }: EmailEditorProps) {
    const [viewMode, setViewMode] = useState<'mobile' | 'desktop'>('mobile');
    const [formData, setFormData] = useState({
        title: initialData.title || 'Â¡Tenemos novedades!',
        content: initialData.content || 'Hola, tenemos algo especial para ti...',
        offer: initialData.offer || '',
        imageUrl: initialData.imageUrl || '',
        primaryColor: '#1E3A8A',
        buttonText: 'Canjear Ahora',
        buttonUrl: '{{PROMO_LINK}}'
    });

    const generateEmailHtml = (data: typeof formData) => {
        return `
<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body style="margin:0; padding:0; background-color:#F3F4F6; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;">
    <div style="max-width: 600px; margin: 0 auto; background-color: #ffffff; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
        <!-- Header Image -->
        ${data.imageUrl ? `
        <div style="width: 100%; height: 300px; background-image: url('${data.imageUrl}'); background-size: cover; background-position: center; position: relative;">
            <div style="position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(0,0,0,0), rgba(0,0,0,0.6));"></div>
        </div>
        ` : ''}
        
        <!-- Content -->
        <div style="padding: 40px 30px; text-align: center;">
            <h1 style="color: ${data.primaryColor}; font-size: 28px; font-weight: 800; margin-bottom: 16px; margin-top: 0;">${data.title}</h1>
            
            ${data.offer ? `
            <div style="background-color: #EFF6FF; border: 2px dashed ${data.primaryColor}; padding: 15px; border-radius: 12px; margin: 20px 0; display: inline-block;">
                <span style="font-size: 24px; font-weight: bold; color: ${data.primaryColor};">${data.offer}</span>
            </div>
            ` : ''}

            <p style="color: #4B5563; font-size: 16px; line-height: 1.6; margin-bottom: 30px;">
                ${data.content.replace(/\n/g, '<br/>')}
            </p>

            <a href="${data.buttonUrl}" style="background-color: ${data.primaryColor}; color: #ffffff; padding: 16px 32px; border-radius: 50px; text-decoration: none; font-weight: bold; font-size: 16px; display: inline-block; box-shadow: 0 4px 14px 0 rgba(0,0,0,0.39);">
                ${data.buttonText}
            </a>
        </div>

        <!-- Footer -->
        <div style="background-color: #F9FAFB; padding: 30px; text-align: center; border-top: 1px solid #E5E7EB;">
            <p style="color: #9CA3AF; font-size: 12px;">
                Mare Cafe - Programa de Fidelidad<br/>
                Sigue disfrutando de tu cafÃ© favorito.
            </p>
            <div style="margin-top: 10px;">
                <a href="#" style="color: #9CA3AF; font-size: 12px; text-decoration: underline;">Darse de baja</a>
            </div>
        </div>
    </div>
</body>
</html>
        `;
    };

    const htmlPreview = generateEmailHtml(formData);

    const handleSubmit = async () => {
        await onSend({
            title: formData.title,
            content: formData.content,
            html: htmlPreview,
            audience
        });
    };

    return (
        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-in fade-in duration-200">
            <div className="bg-white rounded-3xl w-full max-w-6xl h-[90vh] flex overflow-hidden shadow-2xl">

                {/* Visual Editor Sidebar */}
                <div className="w-1/3 border-r border-slate-100 bg-slate-50 flex flex-col">
                    <div className="p-6 border-b border-slate-200 bg-white">
                        <div className="flex justify-between items-center">
                            <h2 className="font-bold text-xl text-slate-800 flex items-center gap-2">
                                <Palette size={20} className="text-blue-600" /> Editor
                            </h2>
                            <button onClick={onClose} className="p-2 hover:bg-slate-100 rounded-full text-slate-400 hover:text-red-500 transition">
                                <X size={20} />
                            </button>
                        </div>
                    </div>

                    <div className="flex-1 overflow-y-auto p-6 space-y-6">
                        {/* Image Section */}
                        <div className="space-y-3">
                            <label className="text-xs font-bold text-slate-400 uppercase tracking-wider flex items-center gap-2">
                                <ImageIcon size={14} /> Imagen de Cabecera
                            </label>
                            <div className="relative aspect-video rounded-xl overflow-hidden border-2 border-slate-200 group bg-slate-100">
                                {formData.imageUrl ? (
                                    <img src={formData.imageUrl} className="w-full h-full object-cover" />
                                ) : (
                                    <div className="flex items-center justify-center h-full text-slate-400 text-xs text-center p-4">
                                        Sin imagen seleccionada
                                    </div>
                                )}
                                <div className="absolute inset-0 bg-black/50 flex flex-col items-center justify-center opacity-0 group-hover:opacity-100 transition-all gap-2">
                                    <label className="cursor-pointer bg-white text-xs font-bold px-4 py-2 rounded-full hover:bg-blue-50 transition">
                                        Cambiar
                                        <input
                                            type="file"
                                            className="hidden"
                                            accept="image/*"
                                            onChange={(e) => {
                                                const file = e.target.files?.[0];
                                                if (file) {
                                                    const reader = new FileReader();
                                                    reader.onload = (e) => setFormData(p => ({ ...p, imageUrl: e.target?.result as string }));
                                                    reader.readAsDataURL(file);
                                                }
                                            }}
                                        />
                                    </label>
                                    <button
                                        onClick={() => setFormData(p => ({ ...p, imageUrl: '' }))}
                                        className="text-white text-xs hover:text-red-300"
                                    >
                                        Quitar
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Text Content */}
                        <div className="space-y-4">
                            <div>
                                <label className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block">TÃ­tulo Principal</label>
                                <input
                                    type="text"
                                    value={formData.title}
                                    onChange={e => setFormData(p => ({ ...p, title: e.target.value }))}
                                    className="w-full p-3 rounded-xl border border-slate-200 text-sm focus:ring-2 focus:ring-blue-500 outline-none"
                                    placeholder="Ej: Â¡Oferta Especial!"
                                />
                            </div>

                            <div>
                                <label className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block">Oferta Destacada (Opcional)</label>
                                <input
                                    type="text"
                                    value={formData.offer}
                                    onChange={e => setFormData(p => ({ ...p, offer: e.target.value }))}
                                    className="w-full p-3 rounded-xl border border-slate-200 text-sm focus:ring-2 focus:ring-blue-500 outline-none font-bold text-blue-600 bg-blue-50"
                                    placeholder="Ej: 2x1 en Lattes"
                                />
                            </div>

                            <div>
                                <label className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block">Contenido del Mensaje</label>
                                <textarea
                                    rows={5}
                                    value={formData.content}
                                    onChange={e => setFormData(p => ({ ...p, content: e.target.value }))}
                                    className="w-full p-3 rounded-xl border border-slate-200 text-sm focus:ring-2 focus:ring-blue-500 outline-none resize-none"
                                    placeholder="Escribe tu mensaje aquÃ­..."
                                ></textarea>
                            </div>
                        </div>

                        {/* Branding */}
                        <div className="space-y-4 pt-4 border-t border-slate-200">
                            <div>
                                <label className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block">Color Primario</label>
                                <div className="flex gap-2">
                                    {['#1E3A8A', '#DC2626', '#059669', '#7C3AED', '#DB2777'].map(color => (
                                        <button
                                            key={color}
                                            onClick={() => setFormData(p => ({ ...p, primaryColor: color }))}
                                            className={`w-8 h-8 rounded-full border-2 transition-transform ${formData.primaryColor === color ? 'border-slate-800 scale-110' : 'border-transparent'}`}
                                            style={{ backgroundColor: color }}
                                        />
                                    ))}
                                    <input
                                        type="color"
                                        value={formData.primaryColor}
                                        onChange={e => setFormData(p => ({ ...p, primaryColor: e.target.value }))}
                                        className="w-8 h-8 rounded-full overflow-hidden border-0 p-0 cursor-pointer"
                                    />
                                </div>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 block">Texto del BotÃ³n</label>
                                <input
                                    type="text"
                                    value={formData.buttonText}
                                    onChange={e => setFormData(p => ({ ...p, buttonText: e.target.value }))}
                                    className="w-full p-3 rounded-xl border border-slate-200 text-sm"
                                />
                            </div>
                        </div>
                    </div>

                    <div className="p-6 border-t border-slate-200 bg-white">
                        <button
                            onClick={handleSubmit}
                            disabled={isSending}
                            className="w-full py-4 bg-blue-600 text-white rounded-xl font-bold shadow-lg shadow-blue-200 hover:bg-blue-700 transition disabled:opacity-50 flex items-center justify-center gap-2"
                        >
                            <Send size={20} />
                            {isSending ? 'Enviando...' : `Enviar a ${audience}`}
                        </button>
                    </div>
                </div>

                {/* Live Preview Area */}
                <div className="flex-1 bg-slate-200 flex flex-col relative">
                    <div className="absolute top-6 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur-md px-2 py-1.5 rounded-full shadow-sm flex gap-1 z-10 border border-slate-200">
                        <button
                            onClick={() => setViewMode('mobile')}
                            className={`p-2 rounded-full transition ${viewMode === 'mobile' ? 'bg-slate-200 text-slate-900' : 'text-slate-400 hover:bg-slate-100'}`}
                        >
                            <Smartphone size={20} />
                        </button>
                        <button
                            onClick={() => setViewMode('desktop')}
                            className={`p-2 rounded-full transition ${viewMode === 'desktop' ? 'bg-slate-200 text-slate-900' : 'text-slate-400 hover:bg-slate-100'}`}
                        >
                            <Monitor size={20} />
                        </button>
                    </div>

                    <div className="flex-1 flex items-center justify-center p-8 overflow-y-auto">
                        <div
                            className={`bg-white shadow-2xl transition-all duration-500 overflow-hidden ${viewMode === 'mobile'
                                ? 'w-[375px] h-[750px] rounded-[40px] border-[8px] border-slate-900'
                                : 'w-[800px] h-[600px] rounded-xl border border-slate-300'
                                }`}
                        >
                            <iframe
                                srcDoc={htmlPreview}
                                className="w-full h-full border-0 bg-white"
                                title="Email Preview"
                            />
                        </div>
                    </div>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/components/client/layouts/MareClient.tsx">
'use client';

/**
 * MareClient.tsx â€” Layout Premium para Mare CafÃ©
 * 
 * DiseÃ±o editorial inspirado en Kinfolk Magazine, Cereal Magazine, Aesop Stores.
 * Paleta: Royal Deep Blue (#1A3278) + Parchment Cream (#F2EDE3) + Espresso Gold (#C8A96E)
 * TipografÃ­a: DM Serif Display (headings) + Plus Jakarta Sans (body) + JetBrains Mono (precios)
 * 
 * AISLAMIENTO: Este componente es 100% independiente. No modifica Perezoso ni componentes compartidos.
 */

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import { supabase } from '@/lib/supabase';
import { useClientConfig } from '@/context/ClientConfigContext';
import QRCode from 'react-qr-code';
import Image from 'next/image';
import PoweredBy from '@/components/PoweredBy';
import MarketingNotification from '@/components/client/marketing/MarketingNotification';

/* â”€â”€â”€ Mare Design Tokens (inline constants) â”€â”€â”€ */
const MARE = {
    primary: '#1A3278',
    primaryHover: '#243D8A',
    blueSoft: '#4A6BB5',
    surface: '#F2EDE3',
    canvas: '#FAF8F4',
    gold: '#C8A96E',
    goldLight: '#E8D5A0',
    ink: '#2A2A2E',
    stone: '#8C8B88',
    mist: '#E5E1D9',
    sage: '#5B8C6A',
    terracotta: '#C0574A',
} as const;

const FONTS = {
    serif: 'var(--font-dm-serif), Georgia, serif',
    sans: 'var(--font-jakarta), system-ui, sans-serif',
    mono: 'var(--font-jetbrains), monospace',
} as const;

/* â”€â”€â”€ Inline SVG Icons (line-art 1.5px, estilo editorial del flyer) â”€â”€â”€ */

/** Ãcono de taza de cafÃ© (para stamps activos) */
function CoffeeStampIcon({ filled = false, size = 20 }: { filled?: boolean; size?: number }) {
    return (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round">
            {filled && <circle cx="12" cy="12" r="11" fill={MARE.primary} stroke="none" />}
            <path
                d={filled ? "M8 15c0 1.1.9 2 2 2h4a2 2 0 002-2v-4H8v4z" : "M6 17c0 1.1.9 2 2 2h8a2 2 0 002-2V9H6v8z"}
                stroke={filled ? MARE.canvas : MARE.gold}
            />
            <path
                d={filled ? "M16 11h1a2 2 0 010 4h-1" : "M18 9h1.5a2.5 2.5 0 010 5H18"}
                stroke={filled ? MARE.canvas : MARE.gold}
            />
            {!filled && (
                <>
                    <path d="M10 5c0-1 .5-2 1.5-2S13 4 13 5" stroke={MARE.gold} opacity="0.5" />
                    <path d="M7.5 5.5C7.5 4.5 8 3.5 9 3.5" stroke={MARE.gold} opacity="0.3" />
                </>
            )}
        </svg>
    );
}

/** Ãcono de estrella con gradiente dorado (para recompensa final) */
function StarRewardIcon({ size = 20 }: { size?: number }) {
    return (
        <svg width={size} height={size} viewBox="0 0 24 24" fill="none">
            <defs>
                <linearGradient id="mare-gold-grad" x1="0" y1="0" x2="1" y2="1">
                    <stop offset="0%" stopColor={MARE.gold} />
                    <stop offset="50%" stopColor={MARE.goldLight} />
                    <stop offset="100%" stopColor={MARE.gold} />
                </linearGradient>
            </defs>
            <path d="M12 2l2.4 7.4H22l-6.2 4.5 2.4 7.4L12 16.8l-6.2 4.5 2.4-7.4L2 9.4h7.6L12 2z" fill="url(#mare-gold-grad)" stroke={MARE.gold} strokeWidth="1" />
        </svg>
    );
}

/** AnimaciÃ³n de olas del mar (pull-to-refresh / loader) */
function WaveLoader() {
    return (
        <svg width="48" height="20" viewBox="0 0 48 20">
            <path
                d="M0 12 Q6 6 12 12 Q18 18 24 12 Q30 6 36 12 Q42 18 48 12"
                fill="none" stroke={MARE.primary} strokeWidth="1.5" strokeLinecap="round" opacity="0.7"
                style={{ animation: 'mare-wave1 2s ease-in-out infinite' }}
            />
            <path
                d="M0 14 Q6 8 12 14 Q18 20 24 14 Q30 8 36 14 Q42 20 48 14"
                fill="none" stroke={MARE.blueSoft} strokeWidth="1.2" strokeLinecap="round" opacity="0.4"
                style={{ animation: 'mare-wave2 2s ease-in-out infinite 0.3s' }}
            />
        </svg>
    );
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   COMPONENTE PRINCIPAL â€” MareClient
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

export default function MareClient() {
    const config = useClientConfig();
    const router = useRouter();

    /* â”€â”€â”€ Estado de usuario y stamps â”€â”€â”€ */
    const [stamps, setStamps] = useState(0);
    const [loading, setLoading] = useState(true);
    const [userName, setUserName] = useState('');
    const [userUUID, setUserUUID] = useState('');
    const [userLevel, setUserLevel] = useState(1);
    const [showQRSheet, setShowQRSheet] = useState(false);
    const [showLevelUpModal, setShowLevelUpModal] = useState(false);
    const [favDrink, setFavDrink] = useState('');
    const [activeTab, setActiveTab] = useState('home');

    /* â”€â”€â”€ AutenticaciÃ³n y carga de datos â”€â”€â”€ */
    useEffect(() => {
        const checkSession = async () => {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) { router.push('/auth/login'); return; }

            setUserUUID(session.user.id);

            const { data: profile } = await supabase
                .from('profiles')
                .select('role, client_code, first_name, level, preferences')
                .eq('id', session.user.id)
                .single();

            if (profile?.role !== 'customer') { router.push('/unauthorized'); return; }

            setUserName(profile?.first_name || 'Cliente');
            setUserLevel(profile?.level || 1);
            if (profile?.preferences?.favorite_drink) setFavDrink(profile.preferences.favorite_drink);

            fetchStamps(session.user.id);

            // Realtime subscription
            const channel = supabase
                .channel('mare_stamps_sub')
                .on('postgres_changes', {
                    event: '*', schema: 'public', table: 'stamps',
                    filter: `user_id=eq.${session.user.id}`,
                }, () => fetchStamps(session.user.id))
                .subscribe();

            return () => { supabase.removeChannel(channel); };
        };
        checkSession();
    }, [router, config.code]);

    const fetchStamps = async (userId: string) => {
        try {
            const { data, error } = await supabase
                .from('stamps').select('count').eq('user_id', userId).single();

            if (error && error.code !== 'PGRST116') { console.error('Error:', error); return; }

            if (data) {
                if (stamps >= (config.rules.stampsPerReward || 7) && data.count < (config.rules.stampsPerReward || 7)) {
                    setShowQRSheet(false);
                    setShowLevelUpModal(true);
                }
                setStamps(data.count);
            } else {
                const { error: insertError } = await supabase
                    .from('stamps')
                    .insert([{ user_id: userId, count: 0, client_code: config.code }]);
                if (!insertError) setStamps(0);
            }
        } catch (err) { console.error('Unexpected:', err); }
        finally { setLoading(false); }
    };

    const handleSavePreferences = async () => {
        if (!userUUID || !favDrink) return;
        await supabase.from('profiles').update({ preferences: { favorite_drink: favDrink } }).eq('id', userUUID);
        setShowLevelUpModal(false);
    };

    const handleTabChange = (tab: string) => {
        setActiveTab(tab);
        if (tab === 'menu' && config.features.menuEnabled) router.push('/client/menu');
    };

    /* â”€â”€â”€ Loading State â”€â”€â”€ */
    if (loading) {
        return (
            <div className="mare-theme" style={{ minHeight: '100vh', background: MARE.canvas, display: 'flex', alignItems: 'center', justifyContent: 'center', flexDirection: 'column', gap: 16 }}>
                <WaveLoader />
                <span style={{ fontFamily: FONTS.sans, fontSize: 13, color: MARE.stone, letterSpacing: '0.05em' }}>Cargando...</span>
            </div>
        );
    }

    const total = config.rules.stampsPerReward || 7;
    const isRewardAvailable = stamps >= total;
    const stampPct = Math.min((stamps / total) * 100, 100);

    /* â”€â”€â”€ Datos de ejemplo para el News Feed â”€â”€â”€ */
    const newsItems = [
        { id: '1', cat: 'Novedad', title: 'Cold Brew de Temporada', desc: 'InfusiÃ³n en frÃ­o con notas tropicales', icon: 'â˜•' },
        { id: '2', cat: 'Evento', title: 'Taller de Latte Art', desc: 'Aprende arte en tu taza este sÃ¡bado', icon: 'ðŸŽ¨' },
        { id: '3', cat: 'Eco', title: 'Descuento Eco-Friendly', desc: '15% OFF con tu vaso reutilizable', icon: 'ðŸŒ±' },
        { id: '4', cat: 'Nuevo', title: 'PastelerÃ­a Artesanal', desc: 'Nuevos croissants de masa madre', icon: 'ðŸ§' },
    ];

    /* â”€â”€â”€ QR Data â”€â”€â”€ */
    const qrData = JSON.stringify({ uid: userUUID, action: isRewardAvailable ? 'redeem' : 'scan', shop: config.code });

    return (
        <div className="mare-theme" style={{ minHeight: '100vh', background: MARE.canvas, fontFamily: FONTS.sans, color: MARE.ink, paddingBottom: 100 }}>

            {/* â•â•â• HEADER â€” Ocean Gradient Hero â•â•â• */}
            <header style={{
                background: 'linear-gradient(175deg, #1A3278 0%, #243D8A 45%, #2E4F9E 100%)',
                padding: '0 0 32px 0', color: MARE.surface, position: 'relative',
            }}>
                {/* Top Bar (sticky feel) */}
                <div style={{ padding: '48px 20px 0', display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                    <div>
                        <h1 style={{ fontFamily: FONTS.serif, fontSize: 28, letterSpacing: '-0.02em', lineHeight: 1.1 }}>Mare</h1>
                        <span style={{ fontSize: 11, opacity: 0.7, letterSpacing: '0.04em', textTransform: 'uppercase' as const }}>
                            PastelerÃ­a y CafÃ©
                        </span>
                    </div>
                    <button
                        onClick={() => setShowQRSheet(true)}
                        style={{
                            width: 40, height: 40, borderRadius: '50%', background: 'rgba(255,255,255,0.12)',
                            display: 'flex', alignItems: 'center', justifyContent: 'center', border: 'none', cursor: 'pointer',
                        }}
                    >
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke={MARE.surface} strokeWidth="1.5">
                            <path d="M18 8A6 6 0 006 8c0 7-3 9-3 9h18s-3-2-3-9M13.73 21a2 2 0 01-3.46 0" />
                        </svg>
                    </button>
                </div>

                {/* Welcome Message */}
                <div style={{ padding: '20px 20px 0' }}>
                    <p style={{ fontSize: 18, fontWeight: 500, marginBottom: 4 }}>Hola, {userName} ðŸ‘‹</p>
                    <p style={{ fontSize: 13, opacity: 0.7 }}>
                        {isRewardAvailable
                            ? 'Â¡Tu premio estÃ¡ listo para canjear!'
                            : `Te faltan ${total - stamps} cafÃ©s para tu recompensa`
                        }
                    </p>
                </div>
            </header>

            {/* â•â•â• MAIN CONTENT â•â•â• */}
            <main style={{ padding: '0 16px', maxWidth: 480, margin: '0 auto' }} className="mare-fade-up">

                {/* â”€â”€â”€ Tarjeta de Fidelidad (Mini, sobresale del header) â”€â”€â”€ */}
                <div style={{ marginTop: -16 }}>
                    <div style={{
                        background: MARE.canvas, borderRadius: 16, padding: '16px 20px',
                        border: `1px solid ${MARE.mist}`, boxShadow: '0 2px 12px rgba(0,0,0,0.04)',
                    }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>
                            <span style={{ fontFamily: FONTS.serif, fontSize: 14, color: MARE.primary }}>{config.texts.stampCardTitle}</span>
                            <span style={{ fontSize: 11, fontFamily: FONTS.mono, color: MARE.stone }}>{stamps}/{total}</span>
                        </div>
                        <div className="mare-stagger" style={{ display: 'flex', gap: 6, justifyContent: 'center', marginBottom: 12 }}>
                            {Array.from({ length: total }).map((_, i) => {
                                const filled = i < stamps;
                                const isLast = i === total - 1;
                                return (
                                    <div key={i} className={filled ? 'mare-stamp-bounce' : ''} style={{
                                        width: 32, height: 32, borderRadius: '50%',
                                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                                        background: isLast && isRewardAvailable
                                            ? `linear-gradient(135deg, ${MARE.gold}, ${MARE.goldLight}, ${MARE.gold})`
                                            : filled ? MARE.primary : 'transparent',
                                        border: filled ? 'none' : `1.5px dashed ${MARE.gold}`,
                                        transition: 'all 300ms ease',
                                    }}>
                                        {isLast ? <StarRewardIcon size={16} /> : filled ? <CoffeeStampIcon filled size={16} /> : <CoffeeStampIcon size={14} />}
                                    </div>
                                );
                            })}
                        </div>
                        {/* Progress Bar */}
                        <div style={{ height: 3, borderRadius: 2, background: MARE.mist, overflow: 'hidden' }}>
                            <div style={{ height: '100%', borderRadius: 2, background: MARE.primary, width: `${stampPct}%`, transition: 'width 500ms ease' }} />
                        </div>
                    </div>
                </div>

                {/* â”€â”€â”€ Acceso RÃ¡pido â”€â”€â”€ */}
                <div style={{ marginTop: 24 }}>
                    <div style={{ fontSize: 11, color: MARE.stone, letterSpacing: '0.06em', textTransform: 'uppercase' as const, marginBottom: 12 }}>Acceso rÃ¡pido</div>
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 10 }}>
                        <button
                            onClick={() => handleTabChange('menu')}
                            style={{
                                padding: '14px 16px', borderRadius: 12, border: `1px solid ${MARE.mist}`,
                                display: 'flex', alignItems: 'center', gap: 10, background: MARE.canvas,
                                cursor: 'pointer', fontFamily: FONTS.sans, fontSize: 13, fontWeight: 500, color: MARE.ink,
                            }}
                        >
                            <span style={{ fontSize: 18 }}>ðŸ“–</span> Ver MenÃº
                        </button>
                        <button
                            onClick={() => setShowQRSheet(true)}
                            style={{
                                padding: '14px 16px', borderRadius: 12, border: `1px solid ${MARE.mist}`,
                                display: 'flex', alignItems: 'center', gap: 10, background: MARE.canvas,
                                cursor: 'pointer', fontFamily: FONTS.sans, fontSize: 13, fontWeight: 500, color: MARE.ink,
                            }}
                        >
                            <span style={{ fontSize: 18 }}>ðŸ“±</span> Mi QR
                        </button>
                    </div>
                </div>

                {/* â”€â”€â”€ Banner Promocional (estilo editorial) â”€â”€â”€ */}
                <div style={{ marginTop: 24 }}>
                    <div style={{
                        background: `linear-gradient(135deg, ${MARE.surface}, ${MARE.canvas})`,
                        borderRadius: 20, padding: 24, border: `1.5px solid ${MARE.primary}`,
                        position: 'relative', overflow: 'hidden',
                    }}>
                        <div style={{
                            position: 'absolute', top: -20, right: -20, width: 100, height: 100,
                            borderRadius: '50%', background: `${MARE.gold}15`,
                        }} />
                        <p style={{ fontSize: 10, fontWeight: 600, letterSpacing: '0.12em', textTransform: 'uppercase' as const, color: MARE.gold, marginBottom: 8 }}>
                            CafÃ© de Especialidad
                        </p>
                        <h3 style={{ fontFamily: FONTS.serif, fontSize: 22, color: MARE.primary, lineHeight: 1.15, letterSpacing: '-0.02em', marginBottom: 8 }}>
                            DescubrÃ­ nuestros nuevos blends
                        </h3>
                        <p style={{ fontSize: 13, color: MARE.stone, lineHeight: 1.5, marginBottom: 16 }}>
                            Microlotes seleccionados de Huila, Colombia y Sidama, EtiopÃ­a.
                        </p>
                        <button style={{
                            background: MARE.primary, color: MARE.surface, border: 'none',
                            padding: '12px 24px', borderRadius: 12, fontFamily: FONTS.sans,
                            fontSize: 13, fontWeight: 600, cursor: 'pointer',
                            transition: 'all 200ms ease',
                        }}>
                            Explorar â†’
                        </button>
                    </div>
                </div>

                {/* â”€â”€â”€ Novedades (News Feed editorial) â”€â”€â”€ */}
                {config.features.showNewsFeed && (
                    <div style={{ marginTop: 32 }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12, padding: '0 4px' }}>
                            <span style={{ fontFamily: FONTS.serif, fontSize: 18, color: MARE.primary, letterSpacing: '-0.01em' }}>Novedades</span>
                            <span style={{ fontSize: 12, color: MARE.blueSoft, fontWeight: 500, cursor: 'pointer' }}>Ver todos â†’</span>
                        </div>
                        <div className="scrollbar-hide" style={{ display: 'flex', gap: 12, overflowX: 'auto', paddingBottom: 4, marginLeft: -16, marginRight: -16, paddingLeft: 16, paddingRight: 16 }}>
                            {newsItems.map((item, i) => (
                                <div key={item.id} className="mare-fade-up" style={{
                                    minWidth: 160, borderRadius: 16, border: `1px solid ${MARE.mist}`,
                                    overflow: 'hidden', background: MARE.canvas, flexShrink: 0,
                                    transition: 'all 200ms ease', cursor: 'pointer',
                                    animationDelay: `${i * 50}ms`,
                                }}>
                                    <div style={{
                                        height: 80,
                                        background: `linear-gradient(${135 + i * 30}deg, ${MARE.primary}, ${MARE.blueSoft})`,
                                        display: 'flex', alignItems: 'center', justifyContent: 'center',
                                        fontSize: 32,
                                    }}>
                                        {item.icon}
                                    </div>
                                    <div style={{ padding: '10px 12px' }}>
                                        <span style={{
                                            fontSize: 9, fontWeight: 600, letterSpacing: '0.06em', textTransform: 'uppercase' as const,
                                            color: MARE.gold, background: `${MARE.gold}15`, padding: '2px 6px', borderRadius: 4,
                                        }}>
                                            {item.cat}
                                        </span>
                                        <h4 style={{ fontFamily: FONTS.serif, fontSize: 13, color: MARE.ink, marginTop: 6, lineHeight: 1.3 }}>{item.title}</h4>
                                        <p style={{ fontSize: 11, color: MARE.stone, marginTop: 4, lineHeight: 1.4 }}>{item.desc}</p>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                )}

                {/* â”€â”€â”€ Powered By â”€â”€â”€ */}
                <div style={{ marginTop: 32, opacity: 0.3, textAlign: 'center' }}>
                    <PoweredBy />
                </div>
            </main>

            {/* â•â•â• BOTTOM NAVIGATION â€” Glass Bar, 4 Tabs â•â•â• */}
            <nav style={{
                position: 'fixed', bottom: 0, left: 0, right: 0, zIndex: 30,
                background: 'rgba(250,248,244,0.9)', backdropFilter: 'blur(20px) saturate(1.4)',
                borderTop: `0.5px solid ${MARE.mist}`,
                paddingBottom: 'env(safe-area-inset-bottom, 0px)',
            }}>
                <div style={{ display: 'flex', justifyContent: 'space-around', padding: '10px 0 12px', maxWidth: 400, margin: '0 auto' }}>
                    {[
                        { id: 'home', icon: 'âŒ‚', label: 'INICIO' },
                        { id: 'menu', icon: 'â˜•', label: 'MENÃš' },
                        { id: 'qr', icon: 'â—Ž', label: 'LEALTAD' },
                        { id: 'profile', icon: 'â—¯', label: 'PERFIL' },
                    ].map(tab => {
                        const isActive = activeTab === tab.id;
                        return (
                            <button
                                key={tab.id}
                                onClick={() => {
                                    if (tab.id === 'qr') { setShowQRSheet(true); return; }
                                    handleTabChange(tab.id);
                                }}
                                style={{
                                    background: 'none', border: 'none', cursor: 'pointer',
                                    display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 3,
                                    padding: '4px 12px',
                                }}
                            >
                                <span style={{ fontSize: 20, color: MARE.primary, opacity: isActive ? 1 : 0.35, transition: 'opacity 200ms' }}>
                                    {tab.icon}
                                </span>
                                <span style={{
                                    fontSize: 9, fontWeight: 600, letterSpacing: '0.08em',
                                    color: isActive ? MARE.primary : MARE.stone,
                                    fontFamily: FONTS.sans,
                                }}>
                                    {tab.label}
                                </span>
                                {/* Dot indicator */}
                                <div style={{
                                    width: 4, height: 4, borderRadius: '50%',
                                    background: isActive ? MARE.primary : 'transparent',
                                    transition: 'background 200ms',
                                }} />
                            </button>
                        );
                    })}
                </div>
            </nav>

            {/* â•â•â• QR SHEET â€” Bottom Sheet (spring animation) â•â•â• */}
            {showQRSheet && (
                <>
                    {/* Overlay */}
                    <div
                        onClick={() => setShowQRSheet(false)}
                        style={{
                            position: 'fixed', inset: 0, zIndex: 40,
                            background: 'rgba(26, 50, 120, 0.4)',
                            backdropFilter: 'blur(8px)',
                            transition: 'opacity 300ms',
                        }}
                    />
                    {/* Sheet */}
                    <div className="mare-slide-up" style={{
                        position: 'fixed', bottom: 0, left: 0, right: 0, zIndex: 50,
                    }}>
                        <div style={{
                            background: MARE.canvas, borderRadius: '24px 24px 0 0',
                            maxWidth: 420, margin: '0 auto', width: '100%',
                            padding: '12px 24px 40px',
                            boxShadow: '0 -8px 40px rgba(0,0,0,0.15)',
                        }}>
                            {/* Drag Handle */}
                            <div style={{ width: 48, height: 5, borderRadius: 3, background: MARE.mist, margin: '0 auto 20px', opacity: 0.5 }} />

                            {/* Status Badge */}
                            <div style={{ textAlign: 'center', marginBottom: 20 }}>
                                <span style={{
                                    display: 'inline-flex', alignItems: 'center', gap: 8,
                                    padding: '6px 16px', borderRadius: 20,
                                    fontSize: 12, fontWeight: 600,
                                    background: isRewardAvailable ? `${MARE.gold}20` : `${MARE.primary}08`,
                                    color: isRewardAvailable ? MARE.gold : MARE.primary,
                                    fontFamily: FONTS.sans,
                                }}>
                                    {isRewardAvailable ? 'â˜… Â¡Premio disponible!' : 'â˜• Muestra al barista'}
                                </span>
                            </div>

                            {/* QR Code */}
                            <div style={{
                                borderRadius: 24, padding: 32, display: 'flex', alignItems: 'center', justifyContent: 'center',
                                maxWidth: 280, margin: '0 auto',
                                background: isRewardAvailable ? MARE.primary : MARE.surface,
                                border: isRewardAvailable ? 'none' : `1.5px solid ${MARE.mist}`,
                                transition: 'all 300ms ease',
                            }}>
                                <div style={{ background: '#fff', padding: 16, borderRadius: 16 }}>
                                    <QRCode
                                        value={qrData}
                                        size={176}
                                        fgColor={MARE.primary}
                                        bgColor="#FFFFFF"
                                    />
                                </div>
                            </div>

                            <p style={{
                                textAlign: 'center', fontSize: 12, color: MARE.stone, marginTop: 20,
                                maxWidth: 220, margin: '20px auto 0', lineHeight: 1.5, fontFamily: FONTS.sans,
                            }}>
                                {isRewardAvailable
                                    ? 'El barista escanearÃ¡ este cÃ³digo para canjear tu premio.'
                                    : 'Acumula sellos con cada compra presentando este cÃ³digo.'}
                            </p>

                            {/* Close Button */}
                            <button
                                onClick={() => setShowQRSheet(false)}
                                style={{
                                    width: '100%', marginTop: 24, padding: '14px 0', borderRadius: 12,
                                    background: MARE.mist, border: 'none', cursor: 'pointer',
                                    fontFamily: FONTS.sans, fontSize: 14, fontWeight: 600, color: MARE.stone,
                                    transition: 'all 200ms ease',
                                }}
                            >
                                Cerrar
                            </button>
                        </div>
                    </div>
                </>
            )}

            {/* â•â•â• MODAL â€” Canje Exitoso / Preferencia â•â•â• */}
            {showLevelUpModal && (
                <div style={{
                    position: 'fixed', inset: 0, zIndex: 50, display: 'flex', alignItems: 'center', justifyContent: 'center',
                    background: 'rgba(26, 50, 120, 0.5)', backdropFilter: 'blur(8px)', padding: 16,
                }}>
                    <div className="mare-fade-up" style={{
                        background: MARE.canvas, borderRadius: 24, padding: 32, maxWidth: 360, width: '100%',
                        textAlign: 'center', position: 'relative', overflow: 'hidden',
                    }}>
                        {/* Gold accent circle */}
                        <div style={{
                            position: 'absolute', top: -30, right: -30, width: 120, height: 120,
                            borderRadius: '50%', background: `${MARE.gold}15`,
                        }} />
                        <div style={{
                            position: 'absolute', bottom: -20, left: -20, width: 80, height: 80,
                            borderRadius: '50%', background: `${MARE.primary}08`,
                        }} />

                        <div style={{ position: 'relative', zIndex: 1 }}>
                            <div style={{
                                width: 64, height: 64, borderRadius: '50%',
                                background: `linear-gradient(135deg, ${MARE.gold}, ${MARE.goldLight}, ${MARE.gold})`,
                                display: 'flex', alignItems: 'center', justifyContent: 'center',
                                margin: '0 auto 16px',
                            }}>
                                <StarRewardIcon size={32} />
                            </div>

                            <h2 style={{ fontFamily: FONTS.serif, fontSize: 24, color: MARE.primary, marginBottom: 8, letterSpacing: '-0.02em' }}>
                                Â¡Canje Exitoso!
                            </h2>
                            <p style={{ fontSize: 14, color: MARE.stone, marginBottom: 24, lineHeight: 1.5 }}>
                                Has disfrutado tu premio. CuÃ©ntanos, Â¿cuÃ¡l fue tu bebida de hoy?
                            </p>

                            <div style={{
                                background: MARE.surface, padding: 16, borderRadius: 16, textAlign: 'left',
                                border: `1px solid ${MARE.mist}`, marginBottom: 20,
                            }}>
                                <label style={{
                                    display: 'block', fontSize: 11, fontWeight: 600, color: MARE.stone,
                                    letterSpacing: '0.08em', textTransform: 'uppercase' as const, marginBottom: 8,
                                }}>
                                    Tu bebida favorita
                                </label>
                                <input
                                    type="text"
                                    value={favDrink}
                                    onChange={(e) => setFavDrink(e.target.value)}
                                    placeholder="Ej. Cappuccino, Latte Vainilla..."
                                    style={{
                                        width: '100%', padding: '12px 14px', borderRadius: 12,
                                        border: `1.5px solid ${MARE.mist}`, fontFamily: FONTS.sans,
                                        fontSize: 14, outline: 'none', background: MARE.canvas, color: MARE.ink,
                                        transition: 'border-color 200ms ease',
                                    }}
                                    onFocus={e => e.target.style.borderColor = MARE.primary}
                                    onBlur={e => e.target.style.borderColor = MARE.mist}
                                />
                            </div>

                            <button
                                onClick={handleSavePreferences}
                                style={{
                                    width: '100%', padding: '14px 0', borderRadius: 12,
                                    background: MARE.primary, color: MARE.surface, border: 'none',
                                    fontFamily: FONTS.sans, fontSize: 14, fontWeight: 600, cursor: 'pointer',
                                    transition: 'all 200ms ease',
                                }}
                            >
                                Guardar Preferencia
                            </button>
                        </div>
                    </div>
                </div>
            )}

            <MarketingNotification userLevel={userLevel} clientCode={config.code} />
        </div>
    );
}
</file>

<file path="src/components/client/layouts/PerezosoClient.tsx">
'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import { supabase } from '@/lib/supabase';
import { useClientConfig } from '@/context/ClientConfigContext';
import { Coffee, Crown } from 'lucide-react';

// Coffeinopia Components
import ClientHeader from '@/components/client/ClientHeader';
import PromoBanner from '@/components/client/PromoBanner';
import StampProgress from '@/components/client/StampProgress';
import NewsFeed from '@/components/client/NewsFeed';
import BottomNav from '@/components/client/BottomNav';
import QRSheet from '@/components/client/QRSheet';
import PoweredBy from '@/components/PoweredBy';

export default function PerezosoClient() {
    const config = useClientConfig();
    const [stamps, setStamps] = useState(0);
    const [loading, setLoading] = useState(true);
    const [userName, setUserName] = useState('');
    const [userUUID, setUserUUID] = useState('');
    const [userLevel, setUserLevel] = useState(1);
    const [showQRSheet, setShowQRSheet] = useState(false);
    const [showLevelUpModal, setShowLevelUpModal] = useState(false);
    const [favDrink, setFavDrink] = useState('');

    const router = useRouter();

    useEffect(() => {
        const checkSession = async () => {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                router.push('/auth/login');
                return;
            }

            setUserUUID(session.user.id);

            const { data: profile } = await supabase
                .from('profiles')
                .select('role, client_code, first_name, level, preferences')
                .eq('id', session.user.id)
                .single();

            if (profile?.role !== 'customer') {
                router.push('/unauthorized');
                return;
            }

            setUserName(profile?.first_name || 'Cliente');
            setUserLevel(profile?.level || 1);
            if (profile?.preferences?.favorite_drink) {
                setFavDrink(profile.preferences.favorite_drink);
            }

            fetchStamps(session.user.id);

            const channel = supabase
                .channel('stamps_subscription')
                .on(
                    'postgres_changes',
                    {
                        event: '*',
                        schema: 'public',
                        table: 'stamps',
                        filter: `user_id=eq.${session.user.id}`,
                    },
                    () => {
                        fetchStamps(session.user.id);
                    }
                )
                .subscribe();

            return () => {
                supabase.removeChannel(channel);
            };
        };

        checkSession();
    }, [router, config.code]);

    const fetchStamps = async (userId: string) => {
        try {
            const { data, error } = await supabase
                .from('stamps')
                .select('count')
                .eq('user_id', userId)
                .single();

            if (error && error.code !== 'PGRST116') {
                console.error('Error fetching stamps:', error);
                return;
            }

            if (data) {
                if (stamps >= (config.rules.stampsPerReward || 10) && data.count < (config.rules.stampsPerReward || 10)) {
                    setShowQRSheet(false);
                    setShowLevelUpModal(true);
                }
                setStamps(data.count);
            } else {
                const { error: insertError } = await supabase
                    .from('stamps')
                    .insert([{ user_id: userId, count: 0, client_code: config.code }]);

                if (!insertError) setStamps(0);
            }
        } catch (error) {
            console.error('Unexpected error:', error);
        } finally {
            setLoading(false);
        }
    };

    const handleTabChange = (tab: string) => {
        if (tab === 'menu') router.push('/client/menu');
    };

    const handleSavePreferences = async () => {
        if (!userUUID || !favDrink) return;

        await supabase.from('profiles').update({
            preferences: { favorite_drink: favDrink }
        }).eq('id', userUUID);

        setShowLevelUpModal(false);
        alert('Â¡Gracias! Guardamos tu preferencia.');
    };

    if (loading) {
        return (
            <div className="min-h-screen flex items-center justify-center bg-gray-50">
                <div className="animate-spin rounded-full h-8 w-8 border-b-2" style={{ borderColor: config.theme.primaryColor }}></div>
            </div>
        );
    }

    const isRewardAvailable = stamps >= (config.rules.stampsPerReward || 10);

    return (
        <div className="min-h-screen bg-[#FAFAFA] pb-[100px] relative overflow-hidden" style={{ fontFamily: config.theme.fontFamily }}>

            <ClientHeader config={config} userName={userName} level={userLevel} />

            <main className="pt-36 px-5 flex flex-col gap-6 animate-in slide-in-from-bottom-4 duration-700">

                <PromoBanner config={config} />

                <StampProgress
                    currentStamps={stamps}
                    config={config}
                />

                {config.features.showNewsFeed && (
                    <NewsFeed config={config} />
                )}

                <div className="mt-4 opacity-50">
                    <PoweredBy />
                </div>

            </main>

            <BottomNav
                config={config}
                onQRClick={() => setShowQRSheet(true)}
                onTabChange={handleTabChange}
            />

            <QRSheet
                isOpen={showQRSheet}
                onClose={() => setShowQRSheet(false)}
                config={config}
                userUUID={userUUID}
                isReward={isRewardAvailable}
            />

            {showLevelUpModal && (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-in fade-in duration-300">
                    <div className="bg-white rounded-3xl p-8 max-w-sm w-full text-center shadow-2xl relative overflow-hidden">
                        <div className="absolute inset-0 bg-yellow-50 opacity-50"></div>
                        <div className="relative z-10 w-full">
                            <div className="text-6xl mb-4 animate-bounce">ðŸŽ‰</div>
                            <h2 className="text-2xl font-black text-gray-900 mb-2">Â¡Canje Exitoso!</h2>
                            <div className="w-20 h-20 bg-amber-100 rounded-full flex items-center justify-center mx-auto mb-4 mt-4">
                                <Crown size={40} className="text-amber-500" />
                            </div>
                            <p className="text-gray-500 mb-6">Has disfrutado tu premio. Â¡Sigue acumulando para el prÃ³ximo!</p>

                            <div className="bg-white/80 p-4 rounded-xl text-left border border-gray-200 mb-4">
                                <label className="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
                                    <Coffee size={16} /> Â¿CuÃ¡l es tu bebida favorita?
                                </label>
                                <input
                                    type="text"
                                    value={favDrink}
                                    onChange={(e) => setFavDrink(e.target.value)}
                                    placeholder="Ej. Latte Vainilla"
                                    className="w-full rounded-lg border-gray-300 shadow-sm focus:border-amber-500 focus:ring-amber-500 px-3 py-2 text-gray-900 border"
                                />
                            </div>

                            <button
                                onClick={handleSavePreferences}
                                className="w-full bg-gray-900 text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:scale-105 transition-transform"
                            >
                                Â¡Genial!
                            </button>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
}
</file>

<file path="src/components/client/layouts/StandardClient.tsx">
'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import { supabase } from '@/lib/supabase';
import { useClientConfig } from '@/context/ClientConfigContext';
import { Coffee, Crown, Home, ClipboardList, Gift, User as UserIcon, Scan, Clock } from 'lucide-react';
import PoweredBy from '@/components/PoweredBy';

// We reuse some standard components but with Mare's configuration
import ClientHeader from '@/components/client/ClientHeader';
import PromoBanner from '@/components/client/PromoBanner';
import StampProgress from '@/components/client/StampProgress';
import NewsFeed from '@/components/client/NewsFeed';
import BottomNav from '@/components/client/BottomNav';
import QRSheet from '@/components/client/QRSheet';

export default function StandardClient() {
    const config = useClientConfig();
    const [stamps, setStamps] = useState(0);
    const [loading, setLoading] = useState(true);
    const [userName, setUserName] = useState('');
    const [userUUID, setUserUUID] = useState('');
    const [userLevel, setUserLevel] = useState(1);
    const [showQRSheet, setShowQRSheet] = useState(false);
    const [showLevelUpModal, setShowLevelUpModal] = useState(false);
    const [favDrink, setFavDrink] = useState('');

    const router = useRouter();

    useEffect(() => {
        const checkSession = async () => {
            const { data: { session } } = await supabase.auth.getSession();
            if (!session) {
                router.push('/auth/login');
                return;
            }

            setUserUUID(session.user.id);

            const { data: profile } = await supabase
                .from('profiles')
                .select('role, client_code, first_name, level, preferences')
                .eq('id', session.user.id)
                .single();

            if (profile?.role !== 'customer') {
                router.push('/unauthorized');
                return;
            }

            setUserName(profile?.first_name || 'Cliente');
            setUserLevel(profile?.level || 1);
            if (profile?.preferences?.favorite_drink) {
                setFavDrink(profile.preferences.favorite_drink);
            }

            fetchStamps(session.user.id);

            const channel = supabase
                .channel('stamps_subscription')
                .on(
                    'postgres_changes',
                    {
                        event: '*',
                        schema: 'public',
                        table: 'stamps',
                        filter: `user_id=eq.${session.user.id}`,
                    },
                    () => {
                        fetchStamps(session.user.id);
                    }
                )
                .subscribe();

            return () => {
                supabase.removeChannel(channel);
            };
        };

        checkSession();
    }, [router, config.code]);

    const fetchStamps = async (userId: string) => {
        try {
            const { data, error } = await supabase
                .from('stamps')
                .select('count')
                .eq('user_id', userId)
                .single();

            if (error && error.code !== 'PGRST116') {
                console.error('Error fetching stamps:', error);
                return;
            }

            if (data) {
                if (stamps >= (config.rules.stampsPerReward || 10) && data.count < (config.rules.stampsPerReward || 10)) {
                    setShowQRSheet(false);
                    setShowLevelUpModal(true);
                }
                setStamps(data.count);
            } else {
                const { error: insertError } = await supabase
                    .from('stamps')
                    .insert([{ user_id: userId, count: 0, client_code: config.code }]);

                if (!insertError) setStamps(0);
            }
        } catch (error) {
            console.error('Unexpected error:', error);
        } finally {
            setLoading(false);
        }
    };

    const handleTabChange = (tab: string) => {
        if (tab === 'menu' && config.features.menuEnabled) router.push('/client/menu');
    };

    const handleSavePreferences = async () => {
        if (!userUUID || !favDrink) return;

        await supabase.from('profiles').update({
            preferences: { favorite_drink: favDrink }
        }).eq('id', userUUID);

        setShowLevelUpModal(false);
        alert('Â¡Gracias! Guardamos tu preferencia.');
    };

    if (loading) {
        return (
            <div className="min-h-screen flex items-center justify-center bg-gray-50">
                <div className="animate-spin rounded-full h-8 w-8 border-b-2" style={{ borderColor: config.theme.primaryColor }}></div>
            </div>
        );
    }

    const isRewardAvailable = stamps >= (config.rules.stampsPerReward || 10);

    return (
        <div className="min-h-screen bg-slate-50 pb-[100px] relative overflow-hidden" style={{ fontFamily: config.theme.fontFamily }}>

            {/* Header Standard */}
            <header className="fixed top-0 left-0 right-0 z-40 bg-white border-b border-slate-200 px-6 py-4 flex items-center justify-between">
                <div>
                    <h2 className="text-xl font-bold text-slate-900 leading-tight">Hola, {userName}</h2>
                    <p className="text-slate-500 text-xs font-medium uppercase tracking-wider mt-0.5">Nivel {userLevel} â€¢ {config.name}</p>
                </div>
                <div className="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-slate-400">
                    <UserIcon size={20} />
                </div>
            </header>

            <main className="pt-24 px-5 flex flex-col gap-6 max-w-lg mx-auto">

                <PromoBanner config={config} />

                <StampProgress
                    currentStamps={stamps}
                    config={config}
                />

                {config.features.showNewsFeed && (
                    <NewsFeed config={config} />
                )}

                <div className="mt-4 opacity-30 text-center">
                    <PoweredBy />
                </div>

            </main>

            <BottomNav
                config={config}
                onQRClick={() => setShowQRSheet(true)}
                onTabChange={handleTabChange}
            />

            <QRSheet
                isOpen={showQRSheet}
                onClose={() => setShowQRSheet(false)}
                config={config}
                userUUID={userUUID}
                isReward={isRewardAvailable}
            />

            {/* Level Up / Preference Modal (Standard Design) */}
            {showLevelUpModal && (
                <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4 animate-in fade-in duration-300">
                    <div className="bg-white rounded-2xl p-8 max-w-sm w-full text-center shadow-2xl relative overflow-hidden">
                        <div className="relative z-10 w-full">
                            <div className="w-16 h-16 bg-brand-primary/10 rounded-full flex items-center justify-center mx-auto mb-6">
                                <Gift size={32} className="text-brand-primary" />
                            </div>
                            <h2 className="text-2xl font-bold text-slate-900 mb-2">Â¡Canje Exitoso!</h2>
                            <p className="text-slate-500 mb-6 text-sm">Has disfrutado tu premio. CuÃ©ntanos, Â¿cuÃ¡l fue tu bebida de hoy?</p>

                            <div className="bg-slate-50 p-4 rounded-xl text-left border border-slate-200 mb-6">
                                <label className="block text-xs font-bold text-slate-400 uppercase tracking-widest mb-2">Tu bebida favorita</label>
                                <input
                                    type="text"
                                    value={favDrink}
                                    onChange={(e) => setFavDrink(e.target.value)}
                                    placeholder="Ej. Latte Vainilla"
                                    className="w-full bg-transparent border-b border-slate-300 focus:border-brand-primary outline-none py-1 text-slate-900 font-medium"
                                />
                            </div>

                            <button
                                onClick={handleSavePreferences}
                                className="w-full bg-brand-primary text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition-all"
                            >
                                Guardar Preferencia
                            </button>
                        </div>
                    </div>
                </div>
            )}
        </div>
    );
}
</file>

<file path="src/components/client/marketing/MarketingNotification.tsx">
'use client';

import { useEffect, useState } from 'react';
import { supabase } from '@/lib/supabase';
import { X } from 'lucide-react';

interface MarketingNotificationProps {
    userLevel: number;
    clientCode: string;
}

export default function MarketingNotification({ userLevel, clientCode }: MarketingNotificationProps) {
    const [campaign, setCampaign] = useState<any | null>(null);
    const [isVisible, setIsVisible] = useState(false);

    useEffect(() => {
        const fetchCampaigns = async () => {
            try {
                // 1. Fetch active campaigns
                const { data: campaigns, error } = await supabase
                    .from('campaigns')
                    .select('*')
                    .eq('status', 'active')
                    .order('created_at', { ascending: false });

                if (error || !campaigns) return;

                // 2. Filter by Client Code (Metadata) & Audience
                const validCampaign = campaigns.find(c => {
                    // Check Client Isolation
                    const metadata = c.metadata || {};
                    if (metadata.client_code && metadata.client_code !== clientCode) return false;

                    // Check Audience Filters
                    if (c.audience === 'Todos') return true;
                    if (c.audience === 'Nivel 2+ (Frecuentes)' && userLevel >= 2) return true;
                    if (c.audience === 'Nivel 3+ (VIP)' && userLevel >= 3) return true;

                    return false;
                });

                if (validCampaign) {
                    // 3. Check LocalStorage (Don't show same campaign twice)
                    const seenKey = `mare_campaign_seen_${validCampaign.id}`;
                    const hasSeen = localStorage.getItem(seenKey);

                    if (!hasSeen) {
                        setCampaign(validCampaign);
                        setIsVisible(true);
                    }
                }

            } catch (err) {
                console.error('Error fetching marketing campaigns:', err);
            }
        };

        // Delay slighty to not block initial render
        const timer = setTimeout(fetchCampaigns, 2000);
        return () => clearTimeout(timer);
    }, [userLevel, clientCode]);

    const handleClose = () => {
        setIsVisible(false);
        if (campaign) {
            localStorage.setItem(`mare_campaign_seen_${campaign.id}`, 'true');
        }
    };

    if (!isVisible || !campaign) return null;

    const imageUrl = campaign.metadata?.imageUrl;

    return (
        <div className="fixed inset-0 z-[100] flex items-center justify-center p-4">
            {/* Backdrop */}
            <div
                className="absolute inset-0 bg-black/60 backdrop-blur-sm animate-in fade-in duration-300"
                onClick={handleClose}
            />

            {/* Modal */}
            <div className="relative w-full max-w-sm bg-white rounded-3xl overflow-hidden shadow-2xl animate-in zoom-in-95 duration-300">
                {/* Close Button */}
                <button
                    onClick={handleClose}
                    className="absolute top-4 right-4 z-10 p-2 bg-black/20 hover:bg-black/40 rounded-full text-white transition-colors backdrop-blur-md"
                >
                    <X size={20} />
                </button>

                {/* Content */}
                <div className="flex flex-col">
                    {imageUrl && (
                        <div className="w-full aspect-[3/4] relative bg-gray-100">
                            <img
                                src={imageUrl}
                                alt={campaign.title}
                                className="w-full h-full object-cover"
                            />
                        </div>
                    )}

                    {!imageUrl && (
                        <div className="p-8 text-center bg-[#1A3278] text-white">
                            <h3 className="text-xl font-serif mb-2">{campaign.title}</h3>
                            <p className="text-sm opacity-80">{campaign.content}</p>
                        </div>
                    )}

                    {/* Action Button */}
                    <button
                        onClick={handleClose}
                        className="w-full py-4 bg-white text-[#1A3278] font-bold text-sm uppercase tracking-wider hover:bg-gray-50 transition-colors border-t border-gray-100"
                    >
                        Entendido
                    </button>
                </div>
            </div>
        </div>
    );
}
</file>

<file path="src/components/client/menu/CategoryTabs.tsx">
import { Category } from '@/types/menu';

interface CategoryTabsProps {
    categories: Category[];
    selectedCategory: string;
    onSelect: (id: string) => void;
}

export default function CategoryTabs({ categories, selectedCategory, onSelect }: CategoryTabsProps) {
    return (
        <div className="sticky top-16 bg-white z-10 shadow-sm border-t border-gray-100">
            <div className="max-w-2xl mx-auto overflow-x-auto no-scrollbar py-3 px-4 flex gap-2">
                <button
                    onClick={() => onSelect('all')}
                    className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${selectedCategory === 'all'
                            ? 'bg-black text-white shadow-md'
                            : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                        }`}
                >
                    Todos
                </button>
                {categories.map((cat) => (
                    <button
                        key={cat.id}
                        onClick={() => onSelect(cat.id)}
                        className={`px-4 py-2 rounded-full text-sm font-medium whitespace-nowrap transition-all ${selectedCategory === cat.id
                                ? 'bg-black text-white shadow-md'
                                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                            }`}
                    >
                        {cat.name}
                    </button>
                ))}
            </div>
        </div>
    );
}
</file>

<file path="src/components/client/menu/MenuGalleryModal.tsx">
'use client';

import { useState, useEffect } from 'react';
import { X, ChevronLeft, ChevronRight } from 'lucide-react';

interface MenuGalleryModalProps {
    isOpen: boolean;
    onClose: () => void;
    images: { src: string; label: string }[];
    initialIndex?: number;
}

export default function MenuGalleryModal({ isOpen, onClose, images, initialIndex = 0 }: MenuGalleryModalProps) {
    const [currentIndex, setCurrentIndex] = useState(initialIndex);

    useEffect(() => {
        if (isOpen) {
            setCurrentIndex(initialIndex);
            document.body.style.overflow = 'hidden';
        } else {
            document.body.style.overflow = 'unset';
        }
    }, [isOpen, initialIndex]);

    if (!isOpen || images.length === 0) return null;

    const handlePrevious = () => {
        setCurrentIndex((prev) => (prev === 0 ? images.length - 1 : prev - 1));
    };

    const handleNext = () => {
        setCurrentIndex((prev) => (prev === images.length - 1 ? 0 : prev + 1));
    };

    return (
        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/95 backdrop-blur-sm animate-in fade-in duration-300">
            {/* Close Button */}
            <button
                onClick={onClose}
                className="absolute top-6 right-6 z-[110] p-2 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors"
                aria-label="Cerrar"
            >
                <X size={28} />
            </button>

            {/* Navigation Buttons (Desktop/Mobile) */}
            <div className="absolute inset-0 flex items-center justify-between px-4 pointer-events-none">
                <button
                    onClick={handlePrevious}
                    className="p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors pointer-events-auto"
                    aria-label="Anterior"
                >
                    <ChevronLeft size={32} />
                </button>
                <button
                    onClick={handleNext}
                    className="p-3 bg-white/10 hover:bg-white/20 rounded-full text-white transition-colors pointer-events-auto"
                    aria-label="Siguiente"
                >
                    <ChevronRight size={32} />
                </button>
            </div>

            {/* Image Container */}
            <div className="w-full h-full flex flex-col items-center justify-center p-4 sm:p-8">
                <div className="relative max-w-4xl w-full h-full flex items-center justify-center">
                    <img
                        src={images[currentIndex].src}
                        alt={images[currentIndex].label}
                        className="max-w-full max-h-full object-contain rounded-lg shadow-2xl animate-in zoom-in-95 duration-300"
                    />
                </div>

                {/* Info Overlay */}
                <div className="mt-6 text-center">
                    <h3 className="text-white text-xl font-bold tracking-tight">
                        {images[currentIndex].label}
                    </h3>
                    <p className="text-white/60 text-sm mt-1">
                        {currentIndex + 1} de {images.length}
                    </p>
                </div>
            </div>

            {/* Thumbnail Indicators */}
            <div className="absolute bottom-10 left-0 right-0 flex justify-center gap-2">
                {images.map((_, idx) => (
                    <button
                        key={idx}
                        onClick={() => setCurrentIndex(idx)}
                        className={`w-2 h-2 rounded-full transition-all ${idx === currentIndex ? 'bg-white w-6' : 'bg-white/30'
                            }`}
                    />
                ))}
            </div>
        </div>
    );
}
</file>

<file path="src/components/client/menu/MenuHeader.tsx">
import Link from 'next/link';
import { ArrowLeft, Coffee } from 'lucide-react';

interface MenuHeaderProps {
    title: string;
}

export default function MenuHeader({ title }: MenuHeaderProps) {
    return (
        <header className="fixed top-0 left-0 right-0 bg-white z-20 shadow-sm">
            <div className="max-w-2xl mx-auto px-4 h-16 flex items-center justify-between">
                <div className="flex items-center gap-3">
                    <Link href="/client" className="p-2 -ml-2 hover:bg-gray-100 rounded-full transition-colors">
                        <ArrowLeft className="w-6 h-6 text-gray-700" />
                    </Link>
                    <h1 className="text-lg font-bold text-gray-900 flex items-center gap-2">
                        <Coffee className="w-5 h-5 text-amber-600" />
                        {title}
                    </h1>
                </div>
            </div>
        </header>
    );
}
</file>

<file path="src/components/client/menu/ProductDetailModal.tsx">
import { Product } from '@/types/menu';
import { X, MapPin, Droplets, AlertTriangle, Ruler } from 'lucide-react';

interface ProductDetailModalProps {
    product: Product | null;
    onClose: () => void;
}

export default function ProductDetailModal({ product, onClose }: ProductDetailModalProps) {
    if (!product) return null;

    return (
        <div className="fixed inset-0 z-50 flex items-end sm:items-center justify-center pointer-events-none">
            {/* Backdrop */}
            <div
                className="absolute inset-0 bg-black/60 backdrop-blur-sm pointer-events-auto"
                onClick={onClose}
            />

            {/* Modal */}
            <div className="bg-white w-full max-w-md h-[85vh] sm:h-auto sm:max-h-[90vh] sm:rounded-3xl rounded-t-3xl shadow-2xl overflow-y-auto pointer-events-auto relative animate-in slide-in-from-bottom duration-300">

                {/* Close Button */}
                <button
                    onClick={onClose}
                    className="absolute top-4 right-4 z-10 bg-white/50 backdrop-blur-md p-2 rounded-full text-black hover:bg-white transition-colors"
                >
                    <X size={24} />
                </button>

                {/* Image Header */}
                <div className="h-64 sm:h-72 bg-gray-100 w-full relative">
                    {product.image && (
                        <img
                            src={product.image}
                            alt={product.name}
                            className="w-full h-full object-cover"
                        />
                    )}
                    <div className="absolute inset-0 bg-gradient-to-t from-black/50 to-transparent"></div>
                    <div className="absolute bottom-4 left-4 text-white">
                        <span className="bg-amber-500 text-white text-[10px] uppercase font-bold px-2 py-1 rounded mb-2 inline-block">
                            {product.category}
                        </span>
                        <h2 className="text-2xl font-bold">{product.name}</h2>
                    </div>
                </div>

                {/* Content */}
                <div className="p-6 space-y-6">

                    {/* Price & Description */}
                    <div>
                        <p className="text-3xl font-bold text-gray-900 mb-2">
                            ${product.price.toLocaleString('es-CL')}
                        </p>
                        <p className="text-gray-600 leading-relaxed">
                            {product.description}
                        </p>
                    </div>

                    <hr className="border-gray-100" />

                    {/* Attributes Grid */}
                    <div className="grid grid-cols-1 gap-4">

                        {product.attributes?.origin && (
                            <div className="bg-amber-50 p-4 rounded-xl flex items-start gap-3">
                                <MapPin className="text-amber-600 shrink-0" size={20} />
                                <div>
                                    <h4 className="font-bold text-amber-900 text-sm">Origen</h4>
                                    <p className="text-amber-800 text-sm">{product.attributes.origin}</p>
                                </div>
                            </div>
                        )}

                        {product.attributes?.tastingNotes && product.attributes.tastingNotes.length > 0 && (
                            <div className="bg-stone-50 p-4 rounded-xl flex items-start gap-3">
                                <Droplets className="text-stone-600 shrink-0" size={20} />
                                <div>
                                    <h4 className="font-bold text-stone-900 text-sm">Notas de Cata</h4>
                                    <div className="flex flex-wrap gap-2 mt-1">
                                        {product.attributes.tastingNotes.map(note => (
                                            <span key={note} className="bg-stone-200 text-stone-700 text-xs px-2 py-1 rounded-md font-medium">
                                                {note}
                                            </span>
                                        ))}
                                    </div>
                                </div>
                            </div>
                        )}

                        {product.attributes?.sizes && (
                            <div className="flex items-center gap-3 p-2 text-gray-500 text-sm">
                                <Ruler size={16} />
                                <span>Disponible en: {product.attributes.sizes.join(', ')}</span>
                            </div>
                        )}

                        {product.attributes?.allergens && (
                            <div className="flex items-center gap-3 p-2 text-red-500 text-sm bg-red-50 rounded-lg">
                                <AlertTriangle size={16} />
                                <span>Contiene: {product.attributes.allergens.join(', ')}</span>
                            </div>
                        )}

                    </div>

                    <div className="h-12"></div> {/* Spacer */}
                </div>

                {/* Sticky Footer Button (Just Close) */}
                <div className="absolute bottom-0 left-0 right-0 p-4 bg-white border-t border-gray-100">
                    <button
                        onClick={onClose}
                        className="w-full py-4 bg-black text-white font-bold rounded-2xl hover:bg-gray-800 transition-colors"
                    >
                        Cerrar
                    </button>
                </div>

            </div>
        </div>
    );
}
</file>

<file path="src/components/client/menu/ProductGrid.tsx">
import { Product } from '@/types/menu';

interface ProductGridProps {
    products: Product[];
    onProductClick: (product: Product) => void;
}

export default function ProductGrid({ products, onProductClick }: ProductGridProps) {
    if (products.length === 0) {
        return (
            <div className="text-center py-12 text-gray-400">
                <p>No hay productos en esta categorÃ­a.</p>
            </div>
        );
    }

    return (
        <div className="grid grid-cols-2 gap-4 p-4 pb-24">
            {products.map((product) => (
                <div
                    key={product.id}
                    onClick={() => onProductClick(product)}
                    className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition-shadow cursor-pointer active:scale-95 duration-200"
                >
                    <div className="aspect-square bg-gray-100 relative">
                        {/* Placeholder if image loading fails or is missing, though we assume good data */}
                        {product.image ? (
                            <img
                                src={product.image}
                                alt={product.name}
                                className="w-full h-full object-cover"
                                loading="lazy"
                            />
                        ) : (
                            <div className="w-full h-full flex items-center justify-center bg-gray-200 text-gray-400">
                                No Image
                            </div>
                        )}
                    </div>
                    <div className="p-3">
                        <h3 className="font-bold text-gray-800 text-sm line-clamp-1">{product.name}</h3>
                        <p className="text-gray-500 text-xs mt-1 font-medium">
                            ${product.price.toLocaleString('es-CL')}
                        </p>
                    </div>
                </div>
            ))}
        </div>
    );
}
</file>

<file path="src/components/client/AboutUs.tsx">
'use client';

import { ClientConfig } from '@/config/types';
import { useState } from 'react';
import { X, ChevronLeft, ChevronRight, Info, Instagram } from 'lucide-react';

interface AboutUsProps {
    config: ClientConfig;
}

export default function AboutUs({ config }: AboutUsProps) {
    const [isOpen, setIsOpen] = useState(false);
    const [currentImage, setCurrentImage] = useState(0);

    const gallery = config.assets.gallery || [];

    if (!config.features.showAboutUs || gallery.length === 0) return null;

    const nextImage = () => {
        setCurrentImage((prev) => (prev + 1) % gallery.length);
    };

    const prevImage = () => {
        setCurrentImage((prev) => (prev - 1 + gallery.length) % gallery.length);
    };

    const accentColor = config.theme.accentColor || config.theme.primaryColor;

    return (
        <>
            {/* Trigger Button */}
            <button
                onClick={() => setIsOpen(true)}
                className="w-full py-4 rounded-3xl font-semibold text-lg flex items-center justify-center gap-3 transition-all duration-300 hover:scale-[1.02] active:scale-95 shadow-lg"
                style={{
                    backgroundColor: config.theme.primaryColor,
                    color: config.theme.secondaryColor,
                }}
            >
                <Info size={20} />
                Acerca de Nosotros
            </button>

            {/* Modal */}
            {isOpen && (
                <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-in fade-in duration-300">
                    <div
                        className="relative w-full max-w-lg rounded-4xl overflow-hidden shadow-2xl"
                        style={{ backgroundColor: config.theme.secondaryColor }}
                    >
                        {/* Close Button */}
                        <button
                            onClick={() => setIsOpen(false)}
                            className="absolute top-4 right-4 z-10 w-10 h-10 rounded-full flex items-center justify-center transition-colors"
                            style={{
                                backgroundColor: config.theme.primaryColor,
                                color: config.theme.secondaryColor,
                            }}
                        >
                            <X size={20} />
                        </button>

                        {/* Image Carousel */}
                        <div className="relative aspect-[4/3] w-full overflow-hidden">
                            <img
                                src={gallery[currentImage]}
                                alt={`${config.name} - Imagen ${currentImage + 1}`}
                                className="w-full h-full object-cover transition-all duration-500"
                            />

                            {/* Navigation Arrows */}
                            {gallery.length > 1 && (
                                <>
                                    <button
                                        onClick={prevImage}
                                        className="absolute left-3 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full flex items-center justify-center transition-all hover:scale-110"
                                        style={{
                                            backgroundColor: `${config.theme.primaryColor}CC`,
                                            color: config.theme.secondaryColor,
                                        }}
                                    >
                                        <ChevronLeft size={24} />
                                    </button>
                                    <button
                                        onClick={nextImage}
                                        className="absolute right-3 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full flex items-center justify-center transition-all hover:scale-110"
                                        style={{
                                            backgroundColor: `${config.theme.primaryColor}CC`,
                                            color: config.theme.secondaryColor,
                                        }}
                                    >
                                        <ChevronRight size={24} />
                                    </button>
                                </>
                            )}

                            {/* Dots Indicator */}
                            <div className="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2">
                                {gallery.map((_, index) => (
                                    <button
                                        key={index}
                                        onClick={() => setCurrentImage(index)}
                                        className="w-2 h-2 rounded-full transition-all duration-300"
                                        style={{
                                            backgroundColor: index === currentImage
                                                ? accentColor
                                                : `${config.theme.secondaryColor}80`,
                                            transform: index === currentImage ? 'scale(1.3)' : 'scale(1)',
                                        }}
                                    />
                                ))}
                            </div>
                        </div>

                        {/* Content */}
                        <div className="p-6 text-center" style={{ color: config.theme.primaryColor }}>
                            <img
                                src={config.assets.logo}
                                alt={config.name}
                                className="w-40 h-40 mx-auto mb-6 object-contain"
                            />
                            <h2
                                className="text-2xl font-bold mb-2"
                                style={{ fontFamily: config.theme.fontFamily }}
                            >
                                {config.name}
                            </h2>
                            <p className="opacity-80">{config.texts.welcomeSubtitle}</p>

                            {/* Social Media */}
                            {config.social?.instagram && (
                                <div className="mt-6 pt-4 border-t border-current/10">
                                    <a
                                        href={config.social.instagram}
                                        target="_blank"
                                        rel="noopener noreferrer"
                                        className="inline-flex items-center gap-2 px-6 py-3 rounded-full font-semibold transition-all hover:scale-105 shadow-md hover:shadow-lg"
                                        style={{
                                            backgroundColor: config.theme.primaryColor,
                                            color: config.theme.secondaryColor
                                        }}
                                    >
                                        <Instagram size={20} />
                                        SÃ­guenos en Instagram
                                    </a>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            )}
        </>
    );
}
</file>

<file path="src/components/client/BottomNav.tsx">
'use client';

import { ClientConfig } from "@/config/types";
import { Home, ClipboardList, Gift, User, Scan } from "lucide-react";
import { useState } from "react";

interface BottomNavProps {
    config: ClientConfig;
    onQRClick: () => void;
    activeTab?: string;
    onTabChange?: (tab: string) => void;
}

export default function BottomNav({ config, onQRClick, activeTab = 'home', onTabChange }: BottomNavProps) {
    const [internalActive, setInternalActive] = useState(activeTab);

    const handleTabClick = (id: string) => {
        setInternalActive(id);
        onTabChange?.(id);
    };

    const items = [
        { id: "home", icon: Home, label: "Inicio" },
        { id: "menu", icon: ClipboardList, label: "MenÃº" },
        { id: "qr", icon: null, label: "QR" },
        { id: "rewards", icon: Gift, label: "Premios" },
        { id: "profile", icon: User, label: "Perfil" },
    ];

    return (
        <nav className="fixed bottom-0 left-0 right-0 z-30 bg-white border-t border-gray-100 pb-safe pt-2 px-6 h-[88px]">
            <div className="max-w-sm mx-auto flex items-center justify-between h-full pb-4">
                {items.map((item) =>
                    item.id === "qr" ? (
                        <button
                            key="qr"
                            onClick={onQRClick}
                            className="w-14 h-14 -mt-10 rounded-2xl flex items-center justify-center text-white transition-all hover:scale-105 active:scale-95 shadow-lg relative z-40"
                            style={{ backgroundColor: config.theme.accentColor, boxShadow: `0 8px 24px ${config.theme.accentColor}50` }}
                        >
                            <Scan size={26} strokeWidth={2.5} />
                        </button>
                    ) : (
                        <button
                            key={item.id}
                            onClick={() => handleTabClick(item.id)}
                            className="flex flex-col items-center gap-1 transition-all w-12"
                            style={{
                                color: internalActive === item.id ? config.theme.accentColor : "#D1D5DB",
                                transform: internalActive === item.id ? "translateY(-2px)" : "none"
                            }}
                        >
                            {item.icon && <item.icon size={24} strokeWidth={internalActive === item.id ? 2.5 : 2} />}
                            <span className={`text-[9px] font-bold ${internalActive === item.id ? 'opacity-100' : 'opacity-0'}`}>
                                {item.label}
                            </span>
                        </button>
                    )
                )}
            </div>
        </nav>
    );
}
</file>

<file path="src/components/client/PromoBanner.tsx">
'use client';

import { ClientConfig } from "@/config/types";
import { ArrowRight } from "lucide-react";

interface PromoBannerProps {
    config: ClientConfig;
}

export default function PromoBanner({ config }: PromoBannerProps) {
    return (
        <div
            className="relative overflow-hidden rounded-[24px] p-5 flex items-center justify-between shadow-lg transform transition-transform duration-500 hover:scale-[1.02]"
            style={{ backgroundColor: config.theme.primaryColor }}
        >
            <div className="absolute inset-0 opacity-10" style={{ backgroundImage: "radial-gradient(circle at 80% 20%, white 0%, transparent 50%)" }} />

            <div className="relative z-10 space-y-1">
                <p className="text-white/60 text-[10px] font-bold uppercase tracking-[0.2em]">
                    Coffee Day
                </p>
                <p className="text-white text-3xl font-black leading-none tracking-tight">
                    OFF 20%
                </p>
                <button
                    className="mt-3 px-4 py-2 rounded-full text-xs font-bold flex items-center gap-2 shadow-md hover:bg-opacity-90 transition-all active:scale-95"
                    style={{ backgroundColor: config.theme.accentColor, color: "#fff" }}
                >
                    Obtener
                    <span className="w-4 h-4 bg-white/20 rounded-full flex items-center justify-center">
                        <ArrowRight size={10} />
                    </span>
                </button>
            </div>

            <div className="relative z-10 w-20 h-20 rounded-2xl bg-white/5 flex items-center justify-center text-4xl backdrop-blur-sm border border-white/10 rotate-3">
                â˜•
            </div>
        </div>
    );
}
</file>

<file path="src/components/client/QRSheet.tsx">
'use client';

import { ClientConfig } from "@/config/types";
import { X } from "lucide-react";
import QRCode from 'react-qr-code';

interface QRSheetProps {
    isOpen: boolean;
    onClose: () => void;
    config: ClientConfig;
    userUUID: string;
    isReward?: boolean;
}

export default function QRSheet({ isOpen, onClose, config, userUUID, isReward }: QRSheetProps) {
    if (!isOpen) return null;

    // We construct the value string to be encoded in the QR.
    // Format: "CLIENT_CODE:USER_UUID" or similar. Staff app handles parsing logic.
    // For safety, let's keep it simple: just UUID or a JSON string.
    // Previous implementatin was just UUID or specific JSON.
    // Let's assume just UUID for identification, or JSON for redeem?
    // Existing logic in staff is `verify_shop_pin` via API? No, staff scans USER.
    // So QR just needs to represent the User ID or a temporary token.
    // Let's stick to JSON for flexibility:
    const qrData = JSON.stringify({
        uid: userUUID,
        action: isReward ? 'redeem' : 'scan',
        shop: config.code // Optional context
    });

    return (
        <>
            <div
                className="fixed inset-0 bg-black/40 z-40 backdrop-blur-[2px] transition-opacity duration-300"
                onClick={onClose}
            />
            <div
                className="fixed bottom-0 left-0 right-0 z-50 animate-[slideUp_0.3s_ease-out]"
            >
                <div
                    className="bg-white rounded-t-[32px] max-w-sm mx-auto w-full px-6 pt-3 pb-10"
                    style={{ boxShadow: "0 -8px 40px rgba(0,0,0,0.15)" }}
                >
                    {/* Handle bar */}
                    <div className="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6 opacity-50" />

                    <div className="text-center mb-6">
                        <span
                            className="inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-xs font-bold ring-1 ring-inset"
                            style={{
                                backgroundColor: isReward ? "#FEF3C7" : `${config.theme.accentColor}10`,
                                color: isReward ? "#92400E" : config.theme.accentColor,
                            }}
                        >
                            {isReward ? "ðŸŽ Â¡Premio disponible!" : "â˜• Muestra al barista"}
                        </span>
                    </div>

                    <div
                        className="rounded-[32px] p-8 flex items-center justify-center mx-auto max-w-[280px] transition-colors duration-300"
                        style={{
                            backgroundColor: isReward ? config.theme.primaryColor : "#F9FAFB",
                            border: isReward ? "none" : "2px solid #F3F4F6"
                        }}
                    >
                        <div className="bg-white p-4 rounded-2xl shadow-sm">
                            <div className="w-48 h-48 flex items-center justify-center bg-white">
                                <QRCode
                                    value={qrData}
                                    size={192}
                                    viewBox={`0 0 192 192`}
                                    fgColor={config.theme.primaryColor}
                                    bgColor="#FFFFFF"
                                />
                            </div>
                        </div>
                    </div>

                    <p className="text-center text-xs text-gray-400 mt-6 max-w-[200px] mx-auto leading-relaxed">
                        {isReward
                            ? "El barista escanearÃ¡ este cÃ³digo para canjear tu premio."
                            : "Acumula sellos con cada compra presentando este cÃ³digo."}
                    </p>

                    <button
                        onClick={onClose}
                        className="w-full mt-8 py-3.5 rounded-2xl font-bold text-sm text-gray-500 bg-gray-100 hover:bg-gray-200 transition-colors flex items-center justify-center gap-2"
                    >
                        <X size={16} /> Cerrar
                    </button>
                </div>
            </div>
        </>
    );
}
</file>

<file path="src/components/PoweredBy.tsx">
import React from 'react';

export default function PoweredBy() {
    return (
        <div className="w-full py-4 text-center mt-auto">
            <p className="text-[10px] text-gray-400 font-medium tracking-widest uppercase opacity-60 hover:opacity-100 transition-opacity cursor-default">
                Desarrollado por <span className="font-bold text-gray-500">BRANDIA</span>
            </p>
        </div>
    );
}
</file>

<file path="src/config/clients/perezoso_cafe.ts">
import { ClientConfig } from '../types';

export const perezosoCafeConfig: ClientConfig = {
    code: 'perezoso_cafe',
    name: 'Perezoso Cafe',
    theme: {
        primaryColor: '#2E2333', // Perezoso Dark Purple
        secondaryColor: '#FFF5E1', // Perezoso Cream
        accentColor: '#F5A623', // Perezoso Orange
        fontFamily: 'var(--font-fredoka)',
    },
    texts: {
        welcomeTitle: 'Perezoso',
        welcomeSubtitle: 'CafÃ© para ir con calma ðŸ¦¥',
        stampCardTitle: 'Tu Tarjeta de Recompensas',
        rewardsTitle: 'Mis Regalos',
    },
    rules: {
        stampsPerReward: 10,
    },
    assets: {
        logo: '/assets/perezoso/LogoPerezoso.png',
        gallery: [
            '/assets/perezoso/image-1.png',
            '/assets/perezoso/image-2.png',
            '/assets/perezoso/image-3.png',
            '/assets/perezoso/image-4.png',
            '/assets/perezoso/image-5.png',
            '/assets/perezoso/image-6.png',
            '/assets/perezoso/image-7.png',
            '/assets/perezoso/image-8.png',
        ],
    },
    social: {
        instagram: 'https://www.instagram.com/perezoso.cafe/',
    },
    features: {
        showBuyButton: true,
        externalMenuUrl: 'https://perezosocafe.com/menu',
        showNewsFeed: true,
        menuEnabled: true,
        showAboutUs: true,
    },
};
</file>

<file path="src/context/ClientConfigContext.tsx">
'use client';

import { createContext, useContext, ReactNode } from 'react';
import { ClientConfig } from '@/config/types';

const ClientConfigContext = createContext<ClientConfig | null>(null);

export function ClientConfigProvider({
    config,
    children
}: {
    config: ClientConfig;
    children: ReactNode;
}) {
    return (
        <ClientConfigContext.Provider value={config}>
            {children}
        </ClientConfigContext.Provider>
    );
}

export function useClientConfig() {
    const context = useContext(ClientConfigContext);
    if (!context) {
        throw new Error('useClientConfig must be used within a ClientConfigProvider');
    }
    return context;
}
</file>

<file path="src/data/menu-data.ts">
import { Product, Category } from '../types/menu';

export const CATEGORIES: Category[] = [
    { id: 'coffee', name: 'CafÃ© de Especialidad' },
    { id: 'bakery', name: 'PastelerÃ­a' },
    { id: 'brunch', name: 'Brunch' },
    { id: 'drinks', name: 'Bebidas FrÃ­as' },
];

export const PRODUCTS: Product[] = [
    {
        id: '1',
        name: 'Espresso Doble',
        description: 'Intenso y concentrado, con notas de chocolate amargo.',
        price: 3500,
        image: '/images/espresso.jpg',
        category: 'coffee',
        attributes: {
            origin: 'Colombia - Huila',
            tastingNotes: ['Cacao', 'Nuez', 'Caramelo'],
            sizes: ['60ml'],
        },
    },
    {
        id: '2',
        name: 'Cappuccino Italiano',
        description: 'Espresso, leche vaporizada y espuma de leche en partes iguales.',
        price: 4500,
        image: '/images/cappuccino.jpg',
        category: 'coffee',
        attributes: {
            origin: 'Blend de la Casa',
            tastingNotes: ['Suave', 'Cremoso'],
            allergens: ['LÃ¡cteos'],
            sizes: ['240ml'],
        },
    },
    {
        id: '3',
        name: 'Latte Vainilla',
        description: 'Espresso con leche texturizada y un toque de jarabe de vainilla artesanal.',
        price: 5200,
        image: '/images/latte.jpg',
        category: 'coffee',
        attributes: {
            origin: 'Brasil - Cerrado',
            tastingNotes: ['Dulce', 'Aromatizado'],
            allergens: ['LÃ¡cteos'],
            sizes: ['300ml'],
        },
    },
    {
        id: '4',
        name: 'Croissant de Almendras',
        description: 'Masa madre hojaldrada, relleno de crema de almendras y decorado con almendras fileteadas.',
        price: 3800,
        image: '/images/croissant.jpg',
        category: 'bakery',
        attributes: {
            allergens: ['Gluten', 'LÃ¡cteos', 'Frutos Secos'],
        },
    },
    {
        id: '5',
        name: 'Tostada de Aguacate',
        description: 'Pan de masa madre, aguacate triturado, huevo pochado y semillas.',
        price: 7500,
        image: '/images/avocado-toast.jpg',
        category: 'brunch',
        attributes: {
            allergens: ['Gluten', 'Huevo'],
        },
    },
    {
        id: '6',
        name: 'Cold Brew',
        description: 'MaceraciÃ³n en frÃ­o por 18 horas. Notas frutales y baja acidez.',
        price: 4800,
        image: '/images/cold-brew.jpg',
        category: 'drinks',
        attributes: {
            origin: 'EtiopÃ­a - Yirgacheffe',
            tastingNotes: ['Floral', 'CÃ­trico', 'Miel'],
            sizes: ['350ml'],
        },
    },
];
</file>

<file path="src/lib/supabase-admin.ts">
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;

if (!supabaseUrl || !supabaseServiceRoleKey) {
    throw new Error('Missing Supabase Service Role Key or URL');
}

// Note: This client BYPASSES RLS. Use with caution.
export const supabaseAdmin = createClient(supabaseUrl, supabaseServiceRoleKey, {
    auth: {
        autoRefreshToken: false,
        persistSession: false
    }
});
</file>

<file path="src/lib/supabase.ts">
import { createClient } from '@supabase/supabase-js';

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;

export const supabase = createClient(supabaseUrl, supabaseKey);
</file>

<file path="src/types/menu.ts">
export interface Product {
    id: string;
    name: string;
    description: string;
    price: number;
    image: string;
    category: string;
    attributes?: {
        origin?: string;
        tastingNotes?: string[];
        allergens?: string[];
        sizes?: string[];
    };
}

export interface Category {
    id: string;
    name: string;
}
</file>

<file path="supabase/migrations/02_phase2_schema.sql">
-- MIGRATION: Phase 2 - Role-Based Architecture
-- Run this entire script in the Supabase SQL Editor

-- 1. Create SHOPS table (Multi-tenant support)
create table if not exists shops (
  id uuid default uuid_generate_v4() primary key,
  name text not null,
  admin_pin text not null, -- Simple text for MVP
  config jsonb default '{}'::jsonb,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 2. Update PROFILES table
-- Add new columns
alter table profiles add column if not exists full_name text;
alter table profiles add column if not exists phone text;
alter table profiles add column if not exists shop_id uuid references shops(id);

-- Update role Enum constraint
-- We are changing 'staff' to 'barista' for clarity, but if you want to keep 'staff' as 'barista', that's fine too.
-- Let's standardize on: 'customer', 'barista', 'admin'
alter table profiles drop constraint if exists profiles_role_check;
alter table profiles add constraint profiles_role_check check (role in ('customer', 'barista', 'admin'));

-- 3. Create REDEMPTIONS table (For approval queue)
create table if not exists redemptions (
  id uuid default uuid_generate_v4() primary key,
  user_id uuid references profiles(id) not null,
  shop_id uuid references shops(id) not null,
  staff_id uuid references profiles(id), -- Who processed it
  status text check (status in ('pending', 'approved', 'rejected')) default 'pending',
  reward_id text, -- e.g. "free_coffee"
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  processed_at timestamp with time zone
);

-- 4. Update TRANSACTION_LOGS
alter table transaction_logs add column if not exists type text check (type in ('add_stamp', 'redeem_reward')) default 'add_stamp';

-- 5. Enable RLS on new tables
alter table shops enable row level security;
alter table redemptions enable row level security;

-- 6. Setup Basic Policies (Open for now, restricted later)
create policy "Shops are viewable by public" on shops for select using (true);

create policy "Users view own redemptions" on redemptions for select using (auth.uid() = user_id);
create policy "Staff view shop redemptions" on redemptions for select using (
  exists (select 1 from profiles p where p.id = auth.uid() and p.role in ('barista', 'admin'))
);

create policy "Staff can update redemptions" on redemptions for update using (
  exists (select 1 from profiles p where p.id = auth.uid() and p.role in ('barista', 'admin'))
);

-- 7. SEED DATA: Create the first Shop 'Mare Cafe'
insert into shops (name, admin_pin, config)
values ('Mare Cafe', '1234', '{"theme": "brown"}'::jsonb)
on conflict do nothing;

-- NOTE: You will need to manually link your existing staff profile to this shop_id once created.
</file>

<file path="supabase/migrations/03_fix_function.sql">
-- FIX: Update add_stamp function to recognize 'barista' role
-- Run this in Supabase SQL Editor

create or replace function add_stamp(target_user_id uuid)
returns void
language plpgsql
security definer
as $$
declare
  caller_role text;
begin
  -- Check if caller is barista or admin
  select role into caller_role from profiles where id = auth.uid();
  
  -- Updated check to include 'barista'
  if caller_role not in ('barista', 'staff', 'admin') then
    raise exception 'Unauthorized: Only staff can add stamps.';
  end if;

  -- 1. Upsert stamp count
  insert into stamps (user_id, count)
  values (target_user_id, 1)
  on conflict (user_id)
  do update set 
    count = stamps.count + 1,
    updated_at = now();

  -- 2. Log transaction
  insert into transaction_logs (staff_id, user_id)
  values (auth.uid(), target_user_id);
  
end;
$$;
</file>

<file path="supabase/migrations/04_rename_role.sql">
-- MIGRATION: Rename 'barista' role to 'staff'
-- Run this in Supabase SQL Editor

-- 1. Update existing profiles (if any were created as 'barista')
update profiles set role = 'staff' where role = 'barista';

-- 2. Update the constraint to allow 'staff' instead of 'barista'
alter table profiles drop constraint if exists profiles_role_check;
alter table profiles add constraint profiles_role_check check (role in ('customer', 'staff', 'admin'));

-- 3. Update redemptions policies or triggers if they hardcoded 'barista' (The previous policies used 'barista' in the list, we need to update expected values if strictly checked, but RLS usually just checks the current row).
-- Re-applying RLS for clarity:
drop policy if exists "Staff view shop redemptions" on redemptions;
create policy "Staff view shop redemptions" on redemptions for select using (
  exists (select 1 from profiles p where p.id = auth.uid() and p.role in ('staff', 'admin'))
);

drop policy if exists "Staff can update redemptions" on redemptions;
create policy "Staff can update redemptions" on redemptions for update using (
  exists (select 1 from profiles p where p.id = auth.uid() and p.role in ('staff', 'admin'))
);

-- 4. Verify add_stamp function (It already checked for 'staff' in my previous fix, but let's be sure).
-- No change needed if 03_fix_function.sql was run, as it allowed ('barista', 'staff', 'admin').
</file>

<file path="supabase/migrations/05_security_rules.sql">
-- SECURITY UPDATE: 24h Cooldown Logic
-- Run this in Supabase SQL Editor

-- Drop previous function signature to allow adding new parameter
drop function if exists add_stamp(uuid);

create or replace function add_stamp(target_user_id uuid, force_override boolean default false)
returns jsonb
language plpgsql
security definer
as $$
declare
  caller_role text;
  last_scan timestamp;
  shop_config jsonb;
  result_message text;
begin
  -- 1. Check permissions
  select role into caller_role from profiles where id = auth.uid();
  if caller_role not in ('staff', 'admin') then
    return jsonb_build_object('success', false, 'message', 'Unauthorized');
  end if;

  -- 2. Check 24h Rule (Unless forced)
  if not force_override then
      select created_at into last_scan 
      from transaction_logs 
      where user_id = target_user_id 
        and type = 'add_stamp'
        and created_at > (now() - interval '24 hours')
      order by created_at desc 
      limit 1;

      if last_scan is not null then
         return jsonb_build_object('success', false, 'code', 'COOLDOWN_ACTIVE', 'message', 'Ya se escaneÃ³ hace menos de 24hs.');
      end if;
  end if;

  -- 3. Proceed to Add Stamp
  insert into stamps (user_id, count)
  values (target_user_id, 1)
  on conflict (user_id)
  do update set 
    count = stamps.count + 1,
    updated_at = now();

  -- 4. Log Transaction
  insert into transaction_logs (staff_id, user_id, type)
  values (auth.uid(), target_user_id, 'add_stamp');
  
  return jsonb_build_object('success', true, 'message', 'Sello agregado correctamente');
end;
$$;
</file>

<file path="supabase/migrations/06_redeem_logic.sql">
-- LOGIC: Reward Redemption
-- Run this in Supabase SQL Editor

create or replace function redeem_reward(target_user_id uuid)
returns jsonb
language plpgsql
security definer
as $$
declare
  current_stamps int;
  caller_role text;
begin
  -- 1. Check permissions (Staff/Admin only)
  select role into caller_role from profiles where id = auth.uid();
  if caller_role not in ('staff', 'admin') then
    return jsonb_build_object('success', false, 'message', 'Unauthorized');
  end if;

  -- 2. Check Balance
  select count into current_stamps from stamps where user_id = target_user_id;
  
  if current_stamps is null or current_stamps < 7 then
     return jsonb_build_object('success', false, 'message', 'El cliente no tiene suficientes sellos (MÃ­nimo 7).');
  end if;

  -- 3. Deduct Stamps (Reset to 0 or subtract 7)
  -- Strategy: Subtract 7 to allow "overflow" if they had 8? Or Reset?
  -- Requirement says "Reset to 0" (implied "Cada 7 sellos es un cafe"). 
  -- Let's subtract 7 to be fair if they have 8.
  update stamps set count = count - 7, updated_at = now() where user_id = target_user_id;

  -- 4. Log Transaction
  insert into transaction_logs (staff_id, user_id, type)
  values (auth.uid(), target_user_id, 'redeem_reward');

  return jsonb_build_object('success', true, 'message', 'Â¡Canje exitoso! Se restaron 7 sellos.');
end;
$$;
</file>

<file path="supabase/migrations/07_gamification.sql">
-- MIGRATION: Phase 5 - Gamification (Levels & Preferences)
-- Run this in Supabase SQL Editor

-- 1. Add Level and Preferences to Profiles
alter table profiles 
add column if not exists level int default 1,
add column if not exists preferences jsonb default '{}'::jsonb;

-- 2. Update 'redeem_reward' to increment level
create or replace function redeem_reward(target_user_id uuid)
returns jsonb
language plpgsql
security definer
as $$
declare
  current_stamps int;
  caller_role text;
  new_level int;
begin
  -- Check permissions (Staff/Admin only)
  select role into caller_role from profiles where id = auth.uid();
  if caller_role not in ('staff', 'admin') then
    return jsonb_build_object('success', false, 'message', 'Unauthorized');
  end if;

  -- Check Stamps
  select count into current_stamps from stamps where user_id = target_user_id;
  
  if current_stamps is null or current_stamps < 7 then
     return jsonb_build_object('success', false, 'message', 'El cliente no tiene suficientes sellos (MÃ­nimo 7).');
  end if;

  -- Deduct Stamps
  update stamps set count = count - 7, updated_at = now() where user_id = target_user_id;

  -- Log Transaction
  insert into transaction_logs (staff_id, user_id, type)
  values (auth.uid(), target_user_id, 'redeem_reward');

  -- GAMIFICATION: Level Up!
  update profiles 
  set level = coalesce(level, 1) + 1 
  where id = target_user_id
  returning level into new_level;

  return jsonb_build_object(
      'success', true, 
      'message', 'Â¡Canje exitoso! Se restaron 7 sellos.',
      'new_level', new_level
  );
end;
$$;
</file>

<file path="supabase/migrations/20240201173000_create_campaigns.sql">
-- Create Campaigns Table
create table if not exists campaigns (
  id uuid default gen_random_uuid() primary key,
  title text not null,
  content text,
  status text default 'active', -- 'active' | 'inactive'
  audience text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  metadata jsonb default '{}'::jsonb -- For storing rich content or editor config
);

-- Enable RLS
alter table campaigns enable row level security;

-- Policies (Admin only for now, maybe public read if needed for Client page check but let's stick to safe defaults)
-- Actually, the client page needs to read the campaign status. So 'anon' needs SELECT.
create policy "Public campaigns" on campaigns for select using (true);

-- Only Admin can insert/update
create policy "Admins can manage campaigns" on campaigns for all using (
  auth.uid() in (select id from profiles where role = 'admin')
);
</file>

<file path="supabase/migrations/20240204_client_features.sql">
-- Add contact details to profiles if not exists
alter table profiles 
add column if not exists full_name text,
add column if not exists phone text;

-- Create News Feed Table
create table if not exists news_feed (
  id uuid default uuid_generate_v4() primary key,
  title text not null,
  content text,
  image_url text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null,
  active boolean default true
);

-- RLS for News Feed
alter table news_feed enable row level security;

-- Customers can view active feed
create policy "Customers can view active news"
  on news_feed for select
  using ( active = true );

-- Staff/Admin can manage feed
create policy "Staff can manage news"
  on news_feed for all
  using ( 
    exists (
      select 1 from profiles
      where profiles.id = auth.uid() and profiles.role in ('staff', 'admin')
    ) 
  );
</file>

<file path="supabase/migrations/20260208_add_client_code_to_stamps.sql">
-- MIGRATION: Add client_code to stamps table
-- Run this in Supabase SQL Editor

alter table stamps 
add column if not exists client_code text;

-- Add index for performance/filtering
create index if not exists idx_stamps_client_code on stamps(client_code);
</file>

<file path="supabase/migrations/20260208_add_missing_profile_cols.sql">
-- MIGRATION: Add missing columns to profiles table
-- Run this in Supabase SQL Editor

alter table profiles 
add column if not exists client_code text,
add column if not exists first_name text;

-- Optional: Add index for client_code if we query by it often
create index if not exists idx_profiles_client_code on profiles(client_code);

-- Update RLS if needed (usually not for adding columns unless we filter by them)
-- Ensure users can update these fields
create policy "Users can update own profile fields"
on profiles for update
using ( auth.uid() = id )
with check ( auth.uid() = id );
</file>

<file path="supabase/migrations/20260208_create_shops_table.sql">
-- Create SHOPS table
drop table if exists shops cascade;
create table if not exists shops (
    code text primary key,
    name text not null,
    config jsonb not null default '{}'::jsonb,
    created_at timestamp with time zone default timezone('utc'::text, now()) not null,
    updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Enable RLS
alter table shops enable row level security;

-- Policy: Everyone can read shop configs (needed for login/landing pages)
create policy "Allow public read access to shops"
    on shops for select
    using (true);

-- Policy: Only admins can update (future proofing)
-- For now we can leave it open or restrict to service_role

-- Seed Data: Perezoso Cafe
insert into shops (code, name, config)
values (
    'perezoso_cafe',
    'Perezoso Cafe',
    '{
        "theme": {
            "primaryColor": "#2E2333",
            "secondaryColor": "#FFF5E1",
            "accentColor": "#F5A623",
            "fontFamily": "var(--font-fredoka)"
        },
        "texts": {
            "welcomeTitle": "Perezoso",
            "welcomeSubtitle": "CafÃ© para ir con calma ðŸ¦¥",
            "stampCardTitle": "Tu Tarjeta de Recompensas",
            "rewardsTitle": "Mis Regalos"
        },
        "rules": {
            "stampsPerReward": 10
        },
        "assets": {
            "logo": "/assets/perezoso/LogoPerezoso.png",
            "gallery": [
                "/assets/perezoso/image-1.png",
                "/assets/perezoso/image-2.png",
                "/assets/perezoso/image-3.png",
                "/assets/perezoso/image-4.png",
                "/assets/perezoso/image-5.png",
                "/assets/perezoso/image-6.png",
                "/assets/perezoso/image-7.png",
                "/assets/perezoso/image-8.png"
            ]
        },
        "social": {
            "instagram": "https://www.instagram.com/perezoso.cafe/"
        },
        "features": {
            "showBuyButton": true,
            "externalMenuUrl": "https://perezosocafe.com/menu",
            "showNewsFeed": true,
            "menuEnabled": true,
            "showAboutUs": true
        }
    }'::jsonb
)
on conflict (code) do update set config = EXCLUDED.config;

-- Seed Data: Mare Cafe
insert into shops (code, name, config)
values (
    'mare_cafe',
    'Mare Cafe',
    '{
        "theme": {
            "primaryColor": "#1E3A8A",
            "secondaryColor": "#F5F5DC",
            "fontFamily": "var(--font-playfair)"
        },
        "texts": {
            "welcomeTitle": "Mare",
            "welcomeSubtitle": "PastelerÃ­a y CafÃ© de Especialidad",
            "stampCardTitle": "Tu Tarjeta de Fidelidad",
            "rewardsTitle": "Tus Recompensas"
        },
        "rules": {
            "stampsPerReward": 7
        },
        "assets": {
            "logo": "/logo-mare.png"
        },
        "features": {
            "showBuyButton": false,
            "externalMenuUrl": "https://instagram.com/marecafe",
            "showNewsFeed": true,
            "menuEnabled": false
        }
    }'::jsonb
)
on conflict (code) do update set config = EXCLUDED.config;
</file>

<file path="supabase/migrations/20260208_fix_schema_all.sql">
-- MIGRATION: Fix Schema (Consolidated)
-- Run this in Supabase SQL Editor to unblock the dashboard

-- 1. Fix Profiles Table
alter table profiles 
add column if not exists client_code text,
add column if not exists first_name text;

-- 2. Fix Stamps Table (Add client_code for insert compatibility)
alter table stamps 
add column if not exists client_code text;

-- 3. Add Indexes for performance
create index if not exists idx_profiles_client_code on profiles(client_code);
create index if not exists idx_stamps_client_code on stamps(client_code);

-- 4. Ensure RLS allows reading these new columns (usually automatic, but good to check)
-- No changes needed to policies if "select using (true)" is active for profiles.
</file>

<file path="supabase/migrations/example_update_perezoso.sql">
-- Ejemplo para actualizar el perfil de Perezoso Cafe
-- Puedes correr esto en el Editor SQL de Supabase para cambiar colores, textos, etc.

UPDATE shops
SET config = jsonb_set(
    config,
    '{theme}', -- Seleccionamos la parte del JSON a cambiar (theme)
    '{
        "primaryColor": "#2E2333",
        "secondaryColor": "#FFF5E1",
        "accentColor": "#FF5733", -- Nuevo color de acento
        "fontFamily": "var(--font-fredoka)"
    }'::jsonb
)
WHERE code = 'perezoso_cafe';

-- O para cambiar solo un texto especifico:
UPDATE shops
SET config = jsonb_set(
    config,
    '{texts, welcomeSubtitle}',
    '"El mejor cafÃ© de la ciudad ðŸ¦¥"'::jsonb
)
WHERE code = 'perezoso_cafe';
</file>

<file path="supabase/schema.sql">
-- Enable UUID extension
create extension if not exists "uuid-ossp";

-- PROFILES TABLE
-- Links to Supabase Auth users
create table profiles (
  id uuid references auth.users not null primary key,
  email text,
  role text check (role in ('customer', 'staff', 'admin')) default 'customer',
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- Turn on RLS
alter table profiles enable row level security;

-- Policies for Profiles
create policy "Public profiles are viewable by everyone"
  on profiles for select
  using ( true );

create policy "Users can insert their own profile"
  on profiles for insert
  with check ( auth.uid() = id );

create policy "Users can update own profile"
  on profiles for update
  using ( auth.uid() = id );

-- STAMPS TABLE
create table stamps (
  user_id uuid references profiles(id) not null primary key,
  count int default 0,
  updated_at timestamp with time zone default timezone('utc'::text, now()) not null
);

alter table stamps enable row level security;

create policy "Users can view own stamps"
  on stamps for select
  using ( auth.uid() = user_id );

-- TRANSACTION LOGS TABLE
create table transaction_logs (
  id uuid default uuid_generate_v4() primary key,
  staff_id uuid references profiles(id) not null,
  user_id uuid references profiles(id) not null,
  location_id text, -- For future multi-branch support
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

alter table transaction_logs enable row level security;

-- Only staff/admin can view transaction logs (or maybe just their own scans?)
create policy "Staff can view logs they created"
  on transaction_logs for select
  using ( auth.uid() = staff_id );

create policy "Admins can view all logs"
  on transaction_logs for select
  using ( 
    exists (
      select 1 from profiles
      where profiles.id = auth.uid() and profiles.role = 'admin'
    ) 
  );

-- DATABASE FUNCTION: Add Stamp
-- Securely adds a stamp and logs the transaction
create or replace function add_stamp(target_user_id uuid)
returns void
language plpgsql
security definer -- Runs with permissions of the function creator (admin)
as $$
declare
  caller_role text;
begin
  -- Check if caller is staff or admin
  select role into caller_role from profiles where id = auth.uid();
  
  if caller_role not in ('staff', 'admin') then
    raise exception 'Unauthorized: Only staff can add stamps.';
  end if;

  -- 1. Upsert stamp count
  insert into stamps (user_id, count)
  values (target_user_id, 1)
  on conflict (user_id)
  do update set 
    count = stamps.count + 1,
    updated_at = now();

  -- 2. Log transaction
  insert into transaction_logs (staff_id, user_id)
  values (auth.uid(), target_user_id);
  
end;
$$;
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
/node_modules
/.pnp
.pnp.js
.yarn/install-state.gz

# testing
/coverage

# next.js
/.next/
/out/

# production
/build

# misc
.DS_Store
*.pem

# debug
npm-debug.log*
yarn-debug.log*
yarn-error.log*

# local env files
.env*.local

# vercel
.vercel

# typescript
*.tsbuildinfo
next-env.d.ts
</file>

<file path="Auditoria_v2_Mejoras_y_Rediseno.md">
# ðŸ” AuditorÃ­a v2 â€” Estado de Mejoras + RediseÃ±o EstÃ©tico Coffeinopia

---

## PARTE 1: ESTADO DE LAS MEJORAS DE LA AUDITORÃA ANTERIOR

### âœ… Mejoras BIEN Implementadas

| Mejora | Estado | Notas |
|--------|--------|-------|
| **`.env.local` en `.gitignore`** | âœ… Correcto | Ya no se expone en el repo |
| **`supabase-admin.ts` con Service Role** | âœ… Correcto | `marketing.ts` ahora usa `supabaseAdmin` |
| **Error Boundaries** | âœ… Bien hechos | `error.tsx` global + `admin/error.tsx` especÃ­fico, con UI profesional |
| **`manifest.ts` dinÃ¡mico** | âœ… Correcto | Lee de `getShopConfig()`, nombre/colores/icon dinÃ¡micos |
| **`layout.tsx` dinÃ¡mico** | âœ… Correcto | `generateMetadata()` lee de DB, tÃ­tulo/favicon/description dinÃ¡micos |
| **`ClientConfigContext`** | âœ… Buena decisiÃ³n | Provider en layout, `useClientConfig()` en todos los componentes |
| **`shop-service.ts`** | âœ… Correcto | Lee config de tabla `shops` en Supabase con fallback |
| **Tabla `shops` en DB** | âœ… Correcto | Configs como JSONB, seed data para ambas cafeterÃ­as |
| **`redeem_reward` dinÃ¡mico** | âœ… Correcto | Lee `stampsPerReward` de `shops.config` en vez de hardcodear 7 |
| **PINs hasheados con pgcrypto** | âœ… Correcto | `bcrypt` via `gen_salt('bf')`, funciÃ³n `verify_shop_pin` |
| **Login usa `verify_shop_pin` RPC** | âœ… Correcto | Ya no hardcodea PINs en el signup flow |
| **Staff canje usa `verify_shop_pin`** | âœ… Correcto | Valida PIN contra DB en vez de comparar string |
| **MÃ©tricas filtradas por `client_code`** | âœ… Correcto | `fetchMetrics` filtra clientes, scans y redemptions por shop |
| **Staff logs filtrados** | âœ… Correcto | `fetchLogs` filtra por `client_code` |
| **Realtime en staff** | âœ… Buena adiciÃ³n | SuscripciÃ³n a `postgres_changes` en `transaction_logs` |
| **Staff stampsNeeded dinÃ¡mico** | âœ… Correcto | Usa `config.rules.stampsPerReward` |

### âš ï¸ Mejoras PARCIALES (necesitan ajuste)

**1. El PIN maestro sigue visible en el admin settings UI:**
```tsx
// admin/page.tsx lÃ­nea ~1586
<input type="password" value="MARE-ADMIN-2024" disabled />
```
**SoluciÃ³n:** Eliminar este campo o reemplazarlo con un botÃ³n "Cambiar PIN" que abra un modal con `current_pin` + `new_pin` validados contra `verify_shop_pin`.

**2. La migraciÃ³n `verify_shop_pin` busca por `config->>'code'` pero la PK de shops es `code`:**
```sql
-- En 20260208_secure_pins.sql:
select admin_pin_hash, staff_pin_hash 
from shops 
where config->>'code' = shop_code;  -- âŒ DeberÃ­a ser: where code = shop_code
```
La tabla `shops` tiene `code text primary key`, pero la funciÃ³n busca dentro del JSONB. Si el JSONB no tiene un campo `code` interno, esta funciÃ³n **nunca encontrarÃ¡ el shop** y siempre retornarÃ¡ "Shop not found". 

**CorrecciÃ³n:**
```sql
select admin_pin_hash, staff_pin_hash 
into stored_admin_hash, stored_staff_hash
from shops 
where code = shop_code;  -- âœ… Busca por la columna PK
```

**3. El `redeem_reward` busca shop por `profiles.shop_id` pero esa columna referencia UUID:**
```sql
select shop_id into user_shop_id from profiles where id = target_user_id;
select config into shop_config from shops where id = user_shop_id;
```
Pero la tabla `shops` nueva tiene `code text primary key`, no `id uuid`. La migraciÃ³n original de Phase 2 creÃ³ una tabla `shops` con `id uuid` PK, y la nueva migraciÃ³n hace `drop table if exists shops cascade` y la recrea con `code text primary key`. Si ya corriste ambas, el `profiles.shop_id` (uuid) no matchea con `shops.code` (text).

**SoluciÃ³n:** La funciÃ³n deberÃ­a buscar por `profiles.client_code` â†’ `shops.code`:
```sql
select client_code into user_client_code from profiles where id = target_user_id;
select config into shop_config from shops where code = user_client_code;
```

**4. Polling en client/page.tsx sigue hardcodeando 7:**
```tsx
if (stamps >= 7 && data.count < 7) {
```
DeberÃ­a ser `stamps >= config.rules.stampsPerReward && data.count < config.rules.stampsPerReward`.

**5. `config-loader.ts` sigue existiendo (cÃ³digo muerto):**
El archivo `config-loader.ts` con los configs estÃ¡ticos todavÃ­a existe. Ahora que usas `shop-service.ts` + `ClientConfigContext`, deberÃ­as eliminarlo para evitar confusiÃ³n. NingÃºn componente actualizado lo importa ya, pero si alguien lo usa por error, cargarÃ­a datos desactualizados.

### âŒ Mejoras NO Implementadas (de la auditorÃ­a anterior)

| Pendiente | Prioridad |
|-----------|-----------|
| RecuperaciÃ³n de contraseÃ±a ("forgot password") | ðŸŸ¡ Alta |
| PaginaciÃ³n en ClientsTab y logs | ðŸŸ¡ Alta |
| MenÃº desde DB en vez de `menu-data.ts` hardcoded | ðŸŸ¡ Media |
| Tests automatizados | ðŸ”´ CrÃ­tica |
| Sentry/error tracking real (los error boundaries solo son UI) | ðŸŸ¡ Alta |
| Rate limiting en login | ðŸŸ¡ Alta |
| Supabase Storage para assets | ðŸŸ¢ Media |
| ValidaciÃ³n de inputs (email format, password strength) | ðŸŸ¡ Alta |

---

## PARTE 2: REDISEÃ‘O ESTÃ‰TICO â€” COFFEINOPIA STYLE

### Principios de diseÃ±o extraÃ­dos de Coffeinopia

Analizando las 3 pantallas de referencia:

1. **Header oscuro compacto** â€” barra superior con color primario, logo pequeÃ±o, ubicaciÃ³n, bell icon. No un logo gigante de 192px.
2. **Banner promocional** â€” card dark con texto grande "OFF 20%", CTA naranja con flecha, ocupa poco espacio vertical.
3. **Cards con rounded corners XXL** â€” border-radius de 20-24px, sombras sutiles, nunca borders agresivos.
4. **Scroll horizontal** â€” secciones "Nearby Shop" y "Popular" son sliders horizontales, no listas verticales.
5. **Bottom navigation bar** â€” 5 iconos fijos, el del centro (QR/carrito) elevado con accent color.
6. **Accent naranja** â€” botones, badges, indicadores, flechas circulares. Un solo accent domina.
7. **TipografÃ­a bold en nÃºmeros** â€” conteos grandes (4.8, $3.00), font-weight extra bold.
8. **Fondo gris claro** (#FAFAFA) â€” no blanco puro, da profundidad.
9. **Micro-animaciones** â€” transiciones suaves en todo.
10. **Zero visual noise** â€” mÃ¡ximo 2 acciones por secciÃ³n, espacio generoso.

### Mapa de cambios por componente

| Componente actual | Problema estÃ©tico | RediseÃ±o Coffeinopia |
|-------------------|------------------|---------------------|
| `ClientHeader` | Logo de 176px (h-44), ocupa demasiado, header de 192px total | Header compacto dark, logo 40px, nombre + subtÃ­tulo texto, h-16 total |
| `WelcomeHero` | Texto centrado genÃ©rico "Hola, Cliente ðŸ‘‹" | Eliminado. La info de bienvenida va en el header |
| `StampProgress` | Barra de progreso plana con icono cafÃ© | Grid de cÃ­rculos/stamps visuales individuales + barra sutil debajo |
| `RewardsCard` | BotÃ³n `animate-bounce` agresivo | Barra fija inferior estilo checkout con "Canjear â†’" |
| `NewsFeed` | Cards verticales apiladas | Slider horizontal con snap scroll |
| `QRFloatingButton` | FAB circular bounce en esquina | Bottom nav bar con botÃ³n central QR elevado |
| `QRModal` | Modal centrado | Bottom sheet con handle y slide-up animation |
| `MenuButton` | BotÃ³n flat con color primario | Integrado en bottom nav |
| Fondo pÃ¡gina | `secondaryColor` (#FFF5E1 crema) | `#FAFAFA` gris neutro claro |
| `pt-56` (padding top) | 224px de padding por el header gigante | `pt-28` (112px) con header compacto |

### ImplementaciÃ³n: quÃ© archivos tocar

Para aplicar el rediseÃ±o **sin romper funcionalidad**, estos son los archivos a modificar:

```
src/components/client/ClientHeader.tsx    â†’ Header compacto dark
src/components/client/WelcomeHero.tsx     â†’ ELIMINAR (info va en header)
src/components/client/StampProgress.tsx   â†’ Grid de stamp circles
src/components/client/RewardsCard.tsx     â†’ Barra inferior fija
src/components/client/NewsFeed.tsx        â†’ Horizontal scroll cards
src/components/client/QRFloatingButton.tsx â†’ REEMPLAZAR por BottomNavBar
src/components/client/QRModal.tsx         â†’ Bottom sheet style
src/components/client/MenuButton.tsx      â†’ ELIMINAR (va en nav)
src/app/client/page.tsx                   â†’ Recomponer layout
src/app/globals.css                       â†’ AÃ±adir animaciones + tokens
```

### CSS a aÃ±adir en globals.css

```css
/* Coffeinopia design tokens */
@keyframes slideUp {
  from { transform: translateY(100%); }
  to { transform: translateY(0); }
}

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* Hide scrollbar for horizontal scroll */
.scrollbar-hide::-webkit-scrollbar { display: none; }
.scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

/* Snap scroll for cards */
.snap-x { scroll-snap-type: x mandatory; }
.snap-start { scroll-snap-align: start; }
```

### TipografÃ­a recomendada

Tu app ya carga **Fredoka** (para Perezoso) y **Playfair Display** (para Mare). Ambas son excelentes elecciones para el estilo Coffeinopia:

- **Fredoka** â†’ Perfecta para Perezoso (rounded, friendly, modern)
- **Playfair Display** â†’ Perfecta para Mare (editorial, premium)

RecomendaciÃ³n adicional: aÃ±adir **DM Sans** como body font para UI elements (labels, descriptions, buttons). Es mÃ¡s legible que Geist para tamaÃ±os pequeÃ±os y tiene personalidad.

```tsx
// layout.tsx
import { DM_Sans } from "next/font/google";
const dmSans = DM_Sans({ variable: "--font-dm-sans", subsets: ["latin"] });
```

---

## PARTE 3: RESUMEN DE PRIORIDADES

### ðŸ”´ Arreglar HOY (bugs funcionales)
1. Fix `verify_shop_pin`: cambiar `config->>'code'` â†’ `code` 
2. Fix `redeem_reward`: cambiar `shops.id` â†’ `shops.code` con `profiles.client_code`
3. Fix polling hardcoded `7` â†’ `config.rules.stampsPerReward`
4. Eliminar PIN visible en admin settings UI

### ðŸŸ¡ Aplicar esta semana (estÃ©tica Coffeinopia)
1. Reemplazar `ClientHeader` por header compacto dark
2. Reemplazar `StampProgress` por grid de stamp circles  
3. Reemplazar `QRFloatingButton` por `BottomNavBar`
4. Hacer `NewsFeed` horizontal scroll
5. Hacer `QRModal` bottom sheet
6. Hacer `RewardsCard` barra inferior fija

### ðŸŸ¢ Siguiente sprint
1. Forgot password flow
2. Input validation (email, password strength)
3. PaginaciÃ³n en admin
4. Eliminar `config-loader.ts` (cÃ³digo muerto)
5. Migrar `menu-data.ts` a DB
</file>

<file path="check_user_role.js">
const { createClient } = require('@supabase/supabase-js');
require('dotenv').config({ path: '.env.local' });

const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL;
const supabaseKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;
const supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY; // Need service key to bypass RLS if anon can't read all

const supabase = createClient(supabaseUrl, supabaseServiceKey || supabaseKey);

async function checkAndFixUser() {
    const email = 'admin@test.com';
    console.log(`Checking user: ${email}...`);

    const { data: profiles, error } = await supabase
        .from('profiles')
        .select('*')
        .eq('email', email);

    if (error) {
        console.error('Error fetching profile:', error);
        return;
    }

    if (!profiles || profiles.length === 0) {
        console.error('User profile not found!');
        return;
    }

    const profile = profiles[0];
    console.log('Current Profile:', profile);

    if (profile.role !== 'admin' || profile.client_code !== 'perezoso_cafe') {
        console.log('Updating user to Admin / Perezoso Cafe...');
        const { data, error: updateError } = await supabase
            .from('profiles')
            .update({ role: 'admin', client_code: 'perezoso_cafe' })
            .eq('id', profile.id)
            .select();

        if (updateError) {
            console.error('Error updating profile:', updateError);
        } else {
            console.log('User updated successfully:', data);
        }
    } else {
        console.log('User is already verified as Admin.');
    }
}

checkAndFixUser();
</file>

<file path="coffeinopia-redesign-preview.jsx">
import { useState, useEffect } from "react";

// â”€â”€â”€ COFFEINOPIA-INSPIRED REDESIGN PREVIEW â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Interactive preview of all redesigned components

const config = {
  name: "Perezoso Cafe",
  theme: { primaryColor: "#2E2333", secondaryColor: "#FFF5E1", accentColor: "#F5A623" },
  texts: { welcomeTitle: "Perezoso", welcomeSubtitle: "CafÃ© para ir con calma ðŸ¦¥", stampCardTitle: "Tu Tarjeta de Recompensas" },
  rules: { stampsPerReward: 10 },
  assets: { logo: null },
  features: { showNewsFeed: true, menuEnabled: true },
};

function Header({ level, userName }) {
  return (
    <header className="fixed w-full top-0 z-20">
      <div className="px-5 pt-12 pb-4 flex items-center justify-between" style={{ backgroundColor: config.theme.primaryColor }}>
        <div className="flex items-center gap-3">
          <div className="h-10 w-10 rounded-xl bg-white/10 flex items-center justify-center text-lg">ðŸ¦¥</div>
          <div>
            <p className="text-white font-bold text-base leading-tight">{config.name}</p>
            <p className="text-white/50 text-xs">Hola, {userName}</p>
          </div>
        </div>
        <div className="flex items-center gap-2">
          {level > 1 && (
            <span className="bg-amber-400/20 text-amber-300 text-[10px] px-2.5 py-1 rounded-full font-bold border border-amber-400/30">
              â˜… Lv {level}
            </span>
          )}
          <button className="w-9 h-9 rounded-xl bg-white/10 flex items-center justify-center text-white/60">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
              <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/>
            </svg>
          </button>
        </div>
      </div>
    </header>
  );
}

function PromoBanner() {
  return (
    <div className="relative overflow-hidden rounded-[20px] p-5 flex items-center justify-between" style={{ backgroundColor: config.theme.primaryColor }}>
      <div className="absolute inset-0 opacity-5" style={{ backgroundImage: "radial-gradient(circle at 80% 20%, white 0%, transparent 50%)" }} />
      <div className="relative z-10 space-y-2">
        <p className="text-white/50 text-[10px] font-bold uppercase tracking-[0.2em]">Coffee Day</p>
        <p className="text-white text-3xl font-black leading-none tracking-tight">OFF 20%</p>
        <button className="mt-2 px-4 py-2 rounded-full text-xs font-bold flex items-center gap-2 shadow-lg transition-transform hover:scale-105 active:scale-95" style={{ backgroundColor: config.theme.accentColor, color: "white" }}>
          Obtener Descuento
          <span className="w-5 h-5 bg-white/20 rounded-full flex items-center justify-center text-[10px]">â†’</span>
        </button>
      </div>
      <div className="relative z-10 w-20 h-20 rounded-2xl bg-white/10 flex items-center justify-center text-4xl backdrop-blur-sm">â˜•</div>
    </div>
  );
}

function StampCard({ stamps, setStamps }) {
  const total = config.rules.stampsPerReward;
  const pct = Math.min((stamps / total) * 100, 100);

  return (
    <div className="bg-white rounded-[24px] p-6" style={{ boxShadow: "0 2px 20px rgba(0,0,0,0.05)" }}>
      <div className="flex items-center justify-between mb-5">
        <div>
          <h3 className="font-bold text-gray-900 text-sm">{config.texts.stampCardTitle}</h3>
          <p className="text-gray-400 text-xs mt-0.5">
            {stamps >= total ? "Â¡Premio disponible!" : `${total - stamps} mÃ¡s para tu premio`}
          </p>
        </div>
        <div className="flex items-baseline gap-0.5">
          <span className="text-2xl font-black text-gray-900">{stamps}</span>
          <span className="text-sm text-gray-300 font-semibold">/{total}</span>
        </div>
      </div>

      <div className="grid grid-cols-5 gap-2.5 mb-4">
        {Array.from({ length: total }).map((_, i) => {
          const filled = i < stamps;
          const next = i === stamps;
          const reward = i === total - 1;
          return (
            <button key={i} onClick={() => setStamps(Math.min(i + 1, total))}
              className={`aspect-square rounded-xl flex items-center justify-center text-sm font-bold transition-all duration-300 cursor-pointer
                ${filled ? "text-white scale-100 shadow-md" : next ? "border-2 border-dashed animate-pulse" : "bg-gray-100 text-gray-300 hover:bg-gray-200"}
              `}
              style={{
                ...(filled ? { backgroundColor: config.theme.accentColor } : {}),
                ...(next ? { borderColor: config.theme.accentColor, color: config.theme.accentColor } : {}),
              }}
            >
              {reward && !filled ? "ðŸŽ" : filled ? (
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>
              ) : i + 1}
            </button>
          );
        })}
      </div>

      <div className="w-full bg-gray-100 rounded-full h-1.5 overflow-hidden">
        <div className="h-1.5 rounded-full transition-all duration-700" style={{ width: `${pct}%`, backgroundColor: config.theme.accentColor }} />
      </div>

      <p className="text-[10px] text-center mt-2 text-gray-400">Toca los sellos para simular progreso</p>
    </div>
  );
}

function NewsFeed() {
  const items = [
    { id: "1", emoji: "â˜•", cat: "Novedad", title: "Cold Brew de Temporada", desc: "InfusiÃ³n en frÃ­o con notas tropicales" },
    { id: "2", emoji: "ðŸŽ¨", cat: "Evento", title: "Taller de Latte Art", desc: "Aprende arte en tu taza este sÃ¡bado" },
    { id: "3", emoji: "ðŸŒ±", cat: "Eco", title: "Descuento Eco-Friendly", desc: "15% OFF con tu vaso reutilizable" },
    { id: "4", emoji: "ðŸ§", cat: "Nuevo", title: "PastelerÃ­a Artesanal", desc: "Nuevos croissants de masa madre" },
  ];

  return (
    <div className="space-y-3">
      <div className="flex items-center justify-between px-1">
        <h3 className="font-bold text-gray-900 text-sm">Novedades</h3>
        <button className="text-xs font-semibold flex items-center gap-1" style={{ color: config.theme.accentColor }}>Ver Todo â†’</button>
      </div>
      <div className="flex gap-3 overflow-x-auto pb-2 -mx-4 px-4 snap-x" style={{ scrollbarWidth: "none" }}>
        {items.map((item) => (
          <div key={item.id} className="min-w-[170px] snap-start bg-white rounded-[20px] overflow-hidden flex-shrink-0 border border-gray-100" style={{ boxShadow: "0 2px 12px rgba(0,0,0,0.04)" }}>
            <div className="h-24 flex items-center justify-center text-3xl" style={{ backgroundColor: config.theme.primaryColor + "08" }}>
              {item.emoji}
            </div>
            <div className="p-3">
              <span className="text-[9px] font-bold uppercase tracking-wider px-2 py-0.5 rounded-full" style={{ backgroundColor: config.theme.accentColor + "12", color: config.theme.accentColor }}>
                {item.cat}
              </span>
              <h4 className="font-bold text-gray-900 text-xs mt-1.5 leading-tight">{item.title}</h4>
              <p className="text-gray-400 text-[10px] mt-0.5 leading-snug">{item.desc}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

function RewardBar({ stamps, onClaim }) {
  return (
    <div className="fixed bottom-0 left-0 right-0 z-30 p-4 pb-6" style={{ background: "linear-gradient(to top, white 60%, transparent)" }}>
      <div className="max-w-sm mx-auto flex items-center justify-between p-4 rounded-2xl text-white" style={{ backgroundColor: config.theme.accentColor, boxShadow: "0 8px 32px rgba(245,166,35,0.4)" }}>
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center text-xl">ðŸŽ</div>
          <div>
            <p className="font-bold text-sm">Â¡Premio Disponible!</p>
            <p className="text-white/70 text-xs">{stamps} sellos acumulados</p>
          </div>
        </div>
        <button onClick={onClaim} className="bg-white text-gray-900 font-bold text-sm px-5 py-2.5 rounded-xl flex items-center gap-2 hover:scale-105 active:scale-95 transition-transform shadow-md">
          Canjear
          <span className="w-5 h-5 rounded-full flex items-center justify-center text-[10px] text-white" style={{ backgroundColor: config.theme.accentColor }}>â†’</span>
        </button>
      </div>
    </div>
  );
}

function BottomNav({ onQR }) {
  const [active, setActive] = useState("home");
  const items = [
    { id: "home", icon: "ðŸ ", label: "Inicio" },
    { id: "menu", icon: "ðŸ“‹", label: "MenÃº" },
    { id: "qr", icon: null, label: "QR" },
    { id: "rewards", icon: "ðŸŽ", label: "Premios" },
    { id: "profile", icon: "ðŸ‘¤", label: "Perfil" },
  ];

  return (
    <nav className="fixed bottom-0 left-0 right-0 z-30 bg-white border-t border-gray-100 pb-6 pt-2 px-6">
      <div className="max-w-sm mx-auto flex items-center justify-between">
        {items.map((item) =>
          item.id === "qr" ? (
            <button key="qr" onClick={onQR}
              className="w-14 h-14 -mt-8 rounded-2xl flex items-center justify-center text-white transition-transform hover:scale-110 active:scale-95"
              style={{ backgroundColor: config.theme.accentColor, boxShadow: `0 6px 24px ${config.theme.accentColor}60` }}>
              <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <rect x="3" y="3" width="7" height="7" rx="1"/><rect x="14" y="3" width="7" height="7" rx="1"/>
                <rect x="3" y="14" width="7" height="7" rx="1"/><rect x="14" y="14" width="3" height="3"/>
                <line x1="21" y1="14" x2="21" y2="21"/><line x1="14" y1="21" x2="21" y2="21"/>
              </svg>
            </button>
          ) : (
            <button key={item.id} onClick={() => setActive(item.id)}
              className="flex flex-col items-center gap-0.5 transition-all"
              style={{ color: active === item.id ? config.theme.accentColor : "#D1D5DB", transform: active === item.id ? "scale(1.1)" : "scale(1)" }}>
              <span className="text-lg">{item.icon}</span>
              <span className="text-[9px] font-bold">{item.label}</span>
            </button>
          )
        )}
      </div>
    </nav>
  );
}

function QRSheet({ open, onClose, isReward }) {
  if (!open) return null;
  return (
    <>
      <div className="fixed inset-0 bg-black/50 z-40 backdrop-blur-sm" onClick={onClose} />
      <div className="fixed bottom-0 left-0 right-0 z-50" style={{ animation: "slideUp 0.3s ease-out" }}>
        <div className="bg-white rounded-t-[32px] max-w-sm mx-auto w-full px-6 pt-3 pb-10" style={{ boxShadow: "0 -8px 40px rgba(0,0,0,0.15)" }}>
          <div className="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6" />
          <div className="text-center mb-5">
            <span className="inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-xs font-bold"
              style={{ backgroundColor: isReward ? "#FEF3C7" : config.theme.accentColor + "15", color: isReward ? "#92400E" : config.theme.accentColor }}>
              {isReward ? "ðŸŽ Â¡Premio listo!" : "â˜• Muestra al barista"}
            </span>
          </div>
          <div className="rounded-[24px] p-6 flex items-center justify-center mx-auto max-w-[260px]"
            style={{ backgroundColor: isReward ? config.theme.primaryColor : "#F9FAFB", border: isReward ? "none" : "2px solid #F3F4F6" }}>
            <div className="bg-white p-4 rounded-2xl">
              <div className="w-44 h-44 bg-gray-50 rounded-xl flex items-center justify-center">
                <svg width="120" height="120" viewBox="0 0 120 120">
                  <rect x="10" y="10" width="30" height="30" rx="4" fill="#333"/><rect x="15" y="15" width="20" height="20" rx="2" fill="white"/>
                  <rect x="18" y="18" width="14" height="14" rx="1" fill="#333"/>
                  <rect x="80" y="10" width="30" height="30" rx="4" fill="#333"/><rect x="85" y="15" width="20" height="20" rx="2" fill="white"/>
                  <rect x="88" y="18" width="14" height="14" rx="1" fill="#333"/>
                  <rect x="10" y="80" width="30" height="30" rx="4" fill="#333"/><rect x="15" y="85" width="20" height="20" rx="2" fill="white"/>
                  <rect x="18" y="88" width="14" height="14" rx="1" fill="#333"/>
                  <rect x="50" y="10" width="8" height="8" rx="1" fill="#333"/><rect x="50" y="26" width="8" height="8" rx="1" fill="#333"/>
                  <rect x="50" y="50" width="8" height="8" rx="1" fill="#333"/><rect x="66" y="50" width="8" height="8" rx="1" fill="#333"/>
                  <rect x="82" y="50" width="8" height="8" rx="1" fill="#333"/><rect x="50" y="66" width="8" height="8" rx="1" fill="#333"/>
                  <rect x="82" y="82" width="28" height="28" rx="4" fill={config.theme.accentColor} opacity="0.2"/>
                  <rect x="87" y="87" width="18" height="18" rx="2" fill={config.theme.accentColor}/>
                </svg>
              </div>
            </div>
          </div>
          <button onClick={onClose} className="w-full mt-5 py-3 rounded-2xl font-bold text-sm text-gray-500 bg-gray-100 hover:bg-gray-200 transition-colors">Cerrar</button>
        </div>
      </div>
      <style>{`@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }`}</style>
    </>
  );
}

// â”€â”€â”€ MAIN APP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
export default function App() {
  const [stamps, setStamps] = useState(5);
  const [showQR, setShowQR] = useState(false);
  const isReward = stamps >= config.rules.stampsPerReward;

  return (
    <div className="bg-gray-50 min-h-screen max-w-sm mx-auto relative overflow-hidden" style={{ fontFamily: "'Fredoka', sans-serif" }}>
      <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&display=swap" rel="stylesheet" />

      <Header level={2} userName="MartÃ­n" />

      <div className="pt-28 pb-28 px-4 flex flex-col gap-5">
        <PromoBanner />
        <StampCard stamps={stamps} setStamps={setStamps} />
        <NewsFeed />
      </div>

      {isReward ? (
        <RewardBar stamps={stamps} onClaim={() => setShowQR(true)} />
      ) : (
        <BottomNav onQR={() => setShowQR(true)} />
      )}

      <QRSheet open={showQR} onClose={() => setShowQR(false)} isReward={isReward} />
    </div>
  );
}
</file>

<file path="eslint.config.mjs">
import { defineConfig, globalIgnores } from "eslint/config";
import nextVitals from "eslint-config-next/core-web-vitals";
import nextTs from "eslint-config-next/typescript";

const eslintConfig = defineConfig([
  ...nextVitals,
  ...nextTs,
  // Override default ignores of eslint-config-next.
  globalIgnores([
    // Default ignores of eslint-config-next:
    ".next/**",
    "out/**",
    "build/**",
    "next-env.d.ts",
  ]),
]);

export default eslintConfig;
</file>

<file path="fix_admin_role.sql">
UPDATE profiles 
SET role = 'admin', client_code = 'perezoso_cafe' 
WHERE email = 'admin@test.com';
</file>

<file path="formatodetrabajo.html">
<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BRANDIA â€” FidelizaciÃ³n Digital para CafeterÃ­as | Demo Mare CafÃ©</title>
    <meta name="description" content="Plataforma de fidelizaciÃ³n digital para cafeterÃ­as. Caso de Ã©xito: Mare CafÃ©, Mar del Plata.">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800;900&family=Playfair+Display:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        mare: { blue: '#1E3A8A', cream: '#F5F5DC', beige: '#E8DCC8' },
                        brandia: { dark: '#0A0A0A', accent: '#9C6644', warm: '#D4A373' }
                    },
                    fontFamily: {
                        display: ['Playfair Display', 'serif'],
                        body: ['Plus Jakarta Sans', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; }
        .font-display { font-family: 'Playfair Display', serif; }

        /* Animations */
        @keyframes float { 0%,100%{transform:translateY(0)} 50%{transform:translateY(-12px)} }
        @keyframes pulse-glow { 0%,100%{box-shadow:0 0 20px rgba(30,58,138,0.3)} 50%{box-shadow:0 0 40px rgba(30,58,138,0.6)} }
        @keyframes slide-up { from{opacity:0;transform:translateY(40px)} to{opacity:1;transform:translateY(0)} }
        @keyframes fade-in { from{opacity:0} to{opacity:1} }
        @keyframes shimmer { 0%{background-position:-200% 0} 100%{background-position:200% 0} }
        @keyframes stamp-pop { 0%{transform:scale(0) rotate(-180deg);opacity:0} 60%{transform:scale(1.3) rotate(10deg)} 100%{transform:scale(1) rotate(0);opacity:1} }
        @keyframes gold-pulse { 0%,100%{background-color:#F59E0B} 50%{background-color:#D97706} }
        @keyframes confetti-fall { 0%{transform:translateY(-100vh) rotate(0deg);opacity:1} 100%{transform:translateY(100vh) rotate(720deg);opacity:0} }
        @keyframes notch-glow { 0%,100%{opacity:0.5} 50%{opacity:1} }

        .animate-float { animation: float 4s ease-in-out infinite; }
        .animate-pulse-glow { animation: pulse-glow 3s ease-in-out infinite; }
        .animate-slide-up { animation: slide-up 0.8s ease-out forwards; }
        .animate-fade-in { animation: fade-in 0.6s ease-out forwards; }
        .animate-stamp-pop { animation: stamp-pop 0.5s cubic-bezier(0.68,-0.55,0.27,1.55) forwards; }

        .shimmer-bg {
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.08) 50%, transparent 100%);
            background-size: 200% 100%;
            animation: shimmer 3s infinite;
        }

        /* iPhone Frame */
        .iphone-frame {
            width: 300px;
            height: 620px;
            border-radius: 44px;
            border: 6px solid #1a1a1a;
            background: #000;
            position: relative;
            box-shadow:
                0 0 0 2px #333,
                0 30px 80px rgba(0,0,0,0.5),
                inset 0 0 4px rgba(255,255,255,0.1);
            overflow: hidden;
        }
        .iphone-notch {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 28px;
            background: #1a1a1a;
            border-radius: 0 0 18px 18px;
            z-index: 30;
        }
        .iphone-notch::after {
            content: '';
            position: absolute;
            top: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 8px;
            height: 8px;
            background: #333;
            border-radius: 50%;
        }
        .iphone-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 38px;
            overflow: hidden;
            background: #fff;
        }
        .iphone-home-bar {
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            width: 120px;
            height: 4px;
            background: rgba(0,0,0,0.3);
            border-radius: 4px;
            z-index: 30;
        }

        /* Phone Screen Transitions */
        .phone-view { transition: all 0.4s cubic-bezier(0.4,0,0.2,1); }
        .phone-view.entering { animation: slide-up 0.35s ease-out forwards; }

        /* Stamp Visual */
        .stamp-circle {
            width: 36px; height: 36px;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; font-weight: 700;
            transition: all 0.3s;
            cursor: pointer;
        }
        .stamp-filled {
            background: #1E3A8A;
            color: white;
            box-shadow: 0 2px 8px rgba(30,58,138,0.4);
        }
        .stamp-empty {
            background: #E5E7EB;
            color: #9CA3AF;
        }
        .stamp-filling {
            animation: stamp-pop 0.5s cubic-bezier(0.68,-0.55,0.27,1.55) forwards;
            background: #1E3A8A;
            color: white;
        }

        /* Gold Mode */
        .gold-mode { background: linear-gradient(135deg, #F59E0B, #D97706, #B45309) !important; }

        /* Scroll Reveal */
        .reveal { opacity: 0; transform: translateY(30px); transition: all 0.8s cubic-bezier(0.4,0,0.2,1); }
        .reveal.visible { opacity: 1; transform: translateY(0); }

        /* Confetti */
        .confetti-piece {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 2px;
            animation: confetti-fall 2s ease-in forwards;
        }

        /* Mobile Nav */
        .mobile-menu {
            transform: translateX(100%);
            transition: transform 0.3s ease;
            visibility: hidden;
            pointer-events: none;
        }
        .mobile-menu.open {
            transform: translateX(0);
            visibility: visible;
            pointer-events: auto;
        }
        .mobile-menu-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(4px);
            z-index: 9998;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }
        .mobile-menu-overlay.open {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }

        /* Custom scrollbar on phone */
        .phone-scroll::-webkit-scrollbar { width: 0; }

        /* Glass effect */
        .glass { background: rgba(255,255,255,0.08); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); }

        @media (max-width: 768px) {
            .iphone-frame { width: 260px; height: 540px; border-radius: 38px; }
            .iphone-notch { width: 100px; height: 24px; border-radius: 0 0 14px 14px; }
        }
        @media (max-width: 380px) {
            .iphone-frame { width: 240px; height: 500px; border-radius: 34px; }
        }
    </style>
</head>

<body class="bg-white text-stone-800 antialiased selection:bg-mare-blue selection:text-white overflow-x-hidden">

    <!-- ==================== NAVIGATION ==================== -->
    <nav id="navbar" class="fixed top-0 left-0 right-0 w-full z-50 transition-all duration-300 bg-white/0 overflow-visible">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 items-center">
                <!-- Logo -->
                <a href="#" class="flex items-center gap-2">
                    <img src="Logo vectorizado.png" alt="BRANDIA" class="h-9 w-9 object-contain rounded-lg">
                    <span class="font-bold text-lg tracking-tight">
                        <span class="text-mare-blue">BRAND</span><span class="text-amber-500">IA</span>
                    </span>
                </a>

                <!-- Desktop Links -->
                <div class="hidden md:flex items-center space-x-8 text-sm font-medium text-stone-500">
                    <a href="#demo" class="hover:text-mare-blue transition">Demo en Vivo</a>
                    <a href="#features" class="hover:text-mare-blue transition">Funciones</a>
                    <a href="#how" class="hover:text-mare-blue transition">CÃ³mo Funciona</a>
                    <a href="#roadmap" class="hover:text-mare-blue transition">Roadmap</a>
                    <a href="#brandia" class="hover:text-amber-500 transition font-bold">BRANDIA</a>
                </div>

                <!-- CTA -->
                <div class="flex items-center gap-3">
                    <a href="#contact" class="hidden sm:inline-flex bg-mare-blue text-white px-5 py-2.5 rounded-xl text-sm font-bold hover:bg-blue-900 transition items-center gap-2 shadow-lg shadow-mare-blue/20">
                        Agendar Demo
                        <i class="fas fa-arrow-right text-xs"></i>
                    </a>
                    <!-- Hamburger -->
                    <button onclick="toggleMobileMenu()" class="md:hidden p-2 text-stone-600">
                        <i class="fas fa-bars text-xl" id="menu-icon"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Mobile Menu Overlay (fuera del nav para evitar conflictos) -->
    <div id="mobile-menu-overlay" class="mobile-menu-overlay" onclick="toggleMobileMenu()" aria-hidden="true"></div>
    <!-- Mobile Menu -->
    <div id="mobile-menu" class="mobile-menu fixed top-0 right-0 w-80 max-w-[85vw] h-full bg-white shadow-2xl z-[9999] p-8 flex flex-col gap-6 overflow-y-auto">
        <div class="flex items-center justify-between">
            <a href="#" onclick="toggleMobileMenu()" class="flex items-center gap-3">
                <img src="Logo vectorizado.png" alt="BRANDIA" class="h-14 w-14 object-contain">
                <span class="font-black text-xl tracking-tight text-stone-900 uppercase">BRAND<span class="text-amber-500">IA</span></span>
            </a>
            <button onclick="toggleMobileMenu()" class="p-2 text-stone-400 hover:text-stone-700 -mr-2">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <nav class="flex flex-col gap-4 pt-2">
            <a href="#demo" onclick="toggleMobileMenu()" class="text-lg font-bold text-stone-800 hover:text-mare-blue py-2 border-b border-stone-100">Demo en Vivo</a>
            <a href="#features" onclick="toggleMobileMenu()" class="text-lg font-bold text-stone-800 hover:text-mare-blue py-2 border-b border-stone-100">Funciones</a>
            <a href="#how" onclick="toggleMobileMenu()" class="text-lg font-bold text-stone-800 hover:text-mare-blue py-2 border-b border-stone-100">CÃ³mo Funciona</a>
            <a href="#roadmap" onclick="toggleMobileMenu()" class="text-lg font-bold text-stone-800 hover:text-mare-blue py-2 border-b border-stone-100">Roadmap</a>
            <a href="#brandia" onclick="toggleMobileMenu()" class="text-lg font-bold text-amber-600 hover:text-amber-700 py-2 border-b border-stone-100">BRANDIA</a>
        </nav>
        <a href="https://wa.me/5491171189084" target="_blank" rel="noopener" onclick="toggleMobileMenu()" class="mt-6 bg-emerald-500 text-white px-6 py-4 rounded-xl text-center font-bold flex items-center justify-center gap-2"><i class="fab fa-whatsapp"></i> Agendar Demo</a>
    </div>

    <!-- ==================== HERO ==================== -->
    <header class="relative min-h-screen flex items-center overflow-hidden bg-gradient-to-br from-slate-950 via-mare-blue to-blue-900">
        <!-- Decorative Elements -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-20 right-[10%] w-[500px] h-[500px] bg-brandia-warm rounded-full blur-[150px] opacity-10"></div>
            <div class="absolute bottom-0 left-[5%] w-[400px] h-[400px] bg-blue-500 rounded-full blur-[120px] opacity-10"></div>
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] border border-white/[0.03] rounded-full"></div>
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] border border-white/[0.05] rounded-full"></div>
            <!-- Grid Pattern -->
            <div class="absolute inset-0 opacity-[0.03]" style="background-image: radial-gradient(circle, white 1px, transparent 1px); background-size: 40px 40px;"></div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-32 relative z-10 w-full">
            <div class="grid lg:grid-cols-2 gap-12 lg:gap-16 items-center">
                <!-- Text -->
                <div class="text-center lg:text-left">
                    <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full border border-white/10 bg-white/5 text-xs font-semibold tracking-wider text-white/70 mb-8">
                        <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
                        CASO DE Ã‰XITO: MARE CAFÃ‰
                    </div>

                    <h1 class="text-4xl sm:text-5xl lg:text-6xl xl:text-7xl font-black leading-[1.05] text-white mb-6 tracking-tight">
                        FidelizaciÃ³n
                        <br>
                        <span class="text-transparent bg-clip-text bg-gradient-to-r from-amber-300 via-orange-400 to-amber-500">Clientes</span>
                        <br>
                        <span class="text-white/60 text-3xl sm:text-4xl lg:text-5xl font-medium">para CafeterÃ­as</span>
                    </h1>

                    <p class="text-base sm:text-lg text-white/50 mb-10 max-w-lg mx-auto lg:mx-0 leading-relaxed">
                        Eliminamos los cartones de papel. Tu cliente acumula sellos desde su celular, vos ves las mÃ©tricas en tiempo real. <strong class="text-white/80">Todo desde el navegador.</strong>
                    </p>

                    <div class="flex flex-col sm:flex-row gap-4 justify-center lg:justify-start">
                        <a href="#demo" class="group px-8 py-4 bg-white text-mare-blue rounded-2xl font-bold text-base hover:bg-stone-100 transition-all shadow-xl shadow-white/10 flex items-center justify-center gap-3">
                            <i class="fas fa-play text-xs p-2 bg-mare-blue/10 rounded-full group-hover:bg-mare-blue/20 transition"></i>
                            Probar Demo en Vivo
                        </a>
                        <a href="#features" class="px-8 py-4 border border-white/15 text-white rounded-2xl font-bold hover:bg-white/5 transition-all flex items-center justify-center gap-2">
                            <i class="fas fa-grid-2 text-sm opacity-60"></i>
                            Ver Funciones
                        </a>
                    </div>

                    <!-- Trust Badges -->
                    <div class="mt-12 flex flex-wrap items-center gap-6 justify-center lg:justify-start text-white/30 text-xs font-medium">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-shield-halved text-emerald-400/60"></i>
                            Anti-fraude integrado
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fas fa-mobile-screen text-blue-400/60"></i>
                            Sin descargas
                        </div>
                        <div class="flex items-center gap-2">
                            <i class="fas fa-chart-line text-amber-400/60"></i>
                            MÃ©tricas real-time
                        </div>
                    </div>
                </div>

                <!-- Hero Visual: Mini Phone Preview -->
                <div class="flex justify-center lg:justify-end">
                    <div class="relative">
                        <!-- Glow behind phone -->
                        <div class="absolute inset-0 bg-gradient-to-b from-amber-400/20 to-mare-blue/20 blur-[80px] scale-110 rounded-full"></div>

                        <!-- Phone -->
                        <div class="iphone-frame animate-float relative" style="animation-delay: 0.5s;">
                            <div class="iphone-notch"></div>
                            <div class="iphone-screen bg-mare-blue flex flex-col items-center justify-center p-8 text-center">
                                <img src="logo-mare.png" alt="Mare CafÃ©" class="w-40 h-40 object-contain mb-6 rounded-full">
                                <h3 class="text-2xl font-bold text-white font-display">Mare Cafe</h3>
                                <p class="text-white/60 text-sm mt-1">PastelerÃ­a y CafÃ© de Especialidad</p>
                                <div class="mt-8 w-full space-y-3">
                                    <div class="bg-white text-mare-blue py-3 px-6 rounded-full font-bold text-sm flex items-center justify-center gap-2">
                                        <i class="fas fa-user"></i> Soy Cliente
                                    </div>
                                    <div class="text-white/40 text-xs py-2">
                                        <i class="fas fa-store text-[10px]"></i> Acceso Staff
                                    </div>
                                </div>
                            </div>
                            <div class="iphone-home-bar"></div>
                        </div>

                        <!-- Floating stats -->
                        <div class="absolute -left-16 top-24 bg-white rounded-2xl p-4 shadow-2xl hidden lg:flex items-center gap-3 animate-float" style="animation-delay: 1s;">
                            <div class="w-10 h-10 bg-emerald-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-chart-line text-emerald-600"></i>
                            </div>
                            <div>
                                <p class="text-xs text-stone-400 font-medium">RetenciÃ³n</p>
                                <p class="font-bold text-stone-800">+24%</p>
                            </div>
                        </div>

                        <div class="absolute -right-12 bottom-32 bg-white rounded-2xl p-4 shadow-2xl hidden lg:flex items-center gap-3 animate-float" style="animation-delay: 2s;">
                            <div class="w-10 h-10 bg-amber-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-users text-amber-600"></i>
                            </div>
                            <div>
                                <p class="text-xs text-stone-400 font-medium">Clientes</p>
                                <p class="font-bold text-stone-800">624</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Scroll indicator -->
        <div class="absolute bottom-8 left-1/2 -translate-x-1/2 flex flex-col items-center gap-2 text-white/30 animate-bounce">
            <span class="text-[10px] tracking-widest uppercase">Scroll</span>
            <i class="fas fa-chevron-down text-xs"></i>
        </div>
    </header>

    <!-- ==================== SOBRE BRANDIA (Quick Strip) ==================== -->
    <section class="py-6 bg-stone-50 border-b border-stone-100">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="flex items-center gap-3">
                    <img src="Logo vectorizado.png" alt="BRANDIA" class="h-8 w-8 object-contain rounded">
                    <p class="text-sm text-stone-400 font-medium">
                        <strong class="text-stone-700">BRAND<span class="text-amber-600">IA</span></strong> â€” Soluciones de fidelizaciÃ³n digital para cafeterÃ­as en Argentina.
                    </p>
                </div>
                <div class="flex items-center gap-6 text-xs text-stone-400">
                    <span class="flex items-center gap-1.5"><i class="fas fa-location-dot text-mare-blue/60"></i> Mar del Plata</span>
                    <span class="flex items-center gap-1.5"><i class="fas fa-rocket text-mare-blue/60"></i> TecnologÃ­a moderna</span>
                    <span class="flex items-center gap-1.5"><i class="fas fa-mobile-screen text-mare-blue/60"></i> Sin descargas</span>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== INTERACTIVE DEMO ==================== -->
    <section id="demo" class="py-20 sm:py-28 relative overflow-hidden">
        <!-- Background -->
        <div class="absolute inset-0 bg-gradient-to-b from-white via-stone-50/50 to-white pointer-events-none"></div>
        <div class="absolute top-0 right-0 w-[600px] h-[600px] bg-mare-blue/5 rounded-full blur-[100px] pointer-events-none"></div>

        <div class="max-w-7xl mx-auto px-4 relative z-10">
            <div class="text-center mb-16 reveal">
                <span class="text-mare-blue font-bold text-xs uppercase tracking-[0.2em]">Demo Interactivo</span>
                <h2 class="text-3xl sm:text-4xl lg:text-5xl font-black text-stone-900 mt-3 tracking-tight">
                    Probalo <span class="text-transparent bg-clip-text bg-gradient-to-r from-mare-blue to-blue-500">ahora mismo</span>
                </h2>
                <p class="text-stone-500 mt-4 max-w-xl mx-auto">InteractuÃ¡ con la app tal como la usarÃ­a un cliente real de Mare CafÃ©. TocÃ¡ los botones, sumÃ¡ sellos y canjeÃ¡ tu premio.</p>
            </div>

            <div class="flex flex-col lg:flex-row items-center gap-12 lg:gap-20">
                <!-- Demo Controls Panel (LEFT) -->
                <div class="flex-1 order-2 lg:order-1 w-full max-w-md">
                    <div class="space-y-6">
                        <!-- Current View Label -->
                        <div class="bg-stone-100 rounded-2xl p-6">
                            <h4 class="font-bold text-stone-800 text-sm uppercase tracking-wider mb-4 flex items-center gap-2">
                                <i class="fas fa-hand-pointer text-mare-blue"></i>
                                Controles de Demo
                            </h4>
                            <div class="space-y-3">
                                <button onclick="phoneNavigate('landing')" class="demo-btn w-full text-left px-4 py-3 rounded-xl border-2 border-stone-200 hover:border-mare-blue/50 bg-white transition-all flex items-center gap-3 text-sm font-medium text-stone-600 hover:text-mare-blue">
                                    <i class="fas fa-home w-5 text-center"></i>
                                    <span>Pantalla de Inicio</span>
                                </button>
                                <button onclick="phoneNavigate('client')" class="demo-btn w-full text-left px-4 py-3 rounded-xl border-2 border-stone-200 hover:border-mare-blue/50 bg-white transition-all flex items-center gap-3 text-sm font-medium text-stone-600 hover:text-mare-blue">
                                    <i class="fas fa-qrcode w-5 text-center"></i>
                                    <span>Vista Cliente (Mi Tarjeta)</span>
                                </button>
                                <button onclick="phoneNavigate('staff')" class="demo-btn w-full text-left px-4 py-3 rounded-xl border-2 border-stone-200 hover:border-mare-blue/50 bg-white transition-all flex items-center gap-3 text-sm font-medium text-stone-600 hover:text-mare-blue">
                                    <i class="fas fa-barcode w-5 text-center"></i>
                                    <span>Vista Staff (EscÃ¡ner)</span>
                                </button>
                                <button onclick="phoneNavigate('admin')" class="demo-btn w-full text-left px-4 py-3 rounded-xl border-2 border-stone-200 hover:border-mare-blue/50 bg-white transition-all flex items-center gap-3 text-sm font-medium text-stone-600 hover:text-mare-blue">
                                    <i class="fas fa-chart-pie w-5 text-center"></i>
                                    <span>Vista Admin (Panel)</span>
                                </button>
                            </div>
                        </div>

                        <!-- Current State Info -->
                        <div id="demo-info" class="bg-mare-blue/5 border border-mare-blue/10 rounded-2xl p-6">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-8 h-8 bg-mare-blue/10 rounded-lg flex items-center justify-center">
                                    <i class="fas fa-info-circle text-mare-blue text-sm"></i>
                                </div>
                                <h5 class="font-bold text-stone-800 text-sm" id="demo-info-title">Pantalla de Inicio</h5>
                            </div>
                            <p class="text-xs text-stone-500 leading-relaxed" id="demo-info-desc">
                                Esta es la pantalla que ve el usuario al entrar por primera vez. Puede elegir "Soy Cliente" para acceder a su tarjeta de fidelidad, o "Acceso Staff" si es empleado del local.
                            </p>
                        </div>

                        <!-- Quick Action -->
                        <div class="text-center">
                            <button onclick="addDemoStamp()" id="add-stamp-btn" class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-mare-blue to-blue-700 text-white rounded-xl font-bold text-sm hover:shadow-lg hover:shadow-mare-blue/30 transition-all active:scale-95">
                                <i class="fas fa-plus-circle"></i>
                                Sumar Sello al Cliente
                            </button>
                            <p class="text-xs text-stone-400 mt-2">SimulÃ¡ que el barista escanea al cliente</p>
                        </div>
                    </div>
                </div>

                <!-- PHONE MOCKUP (CENTER/RIGHT) -->
                <div class="order-1 lg:order-2 flex-shrink-0">
                    <div class="relative">
                        <!-- Glow -->
                        <div class="absolute inset-0 bg-mare-blue/10 blur-[60px] scale-125 rounded-full pointer-events-none"></div>

                        <div class="iphone-frame relative" id="demo-phone">
                            <div class="iphone-notch"></div>
                            <div class="iphone-screen" id="phone-screen">
                                <!-- Screen content injected by JS -->
                            </div>
                            <div class="iphone-home-bar"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== FEATURES ==================== -->
    <section id="features" class="py-20 sm:py-28 bg-slate-950 text-white relative overflow-hidden">
        <div class="absolute inset-0 opacity-[0.03]" style="background-image: radial-gradient(circle, white 1px, transparent 1px); background-size: 32px 32px;"></div>
        <div class="absolute top-0 left-0 w-96 h-96 bg-mare-blue/20 rounded-full blur-[150px] pointer-events-none"></div>

        <div class="max-w-7xl mx-auto px-4 relative z-10">
            <div class="text-center mb-16 reveal">
                <span class="text-amber-400 font-bold text-xs uppercase tracking-[0.2em]">Beneficios</span>
                <h2 class="text-3xl sm:text-4xl lg:text-5xl font-black mt-3 tracking-tight">
                    Todo lo que tu negocio
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-orange-400">necesita</span>
                </h2>
                <p class="text-white/40 mt-4 max-w-xl mx-auto">Funciones reales que ya estÃ¡n funcionando en cafeterÃ­as. No es una demo, es el producto.</p>
            </div>

            <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Feature 1 -->
                <div class="reveal group glass rounded-2xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-mare-blue rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-blue-500/20">
                        <i class="fas fa-qrcode text-white text-lg"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">CÃ³digo Ãºnico por cliente</h3>
                    <p class="text-white/40 text-sm leading-relaxed">Cada cliente tiene su propio cÃ³digo en el celular. Funciona incluso sin internet.</p>
                </div>

                <!-- Feature 2 -->
                <div class="reveal group glass rounded-2xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-br from-emerald-500 to-green-600 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-emerald-500/20">
                        <i class="fas fa-shield-halved text-white text-lg"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">ProtecciÃ³n anti-trampa</h3>
                    <p class="text-white/40 text-sm leading-relaxed">Si alguien intenta sumar sellos dos veces el mismo dÃ­a, el sistema lo detecta y pide tu autorizaciÃ³n.</p>
                </div>

                <!-- Feature 3 -->
                <div class="reveal group glass rounded-2xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-br from-amber-500 to-orange-500 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-amber-500/20">
                        <i class="fas fa-gift text-white text-lg"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">Canje fÃ¡cil y visual</h3>
                    <p class="text-white/40 text-sm leading-relaxed">Al completar los sellos, el cÃ³digo se pone dorado. Tu equipo lo escanea y entrega el premio al instante.</p>
                </div>

                <!-- Feature 4 -->
                <div class="reveal group glass rounded-2xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-violet-600 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-purple-500/20">
                        <i class="fas fa-ranking-star text-white text-lg"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">Clientes que vuelven mÃ¡s</h3>
                    <p class="text-white/40 text-sm leading-relaxed">Los clientes frecuentes ganan reconocimiento. Pueden guardar su bebida favorita y sentirse especiales.</p>
                </div>

                <!-- Feature 5 -->
                <div class="reveal group glass rounded-2xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-br from-pink-500 to-rose-600 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-pink-500/20">
                        <i class="fas fa-envelope-open-text text-white text-lg"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">EnviÃ¡ promos a tus clientes</h3>
                    <p class="text-white/40 text-sm leading-relaxed">EnviÃ¡ ofertas, novedades y flyers por email. Llega directo a quien ya te conoce.</p>
                </div>

                <!-- Feature 6 -->
                <div class="reveal group glass rounded-2xl p-6 hover:bg-white/10 transition-all">
                    <div class="w-12 h-12 bg-gradient-to-br from-cyan-500 to-teal-600 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform shadow-lg shadow-cyan-500/20">
                        <i class="fas fa-gear text-white text-lg"></i>
                    </div>
                    <h3 class="font-bold text-lg mb-2">100% tu marca</h3>
                    <p class="text-white/40 text-sm leading-relaxed">Cada cafÃ© tiene su propia app: tu logo, tus colores, tus reglas de sellos. Todo a tu medida.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== HOW IT WORKS ==================== -->
    <section id="how" class="py-20 sm:py-28 bg-white">
        <div class="max-w-6xl mx-auto px-4">
            <div class="text-center mb-16 reveal">
                <span class="text-mare-blue font-bold text-xs uppercase tracking-[0.2em]">Proceso</span>
                <h2 class="text-3xl sm:text-4xl font-black text-stone-900 mt-3">CÃ³mo funciona en 3 pasos</h2>
            </div>

            <div class="grid md:grid-cols-3 gap-8 lg:gap-12">
                <div class="reveal text-center group">
                    <div class="w-20 h-20 mx-auto bg-mare-blue/5 rounded-3xl flex items-center justify-center mb-6 group-hover:bg-mare-blue group-hover:text-white transition-all duration-300 border-2 border-mare-blue/10 group-hover:border-mare-blue">
                        <i class="fas fa-mobile-screen text-mare-blue text-2xl group-hover:text-white transition"></i>
                    </div>
                    <div class="text-mare-blue font-black text-5xl opacity-10 mb-2">01</div>
                    <h3 class="text-xl font-bold text-stone-900 mb-2">Cliente muestra QR</h3>
                    <p class="text-stone-500 text-sm leading-relaxed">Entra desde su celular, sin instalar nada. Su cÃ³digo Ãºnico aparece al instante.</p>
                </div>

                <div class="reveal text-center group" style="animation-delay: 0.2s">
                    <div class="w-20 h-20 mx-auto bg-mare-blue/5 rounded-3xl flex items-center justify-center mb-6 group-hover:bg-mare-blue group-hover:text-white transition-all duration-300 border-2 border-mare-blue/10 group-hover:border-mare-blue">
                        <i class="fas fa-barcode text-mare-blue text-2xl group-hover:text-white transition"></i>
                    </div>
                    <div class="text-mare-blue font-black text-5xl opacity-10 mb-2">02</div>
                    <h3 class="text-xl font-bold text-stone-900 mb-2">Staff escanea</h3>
                    <p class="text-stone-500 text-sm leading-relaxed">Tu equipo escanea en 2 segundos. El sistema suma el sello y evita usos indebidos automÃ¡ticamente.</p>
                </div>

                <div class="reveal text-center group" style="animation-delay: 0.4s">
                    <div class="w-20 h-20 mx-auto bg-mare-blue/5 rounded-3xl flex items-center justify-center mb-6 group-hover:bg-mare-blue group-hover:text-white transition-all duration-300 border-2 border-mare-blue/10 group-hover:border-mare-blue">
                        <i class="fas fa-gift text-mare-blue text-2xl group-hover:text-white transition"></i>
                    </div>
                    <div class="text-mare-blue font-black text-5xl opacity-10 mb-2">03</div>
                    <h3 class="text-xl font-bold text-stone-900 mb-2">Canjea premio</h3>
                    <p class="text-stone-500 text-sm leading-relaxed">Al completar 7 sellos, el QR se vuelve dorado. El staff lo escanea para canjear la bebida gratis.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== MARE CAFÃ‰ CASE STUDY ==================== -->
    <section class="py-20 sm:py-28 bg-stone-50 border-y border-stone-100">
        <div class="max-w-6xl mx-auto px-4">
            <div class="text-center mb-16 reveal">
                <span class="text-mare-blue font-bold text-xs uppercase tracking-[0.2em]">Cliente Destacado</span>
                <h2 class="text-3xl sm:text-4xl font-black text-stone-900 mt-3">Mare CafÃ©</h2>
                <p class="text-stone-500 mt-3 font-display text-lg italic">"PastelerÃ­a y CafÃ© de Especialidad"</p>
            </div>

            <div class="reveal bg-white rounded-3xl shadow-xl border border-stone-100 overflow-hidden">
                <div class="grid md:grid-cols-2">
                    <!-- Left: Info -->
                    <div class="p-8 sm:p-12 flex flex-col justify-center">
                        <div class="flex items-center gap-4 mb-8">
                            <img src="logo-mare.png" alt="Mare CafÃ©" class="w-24 h-24 rounded-full object-contain shadow-lg">
                            <div>
                                <h3 class="text-2xl font-bold text-stone-900">Mare Cafe</h3>
                                <p class="text-stone-400 text-sm">Mar del Plata, Argentina</p>
                            </div>
                        </div>

                        <div class="space-y-4 mb-8">
                            <div class="flex items-center gap-4">
                                <div class="w-14 h-14 rounded-full flex items-center justify-center shrink-0 overflow-hidden shadow-md">
                                    <img src="logo-mare.png" alt="Mare CafÃ©" class="w-full h-full object-contain">
                                </div>
                                <div>
                                    <p class="font-bold text-stone-800 text-sm">Branding Personalizado</p>
                                    <p class="text-xs text-stone-500">Tu logo y colores en toda la app</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-amber-100 rounded-full flex items-center justify-center shrink-0">
                                    <i class="fas fa-stamp text-amber-600"></i>
                                </div>
                                <div>
                                    <p class="font-bold text-stone-800 text-sm">7 sellos = 1 bebida gratis</p>
                                    <p class="text-xs text-stone-500">Programa de fidelidad flexible</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-emerald-100 rounded-full flex items-center justify-center shrink-0">
                                    <i class="fas fa-newspaper text-emerald-600"></i>
                                </div>
                                <div>
                                    <p class="font-bold text-stone-800 text-sm">News Feed Activo</p>
                                    <p class="text-xs text-stone-500">Promos y novedades para tus clientes</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-stone-50 rounded-2xl p-6 border border-stone-100">
                            <p class="text-xs text-stone-500 uppercase tracking-wider font-bold mb-4">Lo que incluye para tu negocio</p>
                            <ul class="space-y-3 text-sm text-stone-600">
                                <li class="flex items-center gap-2"><i class="fas fa-check text-emerald-500 w-4 shrink-0"></i> Tu logo y colores en la app</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check text-emerald-500 w-4 shrink-0"></i> Programa de sellos personalizado</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check text-emerald-500 w-4 shrink-0"></i> Link a tu menÃº o redes</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check text-emerald-500 w-4 shrink-0"></i> Noticias y promos para tus clientes</li>
                                <li class="flex items-center gap-2"><i class="fas fa-check text-emerald-500 w-4 shrink-0"></i> Soporte directo por WhatsApp</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Right: Stats Visual -->
                    <div class="bg-gradient-to-br from-mare-blue to-blue-900 p-8 sm:p-12 text-white flex flex-col justify-center">
                        <h4 class="text-white/60 text-xs uppercase tracking-widest font-bold mb-8">MÃ©tricas Proyectadas</h4>

                        <div class="grid grid-cols-2 gap-6">
                            <div class="bg-white/10 rounded-2xl p-5 backdrop-blur-sm">
                                <p class="text-3xl font-black">624</p>
                                <p class="text-white/50 text-xs mt-1">Clientes Registrados</p>
                            </div>
                            <div class="bg-white/10 rounded-2xl p-5 backdrop-blur-sm">
                                <p class="text-3xl font-black text-amber-300">~600</p>
                                <p class="text-white/50 text-xs mt-1">Ventas/Semana</p>
                            </div>
                            <div class="bg-white/10 rounded-2xl p-5 backdrop-blur-sm">
                                <p class="text-3xl font-black text-emerald-300">+24%</p>
                                <p class="text-white/50 text-xs mt-1">RetenciÃ³n</p>
                            </div>
                            <div class="bg-white/10 rounded-2xl p-5 backdrop-blur-sm">
                                <p class="text-3xl font-black">4.8x</p>
                                <p class="text-white/50 text-xs mt-1">ROI Estimado</p>
                            </div>
                        </div>

                        <div class="mt-8 bg-white/5 border border-white/10 rounded-xl p-4 flex items-center gap-3">
                            <div class="bg-amber-500 text-black px-2 py-0.5 rounded text-[10px] font-black uppercase">Live</div>
                            <p class="text-white/60 text-xs">Tu app siempre disponible, datos seguros y respaldo en la nube</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== ROADMAP ==================== -->
    <section id="roadmap" class="py-20 sm:py-28 bg-white">
        <div class="max-w-5xl mx-auto px-4">
            <div class="text-center mb-16 reveal">
                <span class="text-mare-blue font-bold text-xs uppercase tracking-[0.2em]">EvoluciÃ³n</span>
                <h2 class="text-3xl sm:text-4xl font-black text-stone-900 mt-3">Roadmap del Producto</h2>
            </div>

            <div class="space-y-0 reveal">
                <!-- Phase 1 -->
                <div class="flex gap-6 items-start pb-12 relative">
                    <div class="flex flex-col items-center shrink-0">
                        <div class="w-12 h-12 bg-emerald-500 rounded-2xl flex items-center justify-center text-white font-bold shadow-lg shadow-emerald-500/30">
                            <i class="fas fa-check"></i>
                        </div>
                        <div class="w-0.5 h-full bg-stone-200 mt-3"></div>
                    </div>
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <h4 class="font-bold text-lg text-stone-900">Fase 1 â€” MVP</h4>
                            <span class="text-[10px] font-bold bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full uppercase">Completado</span>
                        </div>
                        <p class="text-stone-500 text-sm">Tarjeta digital, escaneo QR, sistema de sellos, panel admin, sistema anti-fraude con cooldown 24hs, PWA.</p>
                    </div>
                </div>

                <!-- Phase 2 -->
                <div class="flex gap-6 items-start pb-12 relative">
                    <div class="flex flex-col items-center shrink-0">
                        <div class="w-12 h-12 bg-mare-blue rounded-2xl flex items-center justify-center text-white font-bold shadow-lg shadow-mare-blue/30 animate-pulse">
                            <i class="fas fa-code"></i>
                        </div>
                        <div class="w-0.5 h-full bg-stone-200 mt-3"></div>
                    </div>
                    <div>
                        <div class="flex items-center gap-2 mb-1">
                            <h4 class="font-bold text-lg text-stone-900">Fase 2 â€” GamificaciÃ³n & Marketing</h4>
                            <span class="text-[10px] font-bold bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full uppercase">En Desarrollo</span>
                        </div>
                        <p class="text-stone-500 text-sm">Niveles de cliente, campaÃ±as por email, editor de flyers, segmentaciÃ³n por nivel, news feed in-app.</p>
                    </div>
                </div>

                <!-- Phase 3 -->
                <div class="flex gap-6 items-start pb-12 relative">
                    <div class="flex flex-col items-center shrink-0">
                        <div class="w-12 h-12 bg-stone-200 rounded-2xl flex items-center justify-center text-stone-400 font-bold">
                            <i class="fas fa-rocket"></i>
                        </div>
                        <div class="w-0.5 h-full bg-stone-200 mt-3"></div>
                    </div>
                    <div>
                        <h4 class="font-bold text-lg text-stone-900 mb-1">Fase 3 â€” Escala</h4>
                        <p class="text-stone-500 text-sm">Dashboard de analytics avanzado, integraciÃ³n con POS, white-label para mÃºltiples cafÃ©s, notificaciones push.</p>
                    </div>
                </div>

                <!-- Phase 4 -->
                <div class="flex gap-6 items-start">
                    <div class="flex flex-col items-center shrink-0">
                        <div class="w-12 h-12 bg-stone-200 rounded-2xl flex items-center justify-center text-stone-400 font-bold">
                            <i class="fas fa-globe"></i>
                        </div>
                    </div>
                    <div>
                        <h4 class="font-bold text-lg text-stone-900 mb-1">Fase 4 â€” Marketplace</h4>
                        <p class="text-stone-500 text-sm">Red de cafeterÃ­as conectada, rewards cruzados entre locales, app unificada "Ruta del CafÃ©" de Mar del Plata.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== ABOUT BRANDIA ==================== -->
    <section id="brandia" class="py-20 sm:py-28 bg-stone-100 text-stone-900 relative overflow-hidden">
        <!-- Background Effects -->
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] bg-amber-500/10 rounded-full blur-[150px]"></div>
            <div class="absolute inset-0 opacity-[0.03]" style="background-image: radial-gradient(circle, #78716c 1px, transparent 1px); background-size: 40px 40px;"></div>
        </div>

        <div class="max-w-6xl mx-auto px-4 relative z-10">
            <!-- Header with Logo -->
            <div class="text-center mb-16 reveal">
                <div class="inline-block mb-8 bg-white rounded-3xl p-8 sm:p-12 shadow-xl border border-stone-200">
                    <img src="Logo vectorizado.png" alt="BRANDIA" class="w-[180px] h-[180px] sm:w-[260px] sm:h-[260px] object-contain mx-auto">
                </div>
                <h2 class="text-3xl sm:text-4xl lg:text-5xl font-black tracking-tight text-stone-900">
                    DetrÃ¡s del proyecto:
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-amber-500 via-yellow-500 to-amber-600">BRAND IA</span>
                </h2>
                <p class="text-stone-500 mt-4 max-w-2xl mx-auto text-base sm:text-lg leading-relaxed">
                    BRANDIA es nuestra firma de tecnologÃ­a y diseÃ±o. Creamos soluciones digitales que combinan <strong class="text-stone-800">inteligencia artificial</strong>, branding estratÃ©gico y desarrollo full-stack para negocios locales.
                </p>
            </div>

            <!-- Brand Showcase Grid -->
            <div class="grid md:grid-cols-2 gap-8 mb-16 reveal">
                <!-- Post 1: Brand Grids -->
                <div class="group relative rounded-3xl overflow-hidden border border-stone-200 shadow-lg hover:border-amber-500/50 hover:shadow-xl transition-all duration-500 bg-white">
                    <img src="BRANDIA POST 1.png" alt="BRANDIA - Brand Grids & Visual Hierarchy" class="w-full h-auto object-cover group-hover:scale-105 transition-transform duration-700">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
                    <div class="absolute bottom-0 left-0 right-0 p-6">
                        <p class="text-amber-400 text-xs font-bold uppercase tracking-widest mb-1">Identidad Visual</p>
                        <p class="text-white font-bold text-lg">Brand Grids & Visual Hierarchy</p>
                        <p class="text-white/50 text-sm mt-1">Cada proyecto BRANDIA nace desde una grilla tipogrÃ¡fica y un sistema de diseÃ±o propio.</p>
                    </div>
                </div>

                <!-- Post 2: Full Ecosystem -->
                <div class="group relative rounded-3xl overflow-hidden border border-stone-200 shadow-lg hover:border-amber-500/50 hover:shadow-xl transition-all duration-500 bg-white">
                    <img src="BRANDIA POST 2.png" alt="BRANDIA - Ecosistema Digital Completo" class="w-full h-auto object-cover group-hover:scale-105 transition-transform duration-700">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
                    <div class="absolute bottom-0 left-0 right-0 p-6">
                        <p class="text-amber-400 text-xs font-bold uppercase tracking-widest mb-1">Ecosistema Digital</p>
                        <p class="text-white font-bold text-lg">Web + App + Brandbook</p>
                        <p class="text-white/50 text-sm mt-1">Entregamos presencia completa: web responsive, app mÃ³vil, redes sociales y manual de marca.</p>
                    </div>
                </div>
            </div>

            <!-- BRANDIA Capabilities -->
            <div class="reveal grid sm:grid-cols-3 gap-6 mb-12">
                <div class="bg-white border border-stone-200 rounded-2xl p-6 text-center hover:border-amber-500/40 hover:shadow-lg transition shadow-sm">
                    <div class="w-14 h-14 mx-auto bg-gradient-to-br from-amber-400 to-orange-500 rounded-2xl flex items-center justify-center mb-4 shadow-lg shadow-amber-500/20">
                        <i class="fas fa-wand-magic-sparkles text-white text-xl"></i>
                    </div>
                    <h4 class="font-bold text-stone-900 mb-2">Branding + IA</h4>
                    <p class="text-stone-500 text-sm">DiseÃ±o de marca potenciado con herramientas de inteligencia artificial para resultados profesionales.</p>
                </div>
                <div class="bg-white border border-stone-200 rounded-2xl p-6 text-center hover:border-mare-blue/40 hover:shadow-lg transition shadow-sm">
                    <div class="w-14 h-14 mx-auto bg-gradient-to-br from-mare-blue to-blue-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg shadow-blue-500/20">
                        <i class="fas fa-code text-white text-xl"></i>
                    </div>
                    <h4 class="font-bold text-stone-900 mb-2">Desarrollo Full-Stack</h4>
                    <p class="text-stone-500 text-sm">Apps hechas a medida para tu negocio, no plantillas genÃ©ricas.</p>
                </div>
                <div class="bg-white border border-stone-200 rounded-2xl p-6 text-center hover:border-emerald-500/40 hover:shadow-lg transition shadow-sm">
                    <div class="w-14 h-14 mx-auto bg-gradient-to-br from-emerald-400 to-green-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg shadow-emerald-500/20">
                        <i class="fas fa-store text-white text-xl"></i>
                    </div>
                    <h4 class="font-bold text-stone-900 mb-2">Foco en Comercio Local</h4>
                    <p class="text-stone-500 text-sm">Entendemos al dueÃ±o de cafÃ© que necesita resultados, no tecnologÃ­a compleja.</p>
                </div>
            </div>

            <!-- Brand Statement -->
            <div class="reveal text-center">
                <div class="inline-flex items-center gap-6 bg-white border border-stone-200 rounded-3xl px-12 py-8 shadow-xl">
                    <img src="Logo vectorizado.png" alt="BRANDIA" class="h-20 w-20 sm:h-24 sm:w-24 object-contain">
                    <div class="text-left">
                        <p class="text-stone-900 font-bold text-lg sm:text-xl">BRAND<span class="text-amber-500">IA</span></p>
                        <p class="text-stone-500 text-sm sm:text-base">Donde la marca se encuentra con la inteligencia artificial.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== CTA / CONTACT ==================== -->
    <section id="contact" class="py-20 sm:py-28 bg-gradient-to-br from-slate-950 via-mare-blue to-blue-900 text-white relative overflow-hidden">
        <div class="absolute inset-0 overflow-hidden pointer-events-none">
            <div class="absolute top-0 right-0 w-96 h-96 bg-amber-500/10 rounded-full blur-[150px]"></div>
            <div class="absolute bottom-0 left-0 w-80 h-80 bg-blue-400/10 rounded-full blur-[120px]"></div>
        </div>

        <div class="max-w-3xl mx-auto px-4 text-center relative z-10">
            <div class="reveal">
                <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/5 border border-white/10 text-xs font-semibold text-white/60 mb-8">
                    <span class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></span>
                    PRIMEROS 5 CLIENTES â€” CONDICIONES ESPECIALES
                </div>

                <h2 class="text-4xl sm:text-5xl font-black mb-6 tracking-tight">
                    Â¿QuerÃ©s esto para
                    <span class="text-transparent bg-clip-text bg-gradient-to-r from-amber-300 to-orange-400">tu cafÃ©</span>?
                </h2>
                <p class="text-white/40 text-lg mb-10 max-w-xl mx-auto">
                    Primer mes de prueba gratis. Setup sin cargo. Soporte directo por WhatsApp. Sin permanencia.
                </p>

                <div class="flex flex-col sm:flex-row gap-4 justify-center mb-12">
                    <a href="https://wa.me/5491171189084" class="px-8 py-4 bg-emerald-500 text-white rounded-2xl font-bold text-base hover:bg-emerald-600 transition-all shadow-xl shadow-emerald-500/20 flex items-center justify-center gap-3">
                        <i class="fab fa-whatsapp text-xl"></i>
                        Agendar Demo Gratis
                    </a>
                    <a href="https://linktr.ee/brandia.lat" target="_blank" class="px-8 py-4 border border-white/15 text-white/70 rounded-2xl font-bold hover:bg-white/5 transition-all flex items-center justify-center gap-2">
                        <i class="fas fa-link"></i>
                        Linktree
                    </a>
                </div>

                <!-- Offer Grid -->
                <div class="grid sm:grid-cols-2 gap-3 max-w-lg mx-auto">
                    <div class="glass rounded-xl p-4 flex items-center gap-3 text-left">
                        <i class="fas fa-gift text-amber-400"></i>
                        <span class="text-sm text-white/70">Primer mes de prueba gratis</span>
                    </div>
                    <div class="glass rounded-xl p-4 flex items-center gap-3 text-left">
                        <i class="fas fa-tools text-blue-400"></i>
                        <span class="text-sm text-white/70">Setup sin cargo</span>
                    </div>
                    <div class="glass rounded-xl p-4 flex items-center gap-3 text-left">
                        <i class="fas fa-headset text-emerald-400"></i>
                        <span class="text-sm text-white/70">Actualizaciones y mejoras sin costo</span>
                    </div>
                    <div class="glass rounded-xl p-4 flex items-center gap-3 text-left">
                        <i class="fas fa-bullhorn text-pink-400"></i>
                        <span class="text-sm text-white/70">Post de lanzamiento</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ==================== FOOTER ==================== -->
    <footer class="bg-[#0A0A0A] text-white/40 py-12 px-4">
        <div class="max-w-6xl mx-auto">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6 pb-8 border-b border-white/5">
                <div class="flex items-center gap-4">
                    <div class="bg-white rounded-2xl p-2.5 shadow-lg">
                        <img src="Logo vectorizado.png" alt="BRANDIA" class="h-14 w-14 sm:h-16 sm:w-16 object-contain">
                    </div>
                    <span class="font-bold text-white text-xl sm:text-2xl tracking-tight">BRAND<span class="text-amber-400">IA</span></span>
                </div>
                <div class="flex items-center gap-6 text-xs">
                    <a href="#" class="hover:text-white transition">Instagram</a>
                    <a href="#" class="hover:text-white transition">LinkedIn</a>
                    <a href="#" class="hover:text-white transition">GitHub</a>
                </div>
            </div>

            <div class="flex flex-col md:flex-row justify-between items-center gap-4 pt-8 text-xs">
                <p>
                    &copy; 2026 BRANDIA. FidelizaciÃ³n Digital para CafeterÃ­as. Mar del Plata, Argentina.
                </p>
                <p>
                    Developed by <strong class="text-white/60">Ariel Emiliano Jimenez</strong>
                </p>
            </div>
        </div>
    </footer>

    <!-- ==================== JAVASCRIPT ==================== -->
    <script>
    // ============================================================
    // STATE
    // ============================================================
    const APP = {
        currentView: 'landing',
        stamps: 3,
        maxStamps: 7,
        userName: 'Laura',
        level: 1,
        goldMode: false,
        scanCount: 12,
        totalClients: 624,
        todayScans: 48,
    };

    // ============================================================
    // NAVIGATION
    // ============================================================
    function toggleMobileMenu() {
        const menu = document.getElementById('mobile-menu');
        const overlay = document.getElementById('mobile-menu-overlay');
        menu.classList.toggle('open');
        overlay.classList.toggle('open');
        document.body.classList.toggle('overflow-hidden', menu.classList.contains('open'));
    }

    // Navbar scroll effect
    window.addEventListener('scroll', () => {
        const nav = document.getElementById('navbar');
        if (window.scrollY > 50) {
            nav.classList.add('bg-white/95', 'backdrop-blur-md', 'shadow-sm', 'border-b', 'border-stone-100');
            nav.classList.remove('bg-white/0');
        } else {
            nav.classList.remove('bg-white/95', 'backdrop-blur-md', 'shadow-sm', 'border-b', 'border-stone-100');
            nav.classList.add('bg-white/0');
        }
    });

    // ============================================================
    // SCROLL REVEAL
    // ============================================================
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('visible');
            }
        });
    }, { threshold: 0.1 });

    document.querySelectorAll('.reveal').forEach(el => observer.observe(el));

    // ============================================================
    // PHONE SIMULATOR
    // ============================================================
    const VIEWS = {
        landing: {
            title: 'Pantalla de Inicio',
            desc: 'Esta es la pantalla que ve el usuario al entrar por primera vez. Puede elegir "Soy Cliente" para acceder a su tarjeta de fidelidad, o "Acceso Staff" si es empleado del local.'
        },
        client: {
            title: 'Dashboard del Cliente',
            desc: 'El cliente ve su cÃ³digo QR Ãºnico, el progreso de sellos, y puede canjear su premio cuando completa los 7 sellos. TocÃ¡ "Sumar Sello" para simular un escaneo.'
        },
        staff: {
            title: 'Portal del Staff',
            desc: 'El barista usa esta vista para escanear los QR de los clientes. Incluye contador de escaneos del dÃ­a y botÃ³n de escÃ¡ner con cÃ¡mara.'
        },
        admin: {
            title: 'Panel de AdministraciÃ³n',
            desc: 'El dueÃ±o del cafÃ© ve mÃ©tricas en tiempo real: clientes totales, escaneos del dÃ­a, campaÃ±as de marketing y configuraciÃ³n del programa.'
        }
    };

    function phoneNavigate(view) {
        APP.currentView = view;
        APP.goldMode = false;

        // Update info panel
        document.getElementById('demo-info-title').textContent = VIEWS[view].title;
        document.getElementById('demo-info-desc').textContent = VIEWS[view].desc;

        // Highlight active btn
        document.querySelectorAll('.demo-btn').forEach(b => b.classList.remove('border-mare-blue', 'bg-mare-blue/5'));
        const btns = document.querySelectorAll('.demo-btn');
        const idx = ['landing','client','staff','admin'].indexOf(view);
        if (btns[idx]) { btns[idx].classList.add('border-mare-blue', 'bg-mare-blue/5'); }

        // Render
        renderPhone();
    }

    function renderPhone() {
        const screen = document.getElementById('phone-screen');
        screen.style.opacity = '0';
        screen.style.transform = 'scale(0.95)';

        setTimeout(() => {
            switch(APP.currentView) {
                case 'landing': screen.innerHTML = renderLanding(); break;
                case 'client': screen.innerHTML = renderClient(); break;
                case 'staff': screen.innerHTML = renderStaff(); break;
                case 'admin': screen.innerHTML = renderAdmin(); break;
            }
            screen.style.transition = 'all 0.35s cubic-bezier(0.4,0,0.2,1)';
            screen.style.opacity = '1';
            screen.style.transform = 'scale(1)';
        }, 150);
    }

    // --- LANDING SCREEN ---
    function renderLanding() {
        return `
            <div class="h-full flex flex-col items-center justify-center p-6 text-center" style="background-color: #1E3A8A;">
                <div class="pt-6"></div>
                <img src="logo-mare.png" alt="Mare" class="w-32 h-32 object-contain mb-4 rounded-full shadow-xl" />
                <h2 class="text-xl font-bold text-white" style="font-family:'Playfair Display',serif">Mare Cafe</h2>
                <p class="text-white/50 text-xs mt-1">PastelerÃ­a y CafÃ© de Especialidad</p>
                <div class="mt-8 w-full space-y-3 px-4">
                    <button onclick="phoneNavigate('client')" class="w-full bg-white text-[#1E3A8A] py-3 rounded-full font-bold text-sm flex items-center justify-center gap-2 hover:bg-stone-100 transition active:scale-95">
                        <i class="fas fa-user"></i> Soy Cliente
                    </button>
                    <button onclick="phoneNavigate('staff')" class="w-full text-white/40 text-xs py-2 hover:text-white/60 transition">
                        <i class="fas fa-store"></i> Acceso Staff
                    </button>
                </div>
                <div class="mt-auto pb-4 text-[8px] text-white/20 tracking-widest uppercase">
                    Desarrollado por <b class="text-white/40">BRANDIA</b>
                </div>
            </div>
        `;
    }

    // --- CLIENT SCREEN ---
    function renderClient() {
        const isReward = APP.stamps >= APP.maxStamps;
        const bgColor = APP.goldMode ? '#000' : '#F5F5DC';
        const textColor = APP.goldMode ? '#F59E0B' : '#1E3A8A';
        const progress = Math.min((APP.stamps / APP.maxStamps) * 100, 100);

        let stampsHTML = '';
        for (let i = 0; i < APP.maxStamps; i++) {
            if (i < APP.stamps) {
                stampsHTML += `<div class="stamp-circle stamp-filled"><i class="fas fa-check text-[8px]"></i></div>`;
            } else {
                stampsHTML += `<div class="stamp-circle stamp-empty">${i+1}</div>`;
            }
        }

        const headerBg = APP.goldMode ? 'background:#000;color:#F59E0B' : 'background:white';
        const qrBorderColor = APP.goldMode ? '#FFF' : '#1E3A8A';
        const qrBg = APP.goldMode ? 'background:linear-gradient(135deg,#F59E0B,#D97706);' : 'background:white;';

        return `
            <div class="h-full flex flex-col phone-scroll overflow-y-auto" style="background:${bgColor}; color:${textColor}">
                <!-- Header -->
                <div class="sticky top-0 z-10 px-4 py-3 flex items-center justify-between shadow-sm" style="${headerBg}">
                    <button onclick="phoneNavigate('landing')" class="opacity-50 hover:opacity-100 transition text-xs">
                        <i class="fas fa-arrow-left"></i>
                    </button>
                    <img src="logo-mare.png" alt="Mare" class="h-8 w-8 rounded-full object-cover" />
                    <div class="text-[10px] opacity-40"><i class="fas fa-sign-out-alt"></i></div>
                </div>

                <div class="flex-1 p-4 space-y-4 pt-2">
                    <!-- Welcome -->
                    <div class="text-center pt-2">
                        ${APP.goldMode ?
                            `<h3 class="text-lg font-bold animate-pulse">Momento MÃ¡gico! âœ¨</h3>
                             <p class="text-xs opacity-60">MostrÃ¡ este cÃ³digo al barista</p>` :
                            `<h3 class="text-lg font-bold">Hola, ${APP.userName} ðŸ‘‹</h3>
                             <p class="text-xs opacity-60">PastelerÃ­a y CafÃ© de Especialidad</p>`
                        }
                    </div>

                    <!-- QR Card -->
                    <div class="rounded-2xl p-5 flex flex-col items-center shadow-lg border transition-all" style="${qrBg} border-color:${qrBorderColor}20">
                        <p class="font-bold text-xs mb-1" style="color:${APP.goldMode ? '#000' : '#1E3A8A'}">
                            ${APP.goldMode ? 'CANJE DE PREMIO' : 'Tu Tarjeta de Fidelidad'}
                        </p>
                        <p class="text-[10px] opacity-40 mb-3">${APP.goldMode ? 'VÃ¡lido por 1 Bebida Gratis' : 'EscaneÃ¡ esto en caja'}</p>

                        <!-- Fake QR -->
                        <div class="w-32 h-32 rounded-xl border-4 flex items-center justify-center relative" style="border-color:${qrBorderColor}">
                            <div class="grid grid-cols-7 gap-[2px]">
                                ${generateFakeQR()}
                            </div>
                            ${APP.goldMode ? `<div class="absolute inset-0 flex items-center justify-center opacity-30"><i class="fas fa-gift text-4xl text-amber-700"></i></div>` : ''}
                        </div>
                    </div>

                    ${isReward && !APP.goldMode ? `
                        <button onclick="activateGoldMode()" class="w-full py-3 bg-gradient-to-r from-orange-400 to-orange-600 text-white rounded-xl font-bold text-sm shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2 active:scale-95" style="animation:gold-pulse 2s infinite">
                            <i class="fas fa-gift"></i> RECLAMAR MI PREMIO
                        </button>
                    ` : ''}

                    ${!APP.goldMode ? `
                    <!-- Stamps Section -->
                    <div class="bg-white rounded-2xl p-4 shadow border border-stone-100">
                        <h4 class="font-bold text-sm flex items-center gap-2 mb-3" style="color:#1E3A8A">
                            <i class="fas fa-gift text-orange-500"></i> Tus Recompensas
                        </h4>
                        <div class="flex items-center gap-3 bg-stone-50 p-3 rounded-xl">
                            <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-coffee text-orange-500"></i>
                            </div>
                            <div>
                                <p class="font-bold text-xl" style="color:#1E3A8A">${APP.stamps} <span class="text-xs font-normal text-stone-400">/ ${APP.maxStamps}</span></p>
                                <p class="text-[10px] text-stone-400">Sellos acumulados</p>
                            </div>
                        </div>
                        <!-- Progress Bar -->
                        <div class="mt-3 w-full bg-stone-100 rounded-full h-2">
                            <div class="bg-orange-500 h-2 rounded-full transition-all duration-700" style="width:${progress}%"></div>
                        </div>
                        <p class="text-[10px] text-center mt-1.5 text-stone-400">
                            ${isReward ? 'Â¡TenÃ©s una bebida gratis disponible!' : `Faltan ${APP.maxStamps - APP.stamps} sellos para tu premio.`}
                        </p>

                        <!-- Stamp Circles -->
                        <div class="flex justify-center gap-2 mt-4 flex-wrap">
                            ${stampsHTML}
                        </div>
                    </div>

                    <!-- Menu Button -->
                    <button class="w-full py-2.5 bg-slate-900 text-white text-xs font-bold rounded-xl flex items-center justify-center gap-2">
                        <i class="fas fa-coffee"></i> Ver Nuestro MenÃº
                    </button>
                    ` : `
                    <!-- Gold Mode Info -->
                    <div class="text-center p-4 bg-amber-500/10 rounded-xl border border-amber-500/20">
                        <p class="text-amber-300 text-xs font-bold">El staff escanearÃ¡ tu QR dorado</p>
                        <button onclick="redeemReward()" class="mt-3 text-xs underline opacity-60 hover:opacity-100">Simular Canje</button>
                    </div>
                    `}
                </div>

                <!-- Bottom branding -->
                <div class="text-center py-2 text-[8px] opacity-30">Powered by BRANDIA</div>
            </div>
        `;
    }

    // --- STAFF SCREEN ---
    function renderStaff() {
        return `
            <div class="h-full flex flex-col bg-stone-50">
                <!-- Nav -->
                <div class="bg-white px-4 py-3 flex items-center justify-between shadow-sm">
                    <div class="flex items-center gap-2">
                        <img src="logo-mare.png" alt="Mare" class="h-8 w-8 rounded-full object-cover" />
                        <span class="font-bold text-stone-800 text-sm">Staff Portal</span>
                    </div>
                    <button onclick="phoneNavigate('landing')" class="text-xs text-stone-400">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>

                <div class="flex-1 p-4 pt-6 space-y-4 phone-scroll overflow-y-auto">
                    <!-- Stats -->
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-100">
                            <p class="text-stone-400 text-[10px] font-bold uppercase">Escaneos Hoy</p>
                            <p class="text-2xl font-black text-stone-800 mt-1">${APP.todayScans}</p>
                        </div>
                        <button onclick="simulateScan()" class="p-4 rounded-xl text-white text-left flex flex-col justify-between hover:shadow-lg transition active:scale-95" style="background:#1E3A8A">
                            <p class="text-white/80 text-[10px] font-bold">Escanear</p>
                            <div class="flex items-center justify-between mt-2">
                                <p class="text-xs text-white/60">CÃ¡mara</p>
                                <i class="fas fa-qrcode text-xl opacity-60"></i>
                            </div>
                        </button>
                    </div>

                    <!-- Scanner Simulation -->
                    <div class="bg-white rounded-xl shadow-sm border border-stone-100 overflow-hidden">
                        <div class="bg-black aspect-video flex items-center justify-center relative">
                            <div class="w-32 h-32 border-2 border-white/30 rounded-xl"></div>
                            <div class="absolute inset-0 flex items-center justify-center">
                                <div class="w-40 h-0.5 bg-red-500/60 animate-pulse"></div>
                            </div>
                            <p class="absolute bottom-3 text-white/40 text-[10px]">ApuntÃ¡ la cÃ¡mara al QR del cliente</p>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="bg-white rounded-xl p-4 shadow-sm border border-stone-100">
                        <h4 class="font-bold text-xs text-stone-800 mb-3">
                            <i class="fas fa-clock text-stone-400"></i> Actividad Reciente
                        </h4>
                        <div class="space-y-2" id="staff-activity">
                            <div class="flex items-center gap-2 text-[10px] text-stone-400 py-2 border-b border-stone-50">
                                <i class="fas fa-check-circle text-emerald-500"></i>
                                <span>Sello agregado â€” Laura M. (hace 3 min)</span>
                            </div>
                            <div class="flex items-center gap-2 text-[10px] text-stone-400 py-2 border-b border-stone-50">
                                <i class="fas fa-gift text-amber-500"></i>
                                <span>Canje procesado â€” Carlos R. (hace 15 min)</span>
                            </div>
                            <div class="flex items-center gap-2 text-[10px] text-stone-400 py-2">
                                <i class="fas fa-check-circle text-emerald-500"></i>
                                <span>Sello agregado â€” MarÃ­a G. (hace 22 min)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Admin Link -->
                    <button onclick="phoneNavigate('admin')" class="w-full text-xs text-mare-blue font-bold bg-blue-50 py-2 rounded-lg hover:bg-blue-100 transition">
                        <i class="fas fa-arrow-right"></i> Ir al Panel Admin
                    </button>
                </div>
            </div>
        `;
    }

    // --- ADMIN SCREEN ---
    function renderAdmin() {
        return `
            <div class="h-full flex flex-col bg-stone-50">
                <!-- Nav -->
                <div class="bg-white px-4 py-3 flex items-center justify-between shadow-sm">
                    <div class="flex items-center gap-2">
                        <img src="logo-mare.png" alt="Mare" class="h-6 w-6 rounded-full object-cover" />
                        <span class="font-bold text-stone-800 text-xs">Admin Panel</span>
                    </div>
                    <button onclick="phoneNavigate('landing')" class="text-[10px] text-stone-400 font-medium">
                        Cerrar
                    </button>
                </div>

                <div class="flex-1 p-4 pt-4 space-y-4 phone-scroll overflow-y-auto">
                    <!-- Metric Cards -->
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-white p-3 rounded-xl shadow-sm border border-stone-100">
                            <div class="flex items-center gap-1.5 mb-1">
                                <i class="fas fa-users text-mare-blue text-[10px]"></i>
                                <p class="text-[10px] text-stone-400 font-medium">Clientes</p>
                            </div>
                            <p class="text-xl font-black text-stone-800">${APP.totalClients}</p>
                        </div>
                        <div class="bg-white p-3 rounded-xl shadow-sm border border-stone-100">
                            <div class="flex items-center gap-1.5 mb-1">
                                <i class="fas fa-barcode text-emerald-500 text-[10px]"></i>
                                <p class="text-[10px] text-stone-400 font-medium">Escaneos Hoy</p>
                            </div>
                            <p class="text-xl font-black text-emerald-600">${APP.todayScans}</p>
                        </div>
                        <div class="bg-white p-3 rounded-xl shadow-sm border border-stone-100">
                            <div class="flex items-center gap-1.5 mb-1">
                                <i class="fas fa-gift text-amber-500 text-[10px]"></i>
                                <p class="text-[10px] text-stone-400 font-medium">Canjes Mes</p>
                            </div>
                            <p class="text-xl font-black text-amber-600">18</p>
                        </div>
                        <div class="bg-white p-3 rounded-xl shadow-sm border border-stone-100">
                            <div class="flex items-center gap-1.5 mb-1">
                                <i class="fas fa-chart-line text-purple-500 text-[10px]"></i>
                                <p class="text-[10px] text-stone-400 font-medium">RetenciÃ³n</p>
                            </div>
                            <p class="text-xl font-black text-purple-600">+24%</p>
                        </div>
                    </div>

                    <!-- Chart Simulation -->
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-100">
                        <h4 class="font-bold text-xs text-stone-800 mb-3">Escaneos (7 dÃ­as)</h4>
                        <div class="flex items-end gap-1.5 h-20">
                            ${[35,42,28,55,48,62,45].map((v,i) => `
                                <div class="flex-1 rounded-t" style="height:${v}%;background:${i===5?'#1E3A8A':'#E5E7EB'};transition:all 0.5s;transition-delay:${i*0.1}s"></div>
                            `).join('')}
                        </div>
                        <div class="flex justify-between mt-1 text-[8px] text-stone-300">
                            <span>Lun</span><span>Mar</span><span>MiÃ©</span><span>Jue</span><span>Vie</span><span>SÃ¡b</span><span>Dom</span>
                        </div>
                    </div>

                    <!-- Recent Campaign -->
                    <div class="bg-white p-4 rounded-xl shadow-sm border border-stone-100">
                        <h4 class="font-bold text-xs text-stone-800 mb-3">
                            <i class="fas fa-bullhorn text-stone-400"></i> CampaÃ±as
                        </h4>
                        <div class="bg-mare-blue/5 p-3 rounded-lg border border-mare-blue/10 flex items-center gap-3">
                            <div class="bg-mare-blue text-white px-2 py-0.5 rounded text-[8px] font-bold shrink-0">ACTIVA</div>
                            <div>
                                <p class="text-xs font-bold text-stone-700">"Lluvia y CafÃ©"</p>
                                <p class="text-[10px] text-stone-400">Enviada a 150 clientes</p>
                            </div>
                        </div>
                    </div>

                    <!-- Config Preview -->
                    <div class="bg-stone-800 p-3 rounded-xl text-[9px] text-stone-300 overflow-x-auto">
                        <div class="flex items-center gap-2">
                            <i class="fas fa-check-circle text-emerald-400"></i>
                            <span>7 sellos = 1 premio Â· News feed activo Â· Colores personalizados</span>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    // ============================================================
    // DEMO ACTIONS
    // ============================================================
    function addDemoStamp() {
        if (APP.currentView !== 'client') {
            phoneNavigate('client');
            setTimeout(addDemoStamp, 500);
            return;
        }

        if (APP.stamps < APP.maxStamps) {
            APP.stamps++;
            APP.todayScans++;
            renderPhone();
        } else {
            // Already full
            if (!APP.goldMode) {
                activateGoldMode();
            }
        }
    }

    function activateGoldMode() {
        APP.goldMode = true;
        renderPhone();
    }

    function redeemReward() {
        APP.stamps = 0;
        APP.level++;
        APP.goldMode = false;
        renderPhone();

        // Brief celebration
        setTimeout(() => {
            const screen = document.getElementById('phone-screen');
            const overlay = document.createElement('div');
            overlay.className = 'absolute inset-0 bg-black/80 flex items-center justify-center z-50 animate-fade-in';
            overlay.innerHTML = `
                <div class="text-center p-6 bg-white rounded-2xl mx-4 shadow-2xl">
                    <div class="text-4xl mb-3">ðŸŽ‰</div>
                    <h3 class="text-lg font-bold text-stone-800">Â¡Nivel ${APP.level}!</h3>
                    <p class="text-xs text-stone-400 mt-1">Se restaron 7 sellos. Â¡Gracias por elegirnos!</p>
                    <button onclick="this.closest('.absolute').remove()" class="mt-4 px-6 py-2 bg-black text-white rounded-xl text-xs font-bold">Continuar</button>
                </div>
            `;
            screen.style.position = 'relative';
            screen.appendChild(overlay);
        }, 300);
    }

    function simulateScan() {
        APP.todayScans++;
        const activity = document.getElementById('staff-activity');
        if (activity) {
            const names = ['Ana P.', 'Marco T.', 'Julia S.', 'Pedro L.', 'Sofia D.'];
            const name = names[Math.floor(Math.random() * names.length)];
            const newEntry = document.createElement('div');
            newEntry.className = 'flex items-center gap-2 text-[10px] text-stone-400 py-2 border-b border-stone-50 animate-fade-in';
            newEntry.innerHTML = `<i class="fas fa-check-circle text-emerald-500"></i><span>Sello agregado â€” ${name} (ahora)</span>`;
            activity.insertBefore(newEntry, activity.firstChild);
        }
    }

    // ============================================================
    // HELPERS
    // ============================================================
    function generateFakeQR() {
        let html = '';
        const pattern = [
            1,1,1,1,1,1,1, 1,0,1,0,1,0,1, 1,1,1,1,1,1,1,
            1,0,0,0,0,0,1, 0,1,0,1,0,1,0, 1,0,0,0,0,0,1,
            1,0,1,1,1,0,1, 1,0,1,1,0,0,1, 1,0,1,1,1,0,1,
            0,0,0,0,0,0,0, 1,1,0,1,0,1,0, 0,0,0,0,0,0,0,
            1,1,1,0,1,0,1, 0,0,1,0,1,0,1, 1,0,0,1,0,1,0,
            1,0,0,0,0,0,1, 0,1,0,0,1,0,0, 0,1,1,0,1,0,1,
            1,1,1,1,1,1,1, 0,1,0,1,0,1,0, 1,1,1,1,1,1,1
        ];
        for (let i = 0; i < 49; i++) {
            const filled = pattern[i % pattern.length];
            const color = APP.goldMode ? (filled ? '#92400E' : '#FDE68A') : (filled ? '#1E3A8A' : '#E5E7EB');
            html += `<div style="width:3px;height:3px;background:${color};border-radius:0.5px"></div>`;
        }
        return html;
    }

    // ============================================================
    // INIT
    // ============================================================
    document.addEventListener('DOMContentLoaded', () => {
        phoneNavigate('landing');

        // Mark first button as active
        const btns = document.querySelectorAll('.demo-btn');
        if (btns[0]) btns[0].classList.add('border-mare-blue', 'bg-mare-blue/5');
    });

    // Close mobile menu on outside click
    document.addEventListener('click', (e) => {
        const menu = document.getElementById('mobile-menu');
        const overlay = document.getElementById('mobile-menu-overlay');
        const isOpen = menu.classList.contains('open');
        if (isOpen && !menu.contains(e.target) && !e.target.closest('[onclick*="toggleMobileMenu"]') && !overlay.contains(e.target)) {
            menu.classList.remove('open');
            overlay.classList.remove('open');
            document.body.classList.remove('overflow-hidden');
        }
    });

    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        });
    });
    </script>

</body>
</html>
</file>

<file path="postcss.config.mjs">
const config = {
  plugins: {
    "@tailwindcss/postcss": {},
  },
};

export default config;
</file>

<file path="README.md">
This is a [Next.js](https://nextjs.org) project bootstrapped with [`create-next-app`](https://nextjs.org/docs/app/api-reference/cli/create-next-app).

## Getting Started

First, run the development server:

```bash
npm run dev
# or
yarn dev
# or
pnpm dev
# or
bun dev
```

Open [http://localhost:3000](http://localhost:3000) with your browser to see the result.

You can start editing the page by modifying `app/page.tsx`. The page auto-updates as you edit the file.

This project uses [`next/font`](https://nextjs.org/docs/app/building-your-application/optimizing/fonts) to automatically optimize and load [Geist](https://vercel.com/font), a new font family for Vercel.

## Learn More

To learn more about Next.js, take a look at the following resources:

- [Next.js Documentation](https://nextjs.org/docs) - learn about Next.js features and API.
- [Learn Next.js](https://nextjs.org/learn) - an interactive Next.js tutorial.

You can check out [the Next.js GitHub repository](https://github.com/vercel/next.js) - your feedback and contributions are welcome!

## Deploy on Vercel

The easiest way to deploy your Next.js app is to use the [Vercel Platform](https://vercel.com/new?utm_medium=default-template&filter=next.js&utm_source=create-next-app&utm_campaign=create-next-app-readme) from the creators of Next.js.

Check out our [Next.js deployment documentation](https://nextjs.org/docs/app/building-your-application/deploying) for more details.
</file>

<file path="tsconfig.json">
{
  "compilerOptions": {
    "target": "ES2017",
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,
    "skipLibCheck": true,
    "strict": true,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "react-jsx",
    "incremental": true,
    "plugins": [
      {
        "name": "next"
      }
    ],
    "paths": {
      "@/*": ["./src/*"]
    }
  },
  "include": [
    "next-env.d.ts",
    "**/*.ts",
    "**/*.tsx",
    ".next/types/**/*.ts",
    ".next/dev/types/**/*.ts",
    "**/*.mts"
  ],
  "exclude": ["node_modules"]
}
</file>

<file path="src/app/client/menu/page.tsx">
'use client';

import { useState, useEffect } from 'react';
import { useRouter } from 'next/navigation';
import { useClientConfig } from '@/context/ClientConfigContext';
import { CATEGORIES, PRODUCTS } from '@/data/menu-data';
import { Product } from '@/types/menu';
import { FileText, Utensils, Coffee, Tags, BookOpen } from 'lucide-react';

import MenuHeader from '@/components/client/menu/MenuHeader';
import CategoryTabs from '@/components/client/menu/CategoryTabs';
import ProductGrid from '@/components/client/menu/ProductGrid';
import ProductDetailModal from '@/components/client/menu/ProductDetailModal';
import MenuGalleryModal from '@/components/client/menu/MenuGalleryModal';

export default function MenuPage() {
    const router = useRouter();
    const config = useClientConfig();
    const [loading, setLoading] = useState(true);
    const [selectedCategory, setSelectedCategory] = useState('all');
    const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);
    const [isGalleryOpen, setIsGalleryOpen] = useState(false);
    const [galleryInitialIndex, setGalleryInitialIndex] = useState(0);

    useEffect(() => {
        if (!config.features.menuEnabled) {
            router.replace('/client'); // Redirect if disabled
            return;
        }
        setLoading(false);
    }, [router, config]);

    const handleOpenGallery = (index: number = 0) => {
        setGalleryInitialIndex(index);
        setIsGalleryOpen(true);
    };

    const filteredProducts = selectedCategory === 'all'
        ? PRODUCTS
        : PRODUCTS.filter(p => p.category === selectedCategory);

    if (loading) return <div className="min-h-screen bg-white flex items-center justify-center">Cargando menÃº...</div>;

    const menuGallery = config.assets.menuGallery || [];

    return (
        <div className="min-h-screen bg-gray-50 pb-12 pt-16">
            <MenuHeader title="Nuestro MenÃº" />

            {/* Menu Gallery Section */}
            {menuGallery.length > 0 && (
                <div className="max-w-2xl mx-auto px-4 mt-6">
                    <button
                        onClick={() => handleOpenGallery(0)}
                        className="w-full flex items-center justify-center gap-3 bg-white border-2 border-[#1A3278] text-[#1A3278] py-4 rounded-2xl font-bold shadow-sm hover:bg-gray-50 transition-all group"
                    >
                        <BookOpen className="w-6 h-6 group-hover:scale-110 transition-transform" />
                        VER NUESTRA CARTA COMPLETA
                    </button>

                    <div className="grid grid-cols-3 gap-3 mt-4">
                        {menuGallery.map((item, index) => (
                            <button
                                key={item.label}
                                onClick={() => handleOpenGallery(index)}
                                className="flex flex-col items-center justify-center gap-2 bg-white p-4 rounded-2xl shadow-sm hover:shadow-md transition-all active:scale-95 border border-gray-100"
                            >
                                <div className="p-3 bg-gray-50 rounded-full text-[#1A3278]">
                                    {item.label === 'Comidas' && <Utensils size={24} />}
                                    {item.label === 'Bebidas' && <Coffee size={24} />}
                                    {item.label === 'Promociones' && <Tags size={24} />}
                                    {!['Comidas', 'Bebidas', 'Promociones'].includes(item.label) && <FileText size={24} />}
                                </div>
                                <span className="text-xs font-bold text-gray-700 uppercase tracking-tight">{item.label}</span>
                            </button>
                        ))}
                    </div>
                </div>
            )}

            <div className="mt-8">
                <CategoryTabs
                    categories={CATEGORIES}
                    selectedCategory={selectedCategory}
                    onSelect={setSelectedCategory}
                />
            </div>

            <main className="max-w-2xl mx-auto mt-4 px-4">
                <ProductGrid
                    products={filteredProducts}
                    onProductClick={setSelectedProduct}
                />
            </main>

            <ProductDetailModal
                product={selectedProduct}
                onClose={() => setSelectedProduct(null)}
            />

            <MenuGalleryModal
                isOpen={isGalleryOpen}
                onClose={() => setIsGalleryOpen(false)}
                images={menuGallery}
                initialIndex={galleryInitialIndex}
            />
        </div>
    );
}
</file>

<file path="src/components/client/NewsFeed.tsx">
'use client';

import { ClientConfig } from "@/config/types";
import { ArrowRight } from "lucide-react";

interface NewsFeedProps {
    config: ClientConfig;
}

export default function NewsFeed({ config }: NewsFeedProps) {
    // TODO: Fetch from DB later. Using mock data for now as per plan.
    const items = [
        { id: "1", emoji: "â˜•", cat: "Novedad", title: "Cold Brew de Temporada", desc: "InfusiÃ³n en frÃ­o con notas tropicales" },
        { id: "2", emoji: "ðŸŽ¨", cat: "Evento", title: "Taller de Latte Art", desc: "Aprende arte en tu taza este sÃ¡bado" },
        { id: "3", emoji: "ðŸŒ±", cat: "Eco", title: "Descuento Eco-Friendly", desc: "15% OFF con tu vaso reutilizable" },
        { id: "4", emoji: "ðŸ§", cat: "Nuevo", title: "PastelerÃ­a Artesanal", desc: "Nuevos croissants de masa madre" },
    ];

    return (
        <div className="space-y-4">
            <div className="flex items-center justify-between px-1">
                <h3 className="font-bold text-gray-900 text-sm">Novedades</h3>
                <button
                    className="text-xs font-semibold flex items-center gap-1 transition-colors hover:opacity-80"
                    style={{ color: config.theme.accentColor }}
                >
                    Ver Todo <ArrowRight size={12} />
                </button>
            </div>

            <div className="flex gap-4 overflow-x-auto pb-4 -mx-4 px-4 snap-x scrollbar-hide">
                {items.map((item) => (
                    <div
                        key={item.id}
                        className="min-w-[180px] snap-start bg-white rounded-[20px] overflow-hidden flex-shrink-0 border border-gray-100 shadow-sm transition-transform hover:-translate-y-1 hover:shadow-md"
                    >
                        <div
                            className="h-28 flex items-center justify-center text-5xl"
                            style={{ backgroundColor: `${config.theme.primaryColor}08` }}
                        >
                            {item.emoji}
                        </div>
                        <div className="p-4">
                            <span
                                className="text-[10px] font-bold uppercase tracking-wider px-2 py-0.5 rounded-full"
                                style={{ backgroundColor: `${config.theme.accentColor}15`, color: config.theme.accentColor }}
                            >
                                {item.cat}
                            </span>
                            <h4 className="font-bold text-gray-900 text-xs mt-2 leading-tight">
                                {item.title}
                            </h4>
                            <p className="text-gray-400 text-[10px] mt-1 leading-relaxed">
                                {item.desc}
                            </p>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
}
</file>

<file path="src/components/client/StampProgress.tsx">
'use client';

import { ClientConfig } from "@/config/types";
import { Check, Gift } from "lucide-react";

interface StampProgressProps {
    currentStamps: number;
    config: ClientConfig;
    onStampClick?: (index: number) => void; // Optional for simulation
}

export default function StampProgress({ currentStamps, config, onStampClick }: StampProgressProps) {
    const total = config.rules.stampsPerReward || 10;
    const pct = Math.min((currentStamps / total) * 100, 100);

    return (
        <div className="bg-white rounded-[24px] p-6 shadow-sm border border-gray-100">
            <div className="flex items-center justify-between mb-5">
                <div>
                    <h3 className="font-bold text-gray-900 text-sm">Tu Tarjeta</h3>
                    <p className="text-gray-400 text-xs mt-0.5 font-medium">
                        {currentStamps >= total ? "Â¡Premio disponible!" : `${total - currentStamps} mÃ¡s para tu premio`}
                    </p>
                </div>
                <div className="flex items-baseline gap-0.5">
                    <span className="text-3xl font-black text-gray-900 tracking-tight">{currentStamps}</span>
                    <span className="text-sm text-gray-300 font-bold">/{total}</span>
                </div>
            </div>

            <div className="grid grid-cols-5 gap-3 mb-6">
                {Array.from({ length: total }).map((_, i) => {
                    const filled = i < currentStamps;
                    const next = i === currentStamps;
                    const isReward = i === total - 1;

                    return (
                        <div
                            key={i}
                            onClick={() => onStampClick?.(i + 1)}
                            className={`
                aspect-square rounded-xl flex items-center justify-center text-sm font-bold transition-all duration-300 relative
                ${filled ? "text-white scale-100 shadow-md transform" : next ? "border-2 border-dashed bg-gray-50 scale-105" : "bg-gray-50 text-gray-300"}
              `}
                            style={{
                                backgroundColor: filled ? config.theme.accentColor : undefined,
                                borderColor: next ? config.theme.accentColor : undefined,
                                color: next ? config.theme.accentColor : undefined,
                                cursor: onStampClick ? 'pointer' : 'default'
                            }}
                        >
                            {filled ? (
                                <Check size={14} strokeWidth={4} />
                            ) : isReward ? (
                                <Gift size={16} />
                            ) : (
                                i + 1
                            )}
                        </div>
                    );
                })}
            </div>

            {/* Progress Bar */}
            <div className="w-full bg-gray-100 rounded-full h-2 overflow-hidden">
                <div
                    className="h-full rounded-full transition-all duration-700 ease-out"
                    style={{ width: `${pct}%`, backgroundColor: config.theme.accentColor }}
                />
            </div>
        </div>
    );
}
</file>

<file path="src/components/IOSInstallPrompt.tsx">
'use client';

import { useEffect, useState } from 'react';
import { Share, PlusSquare } from 'lucide-react';
import { useClientConfig } from '@/context/ClientConfigContext';

export default function IOSInstallPrompt() {
    const config = useClientConfig();
    const [isIOS, setIsIOS] = useState(false);
    const [isStandalone, setIsStandalone] = useState(false);
    const [showPrompt, setShowPrompt] = useState(false);

    useEffect(() => {
        // 1. Detect iOS
        const userAgent = window.navigator.userAgent.toLowerCase();
        const isIosDevice = /iphone|ipad|ipod/.test(userAgent);
        setIsIOS(isIosDevice);

        // 2. Detect Standalone (Installed)
        const isInStandaloneMode = ('standalone' in window.navigator) && (window.navigator as any).standalone;
        setIsStandalone(isInStandaloneMode);

        // 3. Show only if iOS + Not Installed
        if (isIosDevice && !isInStandaloneMode) {
            // Wait a bit to show
            const timer = setTimeout(() => setShowPrompt(true), 2000);
            return () => clearTimeout(timer);
        }
    }, []);

    if (!showPrompt) return null;

    return (
        <div className="fixed bottom-0 left-0 right-0 p-4 z-50 animate-in slide-in-from-bottom duration-500">
            <div className="bg-white/90 backdrop-blur-md border border-gray-200 shadow-2xl rounded-2xl p-4 max-w-sm mx-auto flex flex-col gap-3">
                <div className="flex justify-between items-start">
                    <div>
                        <h3 className="font-bold text-black">Instalar App</h3>
                        <p className="text-xs text-gray-500">Agrega <strong>{config.name}</strong> a tu inicio para una mejor experiencia.</p>
                    </div>
                    <button onClick={() => setShowPrompt(false)} className="text-gray-400 hover:text-gray-600">âœ•</button>
                </div>

                <div className="flex items-center gap-3 text-sm text-gray-700">
                    <span>1. Toca</span>
                    <Share size={20} className="text-blue-500" />
                    <span>(Compartir)</span>
                </div>
                <div className="flex items-center gap-3 text-sm text-gray-700">
                    <span>2. Elige</span>
                    <div className="flex items-center gap-1 font-semibold">
                        <PlusSquare size={20} />
                        Agregar a Inicio
                    </div>
                </div>
            </div>

            {/* Pointer arrow to bottom for Safari typically */}
            <div className="w-0 h-0 border-l-[10px] border-l-transparent border-r-[10px] border-r-transparent border-t-[10px] border-t-white mx-auto mt-[-1px] opacity-90 drop-shadow-sm"></div>
        </div>
    );
}
</file>

<file path="src/components/Scanner.tsx">
'use client';

import React from 'react';
import { Scanner as QrScanner } from '@yudiel/react-qr-scanner';
import { X } from 'lucide-react';

interface ScannerProps {
    onScan: (data: string) => void;
    onClose: () => void;
}

const Scanner: React.FC<ScannerProps> = ({ onScan, onClose }) => {
    return (
        <div className="fixed inset-0 z-50 bg-black bg-opacity-90 flex flex-col items-center justify-center p-4">
            <div className="w-full max-w-md bg-white rounded-xl overflow-hidden shadow-2xl relative">
                <button
                    onClick={onClose}
                    className="absolute top-4 right-4 z-10 bg-white/20 hover:bg-white/40 p-2 rounded-full text-white backdrop-blur-sm transition-colors"
                >
                    <X size={24} color="black" />
                </button>

                <div className="p-4 bg-brand-primary text-white text-center">
                    <h2 className="text-lg font-bold font-brand">Escanear CÃ³digo QR</h2>
                    <p className="text-sm opacity-80 font-brand">Apunta la cÃ¡mara al QR del cliente</p>
                </div>

                <div className="w-full aspect-square bg-black relative">
                    <QrScanner
                        onScan={(result) => {
                            if (result && result.length > 0) {
                                onScan(result[0].rawValue);
                            }
                        }}
                        onError={(error) => console.error(error)}
                        styles={{
                            container: { width: '100%', height: '100%' },
                            video: { width: '100%', height: '100%', objectFit: 'cover' }
                        }}
                    />

                    {/* Overlay for guidance */}
                    <div className="absolute inset-0 border-2 border-white/30 flex items-center justify-center pointer-events-none">
                        <div className="w-48 h-48 border-2 border-white rounded-lg opacity-50 animate-pulse"></div>
                    </div>
                </div>
            </div>
        </div>
    );
};

export default Scanner;
</file>

<file path="src/config/clients/mare_cafe.ts">
import { ClientConfig } from '../types';

/**
 * Mare CafÃ© â€” ConfiguraciÃ³n Premium
 * 
 * Design System: Neo-editorial, post-minimal, artesanal-digital
 * Paleta: Royal Deep Blue + Parchment Cream + Espresso Gold
 * TipografÃ­a: DM Serif Display (headings) + Plus Jakarta Sans (body) + JetBrains Mono (precios)
 * Referentes: Kinfolk Magazine, Cereal Magazine, Aesop Stores, Blue Bottle Coffee
 */
export const mareCafeConfig: ClientConfig = {
    code: 'mare_cafe',
    name: 'Mare Cafe',
    theme: {
        primaryColor: '#1A3278',       // Royal Deep Blue (ajustado desde el design system)
        secondaryColor: '#F2EDE3',     // Parchment Cream
        accentColor: '#C8A96E',        // Espresso Gold â€” badges, recompensas, estados dorados
        fontFamily: 'var(--font-dm-serif)',       // Headlines: DM Serif Display
        bodyFontFamily: 'var(--font-jakarta)',    // Body/UI: Plus Jakarta Sans
        monoFontFamily: 'var(--font-jetbrains)', // Precios: JetBrains Mono
    },
    texts: {
        welcomeTitle: 'Mare',
        welcomeSubtitle: 'PastelerÃ­a y CafÃ© de Especialidad',
        stampCardTitle: 'Tu Tarjeta Mare',
        rewardsTitle: 'Tus Recompensas',
    },
    rules: {
        stampsPerReward: 7,
    },
    assets: {
        logo: '/logo-mare.png',
        menuGallery: [
            { src: '/assets/mare/menu/comidas.jpg', label: 'Comidas' },
            { src: '/assets/mare/menu/bebidas.jpg', label: 'Bebidas' },
            { src: '/assets/mare/menu/promociones.jpg', label: 'Promociones' },
        ],
    },
    features: {
        showBuyButton: true,
        externalMenuUrl: undefined,     // Ahora con menÃº nativo
        showNewsFeed: true,
        menuEnabled: true,
        showAboutUs: true,
        marketingEnabled: true,
        adminSettingsEnabled: true,
    },
};
</file>

<file path="src/config/types.ts">
export interface ClientConfig {
  code: string;
  name: string;
  theme: {
    primaryColor: string;
    secondaryColor: string;
    accentColor?: string;
    fontFamily?: string;
    /** Font family for body/UI text (Mare: Plus Jakarta Sans) */
    bodyFontFamily?: string;
    /** Font family for monospace/prices (Mare: JetBrains Mono) */
    monoFontFamily?: string;
  };
  texts: {
    welcomeTitle: string;
    welcomeSubtitle: string;
    stampCardTitle: string;
    rewardsTitle: string;
  };
  rules: {
    stampsPerReward: number;
  };
  assets: {
    logo: string;
    favicon?: string;
    gallery?: string[];
    menuGallery?: { src: string; label: string }[];
  };
  social?: {
    instagram?: string;
    website?: string;
  };
  features: {
    showBuyButton?: boolean;
    externalMenuUrl?: string;
    showNewsFeed?: boolean;
    menuEnabled?: boolean;
    showAboutUs?: boolean;
    marketingEnabled?: boolean;
    adminSettingsEnabled?: boolean;
  };
}
</file>

<file path="src/lib/shop-service.ts">
import { supabase } from '@/lib/supabase';
import { ClientConfig } from '@/config/types';
import { mareCafeConfig } from '@/config/clients/mare_cafe';

// Default config values to fallback if DB fails or is empty, 
// ensuring the app doesn't crash completely.
const DEFAULT_CONFIG: ClientConfig = {
    code: 'default',
    name: 'Loading...',
    theme: {
        primaryColor: '#000000',
        secondaryColor: '#ffffff',
        fontFamily: 'sans-serif'
    },
    texts: {
        welcomeTitle: 'Welcome',
        welcomeSubtitle: '',
        stampCardTitle: 'Rewards',
        rewardsTitle: 'My Rewards'
    },
    rules: { stampsPerReward: 10 },
    assets: { logo: '' },
    features: {
        showBuyButton: false,
        showNewsFeed: false,
        menuEnabled: false
    }
};

export async function getShopConfig(code: string): Promise<ClientConfig | null> {
    // Override: Use local config for mare_cafe to ensure latest features (like menu) are enabled
    if (code === 'mare_cafe') {
        return mareCafeConfig;
    }

    try {
        const { data, error } = await supabase
            .from('shops')
            .select('config, name')
            .eq('code', code)
            .single();

        if (error || !data) {
            console.error(`Error fetching config for ${code}:`, error);
            return null;
        }

        // Merge DB config with name and code
        const config = data.config as Partial<ClientConfig>;

        return {
            ...DEFAULT_CONFIG,
            ...config,
            code: code,
            name: data.name
        } as ClientConfig;

    } catch (e) {
        console.error('Unexpected error fetching shop config:', e);
        return null;
    }
}
</file>

<file path="supabase/migrations/20260208_fix_redeem_logic_dynamic.sql">
-- MIGRATION: Fix Redeem Logic to be Dynamic
-- This replaces the function create in 07_gamification.sql / 06_redeem_logic.sql

create or replace function redeem_reward(target_user_id uuid)
returns jsonb
language plpgsql
security definer
as $$
declare
  current_stamps int;
  stamps_needed int;
  caller_role text;
  user_client_code text;
  shop_config jsonb;
  default_stamps int := 7; -- Default fallback
  new_level int;
begin
  -- Check permissions (Staff/Admin only)
  select role into caller_role from profiles where id = auth.uid();
  if caller_role not in ('staff', 'admin') then
    return jsonb_build_object('success', false, 'message', 'Unauthorized');
  end if;

  -- Get User's Shop via Profile client_code
  select client_code into user_client_code from profiles where id = target_user_id;
  
  -- Get Shop Config using code column
  if user_client_code is not null then
      select config into shop_config from shops where code = user_client_code;
      stamps_needed := (shop_config->'rules'->>'stampsPerReward')::int;
  end if;

  -- Fallback if null
  if stamps_needed is null then
      stamps_needed := default_stamps; 
  end if;

  -- Check Stamps
  select count into current_stamps from stamps where user_id = target_user_id;
  
  if current_stamps is null or current_stamps < stamps_needed then
     return jsonb_build_object('success', false, 'message', 'El cliente no tiene suficientes sellos (MÃ­nimo ' || stamps_needed || ').');
  end if;

  -- Deduct Stamps
  update stamps set count = count - stamps_needed, updated_at = now() where user_id = target_user_id;

  -- Log Transaction
  insert into transaction_logs (staff_id, user_id, type)
  values (auth.uid(), target_user_id, 'redeem_reward');

  -- GAMIFICATION: Level Up!
  update profiles 
  set level = coalesce(level, 1) + 1 
  where id = target_user_id
  returning level into new_level;

  return jsonb_build_object(
      'success', true, 
      'message', 'Â¡Canje exitoso! Se restaron ' || stamps_needed || ' sellos.',
      'new_level', new_level
  );
end;
$$;
</file>

<file path="supabase/migrations/20260208_secure_pins.sql">
-- Enable pgcrypto for hashing
create extension if not exists "pgcrypto";

-- Add hash columns
alter table shops add column if not exists admin_pin_hash text;
alter table shops add column if not exists staff_pin_hash text;

-- Update with defaults for now (will be changed securely later)
update shops
set 
    admin_pin_hash = crypt('MARE-ADMIN-2024', gen_salt('bf')),
    staff_pin_hash = crypt('1234', gen_salt('bf'))
where admin_pin_hash is null;

-- Secure verification function
create or replace function verify_shop_pin(input_pin text, shop_code text)
returns jsonb
language plpgsql
security definer
as $$
declare
    stored_admin_hash text;
    stored_staff_hash text;
begin
    -- Get hashes for the shop
    select admin_pin_hash, staff_pin_hash 
    into stored_admin_hash, stored_staff_hash
    from shops 
    where code = shop_code;

    if not found then
        return jsonb_build_object('valid', false, 'message', 'Shop not found');
    end if;

    -- Check Admin PIn
    if stored_admin_hash is not null and (stored_admin_hash = crypt(input_pin, stored_admin_hash)) then
        return jsonb_build_object('valid', true, 'role', 'admin');
    end if;

    -- Check Staff PIN
    if stored_staff_hash is not null and (stored_staff_hash = crypt(input_pin, stored_staff_hash)) then
         return jsonb_build_object('valid', true, 'role', 'staff');
    end if;

    return jsonb_build_object('valid', false, 'message', 'Invalid PIN');
end;
$$;
</file>

<file path="package.json">
{
  "name": "loyalty-app",
  "version": "0.1.0",
  "private": true,
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "eslint"
  },
  "dependencies": {
    "@ducanh2912/next-pwa": "^10.2.9",
    "@supabase/supabase-js": "^2.93.3",
    "@yudiel/react-qr-scanner": "^2.2.1",
    "lucide-react": "^0.563.0",
    "next": "16.1.6",
    "qrcode.react": "^4.2.0",
    "react": "19.2.3",
    "react-dom": "19.2.3",
    "react-qr-code": "^2.0.18",
    "recharts": "^3.7.0",
    "resend": "^6.9.1"
  },
  "devDependencies": {
    "@tailwindcss/postcss": "^4",
    "@types/node": "^20",
    "@types/react": "^19",
    "@types/react-dom": "^19",
    "dotenv": "^17.2.4",
    "eslint": "^9",
    "eslint-config-next": "16.1.6",
    "tailwindcss": "^4",
    "typescript": "^5"
  }
}
</file>

<file path="src/app/auth/login/page.tsx">
'use client';

import { Suspense, useEffect, useState } from 'react';
import { useSearchParams, useRouter } from 'next/navigation';
import { useClientConfig } from '@/context/ClientConfigContext';
import { supabase } from '@/lib/supabase';
import { ArrowLeft, Loader2, Store, User } from 'lucide-react';
import PoweredBy from '@/components/PoweredBy';
import Link from 'next/link';

function AuthContent() {
    const params = useSearchParams();
    const router = useRouter();
    const config = useClientConfig();

    const role = params.get('role') as 'customer' | 'staff' | null;
    const [isLogin, setIsLogin] = useState(true);
    const [loading, setLoading] = useState(false);

    // Form State
    const [email, setEmail] = useState('');
    const [password, setPassword] = useState('');
    const [fullName, setFullName] = useState('');
    const [shopPin, setShopPin] = useState(''); // Only for staff registration

    // Validation / Error
    const [error, setError] = useState<string | null>(null);

    // If no role specified, redirect to landing
    useEffect(() => {
        if (!role || !['customer', 'staff'].includes(role)) {
            router.push('/');
        }
    }, [role, router]);

    if (!role) return null;

    const handleAuth = async (e: React.FormEvent) => {
        e.preventDefault();
        setLoading(true);
        setError(null);

        try {
            if (isLogin) {
                // --- LOGIN FLOW ---
                const { data, error: signInError } = await supabase.auth.signInWithPassword({
                    email,
                    password,
                });

                if (signInError) throw signInError;

                // Check if user has the correct role AND correct client
                const { data: profile } = await supabase
                    .from('profiles')
                    .select('role, client_code') // Fetch client_code
                    .eq('id', data.user.id)
                    .single();

                // 1. Role Check
                if (profile?.role !== role && profile?.role !== 'admin') {
                    throw new Error(`Este usuario no estÃ¡ registrado como ${role === 'customer' ? 'Cliente' : 'Staff'}.`);
                }

                // 2. Client Isolation Check
                // STRICT RULE for Perezoso: Must match exactly.
                if (config.code === 'perezoso_cafe') {
                    if (profile?.client_code !== 'perezoso_cafe' && profile?.role !== 'admin') {
                        throw new Error(`Esta cuenta no estÃ¡ registrada en Perezoso Cafe.`);
                    }
                }
                // LEGACY RULE for Mare: Allow 'mare_cafe' OR null (old users)
                else if (config.code === 'mare_cafe') {
                    if (profile?.client_code && profile.client_code !== 'mare_cafe' && profile?.role !== 'admin') {
                        throw new Error(`Esta cuenta pertenece a otro comercio.`);
                    }
                }
                // GENERIC: fallback
                else {
                    if (profile?.client_code && profile.client_code !== config.code && profile?.role !== 'admin') {
                        throw new Error(`Esta cuenta no pertenece a ${config.name}.`);
                    }
                }

                // If profile has NO client_code, we effectively treat it as "Global" or "Legacy Mare".
                // To force strictness, we could say: if (!profile.client_code && config.code !== 'mare_cafe') throw Error...
                // But let's stick to positive match if present for now to avoid locking out existing dev users.

                // Redirect based on role
                if (role === 'customer') router.push('/client');
                else if (profile?.role === 'admin') router.push('/admin');
                else router.push('/staff');

            } else {
                // --- SIGN UP FLOW ---

                // ... (PIN logic remains same) ...

                // 1. PIN Verification & Role Assignment
                let finalRole: 'customer' | 'staff' | 'admin' | null = role;

                if (role === 'staff') {
                    // SECURE PIN VERIFICATION
                    const { data: verification, error: verifyError } = await supabase
                        .rpc('verify_shop_pin', { input_pin: shopPin, shop_code: config.code });

                    if (verifyError || !verification?.valid) {
                        throw new Error('PIN de tienda invÃ¡lido.');
                    }

                    finalRole = verification.role === 'admin' ? 'admin' : 'staff';
                }

                // 2. Create Auth User
                const { data, error: signUpError } = await supabase.auth.signUp({
                    email,
                    password,
                    options: {
                        data: {
                            full_name: fullName,
                            role: finalRole,
                            client_code: config.code, // Save client code in auth metadata too
                        }
                    }
                });

                if (signUpError) throw signUpError;

                // 3. Create Profile Entry manually
                if (data.user) {
                    const { error: profileError } = await supabase.from('profiles').insert({
                        id: data.user.id,
                        email: email,
                        role: finalRole,
                        full_name: fullName,
                        client_code: config.code, // IMPORTANT: Associate user with THIS client
                    });
                    if (profileError) console.error("Profile creation warning:", profileError);
                }

                alert('Registro exitoso. Â¡Bienvenido!');
                if (finalRole === 'customer') router.push('/client');
                else if (finalRole === 'admin') router.push('/admin');
                else router.push('/staff');
            }
        } catch (err: any) {
            setError(err.message || 'OcurriÃ³ un error desconocido');
        } finally {
            setLoading(false);
        }
    };

    const isCustomer = role === 'customer';

    return (
        <div className="flex min-h-screen bg-white">
            {/* Left Panel - Branding (Desktop) */}
            <div className="hidden lg:flex w-1/2 items-center justify-center p-12 relative overflow-hidden"
                style={{ backgroundColor: config.theme.primaryColor }}>
                <div className="absolute inset-0 opacity-20" style={{
                    backgroundImage: 'url("https://www.transparenttextures.com/patterns/cubes.png")',
                }}></div>

                <div className="text-center text-white space-y-8 z-10 relative">
                    {config.assets?.logo ? (
                        <img
                            src={config.assets.logo}
                            alt={config.name}
                            className={`mx-auto drop-shadow-2xl hover:scale-105 transition duration-700 ${config.code === 'perezoso_cafe' ? 'w-[32rem]' : 'w-64'}`}
                        />
                    ) : (
                        isCustomer ? <User size={100} className="mx-auto" /> : <Store size={100} className="mx-auto" />
                    )}

                    <div className="space-y-4 max-w-lg mx-auto">
                        <h2 className="text-5xl font-playfair font-bold tracking-wide">
                            {isLogin ? 'Bienvenido' : 'Ãšnete a la Familia'}
                        </h2>
                        <p className="text-xl text-blue-100 font-light leading-relaxed">
                            {isCustomer
                                ? 'La excelencia del cafÃ© de especialidad, ahora premia tu fidelidad.'
                                : 'Plataforma administrativa para el mejor equipo.'}
                        </p>
                    </div>
                </div>
            </div>

            {/* Right Panel - Form */}
            <div className="flex-1 flex flex-col justify-center p-8 sm:p-20 bg-white relative">
                <div className="absolute inset-0 lg:hidden opacity-5 pointer-events-none" style={{ backgroundColor: config.theme.primaryColor }}></div>

                <div className="max-w-md mx-auto w-full space-y-8 relative z-10">
                    <Link href="/" className="text-slate-400 hover:text-slate-600 flex items-center gap-2 transition group inline-flex mb-4">
                        <ArrowLeft size={18} className="group-hover:-translate-x-1 transition-transform" />
                        <span className="font-medium text-sm">Volver al inicio</span>
                    </Link>

                    <div className="text-center lg:text-left space-y-4">
                        {/* Mobile Logo */}
                        <div className="lg:hidden flex justify-center mb-6">
                            {config.assets?.logo ? (
                                <img
                                    src={config.assets.logo}
                                    alt={config.name}
                                    className={`drop-shadow-lg ${config.code === 'perezoso_cafe' ? 'w-64' : 'w-32'}`}
                                />
                            ) : null}
                        </div>

                        <h1 className="text-4xl font-bold text-slate-900 font-playfair leading-tight">
                            {isCustomer ? (isLogin ? 'Acceso Clientes' : 'Crear Cuenta') : 'Acceso Staff'}
                        </h1>
                        <p className="text-slate-500">
                            {isLogin ? 'Ingresa tus datos para continuar.' : 'Completa el formulario para empezar a sumar puntos.'}
                        </p>
                    </div>

                    {error && (
                        <div className="p-4 bg-red-50 text-red-600 rounded-xl text-sm border border-red-100 flex items-center gap-2 animate-in slide-in-from-top-2">
                            <span className="font-bold">Error:</span> {error}
                        </div>
                    )}

                    <form onSubmit={handleAuth} className="space-y-5">
                        {!isLogin && (
                            <div className="space-y-5 animate-in slide-in-from-bottom-4 duration-500">
                                <div>
                                    <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Nombre Completo</label>
                                    <input
                                        type="text"
                                        required
                                        placeholder="Ej. Juan PÃ©rez"
                                        value={fullName}
                                        onChange={(e) => setFullName(e.target.value)}
                                        className="w-full rounded-xl border-slate-200 bg-slate-50 px-4 py-3 text-slate-900 focus:ring-2 focus:ring-blue-900 focus:bg-white transition-all outline-none"
                                    />
                                </div>
                                {role === 'staff' && (
                                    <div>
                                        <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">PIN DE ACCESO</label>
                                        <input
                                            type="password"
                                            required
                                            value={shopPin}
                                            placeholder="â€¢â€¢â€¢â€¢"
                                            onChange={(e) => setShopPin(e.target.value)}
                                            className="w-full rounded-xl border-slate-200 bg-slate-50 px-4 py-3 text-slate-900 focus:ring-2 focus:ring-blue-900 focus:bg-white transition-all outline-none tracking-widest"
                                        />
                                    </div>
                                )}
                            </div>
                        )}

                        <div className="space-y-5">
                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">Email</label>
                                <input
                                    type="email"
                                    required
                                    placeholder="tu@email.com"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    className="w-full rounded-xl border-slate-200 bg-slate-50 px-4 py-3 text-slate-900 focus:ring-2 focus:ring-blue-900 focus:bg-white transition-all outline-none"
                                />
                            </div>

                            <div>
                                <label className="block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1">ContraseÃ±a</label>
                                <input
                                    type="password"
                                    required
                                    placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    className="w-full rounded-xl border-slate-200 bg-slate-50 px-4 py-3 text-slate-900 focus:ring-2 focus:ring-blue-900 focus:bg-white transition-all outline-none"
                                />
                            </div>
                        </div>

                        <div className="pt-4">
                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full py-4 rounded-xl shadow-xl text-sm font-bold text-white transition-all hover:scale-[1.02] active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed flex justify-center items-center gap-2"
                                style={{ backgroundColor: config.theme.primaryColor }}
                            >
                                {loading ? <Loader2 className="animate-spin" /> : (isLogin ? 'INGRESAR' : 'CREAR CUENTA')}
                            </button>
                        </div>
                    </form>

                    <div className="text-center pt-4 border-t border-slate-100">
                        <p className="text-slate-500 text-sm mb-3">
                            {isLogin ? 'Â¿Primera vez aquÃ­?' : 'Â¿Ya tienes una cuenta?'}
                        </p>
                        <button
                            onClick={() => setIsLogin(!isLogin)}
                            className="text-sm font-bold hover:underline transition-all"
                            style={{ color: config.theme.primaryColor }}
                        >
                            {isLogin ? 'RegÃ­strate Gratis' : 'Inicia SesiÃ³n'}
                        </button>
                    </div>
                </div>

                <div className="pb-4 mt-auto">
                    <PoweredBy />
                </div>
            </div >
        </div >

    );
}

export default function LoginPage() {
    return (
        <Suspense fallback={<div className="min-h-screen flex items-center justify-center">Cargando...</div>}>
            <AuthContent />
        </Suspense>
    )
}
</file>

<file path="src/app/staff/page.tsx">
'use client';

import { useEffect, useState } from 'react';
import { useRouter } from 'next/navigation';
import { useClientConfig } from '@/context/ClientConfigContext';
import { ClientConfig } from '@/config/types';
import PoweredBy from '@/components/PoweredBy';
import Scanner from '@/components/Scanner';
import { Scan, LogOut, Coffee, Clock, Gift } from 'lucide-react';
import { supabase } from '@/lib/supabase';

export default function StaffDashboard() {
    const router = useRouter();
    const config = useClientConfig();
    const [showScanner, setShowScanner] = useState(false);
    const [loading, setLoading] = useState(true);
    const [scanCount, setScanCount] = useState(0);
    const [recentLogs, setRecentLogs] = useState<any[]>([]);

    const [isAdmin, setIsAdmin] = useState(false);

    useEffect(() => {
        const init = async () => {
            // Config from context
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) { router.push('/auth/login?role=staff'); return; }

            const { data: profile } = await supabase.from('profiles').select('role, client_code').eq('id', user.id).single();
            if (!profile || (profile.role !== 'staff' && profile.role !== 'admin')) {
                alert('Acceso denegado: No eres Staff.');
                router.push('/');
                return;
            }

            // Client Isolation Check
            let isValidUser = true;
            if (profile.role !== 'admin') {
                if (config.code === 'perezoso_cafe') {
                    if (profile.client_code !== 'perezoso_cafe') isValidUser = false;
                } else if (config.code === 'mare_cafe') {
                    if (profile.client_code && profile.client_code !== 'mare_cafe') isValidUser = false;
                } else {
                    if (profile.client_code && profile.client_code !== config.code) isValidUser = false;
                }
            }

            if (!isValidUser) {
                alert(`Esta cuenta de staff no pertenece a ${config.name}.`);
                await supabase.auth.signOut();
                router.push('/');
                return;
            }

            if (profile.role === 'admin') {
                setIsAdmin(true);
            }

            await fetchLogs(config, profile.client_code);
            setLoading(false);

            // Realtime Subscription
            const changes = supabase
                .channel('staff-dashboard-realtime')
                .on(
                    'postgres_changes',
                    { event: 'INSERT', schema: 'public', table: 'transaction_logs' },
                    (payload) => {
                        console.log('New log:', payload);
                        fetchLogs(config, profile.client_code);
                    }
                )
                .subscribe();

            return () => {
                supabase.removeChannel(changes);
            };
        };
        init();
    }, [router, config]);

    const fetchLogs = async (cfg: ClientConfig, userClientCode: string) => {
        const today = new Date().toISOString().split('T')[0];
        let query = supabase.from('transaction_logs')
            .select('id, created_at, description, type, profiles!transaction_logs_user_id_fkey!inner(client_code)')
            .order('created_at', { ascending: false })
            .limit(5);

        // Filter by Client Code
        if (cfg.code === 'mare_cafe') {
            query = query.or('client_code.eq.mare_cafe,client_code.is.null', { foreignTable: 'profiles' });
        } else {
            query = query.eq('profiles.client_code', cfg.code);
        }

        const { data } = await query;
        if (data) setRecentLogs(data);
    };

    const handleLogout = async () => {
        await supabase.auth.signOut();
        router.push('/');
    };

    const handleScanOperation = async (targetId: string, force = false): Promise<any> => {
        const { data, error } = await supabase.rpc('add_stamp', { target_user_id: targetId, force_override: force });
        if (error) return { success: false, message: error.message };
        return data;
    };

    const handleRedemption = async (targetId: string) => {
        const { data, error } = await supabase.rpc('redeem_reward', { target_user_id: targetId });
        if (error) return { success: false, message: error.message };
        return data;
    };

    const handleScan = async (scannedData: string) => {
        if (!config) return;

        let targetUserId = scannedData;
        let isJson = false;
        let parsedData: any = {};

        // 1. TRY TO PARSE JSON
        try {
            if (scannedData.startsWith('{')) {
                parsedData = JSON.parse(scannedData);
                isJson = true;

                // Extract UID if available (This fixes the "invalid input syntax for type uuid" error)
                if (parsedData.uid) {
                    targetUserId = parsedData.uid;
                }
            }
        } catch (e) {
            // Not JSON, treat as raw UUID string
        }

        // 2. PROMO FLOW
        if (isJson && parsedData.type === 'promo') {
            // --- PROMO REDEMPTION FLOW ---
            const { campaignId, user } = parsedData;

            // 1. Verify Campaign Status
            const { data: campaign, error } = await supabase.from('campaigns').select('status, title').eq('id', campaignId).single();

            if (error || !campaign) {
                alert('âŒ Error: CampaÃ±a no encontrada o invÃ¡lida.');
                setShowScanner(false);
                return;
            }

            if (campaign.status !== 'active') {
                alert(`âŒ PROMOCIÃ“N VENCIDA O INACTIVA\n\nCampaÃ±a: ${campaign.title}\nEstado: ${campaign.status}`);
                setShowScanner(false);
                return;
            }

            // 2. Validate User
            const confirmRedeem = confirm(`âœ… PROMOCIÃ“N VÃLIDA\n\nCampaÃ±a: ${campaign.title}\nUsuario: ${user}\n\nÂ¿Registrar canje?`);

            if (confirmRedeem) {
                // Log usage
                // Try to find UUID from email if user is email
                let logUserId = user;
                // Simple regex to check if user is UUID or Email
                const isUuid = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(user);

                if (!isUuid) {
                    const { data: profile } = await supabase.from('profiles').select('id').eq('email', user).single();
                    if (profile) logUserId = profile.id;
                    // If not found, we might fail FK or insert with email if allowed? Assuming UUID required.
                }

                await supabase.from('transaction_logs').insert({
                    user_id: logUserId,
                    type: 'promo_redeem',
                    description: `Canje PromociÃ³n: ${campaign.title}`
                });

                alert('âœ… Canje registrado exitosamente.');
                setScanCount(prev => prev + 1);
            }
            setShowScanner(false);
            return;
        }

        // --- NORMAL USER FLOW (STAMP) ---
        // Use targetUserId which is now the clean UUID

        // 1. Check current stamps first
        const { data: stampData } = await supabase.from('stamps').select('count').eq('user_id', targetUserId).single();
        const currentStamps = stampData?.count || 0;

        // 2. REWARD LOGIC: Dynamic from config
        const stampsNeeded = config.rules.stampsPerReward;
        if (currentStamps >= stampsNeeded) {
            const wantsToRedeem = confirm(`ðŸŽ‰ Â¡PREMIO DISPONIBLE! ðŸŽ‰\n\nEl cliente tiene ${currentStamps} sellos.\nÂ¿Desea canjear el CafÃ© Gratis ahora?`);

            if (wantsToRedeem) {
                const pin = prompt('ðŸ” AutorizaciÃ³n Requerida\nIngrese PIN de Admin para canjear:');
                const { data: verification } = await supabase.rpc('verify_shop_pin', { input_pin: pin, shop_code: config.code });

                if (verification?.valid && verification?.role === 'admin') {
                    const result = await handleRedemption(targetUserId);
                    if (result.success) {
                        alert('âœ… ' + result.message);
                        setScanCount(prev => prev + 1); // Count as activity
                        setShowScanner(false);
                        return;
                    } else {
                        alert('âŒ Error: ' + result.message);
                        return;
                    }
                } else {
                    alert('PIN Incorrecto o insuficientes permisos. Canje cancelado.');
                    return;
                }
            }
            // If they chose NO, we proceed to try adding a stamp (normal flow)? 
            const addStampInstead = confirm('Â¿Desea sumar un punto normal en su lugar?');
            if (!addStampInstead) {
                setShowScanner(false);
                return;
            }
        }

        // 3. Normal ADD STAMP Logic (Existing)
        const result = await handleScanOperation(targetUserId, false);

        if (result.success) {
            alert('Â¡Sello agregado correctamente!');
            setScanCount(prev => prev + 1);
            setShowScanner(false);
        } else if (result.code === 'COOLDOWN_ACTIVE') {
            const pin = prompt(`âš ï¸ BLOQUEADO POR REGLA 24HS.\nEste cliente ya sumÃ³ hoy.\n\nPara autorizar excepciÃ³n, ingrese PIN de Admin:`);
            const { data: verification } = await supabase.rpc('verify_shop_pin', { input_pin: pin, shop_code: config.code });

            if (verification?.valid && verification?.role === 'admin') {
                const overrideResult = await handleScanOperation(targetUserId, true);
                if (overrideResult.success) {
                    alert('âœ… ExcepciÃ³n Autorizada. Sello agregado.');
                    setScanCount(prev => prev + 1);
                    setShowScanner(false);
                } else {
                    alert('Error al forzar: ' + overrideResult.message);
                }
            } else {
                alert('PIN Incorrecto o insuficientes permisos.');
            }
        } else {
            alert('Error: ' + result.message);
        }
    };

    if (loading) return <div className="flex h-screen items-center justify-center">Cargando...</div>;

    return (
        <main className="min-h-screen bg-gray-50 font-sans">
            <nav className="bg-white shadow-sm px-6 py-4 flex justify-between items-center">
                <div className="flex items-center gap-3">
                    {config.assets?.logo ? (
                        <img
                            src={config.assets.logo}
                            alt={config.name}
                            className="h-24 w-auto object-contain"
                        />
                    ) : (
                        <div className="bg-black text-white p-2 rounded-lg"><Coffee size={20} /></div>
                    )}
                    <span className="font-bold text-gray-800 text-lg">Staff Portal</span>
                </div>
                <div className="flex items-center gap-4">
                    {isAdmin && (
                        <button
                            onClick={() => router.push('/admin')}
                            className="text-sm font-bold text-blue-600 bg-blue-50 px-3 py-1.5 rounded-lg hover:bg-blue-100 transition"
                        >
                            Volver a Admin
                        </button>
                    )}
                    <button onClick={handleLogout} className="text-sm font-medium text-gray-500 hover:text-red-600 transition">Cerrar SesiÃ³n</button>
                </div>
            </nav>

            <div className="max-w-4xl mx-auto p-6 space-y-8">
                <section className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                        <h3 className="text-gray-400 text-sm font-medium uppercase">Tus Escaneos (Hoy)</h3>
                        <p className="text-4xl font-bold mt-2">{scanCount}</p>
                    </div>


                    <button onClick={() => setShowScanner(true)} className="group relative overflow-hidden bg-brand-primary text-white p-6 rounded-2xl shadow-lg flex items-center justify-between hover:shadow-xl transition-all">
                        <div><h3 className="text-white/90 font-medium text-lg font-brand">Escanear Cliente</h3><p className="text-white/60 text-sm font-brand">CÃ¡mara o ingreso manual</p></div>
                        <div className="bg-white/20 p-3 rounded-full group-hover:scale-110 transition-transform"><Scan size={32} /></div>
                    </button>
                </section>

                <section>
                    <h3 className="font-semibold text-gray-800 mb-4">Actividad Reciente</h3>
                    <div className="bg-white rounded-xl shadow-sm border border-gray-100 divide-y divide-gray-50">
                        {recentLogs.length === 0 ? (
                            <div className="p-8 text-center text-gray-400">
                                <Clock className="mx-auto mb-2 opacity-50" size={32} />
                                <p>No hay actividad reciente.</p>
                            </div>
                        ) : (
                            recentLogs.map((log) => (
                                <div key={log.id} className="p-4 flex items-center justify-between">
                                    <div>
                                        <p className="font-medium text-gray-800 text-sm">{log.description}</p>
                                        <p className="text-xs text-gray-400">{new Date(log.created_at).toLocaleTimeString()}</p>
                                    </div>
                                    <span className={`px-2 py-1 rounded-full text-xs font-bold ${log.type === 'add_stamp' ? 'bg-emerald-100 text-emerald-700' : 'bg-purple-100 text-purple-700'}`}>
                                        {log.type === 'add_stamp' ? 'Sello' : 'Canje'}
                                    </span>
                                </div>
                            ))
                        )}
                    </div>
                </section>
            </div>

            {showScanner && <Scanner onScan={handleScan} onClose={() => setShowScanner(false)} />}

            <div className="pb-6">
                <PoweredBy />
            </div>
        </main>
    );
}
</file>

<file path="src/app/globals.css">
@import "tailwindcss";

:root {
  --background: #ffffff;
  --foreground: #171717;
}

@theme inline {
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --font-sans: var(--font-geist-sans);
  --font-mono: var(--font-geist-mono);

  /* Dynamic Branding */
  --color-brand-primary: var(--brand-primary);
  --color-brand-secondary: var(--brand-secondary);
  --font-brand: var(--font-brand);
}

@media (prefers-color-scheme: dark) {
  :root {
    --background: #0a0a0a;
    --foreground: #ededed;
  }
}

body {
  background: var(--background);
  color: var(--foreground);
  font-family: Arial, Helvetica, sans-serif;
}

/* Coffeinopia design tokens & animations */
@keyframes slideUp {
  from {
    transform: translateY(100%);
  }

  to {
    transform: translateY(0);
  }
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }

  to {
    opacity: 1;
  }
}

/* Utilities */
.scrollbar-hide::-webkit-scrollbar {
  display: none;
}

.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.snap-x {
  scroll-snap-type: x mandatory;
}

.snap-start {
  scroll-snap-align: start;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MARE CAFÃ‰ â€” Scoped Design Tokens & Animations
   Estas clases SOLO afectan al mÃ³dulo Mare. No tocan Perezoso.
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

/* --- Mare: Variables de diseÃ±o (scoped bajo .mare-theme) --- */
.mare-theme {
  --mare-primary: #1A3278;
  --mare-primary-hover: #243D8A;
  --mare-blue-soft: #4A6BB5;
  --mare-surface: #F2EDE3;
  --mare-canvas: #FAF8F4;
  --mare-gold: #C8A96E;
  --mare-gold-light: #E8D5A0;
  --mare-ink: #2A2A2E;
  --mare-stone: #8C8B88;
  --mare-mist: #E5E1D9;
  --mare-sage: #5B8C6A;
  --mare-terracotta: #C0574A;

  /* Gradientes */
  --mare-gradient-ocean: linear-gradient(175deg, #1A3278 0%, #243D8A 45%, #2E4F9E 100%);
  --mare-glass-cream: rgba(242, 237, 227, 0.72);
  --mare-gradient-gold: linear-gradient(135deg, #C8A96E 0%, #E8D5A0 50%, #C8A96E 100%);
}

/* --- Mare: Animaciones --- */
@keyframes mare-fadeUp {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

@keyframes mare-stampBounce {
  0% { transform: scale(0); }
  60% { transform: scale(1.15); }
  100% { transform: scale(1); }
}

@keyframes mare-shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

@keyframes mare-slideUp {
  from { transform: translateY(100%); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}

@keyframes mare-wave1 {
  0%, 100% { d: path('M0 12 Q6 6 12 12 Q18 18 24 12 Q30 6 36 12 Q42 18 48 12'); }
  50% { d: path('M0 12 Q6 18 12 12 Q18 6 24 12 Q30 18 36 12 Q42 6 48 12'); }
}

@keyframes mare-wave2 {
  0%, 100% { d: path('M0 14 Q6 8 12 14 Q18 20 24 14 Q30 8 36 14 Q42 20 48 14'); }
  50% { d: path('M0 14 Q6 20 12 14 Q18 8 24 14 Q30 20 36 14 Q42 8 48 14'); }
}

@keyframes mare-pulse-gold {
  0%, 100% { box-shadow: 0 0 0 0 rgba(200, 169, 110, 0.4); }
  50% { box-shadow: 0 0 0 8px rgba(200, 169, 110, 0); }
}

/* --- Mare: Utility classes (scoped) --- */
.mare-theme .mare-fade-up {
  animation: mare-fadeUp 0.3s ease-out both;
}

.mare-theme .mare-stamp-bounce {
  animation: mare-stampBounce 0.5s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

.mare-theme .mare-shimmer {
  background-size: 200% 100%;
  animation: mare-shimmer 3s linear infinite;
}

.mare-theme .mare-slide-up {
  animation: mare-slideUp 0.4s cubic-bezier(0.34, 1.56, 0.64, 1) both;
}

.mare-theme .mare-pulse-gold {
  animation: mare-pulse-gold 2s ease-in-out infinite;
}

/* --- Mare: Stagger children animation --- */
.mare-theme .mare-stagger > * {
  animation: mare-fadeUp 0.25s ease-out both;
}
.mare-theme .mare-stagger > *:nth-child(1) { animation-delay: 0ms; }
.mare-theme .mare-stagger > *:nth-child(2) { animation-delay: 50ms; }
.mare-theme .mare-stagger > *:nth-child(3) { animation-delay: 100ms; }
.mare-theme .mare-stagger > *:nth-child(4) { animation-delay: 150ms; }
.mare-theme .mare-stagger > *:nth-child(5) { animation-delay: 200ms; }
.mare-theme .mare-stagger > *:nth-child(6) { animation-delay: 250ms; }
.mare-theme .mare-stagger > *:nth-child(7) { animation-delay: 300ms; }
</file>

<file path="src/app/layout.tsx">
import type { Metadata, Viewport } from "next";
import { Geist, Geist_Mono, Playfair_Display } from "next/font/google";
import IOSInstallPrompt from "@/components/IOSInstallPrompt";
import "./globals.css";

const geistSans = Geist({
  variable: "--font-geist-sans",
  subsets: ["latin"],
});

const geistMono = Geist_Mono({
  variable: "--font-geist-mono",
  subsets: ["latin"],
});

const playfair = Playfair_Display({
  variable: "--font-playfair",
  subsets: ["latin"],
});

import { Fredoka, DM_Serif_Display, Plus_Jakarta_Sans, JetBrains_Mono } from "next/font/google";

const fredoka = Fredoka({
  variable: "--font-fredoka",
  subsets: ["latin"],
  weight: ["400", "500", "600", "700"],
});

/* â”€â”€â”€ Mare CafÃ© â€” Fuentes Premium â”€â”€â”€ */
const dmSerif = DM_Serif_Display({
  variable: "--font-dm-serif",
  subsets: ["latin"],
  weight: ["400"],
});

const plusJakarta = Plus_Jakarta_Sans({
  variable: "--font-jakarta",
  subsets: ["latin"],
  weight: ["400", "500", "600", "700"],
});

const jetbrainsMono = JetBrains_Mono({
  variable: "--font-jetbrains",
  subsets: ["latin"],
  weight: ["400", "500"],
});

import { getShopConfig } from "@/lib/shop-service";
import { ClientConfigProvider } from "@/context/ClientConfigContext";

const CLIENT_CODE = process.env.NEXT_PUBLIC_CLIENT_CODE || 'mare_cafe';

export async function generateMetadata(): Promise<Metadata> {
  const config = await getShopConfig(CLIENT_CODE);

  if (!config) return { title: 'Loyalty App' };

  const icon = config.assets.favicon || config.assets.logo;

  return {
    title: `${config.name} Loyalty`,
    description: config.texts.welcomeSubtitle || "Tu tarjeta de fidelidad digital",
    manifest: "/manifest.webmanifest",
    icons: {
      icon: icon,
      apple: icon,
    },
  };
}

export const viewport: Viewport = {
  themeColor: "#000000",
  width: "device-width",
  initialScale: 1,
  maximumScale: 1,
};

export default async function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  const config = await getShopConfig(CLIENT_CODE);

  // If config fails to load, we should probably show a critical error or fallback
  // For now, we'll let it pass as null to context (which throws) or handle it gracefully?
  // The service returns a default config on error, so it should be fine.

  return (
    <html lang="en">
      <body
        className={`${geistSans.variable} ${geistMono.variable} ${playfair.variable} ${fredoka.variable} ${dmSerif.variable} ${plusJakarta.variable} ${jetbrainsMono.variable} antialiased`}
        style={{
          '--brand-primary': config?.theme.primaryColor || '#000000',
          '--brand-secondary': config?.theme.secondaryColor || '#ffffff',
          '--font-brand': config?.theme.fontFamily || 'sans-serif',
        } as React.CSSProperties}
      >
        {config ? (
          <ClientConfigProvider config={config}>
            {children}
            <IOSInstallPrompt />
          </ClientConfigProvider>
        ) : (
          <div className="flex items-center justify-center h-screen bg-slate-50 text-slate-800 font-bold">
            Error loading shop configuration.
          </div>
        )}

      </body>
    </html>
  );
}
</file>

<file path="src/components/client/ClientHeader.tsx">
'use client';

import { useState } from "react";
import Image from "next/image";
import { useRouter } from "next/navigation";
import { LogOut, Bell } from "lucide-react";
import { supabase } from "@/lib/supabase";
import { ClientConfig } from "@/config/types";

interface ClientHeaderProps {
    config: ClientConfig;
    userName?: string;
    level?: number;
}

export default function ClientHeader({ config, userName = "Cliente", level = 1 }: ClientHeaderProps) {
    const router = useRouter();
    const [showNotifications, setShowNotifications] = useState(false);

    const hasLogo = config.assets?.logo;
    const logoIsProtagonist = config.code === 'perezoso_cafe';

    const handleLogout = async () => {
        await supabase.auth.signOut();
        router.push('/');
    };

    return (
        <header className="fixed w-full top-0 z-20 transition-all duration-300">
            <div
                className="px-5 pt-12 pb-4 flex items-center justify-between shadow-sm"
                style={{ backgroundColor: config.theme.primaryColor }}
            >
                <div className="flex items-center gap-4">
                    {/* Logo como protagonista (especialmente para Perezoso) */}
                    <div className={`flex-shrink-0 flex items-center justify-center overflow-hidden rounded-xl ${logoIsProtagonist ? 'h-20 w-20 bg-white/5' : 'h-10 w-10 bg-white/10'} backdrop-blur-sm`}>
                        {hasLogo ? (
                            <Image
                                src={config.assets!.logo}
                                alt={config.name}
                                width={logoIsProtagonist ? 80 : 40}
                                height={logoIsProtagonist ? 80 : 40}
                                className="object-contain"
                            />
                        ) : (
                            <span className="text-xl">{config.code === 'perezoso_cafe' ? 'ðŸ¦¥' : 'â˜•'}</span>
                        )}
                    </div>
                    <div>
                        {!logoIsProtagonist && (
                            <p className="text-white font-bold text-base leading-tight tracking-wide">
                                {config.name}
                            </p>
                        )}
                        <p className={`text-white font-bold mt-0.5 ${logoIsProtagonist ? 'text-2xl' : 'text-base'}`}>
                            Hola, {userName}
                        </p>
                    </div>
                </div>

                <div className="flex items-center gap-2">
                    {level > 1 && (
                        <span className="bg-amber-400/20 text-amber-300 text-[10px] px-2.5 py-1 rounded-full font-bold border border-amber-400/30 backdrop-blur-sm">
                            â˜… Lv {level}
                        </span>
                    )}

                    {/* Notifications */}
                    <div className="relative">
                        <button
                            onClick={() => setShowNotifications(!showNotifications)}
                            className="w-9 h-9 rounded-xl bg-white/10 flex items-center justify-center text-white/80 hover:bg-white/20 transition-colors backdrop-blur-sm relative"
                        >
                            <Bell size={18} />
                            <span className="absolute top-2 right-2.5 w-1.5 h-1.5 bg-red-500 rounded-full border border-[#2E2333]"></span>
                        </button>

                        {showNotifications && (
                            <div className="absolute top-12 right-0 w-64 bg-white rounded-2xl shadow-xl border border-gray-100 p-4 animate-in fade-in zoom-in-50 duration-200 z-50">
                                <h3 className="text-gray-900 font-bold text-sm mb-3">Novedades</h3>
                                <div className="space-y-3">
                                    <div className="flex gap-3 items-start p-2 hover:bg-gray-50 rounded-lg transition-colors">
                                        <div className="w-2 h-2 mt-1.5 rounded-full bg-amber-500 flex-shrink-0" />
                                        <div>
                                            <p className="text-gray-800 text-xs font-medium">Â¡Se acerca un evento!</p>
                                            <p className="text-gray-400 text-[10px]">Hace 2 horas</p>
                                        </div>
                                    </div>
                                    <div className="flex gap-3 items-start p-2 hover:bg-gray-50 rounded-lg transition-colors">
                                        <div className="w-2 h-2 mt-1.5 rounded-full bg-blue-500 flex-shrink-0" />
                                        <div>
                                            <p className="text-gray-800 text-xs font-medium">Tenemos productos nuevos</p>
                                            <p className="text-gray-400 text-[10px]">Ayer</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>

                    {/* Logout */}
                    <button
                        onClick={handleLogout}
                        className="w-9 h-9 rounded-xl bg-white/10 flex items-center justify-center text-white/80 hover:bg-red-500/20 hover:text-red-200 transition-colors backdrop-blur-sm"
                    >
                        <LogOut size={18} />
                    </button>
                </div>
            </div>
        </header>
    );
}
</file>

<file path="src/app/client/page.tsx">
'use client';

import { useClientConfig } from '@/context/ClientConfigContext';
import { useEffect, useState } from 'react';
import dynamic from 'next/dynamic';

/* â”€â”€â”€ Layout Dedicado: Perezoso â”€â”€â”€ */
const PerezosoClient = dynamic(() => import('@/components/client/layouts/PerezosoClient'), {
  loading: () => <div className="flex h-screen items-center justify-center bg-gray-50 text-slate-900">Cargando...</div>
});

/* â”€â”€â”€ Layout Dedicado: Mare CafÃ© (Premium Editorial) â”€â”€â”€ */
const MareClient = dynamic(() => import('@/components/client/layouts/MareClient'), {
  loading: () => (
    <div style={{ minHeight: '100vh', background: '#FAF8F4', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
      <span style={{ color: '#8C8B88', fontSize: 14 }}>Cargando Mare...</span>
    </div>
  )
});

/* â”€â”€â”€ Layout GenÃ©rico (Fallback para futuros clientes) â”€â”€â”€ */
const StandardClient = dynamic(() => import('@/components/client/layouts/StandardClient'), {
  loading: () => <div className="flex h-screen items-center justify-center bg-gray-50 text-slate-900">Cargando...</div>
});

export default function ClientPage() {
  const config = useClientConfig();
  const [mounted, setMounted] = useState(false);

  useEffect(() => {
    setMounted(true);
  }, []);

  if (!mounted) return null;

  // ðŸ­ Factory: enruta al layout dedicado segÃºn el cÃ³digo del cliente
  if (config.code === 'perezoso_cafe') {
    return <PerezosoClient />;
  }

  if (config.code === 'mare_cafe') {
    return <MareClient />;
  }

  // Fallback genÃ©rico para futuros clientes
  return <StandardClient />;
}
</file>

<file path="next.config.ts">
import type { NextConfig } from "next";
import withPWAInit from "@ducanh2912/next-pwa";

const withPWA = withPWAInit({
  dest: "public",
  disable: process.env.NODE_ENV === "development", // Disable in dev to avoid noise
  register: true,
});

const nextConfig: NextConfig = {
  images: {
    remotePatterns: [
      {
        protocol: 'https',
        hostname: '**',
      },
    ],
  },

  experimental: {
  },
  turbopack: {
    root: process.cwd(),
  },
};

export default withPWA(nextConfig);
</file>

<file path="src/app/admin/page.tsx">
'use client';

import { useClientConfig } from '@/context/ClientConfigContext';
import { useEffect, useState } from 'react';
import dynamic from 'next/dynamic';

/* â”€â”€â”€ Dashboard Dedicado: Perezoso â”€â”€â”€ */
const PerezosoDashboard = dynamic(() => import('@/components/admin/dashboards/PerezosoDashboard'), {
    loading: () => <div className="flex h-screen items-center justify-center bg-brand-primary text-white font-bold animate-pulse">Cargando Perezoso...</div>
});

/* â”€â”€â”€ Dashboard Dedicado: Mare CafÃ© (Premium Editorial) â”€â”€â”€ */
const MareDashboard = dynamic(() => import('@/components/admin/dashboards/MareDashboard'), {
    loading: () => (
        <div style={{ minHeight: '100vh', background: '#FAF8F4', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
            <span style={{ color: '#8C8B88', fontSize: 14 }}>Cargando Panel Mare...</span>
        </div>
    )
});

/* â”€â”€â”€ Dashboard GenÃ©rico (Fallback para futuros clientes) â”€â”€â”€ */
const StandardDashboard = dynamic(() => import('@/components/admin/dashboards/StandardDashboard'), {
    loading: () => <div className="flex h-screen items-center justify-center bg-slate-50 text-slate-900 font-medium">Cargando Panel...</div>
});

export default function AdminPage() {
    const config = useClientConfig();
    const [mounted, setMounted] = useState(false);

    useEffect(() => {
        setMounted(true);
    }, []);

    if (!mounted) return null; // Avoid hydration mismatch

    // ðŸ­ Factory: enruta al dashboard dedicado segÃºn el cÃ³digo del cliente
    if (config.code === 'perezoso_cafe') {
        return <PerezosoDashboard />;
    }

    if (config.code === 'mare_cafe') {
        return <MareDashboard />;
    }

    // Fallback genÃ©rico para futuros clientes
    return <StandardDashboard />;
}
</file>

</files>
